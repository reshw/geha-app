This file is a merged representation of a subset of the codebase, containing files not matching ignore patterns, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of a subset of the repository's contents that is considered the most important context.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching these patterns are excluded: **/node_modules/**, **/dist/**, **/.next/**, **/public/images/**, **/*.png, **/*.jpg
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.claude/settings.local.json
.gitignore
ALIMTALK_INTEGRATION.md
capacitor.config.json
deno.lock
DESIGN_UPDATE_GUIDE.md
docs/SETTLEMENT_AUTO_CLOSE_SETUP.md
docs/SETTLEMENT_TESTING.md
docs/TMP.HTML
eslint.config.js
index.html
ios/.gitignore
ios/App/App.xcodeproj/project.pbxproj
ios/App/App.xcodeproj/project.xcworkspace/xcshareddata/IDEWorkspaceChecks.plist
ios/App/App/AppDelegate.swift
ios/App/App/Assets.xcassets/AppIcon.appiconset/Contents.json
ios/App/App/Assets.xcassets/Contents.json
ios/App/App/Assets.xcassets/Splash.imageset/Contents.json
ios/App/App/Base.lproj/LaunchScreen.storyboard
ios/App/App/Base.lproj/Main.storyboard
ios/App/App/Info.plist
ios/App/CapApp-SPM/.gitignore
ios/App/CapApp-SPM/Package.swift
ios/App/CapApp-SPM/README.md
ios/App/CapApp-SPM/Sources/CapApp-SPM/CapApp-SPM.swift
ios/debug.xcconfig
MIGRATION_SUMMARY.md
netlify.toml
netlify/functions/check-ip.js
netlify/functions/process-praise.js
netlify/functions/send-alimtalk-proxy.js
netlify/functions/send-alimtalk.js
netlify/functions/send-email.js
netlify/functions/send-notification.js
netlify/functions/send-pending-expense-reminder.js
netlify/functions/send-praise-notification.js
netlify/functions/settlement-auto-close.js
package.json
postcss.config.js
public/_redirects
public/vite.svg
README.md
src/App.css
src/App.jsx
src/components/auth/KakaoCallback.jsx
src/components/auth/KakaoLogin.jsx
src/components/auth/LoginOverlay.jsx
src/components/bartender/BartenderMenuFormModal.jsx
src/components/bartender/BartenderOrderDetailModal.jsx
src/components/bartender/BartenderOrderModal.jsx
src/components/calendar/Calendar.jsx
src/components/common/BottomNav.jsx
src/components/common/Loading.jsx
src/components/common/MainLayout.jsx
src/components/common/Modal.jsx
src/components/expenses/ExpenseDetailModal.jsx
src/components/praise/PraiseCard.jsx
src/components/praise/PraiseDetailModal.jsx
src/components/praise/PraiseModal.jsx
src/components/reservations/CancelReservationModal.jsx
src/components/reservations/CreateMealGatheringModal.jsx
src/components/reservations/GatheringDetailModal.jsx
src/components/reservations/HostSearchInput.jsx
src/components/reservations/MealGatheringCard.jsx
src/components/reservations/MealGatheringModal.jsx
src/components/reservations/MealIndicator.jsx
src/components/reservations/MealParticipantListModal.jsx
src/components/reservations/ReservationDetailModal.jsx
src/components/reservations/ReservationEditModal.jsx
src/components/reservations/ReservationManageModal.jsx
src/components/reservations/ReservationModal.jsx
src/components/reservations/SimpleMealModal.jsx
src/components/reservations/WeeklyCalendarView.jsx
src/components/reservations/WeeklyList.jsx
src/components/settings/EmailNotificationSettings.jsx
src/components/settings/SettlementScheduleSettings.jsx
src/components/settlement/ParticipantDetailModal.jsx
src/components/settlement/ReceiptDetailModal.jsx
src/components/settlement/SettlementTableView.jsx
src/components/space/CreateSpaceModal.jsx
src/components/space/SpaceDropdown.jsx
src/components/tour/TourAutoLauncher.jsx
src/components/tour/TourOverlay.jsx
src/config/firebase.js
src/contexts/TourContext.jsx
src/data/tourData.js
src/hooks/useAuth.js
src/hooks/useReservations.js
src/index.css
src/main.jsx
src/pages/AlimtalkSettingsPage.jsx
src/pages/BartenderManagePage.jsx
src/pages/BartenderMenuPage.jsx
src/pages/BartenderOrderListPage.jsx
src/pages/EmailTestPage.jsx
src/pages/ExpenseListPage.jsx
src/pages/ExpenseRequestPage.jsx
src/pages/GuestPolicySettingsPage.jsx
src/pages/IntroductionPage.jsx
src/pages/JoinSpacePage.jsx
src/pages/MemberManagePage.jsx
src/pages/MigrationPage.jsx
src/pages/MorePage.jsx
src/pages/PraisePage.jsx
src/pages/PrivacyPolicyPage.jsx
src/pages/ReservationStatsPage.jsx
src/pages/SettlementPage.jsx
src/pages/SettlementSchedulePage.jsx
src/pages/SettlementSettingsPage.jsx
src/pages/SettlementSubmitPage.jsx
src/pages/SignupDemoPage.jsx
src/pages/SignupPage.jsx
src/pages/SlopesPage.jsx
src/pages/SpaceManagePage.jsx
src/pages/SpaceSettingsPage.jsx
src/pages/SuperAdminPage.jsx
src/pages/TermsOfServicePage.jsx
src/pages/TestDataPage.jsx
src/pages/TransferManagerPage.jsx
src/pages/UserGuidePage.jsx
src/services/adminSettingsService.js
src/services/authService.js
src/services/bartenderService.js
src/services/expenseService.js
src/services/mealGatheringService.js
src/services/migrateExpenses.js
src/services/notificationService.js
src/services/praiseService.js
src/services/reservationService.js
src/services/settlementService.js
src/services/simpleMealService.js
src/services/spaceService.js
src/services/spaceSettingsService.js
src/services/tourService.js
src/store/useStore.js
src/utils/constants.js
src/utils/dateUtils.js
src/utils/imageUpload.js
src/utils/nicknameUtils.js
src/utils/permissions.js
tailwind.config.js
vite.config.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs['recommended-latest'],
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])
</file>

<file path="netlify/functions/check-ip.js">
const axios = require('axios');

exports.handler = async (event) => {
  const headers = {
    'Access-Control-Allow-Origin': '*',
    'Access-Control-Allow-Headers': 'Content-Type',
    'Access-Control-Allow-Methods': 'GET, OPTIONS'
  };

  if (event.httpMethod === 'OPTIONS') {
    return { statusCode: 200, headers, body: '' };
  }

  try {
    // ì™¸ë¶€ ì„œë¹„ìŠ¤ë¡œ í˜„ì¬ IP í™•ì¸
    const response = await axios.get('https://api.ipify.org?format=json');
    const ip = response.data.ip;
    
    return {
      statusCode: 200,
      headers,
      body: JSON.stringify({
        success: true,
        ip: ip,
        message: `í˜„ì¬ Netlify Functions IP: ${ip}`
      })
    };
  } catch (error) {
    return {
      statusCode: 500,
      headers,
      body: JSON.stringify({
        success: false,
        error: error.message
      })
    };
  }
};
</file>

<file path="netlify/functions/send-alimtalk.js">
const axios = require('axios');

exports.handler = async (event) => {
  // CORS í—¤ë”
  const headers = {
    'Access-Control-Allow-Origin': '*',
    'Access-Control-Allow-Headers': 'Content-Type',
    'Access-Control-Allow-Methods': 'POST, OPTIONS'
  };

  // OPTIONS ìš”ì²­ ì²˜ë¦¬
  if (event.httpMethod === 'OPTIONS') {
    return { statusCode: 200, headers, body: '' };
  }

  try {
    const data = JSON.parse(event.body);

    // í•„ìˆ˜ í•„ë“œ ê²€ì¦
    const required = ['name', 'phone', 'checkIn', 'checkOut'];
    for (const field of required) {
      if (!data[field]) {
        throw new Error(`Missing required field: ${field}`);
      }
    }

    // ì „í™”ë²ˆí˜¸ ì •ì œ (í•˜ì´í”ˆ ë“± ì œê±°)
    const phone = data.phone.replace(/[^0-9]/g, '');
    if (phone.length < 10) {
      throw new Error('Invalid phone number format');
    }

    // ë‚ ì§œ ê³„ì‚°
    const checkinDate = new Date(data.checkIn);
    const checkoutDate = new Date(data.checkOut);
    const nights = Math.floor((checkoutDate - checkinDate) / (1000 * 60 * 60 * 24));
    const days = nights + 1;
    const cost = nights * 30000;

    // í˜„ê´€ ë¹„ë°€ë²ˆí˜¸ (ì „í™”ë²ˆí˜¸ ë’¤ 4ìë¦¬)
    const password = phone.slice(-4);

    // ê³„ì¢Œ ì •ë³´
    const accountInfo = process.env.ALIGO_ACCOUNT || 'ì¹´ì¹´ì˜¤ë±…í¬ 7979-38-83356 ì–‘ì„í™˜';

    // ì•Œë¦¼í†¡ ë©”ì‹œì§€ ìƒì„± (PHP í…œí”Œë¦¿ê³¼ ë™ì¼)
    let message = `${data.name}ë‹˜(êº„ì•„)\n`;
    message += `ì¡°ê°• 308 ê²ŒìŠ¤íŠ¸ ì˜ˆì•½ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n`;
    message += `[ì˜ˆì•½ì•ˆë‚´]\n`;
    message += `Â· ì…ì‹¤ì¼ : ${data.checkIn}\n`;
    message += `Â· í‡´ì‹¤ì¼ : ${data.checkOut}\n`;
    message += `   - ${nights}ë°• ${days}ì¼\n\n`;
    message += `[ì´ìš©ë£Œ]\n`;
    message += `Â· ê²ŒìŠ¤íŠ¸ ë¹„ìš© : ${cost.toLocaleString()}ì›(3ë§Œì›/1ë°•)\n`;
    message += `Â· ${accountInfo}\n\n`;
    message += `[í˜„ê´€ ë²ˆí˜¸] : ${password}11*\n`;
    message += `(ì…ì‹¤ì¼~í‡´ì‹¤ì¼ì—ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤)`;

    if (data.memo) {
      message += `\n\n[ë©”ëª¨]\n${data.memo}`;
    }

    // ì•Œë¦¼í†¡ ë°œì†¡ (alimtalkEnabledê°€ trueì¼ ë•Œë§Œ)
    let alimtalkResult = null;
    if (data.alimtalkEnabled === true) {
      const response = await axios.post(
        'https://kakaoapi.aligo.in/akv10/alimtalk/send/',
        new URLSearchParams({
          apikey: process.env.ALIGO_API_KEY,
          userid: process.env.ALIGO_USER_ID,
          senderkey: process.env.ALIGO_SENDER_KEY,
          tpl_code: 'TW_5514', // PHPì—ì„œ ì‚¬ìš©í•˜ë˜ í…œí”Œë¦¿ ì½”ë“œ
          sender: process.env.ALIGO_SENDER,
          receiver_1: phone,
          subject_1: 'JH308',
          message_1: message,
          emtitle_1: 'ê²ŒìŠ¤íŠ¸ ì˜ˆì•½ì•ˆë‚´',
          button_1: JSON.stringify({
            button: [{
              name: 'ê²ŒìŠ¤íŠ¸ í˜„í™© ë³´ê¸°',
              linkType: 'WL',
              linkM: 'https://www.lunagarden.co.kr/guest'
            }]
          })
        }).toString(),
        {
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          }
        }
      );

      alimtalkResult = response.data;
      console.log('Alimtalk response:', alimtalkResult);
    }

    // ì‘ë‹µ ì¤€ë¹„
    const result = {
      success: true,
      alimtalk: data.alimtalkEnabled === true ? {
        success: alimtalkResult?.code === 0,
        message: alimtalkResult?.code === 0 ? 'ì•Œë¦¼í†¡ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ì•Œë¦¼í†¡ ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.',
        detail: alimtalkResult
      } : {
        success: null,
        message: 'ì•Œë¦¼í†¡ ê¸°ëŠ¥ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.'
      }
    };

    return {
      statusCode: 200,
      headers,
      body: JSON.stringify(result)
    };

  } catch (error) {
    console.error('Alimtalk function error:', error);
    return {
      statusCode: 500,
      headers,
      body: JSON.stringify({ 
        success: false, 
        message: error.message,
        debug: {
          error_type: error.constructor.name
        }
      })
    };
  }
};
</file>

<file path="postcss.config.js">
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
</file>

<file path="public/_redirects">
/*    /index.html   200
</file>

<file path="public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="README.md">
# ğŸ  ë¼ìš´ì§€ ì˜ˆì•½ ì‹œìŠ¤í…œ (ë¦¬íŒ©í† ë§ ì™„ë£Œ)

ê¹”ë”í•˜ê²Œ ì¬ì‘ì„±ëœ ë¼ìš´ì§€ ì˜ˆì•½ ê´€ë¦¬ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜

## âœ¨ íŠ¹ì§•

- ğŸ“¦ **ë‹¨ìˆœí•œ êµ¬ì¡°** - í•µì‹¬ ê¸°ëŠ¥ë§Œ êµ¬í˜„
- ğŸ¯ **ëª…í™•í•œ ì±…ì„** - Service/Hook/Component ë¶„ë¦¬
- ğŸ”§ **í™•ì¥ ê°€ëŠ¥** - ëª¨ë‹¬, ìŠ¤í˜ì´ìŠ¤ ê´€ë¦¬ ë“± ì‰½ê²Œ ì¶”ê°€ ê°€ëŠ¥
- ğŸ“± **ë°˜ì‘í˜•** - ëª¨ë°”ì¼ ìµœì í™”

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

```bash
# 1. íŒ¨í‚¤ì§€ ì„¤ì¹˜
npm install

# 2. í™˜ê²½ë³€ìˆ˜ ì„¤ì •
cp .env.example .env
# .env íŒŒì¼ í¸ì§‘

# 3. ì‹¤í–‰
npm run dev
```

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ auth/           # ì¸ì¦ (KakaoLogin, LoginOverlay)
â”‚   â”œâ”€â”€ calendar/       # ìº˜ë¦°ë” ë©”ì¸
â”‚   â””â”€â”€ common/         # ê³µí†µ (Loading, Modal)
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useAuth.js      # ì¸ì¦ í›…
â”‚   â””â”€â”€ useReservations.js  # ì˜ˆì•½ ê´€ë¦¬ í›…
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ authService.js
â”‚   â”œâ”€â”€ reservationService.js
â”‚   â””â”€â”€ spaceService.js
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ constants.js
â”‚   â”œâ”€â”€ dateUtils.js
â”‚   â””â”€â”€ permissions.js
â”œâ”€â”€ store/
â”‚   â””â”€â”€ useStore.js     # Zustand ì „ì—­ ìƒíƒœ
â””â”€â”€ config/
    â””â”€â”€ firebase.js
```

## ğŸ¯ êµ¬í˜„ ì™„ë£Œ

- âœ… ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸
- âœ… ìº˜ë¦°ë” UI
- âœ… ì˜ˆì•½ ì¡°íšŒ
- âœ… ê¶Œí•œë³„ ì ‘ê·¼ ì œì–´
- âœ… ìŠ¤í˜ì´ìŠ¤ ì „í™˜

## ğŸ“ ë‹¤ìŒ ë‹¨ê³„ (ì¶”ê°€ ê°œë°œ)

- [ ] ì˜ˆì•½ ìƒì„± ëª¨ë‹¬
- [ ] ì˜ˆì•½ ì·¨ì†Œ ê¸°ëŠ¥
- [ ] ìŠ¤í˜ì´ìŠ¤ ê´€ë¦¬ UI
- [ ] í”„ë¡œí•„ ì´ë¯¸ì§€ í‘œì‹œ
- [ ] ì•Œë¦¼í†¡ ì—°ë™

## ğŸ”‘ í™˜ê²½ë³€ìˆ˜

```env
VITE_FIREBASE_API_KEY=your_key
VITE_FIREBASE_AUTH_DOMAIN=your_domain
VITE_FIREBASE_PROJECT_ID=your_project
VITE_FIREBASE_STORAGE_BUCKET=your_bucket
VITE_FIREBASE_MESSAGING_SENDER_ID=your_sender
VITE_FIREBASE_APP_ID=your_app_id

VITE_KAKAO_REST_API_KEY=your_kakao_key
VITE_KAKAO_REDIRECT_URI=http://localhost:5173/auth/kakao/callback
```

---

**ê¹”ë”í•˜ê²Œ ë¦¬íŒ©í† ë§ ì™„ë£Œ!** ğŸ‰
</file>

<file path="src/App.css">
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}
</file>

<file path="src/components/auth/LoginOverlay.jsx">
import KakaoLogin from './KakaoLogin';

const LoginOverlay = () => {
  return (
    <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center">
      <div className="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
        <h2 className="text-2xl font-bold mb-3">ë¼ìš´ì§€ ì˜ˆì•½ ì‹œìŠ¤í…œ</h2>
        <p className="text-gray-600 mb-8">
          ì˜ˆì•½ í˜„í™©ì„ í™•ì¸í•˜ê³  ì˜ˆì•½í•˜ë ¤ë©´<br />
          ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤
        </p>
        <div className="flex justify-center">
          <KakaoLogin />
        </div>
      </div>
    </div>
  );
};

export default LoginOverlay;
</file>

<file path="src/components/calendar/Calendar.jsx">
import { useState, useEffect } from 'react';
import { ChevronLeft, ChevronRight } from 'lucide-react';
import { useAuth } from '../../hooks/useAuth';
import { useReservations } from '../../hooks/useReservations';
import useStore from '../../store/useStore';
import spaceService from '../../services/spaceService';
import LoginOverlay from '../auth/LoginOverlay';
import Loading from '../common/Loading';
import { formatYearMonth, getCalendarDays, formatDate, isToday, isPastDate } from '../../utils/dateUtils';
import { WEEK_DAYS } from '../../utils/constants';
import { canReserveOnDate } from '../../utils/permissions';

const Calendar = () => {
  const { user, isLoggedIn } = useAuth();
  const { selectedSpace, setSelectedSpace } = useStore();
  const [currentDate, setCurrentDate] = useState(new Date());
  const [userSpaces, setUserSpaces] = useState([]);
  const [loading, setLoading] = useState(true);
  
  const { reservations, loading: reservationsLoading } = useReservations(selectedSpace?.id);
  
  // ì‚¬ìš©ì ìŠ¤í˜ì´ìŠ¤ ë¡œë“œ
  useEffect(() => {
    const loadSpaces = async () => {
      if (!user?.id) return;
      
      setLoading(true);
      const spaces = await spaceService.getUserSpaces(user.id);
      setUserSpaces(spaces);
      
      if (spaces.length > 0 && !selectedSpace) {
        setSelectedSpace(spaces[0]);
      }
      setLoading(false);
    };
    
    loadSpaces();
  }, [user, selectedSpace, setSelectedSpace]);
  
  const prevMonth = () => {
    setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1));
  };
  
  const nextMonth = () => {
    setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1));
  };
  
  const handleDateClick = (day) => {
    if (!day) return;
    const date = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
    const userType = selectedSpace?.userType;
    
    if (!canReserveOnDate(userType, date)) {
      alert('ì´ ë‚ ì§œëŠ” ì˜ˆì•½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
      return;
    }
    
    alert(`ì˜ˆì•½ ëª¨ë‹¬ - ${formatDate(date)}`);
  };
  
  const renderReservations = (day) => {
    const date = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
    const dateStr = formatDate(date);
    const dayReservations = reservations[dateStr] || [];
    
    if (dayReservations.length === 0) return null;
    
    return (
      <div className="text-xs text-blue-600 font-medium">
        {dayReservations.length}ê±´
      </div>
    );
  };
  
  if (!isLoggedIn) {
    return <LoginOverlay />;
  }
  
  if (loading) {
    return <Loading />;
  }
  
  return (
    <div className="max-w-7xl mx-auto p-4">
      {/* í—¤ë” */}
      <div className="flex items-center justify-between mb-4">
        <h2 className="text-2xl font-bold">
          {selectedSpace?.name} - {formatYearMonth(currentDate)}
        </h2>
        <div className="flex gap-2">
          <button onClick={prevMonth} className="p-2 hover:bg-gray-100 rounded-lg">
            <ChevronLeft className="w-5 h-5" />
          </button>
          <button onClick={nextMonth} className="p-2 hover:bg-gray-100 rounded-lg">
            <ChevronRight className="w-5 h-5" />
          </button>
        </div>
      </div>
      
      {/* ìŠ¤í˜ì´ìŠ¤ ì„ íƒ */}
      {userSpaces.length > 1 && (
        <div className="mb-4">
          <select 
            value={selectedSpace?.id || ''} 
            onChange={(e) => {
              const space = userSpaces.find(s => s.id === e.target.value);
              setSelectedSpace(space);
            }}
            className="px-4 py-2 border rounded-lg"
          >
            {userSpaces.map(space => (
              <option key={space.id} value={space.id}>
                {space.name} ({space.userType})
              </option>
            ))}
          </select>
        </div>
      )}
      
      {/* ìº˜ë¦°ë” */}
      {reservationsLoading ? (
        <Loading />
      ) : (
        <div className="grid grid-cols-7 gap-2">
          {/* ìš”ì¼ í—¤ë” */}
          {WEEK_DAYS.map((day, index) => (
            <div 
              key={day} 
              className={`text-center py-2 font-medium ${
                index === 0 ? 'text-red-500' : index === 6 ? 'text-blue-500' : ''
              }`}
            >
              {day}
            </div>
          ))}
          
          {/* ë‚ ì§œ ì…€ */}
          {getCalendarDays(currentDate.getFullYear(), currentDate.getMonth()).map((day, index) => {
            if (!day) {
              return <div key={index} className="min-h-[100px] bg-gray-50 rounded-lg" />;
            }
            
            const date = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
            const isPast = isPastDate(date);
            const dayOfWeek = date.getDay();
            
            return (
              <div
                key={index}
                onClick={() => handleDateClick(day)}
                className={`
                  min-h-[100px] border rounded-lg p-2 cursor-pointer relative
                  ${isPast ? 'bg-gray-50' : 'hover:bg-blue-50'}
                  ${isToday(date) ? 'ring-2 ring-blue-500' : ''}
                `}
              >
                <span className={`
                  text-sm font-medium
                  ${isPast ? 'text-gray-400' : ''}
                  ${dayOfWeek === 0 ? 'text-red-500' : dayOfWeek === 6 ? 'text-blue-500' : ''}
                `}>
                  {day}
                </span>
                <div className="mt-2">
                  {renderReservations(day)}
                </div>
              </div>
            );
          })}
        </div>
      )}
    </div>
  );
};

export default Calendar;
</file>

<file path="src/components/common/Loading.jsx">
const Loading = () => (
  <div className="flex justify-center items-center h-40">
    <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500" />
  </div>
);

export default Loading;
</file>

<file path="src/config/firebase.js">
import { initializeApp } from 'firebase/app';
import { getFirestore } from 'firebase/firestore';

const firebaseConfig = {
  apiKey: import.meta.env.VITE_FIREBASE_API_KEY,
  authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,
  projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,
  storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,
  appId: import.meta.env.VITE_FIREBASE_APP_ID
};

const app = initializeApp(firebaseConfig);
export const db = getFirestore(app);
</file>

<file path="src/hooks/useAuth.js">
import { useEffect } from 'react';
import useStore from '../store/useStore';
import authService from '../services/authService';

export const useAuth = () => {
  const { user, isLoggedIn, setUser, logout } = useStore();
  
  useEffect(() => {
    const storedUser = localStorage.getItem('userData');
    if (storedUser && !user) {
      const userData = JSON.parse(storedUser);
      authService.getUserData(userData.id).then((fullUserData) => {
        if (fullUserData) {
          setUser(fullUserData);
        }
      });
    }
  }, [user, setUser]);
  
  const login = async (userData) => {
    localStorage.setItem('userData', JSON.stringify(userData));
    const fullUserData = await authService.getUserData(userData.id);
    setUser(fullUserData);
  };
  
  const handleLogout = () => {
    localStorage.removeItem('userData');
    logout();
  };
  
  return { user, isLoggedIn, login, logout: handleLogout };
};
</file>

<file path="src/main.jsx">
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.jsx'

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <App />
  </StrictMode>,
)
</file>

<file path="src/utils/dateUtils.js">
export const formatDate = (date) => {
  if (!date) return '';
  const d = new Date(date);
  return d.toLocaleDateString('ko-KR', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    timeZone: 'Asia/Seoul'
  }).replace(/\. /g, '-').replace('.', '');
};

export const formatYearMonth = (date) => {
  return `${date.getFullYear()}ë…„ ${date.getMonth() + 1}ì›”`;
};

export const isToday = (date) => {
  const today = new Date();
  return (
    date.getDate() === today.getDate() &&
    date.getMonth() === today.getMonth() &&
    date.getFullYear() === today.getFullYear()
  );
};

export const isPastDate = (date) => {
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  const compareDate = new Date(date);
  compareDate.setHours(0, 0, 0, 0);
  return compareDate < today;
};

export const getCalendarDays = (year, month) => {
  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  const days = [];
  
  for (let i = 0; i < firstDay; i++) {
    days.push(null);
  }
  
  for (let i = 1; i <= daysInMonth; i++) {
    days.push(i);
  }
  
  return days;
};

export const formatWeekDay = (date) => {
  const weekDays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
  return weekDays[date.getDay()];
};

export const getWeekDates = (startDate) => {
  const dates = [];
  for (let i = 0; i < 7; i++) {
    const date = new Date(startDate);
    date.setDate(startDate.getDate() + i);
    dates.push(date);
  }
  return dates;
};
</file>

<file path="tailwind.config.js">
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      animation: {
        'fadeIn': 'fadeIn 0.3s ease-in-out',
      },
      keyframes: {
        fadeIn: {
          '0%': { opacity: '0', transform: 'translateY(-10px)' },
          '100%': { opacity: '1', transform: 'translateY(0)' },
        }
      }
    },
  },
  plugins: [],
}
</file>

<file path="ALIMTALK_INTEGRATION.md">
# ì•Œë¦¼í†¡/ì´ë©”ì¼ í†µí•© ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

PHP ê¸°ë°˜ ì™¸ë¶€ í˜¸ìŠ¤íŒ…ì„ Netlify Functionsë¡œ ì™„ì „íˆ ë‚´ì¬í™”í–ˆìŠµë‹ˆë‹¤.

### ê¸°ì¡´ êµ¬ì¡° (PHP)
```
ì™¸ë¶€ í˜¸ìŠ¤íŒ… ì„œë²„
â”œâ”€â”€ config.php (API ì¸ì¦ ì •ë³´)
â”œâ”€â”€ send_alimtalk.php (ì•Œë¦¼í†¡ + ì´ë©”ì¼ ì²˜ë¦¬)
â””â”€â”€ ì•±ì—ì„œ ì™¸ë¶€ URL í˜¸ì¶œ
```

### ìƒˆë¡œìš´ êµ¬ì¡° (Netlify Functions)11231
```
Netlify Functions
â”œâ”€â”€ send-notification.js (í†µí•©: ì´ë©”ì¼ + ì•Œë¦¼í†¡)
â”œâ”€â”€ send-email.js (ì´ë©”ì¼ë§Œ)
â”œâ”€â”€ send-alimtalk.js (ì•Œë¦¼í†¡ë§Œ)
â””â”€â”€ í™˜ê²½ë³€ìˆ˜ë¡œ ì¸ì¦ ì •ë³´ ê´€ë¦¬
```

## ğŸš€ ì‚¬ìš© ë°©ë²•

### 1. í†µí•© ì—”ë“œí¬ì¸íŠ¸ (ê¶Œì¥)
ì´ë©”ì¼ê³¼ ì•Œë¦¼í†¡ì„ í•œ ë²ˆì— ì²˜ë¦¬í•©ë‹ˆë‹¤.

```javascript
const response = await fetch('/.netlify/functions/send-notification', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    name: 'í™ê¸¸ë™',
    phone: '010-1234-5678',
    checkIn: '2025-11-15',
    checkOut: '2025-11-17',
    gender: 'ë‚¨ì„±',
    birthYear: '1990',
    hostDisplayName: 'ê¹€ì£¼ì£¼',
    spaceName: 'ì¡°ê°•308í˜¸',
    memo: 'íŠ¹ë³„ ìš”ì²­ì‚¬í•­',
    alimtalkEnabled: true  // falseë©´ ì•Œë¦¼í†¡ ë¯¸ë°œì†¡
  })
});

const result = await response.json();
// {
//   success: true,
//   email: { success: true, message: 'ì´ë©”ì¼ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.' },
//   alimtalk: { success: true, message: 'ì•Œë¦¼í†¡ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.' }
// }
```

### 2. ê°œë³„ ì—”ë“œí¬ì¸íŠ¸

#### ì´ë©”ì¼ë§Œ ë°œì†¡
```javascript
await fetch('/.netlify/functions/send-email', {
  method: 'POST',
  body: JSON.stringify({ /* ë™ì¼í•œ ë°ì´í„° */ })
});
```

#### ì•Œë¦¼í†¡ë§Œ ë°œì†¡
```javascript
await fetch('/.netlify/functions/send-alimtalk', {
  method: 'POST',
  body: JSON.stringify({ /* ë™ì¼í•œ ë°ì´í„° */ })
});
```

## ğŸ”‘ í™˜ê²½ë³€ìˆ˜ ì„¤ì •

Netlify ëŒ€ì‹œë³´ë“œì—ì„œ ë‹¤ìŒ í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤:

```bash
# ì•Œë¦¬ê³  (Alimtalk)
ALIGO_API_KEY=aam0a3v7mfcn6ar5sn4mkhiwcmw0kruh
ALIGO_USER_ID=silversh13
ALIGO_SENDER_KEY=2a1782c49b7323eb43017cf41a62730f71407278
ALIGO_SENDER=01031148626
ALIGO_ACCOUNT=ì¹´ì¹´ì˜¤ë±…í¬ 7979-38-83356 ì–‘ì„í™˜

# Resend (Email)
RESEND_API_KEY=re_St6PqQSa_DkQZt8mUPpiRd2RgKuTyDzBb
```

### Netlify í™˜ê²½ë³€ìˆ˜ ì„¤ì • ë°©ë²•
1. Netlify ëŒ€ì‹œë³´ë“œ ì ‘ì†
2. Site settings â†’ Environment variables
3. ìœ„ì˜ ë³€ìˆ˜ë“¤ì„ ê°ê° ì¶”ê°€
4. ì¬ë°°í¬ (ìë™ìœ¼ë¡œ íŠ¸ë¦¬ê±°ë¨)

## ğŸ“§ ì´ë©”ì¼ í…œí”Œë¦¿

PHP í…œí”Œë¦¿ê³¼ ë™ì¼í•œ HTML ì´ë©”ì¼ì´ ë°œì†¡ë©ë‹ˆë‹¤:

- **ìˆ˜ì‹ ì**: reshw@naver.com (ê³ ì •)
- **ë‚´ìš©**:
  - ì˜ˆì•½ ì •ë³´ (ì…ì‹¤ì¼, í‡´ì‹¤ì¼, ìˆ™ë°•ê¸°ê°„)
  - ê²ŒìŠ¤íŠ¸ ì •ë³´ (ì´ë¦„, ì—°ë½ì²˜, ì„±ë³„, ìƒë…„, ì´ˆëŒ€ ì£¼ì£¼)
  - ì´ìš©ë£Œ ì •ë³´ (ì´ì•¡, ê³„ì¢Œë²ˆí˜¸)
  - ë©”ëª¨ (ì„ íƒì‚¬í•­)

## ğŸ’¬ ì•Œë¦¼í†¡ í…œí”Œë¦¿

ê²ŒìŠ¤íŠ¸ì—ê²Œ ë°œì†¡ë˜ëŠ” ì•Œë¦¼í†¡ ë©”ì‹œì§€:

```
í™ê¸¸ë™ë‹˜(êº„ì•„)
ì¡°ê°• 308 ê²ŒìŠ¤íŠ¸ ì˜ˆì•½ë˜ì—ˆìŠµë‹ˆë‹¤.

[ì˜ˆì•½ì•ˆë‚´]
Â· ì…ì‹¤ì¼ : 2025-11-15
Â· í‡´ì‹¤ì¼ : 2025-11-17
   - 2ë°• 3ì¼

[ì´ìš©ë£Œ]
Â· ê²ŒìŠ¤íŠ¸ ë¹„ìš© : 60,000ì›(3ë§Œì›/1ë°•)
Â· ì¹´ì¹´ì˜¤ë±…í¬ 7979-38-83356 ì–‘ì„í™˜

[í˜„ê´€ ë²ˆí˜¸] : 567811*
(ì…ì‹¤ì¼~í‡´ì‹¤ì¼ì—ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤)

[ë©”ëª¨]
íŠ¹ë³„ ìš”ì²­ì‚¬í•­
```

**ì£¼ìš” ê¸°ëŠ¥**:
- í˜„ê´€ ë¹„ë°€ë²ˆí˜¸ ìë™ ìƒì„± (ì „í™”ë²ˆí˜¸ ë’¤ 4ìë¦¬ + "11*")
- ì´ìš©ë£Œ ìë™ ê³„ì‚° (3ë§Œì›/1ë°•)
- ë²„íŠ¼: "ê²ŒìŠ¤íŠ¸ í˜„í™© ë³´ê¸°" â†’ https://www.lunagarden.co.kr/guest

## ğŸ”„ ë§ˆì´ê·¸ë ˆì´ì…˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] PHP config.php â†’ í™˜ê²½ë³€ìˆ˜ë¡œ ì´ì „
- [x] ì´ë©”ì¼ HTML í…œí”Œë¦¿ PHP â†’ JS ë³€í™˜
- [x] ì•Œë¦¼í†¡ ë©”ì‹œì§€ í¬ë§· PHP â†’ JS ë³€í™˜
- [x] ë‚ ì§œ ê³„ì‚° ë¡œì§ ë™ì¼í•˜ê²Œ êµ¬í˜„
- [x] ì—ëŸ¬ ì²˜ë¦¬ ë° ë¡œê¹…
- [x] CORS í—¤ë” ì„¤ì •
- [ ] Netlify í™˜ê²½ë³€ìˆ˜ ì„¤ì •
- [ ] í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ìƒˆ ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œ í…ŒìŠ¤íŠ¸
- [ ] ì‹¤ì œ ë°œì†¡ í…ŒìŠ¤íŠ¸

## ğŸ§ª ë¡œì»¬ í…ŒìŠ¤íŠ¸

```bash
# Netlify CLI ì„¤ì¹˜
npm install -g netlify-cli

# ë¡œì»¬ì—ì„œ Functions í…ŒìŠ¤íŠ¸
netlify dev

# í…ŒìŠ¤íŠ¸ ìš”ì²­
curl -X POST http://localhost:8888/.netlify/functions/send-notification \
  -H "Content-Type: application/json" \
  -d '{
    "name": "í…ŒìŠ¤íŠ¸",
    "phone": "01012345678",
    "checkIn": "2025-11-15",
    "checkOut": "2025-11-17",
    "alimtalkEnabled": true
  }'
```

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **í…œí”Œë¦¿ ì½”ë“œ**: ì•Œë¦¼í†¡ í…œí”Œë¦¿ ì½”ë“œ `TW_5514`ê°€ ì•Œë¦¬ê³ ì— ë“±ë¡ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
2. **ë°œì‹ ë²ˆí˜¸**: `01031148626`ì´ ì•Œë¦¬ê³ ì— ë“±ë¡ëœ ë°œì‹ ë²ˆí˜¸ì—¬ì•¼ í•©ë‹ˆë‹¤.
3. **ì´ë©”ì¼ ë„ë©”ì¸**: Resendì—ì„œ `lunagarden.co.kr` ë„ë©”ì¸ì´ ì¸ì¦ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
4. **ìš”ê¸ˆ**: ì•Œë¦¼í†¡ 1ê±´ë‹¹ ìš”ê¸ˆì´ ë¶€ê³¼ë©ë‹ˆë‹¤. `alimtalkEnabled`ë¡œ ì œì–´í•˜ì„¸ìš”.

## ğŸ“š ì°¸ê³  ë¬¸ì„œ

- [Netlify Functions ë¬¸ì„œ](https://docs.netlify.com/functions/overview/)
- [ì•Œë¦¬ê³  API ë¬¸ì„œ](https://smartsms.aligo.in/admin/api/info.html)
- [Resend API ë¬¸ì„œ](https://resend.com/docs)

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

1. Netlify í™˜ê²½ë³€ìˆ˜ ì„¤ì •
2. í”„ë¡ íŠ¸ì—”ë“œ ì½”ë“œì—ì„œ ìƒˆ ì—”ë“œí¬ì¸íŠ¸ ì—°ë™
3. ì‹¤ì œ ì˜ˆì•½ìœ¼ë¡œ í…ŒìŠ¤íŠ¸
4. ê¸°ì¡´ PHP ì„œë²„ ì œê±°
</file>

<file path="capacitor.config.json">
{
  "appId": "com.loungeapp.mobile",
  "appName": "Lounge App",
  "webDir": "dist"
}
</file>

<file path="deno.lock">
{
  "version": "5",
  "remote": {
    "https://edge.netlify.com/": "fd941d61d88673d5f28aab283fb86fcc50f08a3bc80ee5470498fcfa88c65cfb",
    "https://edge.netlify.com/bootstrap/config.ts": "6a2ce0e544e15e8f8883a5c18da5948e37fd0f2619f68cb31f3af53c51817025",
    "https://edge.netlify.com/bootstrap/context.ts": "72496497b40d9e808f419efc764ecb438952a32f61ed94cd54952fc59f17f69d",
    "https://edge.netlify.com/bootstrap/cookie.ts": "8b0baae708989ca183c6f3b4ab3d029e6abcbc2e43f93edeb0ff447b3bbc3a05",
    "https://edge.netlify.com/bootstrap/edge_function.ts": "b8253e86aa83c67341f5cfedeba5049d77fbf84dcab7eceff7566b7728ae9b39",
    "https://edge.netlify.com/bootstrap/globals/types.ts": "eaa6148ded3121d8dee62dd91c86e7fe76601df0f3ca8d7962243a30f4c8935f"
  },
  "workspace": {
    "packageJson": {
      "dependencies": [
        "npm:@eslint/js@^9.36.0",
        "npm:@types/react-dom@^19.1.9",
        "npm:@types/react@^19.1.16",
        "npm:@vitejs/plugin-react@^5.0.4",
        "npm:autoprefixer@^10.4.20",
        "npm:axios@^1.7.7",
        "npm:clsx@^2.1.1",
        "npm:eslint-plugin-react-hooks@^5.2.0",
        "npm:eslint-plugin-react-refresh@~0.4.22",
        "npm:eslint@^9.36.0",
        "npm:firebase@^10.13.0",
        "npm:globals@^16.4.0",
        "npm:lucide-react@0.446",
        "npm:node-fetch@^2.7.0",
        "npm:postcss@^8.4.45",
        "npm:react-dom@^19.1.1",
        "npm:react-router-dom@^6.26.2",
        "npm:react@^19.1.1",
        "npm:resend@^6.4.2",
        "npm:tailwind-merge@^3.3.1",
        "npm:tailwindcss@^3.4.1",
        "npm:vite@^7.1.7",
        "npm:zustand@^4.5.5"
      ]
    }
  }
}
</file>

<file path="docs/SETTLEMENT_AUTO_CLOSE_SETUP.md">
# ì •ì‚° ìë™ ë§ˆê° ê¸°ëŠ¥ ì„¤ì • ê°€ì´ë“œ

## ê°œìš”

ê° ìŠ¤í˜ì´ìŠ¤ë³„ë¡œ ì„¤ì •ëœ ì‹œê°„ì— ì •ì‚°ì„ ìë™ìœ¼ë¡œ ë§ˆê°í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.

Netlify Scheduled Functionsë¥¼ ì‚¬ìš©í•˜ì—¬ ë§¤ì‹œê°„ ìë™ ì‹¤í–‰ë˜ë©°, ê° ìŠ¤í˜ì´ìŠ¤ì˜ ì„¤ì •ì„ í™•ì¸í•˜ì—¬ ë§ˆê° ì‹œê°„ì´ ë˜ë©´ ìë™ìœ¼ë¡œ ì •ì‚°ì„ ë§ˆê°í•©ë‹ˆë‹¤.

**ì¶”ê°€ ë¹„ìš© ì—†ìŒ** - Netlifyì—ì„œ ë¬´ë£Œë¡œ ì œê³µí•˜ëŠ” Scheduled Functions ì‚¬ìš©

## ì•„í‚¤í…ì²˜

```
Netlify Scheduled Functions (ë§¤ì‹œê°„ ìë™ ì‹¤í–‰)
    â†“
settlement-auto-close.js
    â†“
Firestore ì¡°íšŒ (/spaces/{spaceId}/settings/settlement)
    â†“ (ë§ˆê° ì‹œê°„ í™•ì¸)
Firestore ì—…ë°ì´íŠ¸ (/spaces/{spaceId}/settlement/{weekId})
```

## ìŠ¤í˜ì´ìŠ¤ë³„ ì„¤ì •

ê° ìŠ¤í˜ì´ìŠ¤ ë§¤ë‹ˆì €ëŠ” ì•± ë‚´ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

1. **ì •ì‚° ì£¼ê¸°**: ë§¤ì£¼ / ë§¤ë‹¬ / ë§¤ë…„
2. **ë§ˆê° ìš”ì¼/ë‚ ì§œ**:
   - ë§¤ì£¼: ì›”ìš”ì¼ ~ ì¼ìš”ì¼ ì„ íƒ
   - ë§¤ë‹¬: 1ì¼ ~ 31ì¼ ì„ íƒ
   - ë§¤ë…„: ëª‡ ì›” ëª‡ ì¼ ì„ íƒ
3. **ë§ˆê° ì‹œê°„**: 00:00 ~ 23:59

ì„¤ì • ê²½ë¡œ: ì•± â†’ ë”ë³´ê¸° â†’ ì •ì‚° ìë™í™” ì„¤ì •

## ì„¤ì • ë°©ë²•

### 1. Firebase Admin SDK ì„œë¹„ìŠ¤ ê³„ì • ìƒì„±

1. [Firebase Console](https://console.firebase.google.com/) ì ‘ì†
2. í”„ë¡œì íŠ¸ ì„ íƒ â†’ í”„ë¡œì íŠ¸ ì„¤ì • â†’ ì„œë¹„ìŠ¤ ê³„ì •
3. "ìƒˆ ë¹„ê³µê°œ í‚¤ ìƒì„±" í´ë¦­
4. JSON íŒŒì¼ ë‹¤ìš´ë¡œë“œ

### 2. Netlify í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

Netlify ëŒ€ì‹œë³´ë“œì—ì„œ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •:

- `FIREBASE_SERVICE_ACCOUNT`: Firebase ì„œë¹„ìŠ¤ ê³„ì • JSON ì „ì²´ ë‚´ìš© (ì••ì¶•ëœ í•œ ì¤„ë¡œ)

ì„¤ì • ê²½ë¡œ: Netlify Dashboard â†’ Site Settings â†’ Environment Variables

**ì¤‘ìš”**: JSONì„ í•œ ì¤„ë¡œ ì••ì¶•í•˜ì—¬ ì…ë ¥í•˜ì„¸ìš”.

### 3. Netlify Functions íŒ¨í‚¤ì§€ ì„¤ì¹˜

```bash
cd netlify/functions
npm install firebase-admin
```

ë˜ëŠ” í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ:

```bash
npm install --prefix netlify/functions firebase-admin
```

### 4. ë°°í¬

```bash
git add .
git commit -m "ì •ì‚° ìë™ ë§ˆê° ê¸°ëŠ¥ ì¶”ê°€"
git push
```

Netlifyê°€ ìë™ìœ¼ë¡œ ë°°í¬í•˜ë©°, Scheduled Functionì´ ë“±ë¡ë©ë‹ˆë‹¤.

## ë™ì‘ ë°©ì‹

### 1. ìŠ¤ì¼€ì¤„

- **ì‹¤í–‰ ì£¼ê¸°**: ë§¤ì‹œê°„ ì •ê° (Netlifyê°€ ìë™ ì‹¤í–‰)
- **ì²´í¬ ë°©ì‹**: ê° ìŠ¤í˜ì´ìŠ¤ì˜ ì„¤ì •ì„ ì½ì–´ í˜„ì¬ ì‹œê°„ê³¼ ë¹„êµ
- **ë§ˆê° ëŒ€ìƒ**: ê° ì£¼ê¸°ì— ë”°ë¼ ë‹¤ë¦„
  - ë§¤ì£¼: ì§€ë‚œ ì£¼ ì •ì‚° ë§ˆê°
  - ë§¤ë‹¬: ì§€ë‚œ ë‹¬ ì •ì‚° ë§ˆê°
  - ë§¤ë…„: ì§€ë‚œ í•´ ì •ì‚° ë§ˆê°

### 2. ì²˜ë¦¬ ë¡œì§

1. Netlifyê°€ ë§¤ì‹œê°„ ì •ê°ì— `settlement-auto-close` í•¨ìˆ˜ ìë™ ì‹¤í–‰
2. ëª¨ë“  ìŠ¤í˜ì´ìŠ¤ ì¡°íšŒ
3. ê° ìŠ¤í˜ì´ìŠ¤ì˜ `/settings/settlement` ì„¤ì • ì¡°íšŒ
4. ìë™ ë§ˆê°ì´ í™œì„±í™”ë˜ì–´ ìˆê³ , í˜„ì¬ ì‹œê°„ì´ ì„¤ì • ì‹œê°„(Â±5ë¶„)ì¸ì§€ í™•ì¸
5. ì¡°ê±´ ì¶©ì¡± ì‹œ í•´ë‹¹ ì£¼ê¸°ì˜ ì •ì‚° ë§ˆê°
   - `status: 'active'` â†’ `status: 'settled'`
   - `autoSettled: true` í”Œë˜ê·¸ ì¶”ê°€
   - `settledBySchedule: {...}` ì–´ë–¤ ìŠ¤ì¼€ì¤„ì— ì˜í•´ ë§ˆê°ë˜ì—ˆëŠ”ì§€ ê¸°ë¡
6. ê²°ê³¼ ìš”ì•½ ë¡œê·¸ ì¶œë ¥

### 3. ì˜ˆì™¸ ì²˜ë¦¬

- ì •ì‚° ì„¤ì •ì´ ì—†ëŠ” ê²½ìš° â†’ ìŠ¤í‚µ (no_settings)
- ìë™ ë§ˆê°ì´ ë¹„í™œì„±í™”ëœ ê²½ìš° â†’ ìŠ¤í‚µ (disabled)
- ë§ˆê° ì‹œê°„ì´ ì•„ë‹Œ ê²½ìš° â†’ ìŠ¤í‚µ (not_time)
- ì •ì‚° ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° â†’ ìŠ¤í‚µ (no_data)
- ì´ë¯¸ ì •ì‚° ì™„ë£Œëœ ê²½ìš° â†’ ìŠ¤í‚µ (already_settled)
- ì˜¤ë¥˜ ë°œìƒ ì‹œ â†’ ë¡œê·¸ ê¸°ë¡ ë° ê³„ì† ì§„í–‰ (error)

## ëª¨ë‹ˆí„°ë§

### Netlify Functions ë¡œê·¸ í™•ì¸

1. Netlify Dashboard â†’ Functions íƒ­
2. `settlement-auto-close` ì„ íƒ
3. Logs í™•ì¸

ë˜ëŠ” Netlify CLIë¡œ ë¡œê·¸ í™•ì¸:

```bash
netlify functions:log settlement-auto-close
```

### ë¡œê·¸ ì˜ˆì‹œ

```
ğŸ¤– Netlify Scheduled Function ì‹¤í–‰: 2025-01-06T09:00:00.000Z
ğŸ  ìŠ¤í˜ì´ìŠ¤: ì¡°ê°• 308 (308308)
  âœ… ë§ˆê° ì‹œê°„ ì¼ì¹˜! ì •ì‚° ë§ˆê° ì‹œì‘...
  ğŸ“… ë§ˆê° ëŒ€ìƒ ì£¼ì°¨: 2024-W52
  ğŸ”„ ì •ì‚° ë§ˆê° ì²˜ë¦¬ ì¤‘...
  âœ… ì •ì‚° ë§ˆê° ì™„ë£Œ

ğŸ“Š ìë™ ë§ˆê° ì²´í¬ ì™„ë£Œ: {
  timestamp: "2025-01-06T09:00:00.000Z",
  totalSpaces: 3,
  settled: 1,
  notTime: 2,
  ...
}
```

## í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1. ì•±ì—ì„œ ì„¤ì •
1. ì•± â†’ `ë”ë³´ê¸°` â†’ `ì •ì‚° ìë™í™” ì„¤ì •`
2. ìë™í™” í™œì„±í™” ON
3. **ë§¤ì£¼** ì„ íƒ
4. í˜„ì¬ ì‹œê°„ ê¸°ì¤€ **5-10ë¶„ í›„** ì‹œê°„ ì„¤ì •
   - ì˜ˆ: í˜„ì¬ 14:35 â†’ 14:40ìœ¼ë¡œ ì„¤ì •
5. ì €ì¥

### 2. ìë™ ë§ˆê° ëŒ€ê¸°
- Netlifyê°€ ë§¤ì‹œê°„ ì •ê°ì— ìë™ ì‹¤í–‰
- ì„¤ì • ì‹œê°„ (Â±5ë¶„) ë˜ë©´ ìë™ìœ¼ë¡œ ì •ì‚° ë§ˆê°
- Netlify Functions ë¡œê·¸ì—ì„œ í™•ì¸

### 3. Scheduled Function ìˆ˜ë™ í…ŒìŠ¤íŠ¸

Netlify CLI ì„¤ì¹˜:
```bash
npm install -g netlify-cli
```

ë¡œì»¬ í…ŒìŠ¤íŠ¸:
```bash
# .env íŒŒì¼ì— FIREBASE_SERVICE_ACCOUNT ì„¤ì •
netlify dev

# ë‹¤ë¥¸ í„°ë¯¸ë„ì—ì„œ í•¨ìˆ˜ ì§ì ‘ í˜¸ì¶œ
curl http://localhost:8888/.netlify/functions/settlement-auto-close
```

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ: Scheduled Functionì´ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ

**í•´ê²°ì±…:**
1. Netlify ë°°í¬ê°€ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸
2. `netlify.toml`ì— schedule ì„¤ì •ì´ ìˆëŠ”ì§€ í™•ì¸
3. Netlify Dashboard â†’ Functionsì—ì„œ `settlement-auto-close` í•¨ìˆ˜ê°€ ë³´ì´ëŠ”ì§€ í™•ì¸
4. Netlify Functions ë¡œê·¸ í™•ì¸

### ë¬¸ì œ: Firebase ì¸ì¦ ì‹¤íŒ¨

**í•´ê²°ì±…:**
```bash
# Netlify í™˜ê²½ ë³€ìˆ˜ í™•ì¸
netlify env:list

# FIREBASE_SERVICE_ACCOUNTê°€ ì˜¬ë°”ë¥¸ JSONì¸ì§€ í™•ì¸
# JSONì„ í•œ ì¤„ë¡œ ì••ì¶•í–ˆëŠ”ì§€ í™•ì¸
```

### ë¬¸ì œ: ì„¤ì • ì‹œê°„ì— ì‹¤í–‰ë˜ì§€ ì•ŠìŒ

**ì›ì¸:**
- Netlify Scheduled FunctionsëŠ” **ë§¤ì‹œê°„ ì •ê°**ì—ë§Œ ì‹¤í–‰
- Â±5ë¶„ í—ˆìš©ì´ë¯€ë¡œ ìµœëŒ€ 55ë¶„~5ë¶„ ì‚¬ì´ì— ì‹¤í–‰

**í•´ê²°ì±…:**
- 14:30 ì„¤ì • ì‹œ â†’ 14ì‹œ ì •ê°ì— ì²´í¬ â†’ ì‹œê°„ ì°¨ì´ 30ë¶„ > 5ë¶„ â†’ ì‹¤í–‰ ì•ˆ ë¨
- 14:00 ~ 14:05 ì‚¬ì´ë¡œ ì„¤ì •í•´ì•¼ 14ì‹œ ì •ê° ì‹¤í–‰ ì‹œ ë§ˆê°ë¨
- ë˜ëŠ” 15:00ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ 15ì‹œ ì •ê°ì— ì‹¤í–‰ë˜ë„ë¡

## ì£¼ì˜ì‚¬í•­

1. **íƒ€ì„ì¡´**: ì„œë²„ëŠ” UTC ì‹œê°„ëŒ€ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤
   - Netlify FunctionsëŠ” UTC ê¸°ì¤€ìœ¼ë¡œ ì‹¤í–‰
   - ì•±ì—ì„œëŠ” í•œêµ­ ì‹œê°„ìœ¼ë¡œ í‘œì‹œë˜ì§€ë§Œ, ì„œë²„ëŠ” UTC ê¸°ì¤€
   - í•œêµ­ ì‹œê°„ 18:00 = UTC 09:00

2. **ì‹œê°„ ì˜¤ì°¨**: Â±5ë¶„ í—ˆìš©
   - 18:00 ì„¤ì • ì‹œ 17:55 ~ 18:05 ì‚¬ì´ì— ì‹¤í–‰ë˜ë©´ ë§ˆê°
   - ë§¤ì‹œê°„ ì •ê°ì—ë§Œ ì²´í¬í•˜ë¯€ë¡œ ì •í™•í•œ ì‹œê°„ ë§ì¶”ê¸° ì–´ë ¤ì›€

3. **í…ŒìŠ¤íŠ¸ ë°©ë²•**:
   - í˜„ì¬ ì‹œê°„ì´ 14:35ë¼ë©´ â†’ 15:00ìœ¼ë¡œ ì„¤ì •
   - 15ì‹œ ì •ê°ì— Netlifyê°€ ì‹¤í–‰í•˜ë©´ ìë™ ë§ˆê°
   - ë˜ëŠ” 14:00ìœ¼ë¡œ ì„¤ì •í•˜ê³  ë‹¤ìŒ ì •ê°(15ì‹œ)ê¹Œì§€ ëŒ€ê¸°

4. **ì‹¤í–‰ ë¹ˆë„**: ë§¤ì‹œê°„ ì •ê° (1ì‹œê°„ì— 1ë²ˆ)
   - 00:00, 01:00, 02:00, ... 23:00

5. **ë¹„ìš©**: ì™„ì „ ë¬´ë£Œ
   - Netlify Scheduled FunctionsëŠ” ë¬´ë£Œ í”Œëœì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥
   - ì›” 125,000 function requests ë¬´ë£Œ (ì´ˆê³¼ ì‹œ $25/ë°±ë§Œ requests)
   - ë§¤ì‹œê°„ ì‹¤í–‰ = ì›” 720íšŒ ì‹¤í–‰ = ë¬´ë£Œ ë²”ìœ„ ë‚´

6. **ì•Œë¦¼ ë°œì†¡**: í˜„ì¬ëŠ” ì •ì‚° ë§ˆê°ë§Œ ìˆ˜í–‰í•©ë‹ˆë‹¤. ì•Œë¦¼í†¡ ë°œì†¡ì€ ë³„ë„ êµ¬í˜„ í•„ìš”.

## FAQ

### Q: ì •í™•íˆ 18:00ì— ì‹¤í–‰í•˜ê³  ì‹¶ì€ë°?

A: Netlify Scheduled FunctionsëŠ” ë§¤ì‹œê°„ ì •ê°ì—ë§Œ ì‹¤í–‰ë©ë‹ˆë‹¤. 18:00 ~ 18:05 ì‚¬ì´ë¥¼ ëª©í‘œë¡œ ì„¤ì •í•˜ì„¸ìš”.

### Q: í…ŒìŠ¤íŠ¸ë¥¼ ë¹¨ë¦¬ í•˜ê³  ì‹¶ì€ë°?

A: í˜„ì¬ ì‹œê°„ì˜ ë‹¤ìŒ ì •ê° ì‹œê°„ìœ¼ë¡œ ì„¤ì •í•˜ì„¸ìš”.
- ì˜ˆ: í˜„ì¬ 14:35 â†’ 15:00ìœ¼ë¡œ ì„¤ì • â†’ 15ì‹œ ì •ê°ì— ì‹¤í–‰
- ë˜ëŠ” Netlify CLIë¡œ ë¡œì»¬ í…ŒìŠ¤íŠ¸

### Q: ì—¬ëŸ¬ ìŠ¤í˜ì´ìŠ¤ê°€ ê°ê° ë‹¤ë¥¸ ì‹œê°„ì— ë§ˆê°ë˜ë‚˜ìš”?

A: ë„¤! ê° ìŠ¤í˜ì´ìŠ¤ê°€ ë…ë¦½ì ì¸ ì„¤ì •ì„ ê°€ì§‘ë‹ˆë‹¤. 308í˜¸ëŠ” ì›”ìš”ì¼ 18:00, 408í˜¸ëŠ” ì¼ìš”ì¼ 20:00 ì´ëŸ° ì‹ìœ¼ë¡œ ì„¤ì • ê°€ëŠ¥í•©ë‹ˆë‹¤.

### Q: ìë™ ë§ˆê°ì´ ì‹¤í–‰ë˜ì—ˆëŠ”ì§€ ì–´ë–»ê²Œ í™•ì¸í•˜ë‚˜ìš”?

A: Netlify Dashboard â†’ Functions â†’ settlement-auto-close â†’ Logsì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.

## í–¥í›„ ê°œì„  ì‚¬í•­

- [ ] ì •ì‚° ì™„ë£Œ ì‹œ ì•Œë¦¼í†¡ ìë™ ë°œì†¡
- [ ] Slack/Discord ì•Œë¦¼ ì—°ë™
- [ ] ì‹¤í–‰ ê²°ê³¼ ì´ë©”ì¼ ì•Œë¦¼
- [ ] ë” ì •í™•í•œ ì‹œê°„ ì œì–´ (ë¶„ ë‹¨ìœ„ ìŠ¤ì¼€ì¤„)
</file>

<file path="docs/SETTLEMENT_TESTING.md">
# ì •ì‚° ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

## 1. ì£¼ì°¨ë³„ ë¦¬ìŠ¤íŠ¸ ë³´ê¸° í…ŒìŠ¤íŠ¸

### í…ŒìŠ¤íŠ¸ ë‹¨ê³„

1. **ì •ì‚° í˜ì´ì§€ ì ‘ì†**
   - ì•±ì—ì„œ ì •ì‚° í˜ì´ì§€ë¡œ ì´ë™
   - í˜„ì¬ ì£¼ì°¨ê°€ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸

2. **ì£¼ì°¨ ë„¤ë¹„ê²Œì´ì…˜ í…ŒìŠ¤íŠ¸**
   - â—€ ë²„íŠ¼ í´ë¦­ â†’ ì´ì „ ì£¼ì°¨ë¡œ ì´ë™ í™•ì¸
   - â–¶ ë²„íŠ¼ í´ë¦­ â†’ ë‹¤ìŒ ì£¼ì°¨ë¡œ ì´ë™ í™•ì¸
   - "ì´ë²ˆ ì£¼" ë²„íŠ¼ í´ë¦­ â†’ í˜„ì¬ ì£¼ì°¨ë¡œ ë³µê·€ í™•ì¸

3. **ì£¼ì°¨ ëª©ë¡ í…ŒìŠ¤íŠ¸**
   - ìš°ì¸¡ ìƒë‹¨ "ëª©ë¡" ë²„íŠ¼ í´ë¦­
   - ëª¨ë“  ì •ì‚° ë‚´ì—­ì´ ìµœì‹ ìˆœìœ¼ë¡œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸
   - ê° ì£¼ì°¨ í´ë¦­ ì‹œ í•´ë‹¹ ì£¼ì°¨ë¡œ ì´ë™í•˜ëŠ”ì§€ í™•ì¸

4. **ìƒíƒœ í‘œì‹œ í™•ì¸**
   - ì •ì‚° ì™„ë£Œëœ ì£¼ì°¨ì— "âœ“ ì •ì‚°ì™„ë£Œ" ë°°ì§€ í‘œì‹œ í™•ì¸
   - í˜„ì¬ ì£¼ì°¨ì— "ì´ë²ˆ ì£¼" ë°°ì§€ í‘œì‹œ í™•ì¸
   - ì •ì‚° ë‚´ì—­ì´ ì—†ëŠ” ì£¼ì°¨ì— "ì •ì‚° ë‚´ì—­ ì—†ìŒ" í‘œì‹œ í™•ì¸

### ì˜ˆìƒ ê²°ê³¼

âœ… ì£¼ì°¨ ê°„ ì´ë™ì´ ë¶€ë“œëŸ½ê²Œ ì‘ë™
âœ… ê³¼ê±°/ë¯¸ë˜ ì£¼ì°¨ ì¡°íšŒ ê°€ëŠ¥
âœ… ì •ì‚° ì™„ë£Œëœ ì£¼ì°¨ëŠ” "ì •ì‚°ì™„ë£Œ" ë²„íŠ¼ ë¯¸í‘œì‹œ (ì´ë²ˆ ì£¼ë§Œ í‘œì‹œ)

---

## 2. ì£¼ì°¨ ì „í™˜ ë¡œì§ í…ŒìŠ¤íŠ¸

### í…ŒìŠ¤íŠ¸ ë‹¨ê³„

1. **ìƒˆ ì£¼ì°¨ ì‹œì‘ ì‹œë®¬ë ˆì´ì…˜**
   - ê°œë°œì ë„êµ¬ì—ì„œ `getWeekId()` í•¨ìˆ˜ë¡œ ìƒˆ ì£¼ì°¨ ìƒì„±
   - ë˜ëŠ” ì‹¤ì œ ì£¼ê°€ ë°”ë€” ë•Œê¹Œì§€ ëŒ€ê¸°

2. **ì´ì „ ì£¼ì°¨ ë¯¸ì •ì‚° ê²½ê³  í™•ì¸**
   - ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ê²½ê³  ë©”ì‹œì§€ í™•ì¸
   - "ì´ì „ ì£¼ì°¨ê°€ ì•„ì§ ì •ì‚° ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤" ë¡œê·¸ í™•ì¸

3. **ì •ì‚° ì™„ë£Œ í›„ ìƒˆ ì£¼ì°¨ ìƒì„±**
   - ì´ì „ ì£¼ì°¨ ì •ì‚° ì™„ë£Œ
   - ìƒˆ ì£¼ì°¨ ì‹œì‘ ì‹œ ê²½ê³  ì—†ì´ ìƒì„±ë˜ëŠ”ì§€ í™•ì¸

### ì˜ˆìƒ ê²°ê³¼

âœ… ìƒˆ ì£¼ì°¨ ìƒì„± ì‹œ ì´ì „ ì£¼ì°¨ ìƒíƒœ ìë™ ì²´í¬
âœ… ë¯¸ì •ì‚° ì£¼ì°¨ê°€ ìˆìœ¼ë©´ ì½˜ì†”ì— ê²½ê³  í‘œì‹œ
âš ï¸ í˜„ì¬ëŠ” ê²½ê³ ë§Œ í‘œì‹œí•˜ê³ , ìë™ ë§ˆê°ì€ ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ìˆ˜í–‰

---

## 3. ìë™ ë§ˆê° ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

### ì‚¬ì „ ì¤€ë¹„

1. **í™˜ê²½ ë³€ìˆ˜ ì„¤ì • í™•ì¸**
   - Netlify: `FIREBASE_SERVICE_ACCOUNT`, `SETTLEMENT_AUTO_CLOSE_SECRET`
   - GitHub Secrets: `NETLIFY_FUNCTION_URL`, `SETTLEMENT_AUTO_CLOSE_SECRET`

2. **Firebase ì„œë¹„ìŠ¤ ê³„ì • ê¶Œí•œ í™•ì¸**
   - Firestore ì½ê¸°/ì“°ê¸° ê¶Œí•œ ìˆëŠ”ì§€ í™•ì¸

### ìˆ˜ë™ í…ŒìŠ¤íŠ¸ (ë°°í¬ ì „)

#### ë¡œì»¬ í…ŒìŠ¤íŠ¸

```bash
# 1. netlify-cli ì„¤ì¹˜ (ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ë‹¤ë©´)
npm install -g netlify-cli

# 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
# .env íŒŒì¼ ìƒì„± ë˜ëŠ” netlify.tomlì— ì¶”ê°€

# 3. ë¡œì»¬ì—ì„œ functions ì‹¤í–‰
netlify dev

# 4. ë‹¤ë¥¸ í„°ë¯¸ë„ì—ì„œ í•¨ìˆ˜ í˜¸ì¶œ
curl -X POST \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_SECRET_KEY" \
  http://localhost:8888/.netlify/functions/settlement-auto-close
```

### ë°°í¬ í›„ í…ŒìŠ¤íŠ¸

#### 1. Netlify Functions ë¡œê·¸ í™•ì¸

1. Netlify Dashboard â†’ Functions íƒ­
2. `settlement-auto-close` ì„ íƒ
3. Logs í™•ì¸

ë˜ëŠ” CLIë¡œ:
```bash
netlify functions:log settlement-auto-close
```

#### 2. ìˆ˜ë™ í•¨ìˆ˜ í˜¸ì¶œ í…ŒìŠ¤íŠ¸ (ë¡œì»¬)

```bash
# Netlify CLI ì„¤ì¹˜
npm install -g netlify-cli

# ë¡œì»¬ì—ì„œ functions ì‹¤í–‰
netlify dev

# ë‹¤ë¥¸ í„°ë¯¸ë„ì—ì„œ
curl http://localhost:8888/.netlify/functions/settlement-auto-close
```

ì˜ˆìƒ ì‘ë‹µ:
```json
{
  "timestamp": "2025-01-06T09:00:00.000Z",
  "totalSpaces": 3,
  "settled": 1,
  "notTime": 2,
  "disabled": 0,
  "noSettings": 0,
  "results": [...]
}
```

#### 3. ìŠ¤ì¼€ì¤„ ì‹¤í–‰ ëŒ€ê¸°

- Netlifyê°€ ë§¤ì‹œê°„ ì •ê°ì— ìë™ ì‹¤í–‰
- ì„¤ì • ì‹œê°„(Â±5ë¶„)ì´ ë˜ë©´ ìë™ìœ¼ë¡œ ë§ˆê°
- Netlify Functions ë¡œê·¸ì—ì„œ ì‹¤í–‰ ê¸°ë¡ í™•ì¸

### ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] Netlify Functionì´ ì •ìƒ ë°°í¬ë¨
- [ ] `netlify.toml`ì— schedule ì„¤ì • ì¶”ê°€ë¨
- [ ] í™˜ê²½ ë³€ìˆ˜ê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë¨
- [ ] Firebase ì„œë¹„ìŠ¤ ê³„ì • ì¸ì¦ ì„±ê³µ
- [ ] ìŠ¤í˜ì´ìŠ¤ ì •ì‚° ì„¤ì • ì¡°íšŒ ì„±ê³µ
- [ ] ë§ˆê° ì‹œê°„ ì²´í¬ ë¡œì§ ë™ì‘ í™•ì¸
- [ ] `status: 'active'` â†’ `status: 'settled'` ì—…ë°ì´íŠ¸ ì„±ê³µ
- [ ] `autoSettled: true` í”Œë˜ê·¸ ì¶”ê°€ë¨
- [ ] `settledBySchedule` ì •ë³´ ê¸°ë¡ë¨
- [ ] Netlify Scheduled Functionì´ ì •ìƒ ì‘ë™
- [ ] ì‹¤í–‰ ë¡œê·¸ê°€ Netlifyì— ì •ìƒì ìœ¼ë¡œ ê¸°ë¡ë¨

---

## 4. ì—£ì§€ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸

### 1. ì •ì‚° ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš°

- í…ŒìŠ¤íŠ¸: ì˜ìˆ˜ì¦ì´ ì—†ëŠ” ì£¼ì°¨
- ì˜ˆìƒ: ì •ì‚° ë§ˆê° ìŠ¤í‚µ, `status: 'no_data'` ë°˜í™˜

### 2. ì´ë¯¸ ì •ì‚° ì™„ë£Œëœ ê²½ìš°

- í…ŒìŠ¤íŠ¸: ìˆ˜ë™ìœ¼ë¡œ ì •ì‚° ì™„ë£Œ í›„ ìë™ ë§ˆê° ì‹¤í–‰
- ì˜ˆìƒ: ìŠ¤í‚µ, `status: 'already_settled'` ë°˜í™˜

### 3. ì—¬ëŸ¬ ìŠ¤í˜ì´ìŠ¤ ë™ì‹œ ì²˜ë¦¬

- í…ŒìŠ¤íŠ¸: 3ê°œ ì´ìƒì˜ ìŠ¤í˜ì´ìŠ¤ì—ì„œ ê°ê° ë‹¤ë¥¸ ìƒíƒœ
- ì˜ˆìƒ: ëª¨ë“  ìŠ¤í˜ì´ìŠ¤ ê°œë³„ ì²˜ë¦¬, í•œ ê³³ ì‹¤íŒ¨í•´ë„ ë‹¤ë¥¸ ê³³ ê³„ì† ì§„í–‰

### 4. ì¸ì¦ ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸

- í…ŒìŠ¤íŠ¸: ì˜ëª»ëœ Secret í‚¤ë¡œ í˜¸ì¶œ
- ì˜ˆìƒ: `401 Unauthorized` ì‘ë‹µ

---

## 5. í†µí•© í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì •ìƒ íë¦„

1. ì›”ìš”ì¼~ì¼ìš”ì¼: ì˜ìˆ˜ì¦ ì œì¶œ ë° ì •ì‚° ë°ì´í„° ì¶•ì 
2. ì¼ìš”ì¼ 23:59: ì£¼ì°¨ ì¢…ë£Œ
3. ì›”ìš”ì¼ 18:00: ìë™ ë§ˆê° ì‹¤í–‰
4. í™•ì¸: ì§€ë‚œ ì£¼ ì •ì‚°ì´ `settled` ìƒíƒœë¡œ ë³€ê²½ë¨
5. í™•ì¸: ìƒˆ ì£¼ì°¨ëŠ” `active` ìƒíƒœë¡œ ìƒì„±ë¨

### ì‹œë‚˜ë¦¬ì˜¤ 2: ìˆ˜ë™ ë§ˆê° í›„ ìë™ ë§ˆê°

1. ì¼ìš”ì¼: ë§¤ë‹ˆì €ê°€ ìˆ˜ë™ìœ¼ë¡œ ì •ì‚° ì™„ë£Œ
2. ì›”ìš”ì¼ 18:00: ìë™ ë§ˆê° ì‹¤í–‰
3. í™•ì¸: ì´ë¯¸ ì •ì‚° ì™„ë£Œë˜ì–´ ìŠ¤í‚µë¨

### ì‹œë‚˜ë¦¬ì˜¤ 3: ì •ì‚° ë°ì´í„° ì—†ìŒ

1. ì›”ìš”ì¼~ì¼ìš”ì¼: ì˜ìˆ˜ì¦ ì œì¶œ ì—†ìŒ
2. ì›”ìš”ì¼ 18:00: ìë™ ë§ˆê° ì‹¤í–‰
3. í™•ì¸: ì •ì‚° ë°ì´í„° ì—†ìŒìœ¼ë¡œ ìŠ¤í‚µë¨

---

## ë¬¸ì œ í•´ê²°

### ë¬¸ì œ: Scheduled Functionì´ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ

**í•´ê²°ì±…:**
1. Netlify ë°°í¬ê°€ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸
2. `netlify.toml`ì— schedule ì„¤ì •ì´ ìˆëŠ”ì§€ í™•ì¸:
   ```toml
   [functions."settlement-auto-close"]
     schedule = "@hourly"
   ```
3. Netlify Dashboard â†’ Functionsì—ì„œ í•¨ìˆ˜ í™•ì¸
4. Netlify Functions ë¡œê·¸ í™•ì¸

### ë¬¸ì œ: 500 Internal Server Error

**í•´ê²°ì±…:**
```bash
# Netlify í•¨ìˆ˜ ë¡œê·¸ í™•ì¸
netlify functions:log settlement-auto-close

# ë˜ëŠ” Netlify ëŒ€ì‹œë³´ë“œì—ì„œ Functions â†’ Logs í™•ì¸
```

### ë¬¸ì œ: Firebase ì¸ì¦ ì‹¤íŒ¨

**í•´ê²°ì±…:**
```bash
# Netlify í™˜ê²½ ë³€ìˆ˜ í™•ì¸
netlify env:list

# FIREBASE_SERVICE_ACCOUNTê°€ ì˜¬ë°”ë¥¸ JSONì¸ì§€ í™•ì¸
```

### ë¬¸ì œ: ì„¤ì • ì‹œê°„ì— ë§ˆê°ë˜ì§€ ì•ŠìŒ

**ì›ì¸:**
- NetlifyëŠ” ë§¤ì‹œê°„ ì •ê°ì—ë§Œ ì‹¤í–‰
- Â±5ë¶„ í—ˆìš© ë²”ìœ„ í™•ì¸ í•„ìš”

**í•´ê²°ì±…:**
- ì •ê° ì‹œê°„ìœ¼ë¡œ ì„¤ì • (ì˜ˆ: 18:00, 19:00)
- ë˜ëŠ” ì •ê° Â±5ë¶„ ë‚´ (ì˜ˆ: 18:03)

---

## ëª¨ë‹ˆí„°ë§ ë° ìœ ì§€ë³´ìˆ˜

### ì£¼ê°„ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] Netlify Functions ë¡œê·¸ í™•ì¸ (ìë™ ë§ˆê° ì„±ê³µ ì—¬ë¶€)
- [ ] ê° ìŠ¤í˜ì´ìŠ¤ì˜ ì •ì‚° ë§ˆê° ì‹œê°„ í™•ì¸
- [ ] ì˜¤ë¥˜ ë°œìƒ ì‹œ ì›ì¸ íŒŒì•… ë° ìˆ˜ì •

### ì›”ê°„ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] Firebase ì„œë¹„ìŠ¤ ê³„ì • ê¶Œí•œ ìœ íš¨ì„± í™•ì¸
- [ ] Netlify Functions ì‚¬ìš©ëŸ‰ í™•ì¸ (ë¬´ë£Œ ë²”ìœ„ ë‚´ì¸ì§€)
- [ ] ë¡œê·¸ ì¶•ì  ê´€ë¦¬
- [ ] ê° ìŠ¤í˜ì´ìŠ¤ì˜ ì„¤ì • ê²€í† 

### ì—°ê°„ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] Netlify Functions ì´ ì‚¬ìš©ëŸ‰ ë¦¬ë·°
- [ ] Firebase Admin SDK ë²„ì „ ì—…ë°ì´íŠ¸ ê²€í† 
- [ ] ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë¦¬ë·°
- [ ] ì•Œë¦¼ ë°œì†¡ ê¸°ëŠ¥ ì¶”ê°€ ê²€í† 
</file>

<file path="ios/.gitignore">
App/build
App/Pods
App/output
App/App/public
DerivedData
xcuserdata

# Cordova plugins for Capacitor
capacitor-cordova-ios-plugins

# Generated Config files
App/App/capacitor.config.json
App/App/config.xml
</file>

<file path="ios/App/App.xcodeproj/project.pbxproj">
// !$*UTF8*$!
{
	archiveVersion = 1;
	classes = {
	};
	objectVersion = 60;
	objects = {

/* Begin PBXBuildFile section */
		2FAD9763203C412B000D30F8 /* config.xml in Resources */ = {isa = PBXBuildFile; fileRef = 2FAD9762203C412B000D30F8 /* config.xml */; };
		4D22ABE92AF431CB00220026 /* CapApp-SPM in Frameworks */ = {isa = PBXBuildFile; productRef = 4D22ABE82AF431CB00220026 /* CapApp-SPM */; };
		50379B232058CBB4000EE86E /* capacitor.config.json in Resources */ = {isa = PBXBuildFile; fileRef = 50379B222058CBB4000EE86E /* capacitor.config.json */; };
		504EC3081FED79650016851F /* AppDelegate.swift in Sources */ = {isa = PBXBuildFile; fileRef = 504EC3071FED79650016851F /* AppDelegate.swift */; };
		504EC30D1FED79650016851F /* Main.storyboard in Resources */ = {isa = PBXBuildFile; fileRef = 504EC30B1FED79650016851F /* Main.storyboard */; };
		504EC30F1FED79650016851F /* Assets.xcassets in Resources */ = {isa = PBXBuildFile; fileRef = 504EC30E1FED79650016851F /* Assets.xcassets */; };
		504EC3121FED79650016851F /* LaunchScreen.storyboard in Resources */ = {isa = PBXBuildFile; fileRef = 504EC3101FED79650016851F /* LaunchScreen.storyboard */; };
		50B271D11FEDC1A000F3C39B /* public in Resources */ = {isa = PBXBuildFile; fileRef = 50B271D01FEDC1A000F3C39B /* public */; };
/* End PBXBuildFile section */

/* Begin PBXFileReference section */
		2FAD9762203C412B000D30F8 /* config.xml */ = {isa = PBXFileReference; lastKnownFileType = text.xml; path = config.xml; sourceTree = "<group>"; };
		50379B222058CBB4000EE86E /* capacitor.config.json */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = text.json; path = capacitor.config.json; sourceTree = "<group>"; };
		504EC3041FED79650016851F /* App.app */ = {isa = PBXFileReference; explicitFileType = wrapper.application; includeInIndex = 0; path = App.app; sourceTree = BUILT_PRODUCTS_DIR; };
		504EC3071FED79650016851F /* AppDelegate.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = AppDelegate.swift; sourceTree = "<group>"; };
		504EC30C1FED79650016851F /* Base */ = {isa = PBXFileReference; lastKnownFileType = file.storyboard; name = Base; path = Base.lproj/Main.storyboard; sourceTree = "<group>"; };
		504EC30E1FED79650016851F /* Assets.xcassets */ = {isa = PBXFileReference; lastKnownFileType = folder.assetcatalog; path = Assets.xcassets; sourceTree = "<group>"; };
		504EC3111FED79650016851F /* Base */ = {isa = PBXFileReference; lastKnownFileType = file.storyboard; name = Base; path = Base.lproj/LaunchScreen.storyboard; sourceTree = "<group>"; };
		504EC3131FED79650016851F /* Info.plist */ = {isa = PBXFileReference; lastKnownFileType = text.plist.xml; path = Info.plist; sourceTree = "<group>"; };
		50B271D01FEDC1A000F3C39B /* public */ = {isa = PBXFileReference; lastKnownFileType = folder; path = public; sourceTree = "<group>"; };
		958DCC722DB07C7200EA8C5F /* debug.xcconfig */ = {isa = PBXFileReference; lastKnownFileType = text.xcconfig; name = debug.xcconfig; path = ../debug.xcconfig; sourceTree = SOURCE_ROOT; };
/* End PBXFileReference section */

/* Begin PBXFrameworksBuildPhase section */
		504EC3011FED79650016851F /* Frameworks */ = {
			isa = PBXFrameworksBuildPhase;
			buildActionMask = 2147483647;
			files = (
				4D22ABE92AF431CB00220026 /* CapApp-SPM in Frameworks */,
			);
			runOnlyForDeploymentPostprocessing = 0;
		};
/* End PBXFrameworksBuildPhase section */

/* Begin PBXGroup section */
		504EC2FB1FED79650016851F = {
			isa = PBXGroup;
			children = (
				958DCC722DB07C7200EA8C5F /* debug.xcconfig */,
				504EC3061FED79650016851F /* App */,
				504EC3051FED79650016851F /* Products */,
			);
			sourceTree = "<group>";
		};
		504EC3051FED79650016851F /* Products */ = {
			isa = PBXGroup;
			children = (
				504EC3041FED79650016851F /* App.app */,
			);
			name = Products;
			sourceTree = "<group>";
		};
		504EC3061FED79650016851F /* App */ = {
			isa = PBXGroup;
			children = (
				50379B222058CBB4000EE86E /* capacitor.config.json */,
				504EC3071FED79650016851F /* AppDelegate.swift */,
				504EC30B1FED79650016851F /* Main.storyboard */,
				504EC30E1FED79650016851F /* Assets.xcassets */,
				504EC3101FED79650016851F /* LaunchScreen.storyboard */,
				504EC3131FED79650016851F /* Info.plist */,
				2FAD9762203C412B000D30F8 /* config.xml */,
				50B271D01FEDC1A000F3C39B /* public */,
			);
			path = App;
			sourceTree = "<group>";
		};
/* End PBXGroup section */

/* Begin PBXNativeTarget section */
		504EC3031FED79650016851F /* App */ = {
			isa = PBXNativeTarget;
			buildConfigurationList = 504EC3161FED79650016851F /* Build configuration list for PBXNativeTarget "App" */;
			buildPhases = (
				504EC3001FED79650016851F /* Sources */,
				504EC3011FED79650016851F /* Frameworks */,
				504EC3021FED79650016851F /* Resources */,
			);
			buildRules = (
			);
			dependencies = (
			);
			name = App;
			packageProductDependencies = (
				4D22ABE82AF431CB00220026 /* CapApp-SPM */,
			);
			productName = App;
			productReference = 504EC3041FED79650016851F /* App.app */;
			productType = "com.apple.product-type.application";
		};
/* End PBXNativeTarget section */

/* Begin PBXProject section */
		504EC2FC1FED79650016851F /* Project object */ = {
			isa = PBXProject;
			attributes = {
				LastSwiftUpdateCheck = 0920;
				LastUpgradeCheck = 0920;
				TargetAttributes = {
					504EC3031FED79650016851F = {
						CreatedOnToolsVersion = 9.2;
						LastSwiftMigration = 1100;
						ProvisioningStyle = Automatic;
					};
				};
			};
			buildConfigurationList = 504EC2FF1FED79650016851F /* Build configuration list for PBXProject "App" */;
			compatibilityVersion = "Xcode 8.0";
			developmentRegion = en;
			hasScannedForEncodings = 0;
			knownRegions = (
				en,
				Base,
			);
			mainGroup = 504EC2FB1FED79650016851F;
			packageReferences = (
				D4C12C0A2AAA248700AAC8A2 /* XCLocalSwiftPackageReference "CapApp-SPM" */,
			);
			productRefGroup = 504EC3051FED79650016851F /* Products */;
			projectDirPath = "";
			projectRoot = "";
			targets = (
				504EC3031FED79650016851F /* App */,
			);
		};
/* End PBXProject section */

/* Begin PBXResourcesBuildPhase section */
		504EC3021FED79650016851F /* Resources */ = {
			isa = PBXResourcesBuildPhase;
			buildActionMask = 2147483647;
			files = (
				504EC3121FED79650016851F /* LaunchScreen.storyboard in Resources */,
				50B271D11FEDC1A000F3C39B /* public in Resources */,
				504EC30F1FED79650016851F /* Assets.xcassets in Resources */,
				50379B232058CBB4000EE86E /* capacitor.config.json in Resources */,
				504EC30D1FED79650016851F /* Main.storyboard in Resources */,
				2FAD9763203C412B000D30F8 /* config.xml in Resources */,
			);
			runOnlyForDeploymentPostprocessing = 0;
		};
/* End PBXResourcesBuildPhase section */

/* Begin PBXSourcesBuildPhase section */
		504EC3001FED79650016851F /* Sources */ = {
			isa = PBXSourcesBuildPhase;
			buildActionMask = 2147483647;
			files = (
				504EC3081FED79650016851F /* AppDelegate.swift in Sources */,
			);
			runOnlyForDeploymentPostprocessing = 0;
		};
/* End PBXSourcesBuildPhase section */

/* Begin PBXVariantGroup section */
		504EC30B1FED79650016851F /* Main.storyboard */ = {
			isa = PBXVariantGroup;
			children = (
				504EC30C1FED79650016851F /* Base */,
			);
			name = Main.storyboard;
			sourceTree = "<group>";
		};
		504EC3101FED79650016851F /* LaunchScreen.storyboard */ = {
			isa = PBXVariantGroup;
			children = (
				504EC3111FED79650016851F /* Base */,
			);
			name = LaunchScreen.storyboard;
			sourceTree = "<group>";
		};
/* End PBXVariantGroup section */

/* Begin XCBuildConfiguration section */
		504EC3141FED79650016851F /* Debug */ = {
			isa = XCBuildConfiguration;
			baseConfigurationReference = 958DCC722DB07C7200EA8C5F /* debug.xcconfig */;
			buildSettings = {
				ALWAYS_SEARCH_USER_PATHS = NO;
				CLANG_ANALYZER_NONNULL = YES;
				CLANG_ANALYZER_NUMBER_OBJECT_CONVERSION = YES_AGGRESSIVE;
				CLANG_CXX_LANGUAGE_STANDARD = "gnu++14";
				CLANG_CXX_LIBRARY = "libc++";
				CLANG_ENABLE_MODULES = YES;
				CLANG_ENABLE_OBJC_ARC = YES;
				CLANG_WARN_BLOCK_CAPTURE_AUTORELEASING = YES;
				CLANG_WARN_BOOL_CONVERSION = YES;
				CLANG_WARN_COMMA = YES;
				CLANG_WARN_CONSTANT_CONVERSION = YES;
				CLANG_WARN_DIRECT_OBJC_ISA_USAGE = YES_ERROR;
				CLANG_WARN_DOCUMENTATION_COMMENTS = YES;
				CLANG_WARN_EMPTY_BODY = YES;
				CLANG_WARN_ENUM_CONVERSION = YES;
				CLANG_WARN_INFINITE_RECURSION = YES;
				CLANG_WARN_INT_CONVERSION = YES;
				CLANG_WARN_NON_LITERAL_NULL_CONVERSION = YES;
				CLANG_WARN_OBJC_LITERAL_CONVERSION = YES;
				CLANG_WARN_OBJC_ROOT_CLASS = YES_ERROR;
				CLANG_WARN_RANGE_LOOP_ANALYSIS = YES;
				CLANG_WARN_STRICT_PROTOTYPES = YES;
				CLANG_WARN_SUSPICIOUS_MOVE = YES;
				CLANG_WARN_UNGUARDED_AVAILABILITY = YES_AGGRESSIVE;
				CLANG_WARN_UNREACHABLE_CODE = YES;
				CLANG_WARN__DUPLICATE_METHOD_MATCH = YES;
				CODE_SIGN_IDENTITY = "iPhone Developer";
				COPY_PHASE_STRIP = NO;
				DEBUG_INFORMATION_FORMAT = dwarf;
				ENABLE_STRICT_OBJC_MSGSEND = YES;
				ENABLE_TESTABILITY = YES;
				GCC_C_LANGUAGE_STANDARD = gnu11;
				GCC_DYNAMIC_NO_PIC = NO;
				GCC_NO_COMMON_BLOCKS = YES;
				GCC_OPTIMIZATION_LEVEL = 0;
				GCC_PREPROCESSOR_DEFINITIONS = (
					"DEBUG=1",
					"$(inherited)",
				);
				GCC_WARN_64_TO_32_BIT_CONVERSION = YES;
				GCC_WARN_ABOUT_RETURN_TYPE = YES_ERROR;
				GCC_WARN_UNDECLARED_SELECTOR = YES;
				GCC_WARN_UNINITIALIZED_AUTOS = YES_AGGRESSIVE;
				GCC_WARN_UNUSED_FUNCTION = YES;
				GCC_WARN_UNUSED_VARIABLE = YES;
				IPHONEOS_DEPLOYMENT_TARGET = 15.0;
				MTL_ENABLE_DEBUG_INFO = YES;
				ONLY_ACTIVE_ARCH = YES;
				SDKROOT = iphoneos;
				SWIFT_ACTIVE_COMPILATION_CONDITIONS = DEBUG;
				SWIFT_OPTIMIZATION_LEVEL = "-Onone";
			};
			name = Debug;
		};
		504EC3151FED79650016851F /* Release */ = {
			isa = XCBuildConfiguration;
			buildSettings = {
				ALWAYS_SEARCH_USER_PATHS = NO;
				CLANG_ANALYZER_NONNULL = YES;
				CLANG_ANALYZER_NUMBER_OBJECT_CONVERSION = YES_AGGRESSIVE;
				CLANG_CXX_LANGUAGE_STANDARD = "gnu++14";
				CLANG_CXX_LIBRARY = "libc++";
				CLANG_ENABLE_MODULES = YES;
				CLANG_ENABLE_OBJC_ARC = YES;
				CLANG_WARN_BLOCK_CAPTURE_AUTORELEASING = YES;
				CLANG_WARN_BOOL_CONVERSION = YES;
				CLANG_WARN_COMMA = YES;
				CLANG_WARN_CONSTANT_CONVERSION = YES;
				CLANG_WARN_DIRECT_OBJC_ISA_USAGE = YES_ERROR;
				CLANG_WARN_DOCUMENTATION_COMMENTS = YES;
				CLANG_WARN_EMPTY_BODY = YES;
				CLANG_WARN_ENUM_CONVERSION = YES;
				CLANG_WARN_INFINITE_RECURSION = YES;
				CLANG_WARN_INT_CONVERSION = YES;
				CLANG_WARN_NON_LITERAL_NULL_CONVERSION = YES;
				CLANG_WARN_OBJC_LITERAL_CONVERSION = YES;
				CLANG_WARN_OBJC_ROOT_CLASS = YES_ERROR;
				CLANG_WARN_RANGE_LOOP_ANALYSIS = YES;
				CLANG_WARN_STRICT_PROTOTYPES = YES;
				CLANG_WARN_SUSPICIOUS_MOVE = YES;
				CLANG_WARN_UNGUARDED_AVAILABILITY = YES_AGGRESSIVE;
				CLANG_WARN_UNREACHABLE_CODE = YES;
				CLANG_WARN__DUPLICATE_METHOD_MATCH = YES;
				CODE_SIGN_IDENTITY = "iPhone Developer";
				COPY_PHASE_STRIP = NO;
				DEBUG_INFORMATION_FORMAT = "dwarf-with-dsym";
				ENABLE_NS_ASSERTIONS = NO;
				ENABLE_STRICT_OBJC_MSGSEND = YES;
				GCC_C_LANGUAGE_STANDARD = gnu11;
				GCC_NO_COMMON_BLOCKS = YES;
				GCC_WARN_64_TO_32_BIT_CONVERSION = YES;
				GCC_WARN_ABOUT_RETURN_TYPE = YES_ERROR;
				GCC_WARN_UNDECLARED_SELECTOR = YES;
				GCC_WARN_UNINITIALIZED_AUTOS = YES_AGGRESSIVE;
				GCC_WARN_UNUSED_FUNCTION = YES;
				GCC_WARN_UNUSED_VARIABLE = YES;
				IPHONEOS_DEPLOYMENT_TARGET = 15.0;
				MTL_ENABLE_DEBUG_INFO = NO;
				SDKROOT = iphoneos;
				SWIFT_COMPILATION_MODE = wholemodule;
				SWIFT_OPTIMIZATION_LEVEL = "-O";
				VALIDATE_PRODUCT = YES;
			};
			name = Release;
		};
		504EC3171FED79650016851F /* Debug */ = {
			isa = XCBuildConfiguration;
			baseConfigurationReference = 958DCC722DB07C7200EA8C5F /* debug.xcconfig */;
			buildSettings = {
				ASSETCATALOG_COMPILER_APPICON_NAME = AppIcon;
				CODE_SIGN_STYLE = Automatic;
				CURRENT_PROJECT_VERSION = 1;
				INFOPLIST_FILE = App/Info.plist;
				IPHONEOS_DEPLOYMENT_TARGET = 15.0;
				LD_RUNPATH_SEARCH_PATHS = (
					"$(inherited)",
					"@executable_path/Frameworks",
				);
				MARKETING_VERSION = 1.0;
				OTHER_SWIFT_FLAGS = "$(inherited) \"-D\" \"COCOAPODS\" \"-DDEBUG\"";
				PRODUCT_BUNDLE_IDENTIFIER = com.loungeapp.mobile;
				PRODUCT_NAME = "$(TARGET_NAME)";
				SWIFT_ACTIVE_COMPILATION_CONDITIONS = DEBUG;
				SWIFT_VERSION = 5.0;
				TARGETED_DEVICE_FAMILY = "1,2";
			};
			name = Debug;
		};
		504EC3181FED79650016851F /* Release */ = {
			isa = XCBuildConfiguration;
			buildSettings = {
				ASSETCATALOG_COMPILER_APPICON_NAME = AppIcon;
				CODE_SIGN_STYLE = Automatic;
				CURRENT_PROJECT_VERSION = 1;
				INFOPLIST_FILE = App/Info.plist;
				IPHONEOS_DEPLOYMENT_TARGET = 15.0;
				LD_RUNPATH_SEARCH_PATHS = (
					"$(inherited)",
					"@executable_path/Frameworks",
				);
				MARKETING_VERSION = 1.0;
				PRODUCT_BUNDLE_IDENTIFIER = com.loungeapp.mobile;
				PRODUCT_NAME = "$(TARGET_NAME)";
				SWIFT_ACTIVE_COMPILATION_CONDITIONS = "";
				SWIFT_VERSION = 5.0;
				TARGETED_DEVICE_FAMILY = "1,2";
			};
			name = Release;
		};
/* End XCBuildConfiguration section */

/* Begin XCConfigurationList section */
		504EC2FF1FED79650016851F /* Build configuration list for PBXProject "App" */ = {
			isa = XCConfigurationList;
			buildConfigurations = (
				504EC3141FED79650016851F /* Debug */,
				504EC3151FED79650016851F /* Release */,
			);
			defaultConfigurationIsVisible = 0;
			defaultConfigurationName = Release;
		};
		504EC3161FED79650016851F /* Build configuration list for PBXNativeTarget "App" */ = {
			isa = XCConfigurationList;
			buildConfigurations = (
				504EC3171FED79650016851F /* Debug */,
				504EC3181FED79650016851F /* Release */,
			);
			defaultConfigurationIsVisible = 0;
			defaultConfigurationName = Release;
		};
/* End XCConfigurationList section */

/* Begin XCLocalSwiftPackageReference section */
		D4C12C0A2AAA248700AAC8A2 /* XCLocalSwiftPackageReference "CapApp-SPM" */ = {
			isa = XCLocalSwiftPackageReference;
			relativePath = "CapApp-SPM";
		};
/* End XCLocalSwiftPackageReference section */

/* Begin XCSwiftPackageProductDependency section */
		4D22ABE82AF431CB00220026 /* CapApp-SPM */ = {
			isa = XCSwiftPackageProductDependency;
			package = D4C12C0A2AAA248700AAC8A2 /* XCLocalSwiftPackageReference "CapApp-SPM" */;
			productName = "CapApp-SPM";
		};
/* End XCSwiftPackageProductDependency section */
	};
	rootObject = 504EC2FC1FED79650016851F /* Project object */;
}
</file>

<file path="ios/App/App.xcodeproj/project.xcworkspace/xcshareddata/IDEWorkspaceChecks.plist">
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>IDEDidComputeMac32BitWarning</key>
	<true/>
</dict>
</plist>
</file>

<file path="ios/App/App/AppDelegate.swift">
import UIKit
import Capacitor

@UIApplicationMain
class AppDelegate: UIResponder, UIApplicationDelegate {

    var window: UIWindow?

    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {
        // Override point for customization after application launch.
        return true
    }

    func applicationWillResignActive(_ application: UIApplication) {
        // Sent when the application is about to move from active to inactive state. This can occur for certain types of temporary interruptions (such as an incoming phone call or SMS message) or when the user quits the application and it begins the transition to the background state.
        // Use this method to pause ongoing tasks, disable timers, and invalidate graphics rendering callbacks. Games should use this method to pause the game.
    }

    func applicationDidEnterBackground(_ application: UIApplication) {
        // Use this method to release shared resources, save user data, invalidate timers, and store enough application state information to restore your application to its current state in case it is terminated later.
        // If your application supports background execution, this method is called instead of applicationWillTerminate: when the user quits.
    }

    func applicationWillEnterForeground(_ application: UIApplication) {
        // Called as part of the transition from the background to the active state; here you can undo many of the changes made on entering the background.
    }

    func applicationDidBecomeActive(_ application: UIApplication) {
        // Restart any tasks that were paused (or not yet started) while the application was inactive. If the application was previously in the background, optionally refresh the user interface.
    }

    func applicationWillTerminate(_ application: UIApplication) {
        // Called when the application is about to terminate. Save data if appropriate. See also applicationDidEnterBackground:.
    }

    func application(_ app: UIApplication, open url: URL, options: [UIApplication.OpenURLOptionsKey: Any] = [:]) -> Bool {
        // Called when the app was launched with a url. Feel free to add additional processing here,
        // but if you want the App API to support tracking app url opens, make sure to keep this call
        return ApplicationDelegateProxy.shared.application(app, open: url, options: options)
    }

    func application(_ application: UIApplication, continue userActivity: NSUserActivity, restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {
        // Called when the app was launched with an activity, including Universal Links.
        // Feel free to add additional processing here, but if you want the App API to support
        // tracking app url opens, make sure to keep this call
        return ApplicationDelegateProxy.shared.application(application, continue: userActivity, restorationHandler: restorationHandler)
    }

}
</file>

<file path="ios/App/App/Assets.xcassets/AppIcon.appiconset/Contents.json">
{
  "images" : [
    {
      "filename" : "AppIcon-512@2x.png",
      "idiom" : "universal",
      "platform" : "ios",
      "size" : "1024x1024"
    }
  ],
  "info" : {
    "author" : "xcode",
    "version" : 1
  }
}
</file>

<file path="ios/App/App/Assets.xcassets/Contents.json">
{
  "info" : {
    "version" : 1,
    "author" : "xcode"
  }
}
</file>

<file path="ios/App/App/Assets.xcassets/Splash.imageset/Contents.json">
{
  "images" : [
    {
      "idiom" : "universal",
      "filename" : "splash-2732x2732-2.png",
      "scale" : "1x"
    },
    {
      "idiom" : "universal",
      "filename" : "splash-2732x2732-1.png",
      "scale" : "2x"
    },
    {
      "idiom" : "universal",
      "filename" : "splash-2732x2732.png",
      "scale" : "3x"
    }
  ],
  "info" : {
    "version" : 1,
    "author" : "xcode"
  }
}
</file>

<file path="ios/App/App/Base.lproj/LaunchScreen.storyboard">
<?xml version="1.0" encoding="UTF-8"?>
<document type="com.apple.InterfaceBuilder3.CocoaTouch.Storyboard.XIB" version="3.0" toolsVersion="17132" targetRuntime="iOS.CocoaTouch" propertyAccessControl="none" useAutolayout="YES" launchScreen="YES" useTraitCollections="YES" useSafeAreas="YES" colorMatched="YES" initialViewController="01J-lp-oVM">
    <device id="retina4_7" orientation="portrait" appearance="light"/>
    <dependencies>
        <deployment identifier="iOS"/>
        <plugIn identifier="com.apple.InterfaceBuilder.IBCocoaTouchPlugin" version="17105"/>
        <capability name="System colors in document resources" minToolsVersion="11.0"/>
        <capability name="documents saved in the Xcode 8 format" minToolsVersion="8.0"/>
    </dependencies>
    <scenes>
        <!--View Controller-->
        <scene sceneID="EHf-IW-A2E">
            <objects>
                <viewController id="01J-lp-oVM" sceneMemberID="viewController">
                    <imageView key="view" userInteractionEnabled="NO" contentMode="scaleAspectFill" horizontalHuggingPriority="251" verticalHuggingPriority="251" image="Splash" id="snD-IY-ifK">
                        <rect key="frame" x="0.0" y="0.0" width="375" height="667"/>
                        <autoresizingMask key="autoresizingMask"/>
                        <color key="backgroundColor" systemColor="systemBackgroundColor"/>
                    </imageView>
                </viewController>
                <placeholder placeholderIdentifier="IBFirstResponder" id="iYj-Kq-Ea1" userLabel="First Responder" sceneMemberID="firstResponder"/>
            </objects>
            <point key="canvasLocation" x="53" y="375"/>
        </scene>
    </scenes>
    <resources>
        <image name="Splash" width="1366" height="1366"/>
        <systemColor name="systemBackgroundColor">
            <color white="1" alpha="1" colorSpace="custom" customColorSpace="genericGamma22GrayColorSpace"/>
        </systemColor>
    </resources>
</document>
</file>

<file path="ios/App/App/Base.lproj/Main.storyboard">
<?xml version="1.0" encoding="UTF-8"?>
<document type="com.apple.InterfaceBuilder3.CocoaTouch.Storyboard.XIB" version="3.0" toolsVersion="14111" targetRuntime="iOS.CocoaTouch" propertyAccessControl="none" useAutolayout="YES" useTraitCollections="YES" colorMatched="YES" initialViewController="BYZ-38-t0r">
    <device id="retina4_7" orientation="portrait">
        <adaptation id="fullscreen"/>
    </device>
    <dependencies>
        <deployment identifier="iOS"/>
        <plugIn identifier="com.apple.InterfaceBuilder.IBCocoaTouchPlugin" version="14088"/>
    </dependencies>
    <scenes>
        <!--Bridge View Controller-->
        <scene sceneID="tne-QT-ifu">
            <objects>
                <viewController id="BYZ-38-t0r" customClass="CAPBridgeViewController" customModule="Capacitor" sceneMemberID="viewController"/>
                <placeholder placeholderIdentifier="IBFirstResponder" id="dkx-z0-nzr" sceneMemberID="firstResponder"/>
            </objects>
        </scene>
    </scenes>
</document>
</file>

<file path="ios/App/App/Info.plist">
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>CAPACITOR_DEBUG</key>
	<string>$(CAPACITOR_DEBUG)</string>
	<key>CFBundleDevelopmentRegion</key>
	<string>en</string>
	<key>CFBundleDisplayName</key>
        <string>Lounge App</string>
	<key>CFBundleExecutable</key>
	<string>$(EXECUTABLE_NAME)</string>
	<key>CFBundleIdentifier</key>
	<string>$(PRODUCT_BUNDLE_IDENTIFIER)</string>
	<key>CFBundleInfoDictionaryVersion</key>
	<string>6.0</string>
	<key>CFBundleName</key>
	<string>$(PRODUCT_NAME)</string>
	<key>CFBundlePackageType</key>
	<string>APPL</string>
	<key>CFBundleShortVersionString</key>
	<string>$(MARKETING_VERSION)</string>
	<key>CFBundleVersion</key>
	<string>$(CURRENT_PROJECT_VERSION)</string>
	<key>LSRequiresIPhoneOS</key>
	<true/>
	<key>UILaunchStoryboardName</key>
	<string>LaunchScreen</string>
	<key>UIMainStoryboardFile</key>
	<string>Main</string>
	<key>UIRequiredDeviceCapabilities</key>
	<array>
		<string>armv7</string>
	</array>
	<key>UISupportedInterfaceOrientations</key>
	<array>
		<string>UIInterfaceOrientationPortrait</string>
		<string>UIInterfaceOrientationLandscapeLeft</string>
		<string>UIInterfaceOrientationLandscapeRight</string>
	</array>
	<key>UISupportedInterfaceOrientations~ipad</key>
	<array>
		<string>UIInterfaceOrientationPortrait</string>
		<string>UIInterfaceOrientationPortraitUpsideDown</string>
		<string>UIInterfaceOrientationLandscapeLeft</string>
		<string>UIInterfaceOrientationLandscapeRight</string>
	</array>
	<key>UIViewControllerBasedStatusBarAppearance</key>
	<true/>
</dict>
</plist>
</file>

<file path="ios/App/CapApp-SPM/.gitignore">
.DS_Store
/.build
/Packages
/*.xcodeproj
xcuserdata/
DerivedData/
.swiftpm/config/registries.json
.swiftpm/xcode/package.xcworkspace/contents.xcworkspacedata
.netrc
</file>

<file path="ios/App/CapApp-SPM/Package.swift">
// swift-tools-version: 5.9
import PackageDescription

// DO NOT MODIFY THIS FILE - managed by Capacitor CLI commands
let package = Package(
    name: "CapApp-SPM",
    platforms: [.iOS(.v15)],
    products: [
        .library(
            name: "CapApp-SPM",
            targets: ["CapApp-SPM"])
    ],
    dependencies: [
        .package(url: "https://github.com/ionic-team/capacitor-swift-pm.git", exact: "8.0.0"),
        .package(name: "CapacitorPushNotifications", path: "..\..\..\node_modules\@capacitor\push-notifications")
    ],
    targets: [
        .target(
            name: "CapApp-SPM",
            dependencies: [
                .product(name: "Capacitor", package: "capacitor-swift-pm"),
                .product(name: "Cordova", package: "capacitor-swift-pm"),
                .product(name: "CapacitorPushNotifications", package: "CapacitorPushNotifications")
            ]
        )
    ]
)
</file>

<file path="ios/App/CapApp-SPM/README.md">
# CapApp-SPM

This SPM is used to host SPM dependencies for you Capacitor project

Do not modify the contents of it or there may be unintended consequences.
</file>

<file path="ios/App/CapApp-SPM/Sources/CapApp-SPM/CapApp-SPM.swift">
public let isCapacitorApp = true
</file>

<file path="ios/debug.xcconfig">
CAPACITOR_DEBUG = true
</file>

<file path="netlify/functions/send-alimtalk-proxy.js">
const fetch = require('node-fetch');

exports.handler = async (event) => {
  // CORS í—¤ë”
  const headers = {
    'Access-Control-Allow-Origin': '*',
    'Access-Control-Allow-Headers': 'Content-Type',
    'Access-Control-Allow-Methods': 'POST, OPTIONS'
  };

  // OPTIONS ìš”ì²­ ì²˜ë¦¬
  if (event.httpMethod === 'OPTIONS') {
    return { statusCode: 200, headers, body: '' };
  }

  console.log('ğŸ”„ ì¹´í˜24 í”„ë¡ì‹œ ì‹œì‘');

  try {
    const data = JSON.parse(event.body);
    console.log('ğŸ“¨ ë°›ì€ ë°ì´í„°:', {
      name: data.name,
      phone: data.phone,
      checkIn: data.checkIn,
      checkOut: data.checkOut,
      alimtalkEnabled: data.alimtalkEnabled
    });

    // ì¹´í˜24ë¡œ ìš”ì²­ ì „ë‹¬ (ì¿ í‚¤ ìë™ ì²˜ë¦¬)
    console.log('ğŸŒ ì¹´í˜24 API í˜¸ì¶œ ì¤‘...');
    
    const requestOptions = {
      method: 'POST',
      headers: { 
        'Content-Type': 'application/json',
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
      },
      body: JSON.stringify(data),
      redirect: 'follow'  // ë¦¬ë‹¤ì´ë ‰íŠ¸ ìë™ ì¶”ì 
    };

    let response = await fetch('https://lunagarden.co.kr/guest/send_alimtalk.php', requestOptions);
    
    // CUPID ì¿ í‚¤ ì²´í¬ - HTML ì‘ë‹µì´ë©´ ì¿ í‚¤ í¬í•¨í•´ì„œ ì¬ì‹œë„
    let responseText = await response.text();
    
    if (responseText.includes('CUPID') && responseText.includes('ckattempt=1')) {
      console.log('ğŸª CUPID ì¿ í‚¤ ê°ì§€ - ì¬ì‹œë„ ì¤‘...');
      
      // Set-Cookie í—¤ë”ì—ì„œ ì¿ í‚¤ ì¶”ì¶œ
      const cookies = response.headers.raw()['set-cookie'];
      let cookieHeader = '';
      
      if (cookies) {
        cookieHeader = cookies.map(cookie => cookie.split(';')[0]).join('; ');
        console.log('ğŸª ì¿ í‚¤ ì„¤ì •:', cookieHeader);
      }
      
      // ì¿ í‚¤ í¬í•¨í•´ì„œ ì¬ì‹œë„
      requestOptions.headers['Cookie'] = cookieHeader;
      response = await fetch('https://lunagarden.co.kr/guest/send_alimtalk.php?ckattempt=1', requestOptions);
      responseText = await response.text();
      
      console.log('ğŸ”„ ì¬ì‹œë„ ì‘ë‹µ ìƒíƒœ:', response.status);
    }

    console.log('ğŸ“¥ ì¹´í˜24 ì‘ë‹µ:', {
      status: response.status,
      statusText: response.statusText,
      bodyStart: responseText.substring(0, 100)
    });

    let result;
    try {
      result = JSON.parse(responseText);
    } catch (parseError) {
      console.error('âŒ JSON íŒŒì‹± ì‹¤íŒ¨');
      console.error('ì‘ë‹µ ë‚´ìš©:', responseText.substring(0, 500));
      
      return {
        statusCode: 500,
        headers,
        body: JSON.stringify({
          success: false,
          alimtalk: {
            success: false,
            message: 'ì¹´í˜24 ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜',
            error: 'Invalid JSON response',
            rawResponse: responseText.substring(0, 200)
          }
        })
      };
    }

    console.log('âœ… í”„ë¡ì‹œ ì™„ë£Œ:', result);

    return {
      statusCode: 200,
      headers,
      body: JSON.stringify(result)
    };

  } catch (error) {
    console.error('âŒ í”„ë¡ì‹œ ì—ëŸ¬:', error);
    
    return {
      statusCode: 500,
      headers,
      body: JSON.stringify({
        success: false,
        alimtalk: {
          success: false,
          message: 'ì•Œë¦¼í†¡ ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
          error: error.message
        }
      })
    };
  }
};
</file>

<file path="netlify/functions/send-praise-notification.js">
// netlify/functions/send-praise-notification.js
import { Resend } from 'resend';

const resend = new Resend(process.env.RESEND_API_KEY);

export async function handler(event) {
  const headers = {
    'Access-Control-Allow-Origin': '*',
    'Access-Control-Allow-Headers': 'Content-Type',
    'Access-Control-Allow-Methods': 'POST, OPTIONS',
    'Content-Type': 'application/json'
  };

  if (event.httpMethod === 'OPTIONS') {
    return { statusCode: 200, headers, body: '' };
  }

  if (event.httpMethod !== 'POST') {
    return {
      statusCode: 405,
      headers,
      body: JSON.stringify({ error: 'Method not allowed' })
    };
  }

  try {
    const { 
      spaceId, 
      spaceName, 
      userName, 
      originalText, 
      refinedText, 
      eventDate 
    } = JSON.parse(event.body);

    const htmlContent = `
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="UTF-8">
        <style>
          body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; line-height: 1.6; color: #333; }
          .container { max-width: 600px; margin: 0 auto; padding: 20px; }
          .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 10px 10px 0 0; }
          .content { background: #f7f7f7; padding: 30px; border-radius: 0 0 10px 10px; }
          .card { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #667eea; }
          .label { font-size: 12px; color: #666; font-weight: bold; margin-bottom: 5px; }
          .value { font-size: 16px; color: #333; margin-bottom: 15px; }
          .button { display: inline-block; padding: 12px 30px; background: #667eea; color: white; text-decoration: none; border-radius: 6px; font-weight: bold; }
          .footer { text-align: center; color: #999; font-size: 12px; margin-top: 30px; }
        </style>
      </head>
      <body>
        <div class="container">
          <div class="header">
            <h1 style="margin: 0;">âœ¨ ìƒˆë¡œìš´ ì¹­ì°¬ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤</h1>
            <p style="margin: 10px 0 0 0; opacity: 0.9;">ê´€ë¦¬ì ìŠ¹ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</p>
          </div>
          <div class="content">
            <div class="card">
              <div class="label">ë¼ìš´ì§€</div>
              <div class="value">${spaceName}</div>
              
              <div class="label">ì‘ì„±ì</div>
              <div class="value">${userName}</div>
              
              <div class="label">ë‚ ì§œ</div>
              <div class="value">${eventDate}</div>
            </div>

            <div class="card">
              <div class="label">ì›ë³¸ í…ìŠ¤íŠ¸ (ì£¼ì–´ ì œê±°ë¨)</div>
              <div class="value" style="background: #f0f0f0; padding: 15px; border-radius: 6px;">
                ${originalText}
              </div>
            </div>

            <div class="card">
              <div class="label">AI ì •ì œëœ ê²Œì‹œìš© í…ìŠ¤íŠ¸</div>
              <div class="value" style="background: #e8f5e9; padding: 15px; border-radius: 6px; color: #2e7d32;">
                ${refinedText}
              </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
              <a href="https://geha-app.netlify.app/praise" class="button">
                ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ìŠ¹ì¸í•˜ê¸°
              </a>
            </div>
          </div>
          
          <div class="footer">
            <p>ì´ ì´ë©”ì¼ì€ ê²Œí•˜ ì•±ì—ì„œ ìë™ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
          </div>
        </div>
      </body>
      </html>
    `;

    const textContent = `
ìƒˆë¡œìš´ ì¹­ì°¬ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤

ë¼ìš´ì§€: ${spaceName}
ì‘ì„±ì: ${userName}
ë‚ ì§œ: ${eventDate}

[ì›ë³¸]
${originalText}

[ê²Œì‹œìš©]
${refinedText}

ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ìŠ¹ì¸í•´ì£¼ì„¸ìš”:
https://geha-app.netlify.app/praise
    `;

    const data = await resend.emails.send({
      from: 'geha-app@resend.dev',
      to: 'reshw@naver.com',
      subject: `[ê²Œí•˜] ìƒˆë¡œìš´ ì¹­ì°¬ ë“±ë¡ - ${userName}`,
      html: htmlContent,
      text: textContent
    });

    console.log('âœ… ì´ë©”ì¼ ë°œì†¡ ì„±ê³µ:', data);

    return {
      statusCode: 200,
      headers,
      body: JSON.stringify({ 
        success: true, 
        messageId: data.id 
      })
    };

  } catch (error) {
    console.error('âŒ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨:', error);
    
    return {
      statusCode: 200,
      headers,
      body: JSON.stringify({ 
        success: false, 
        error: error.message 
      })
    };
  }
}
</file>

<file path="src/components/bartender/BartenderMenuFormModal.jsx">
import { useState, useEffect } from 'react';
import { X, Loader2, Upload, Image as ImageIcon } from 'lucide-react';

const CATEGORIES = ['ì¹µí…Œì¼', 'ë§¥ì£¼', 'ìœ„ìŠ¤í‚¤', 'ì•ˆì£¼', 'ê¸°íƒ€'];

export default function BartenderMenuFormModal({ mode, menu, onClose, onSave, currentUser }) {
  const [loading, setLoading] = useState(false);
  const [uploading, setUploading] = useState(false);
  const [imageFile, setImageFile] = useState(null);
  const [imagePreview, setImagePreview] = useState(null);
  const [formData, setFormData] = useState({
    menuName: '',
    price: '',
    category: 'ì¹µí…Œì¼',
    description: '',
    imageUrl: ''
  });

  useEffect(() => {
    if (mode === 'edit' && menu) {
      setFormData({
        menuName: menu.menuName || '',
        price: menu.price?.toString() || '',
        category: menu.category || 'ì¹µí…Œì¼',
        description: menu.description || '',
        imageUrl: menu.imageUrl || ''
      });
      if (menu.imageUrl) {
        setImagePreview(menu.imageUrl);
      }
    }
  }, [mode, menu]);

  const handleImageSelect = (e) => {
    const file = e.target.files[0];
    if (!file) return;

    if (file.size > 10 * 1024 * 1024) {
      alert('íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤');
      return;
    }

    setImageFile(file);
    const reader = new FileReader();
    reader.onloadend = () => {
      setImagePreview(reader.result);
    };
    reader.readAsDataURL(file);
  };

  const removeImage = () => {
    setImageFile(null);
    setImagePreview(null);
    setFormData(prev => ({ ...prev, imageUrl: '' }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();

    if (!formData.menuName.trim()) {
      alert('ë©”ë‰´ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
      return;
    }

    if (!formData.price || parseFloat(formData.price) <= 0) {
      alert('ê°€ê²©ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”');
      return;
    }

    setLoading(true);
    try {
      let imageUrl = formData.imageUrl;

      // ìƒˆ ì´ë¯¸ì§€ ì—…ë¡œë“œ
      if (imageFile) {
        setUploading(true);
        const uploadFormData = new FormData();
        uploadFormData.append('file', imageFile);
        uploadFormData.append('upload_preset', import.meta.env.VITE_CLOUDINARY_UPLOAD_PRESET);
        uploadFormData.append('folder', 'bartender-menu');

        const uploadResponse = await fetch(
          `https://api.cloudinary.com/v1_1/dhnyr34t1/image/upload`,
          {
            method: 'POST',
            body: uploadFormData
          }
        );

        if (!uploadResponse.ok) {
          throw new Error('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨');
        }

        const uploadResult = await uploadResponse.json();
        imageUrl = uploadResult.secure_url;
        console.log('âœ… ì´ë¯¸ì§€ ì—…ë¡œë“œ ì™„ë£Œ:', imageUrl);
        setUploading(false);
      }

      const menuData = {
        menuName: formData.menuName.trim(),
        price: parseFloat(formData.price),
        category: formData.category,
        description: formData.description.trim(),
        imageUrl: imageUrl,
        ...(mode === 'create' ? {
          createdBy: currentUser.id,
          createdByName: currentUser.displayName
        } : {
          updatedBy: currentUser.id,
          updatedByName: currentUser.displayName
        })
      };

      await onSave(menuData);
      onClose();
    } catch (error) {
      console.error('âŒ ë©”ë‰´ ì €ì¥ ì‹¤íŒ¨:', error);
      alert('ë©”ë‰´ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\nì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
      setLoading(false);
      setUploading(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto">
        {/* í—¤ë” */}
        <div className="sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between rounded-t-2xl">
          <h2 className="text-2xl font-bold text-gray-900">
            {mode === 'create' ? 'ë©”ë‰´ ì¶”ê°€' : 'ë©”ë‰´ ìˆ˜ì •'}
          </h2>
          <button
            onClick={onClose}
            className="p-2 hover:bg-gray-100 rounded-full transition-colors"
            disabled={loading}
          >
            <X className="w-5 h-5 text-gray-500" />
          </button>
        </div>

        {/* í¼ */}
        <form onSubmit={handleSubmit} className="p-6 space-y-6">
          {/* ë©”ë‰´ëª… */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-2">
              ë©”ë‰´ëª… <span className="text-red-500">*</span>
            </label>
            <input
              type="text"
              value={formData.menuName}
              onChange={(e) => setFormData({ ...formData, menuName: e.target.value })}
              className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
              placeholder="ì˜ˆ: ì§„í† ë‹‰"
              disabled={loading}
              required
            />
          </div>

          {/* ê°€ê²© */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-2">
              ê°€ê²© <span className="text-red-500">*</span>
            </label>
            <div className="relative">
              <input
                type="number"
                value={formData.price}
                onChange={(e) => setFormData({ ...formData, price: e.target.value })}
                className="w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                placeholder="15000"
                disabled={loading}
                required
                min="0"
                step="100"
              />
              <span className="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500">ì›</span>
            </div>
          </div>

          {/* ì¹´í…Œê³ ë¦¬ */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-2">
              ì¹´í…Œê³ ë¦¬ <span className="text-red-500">*</span>
            </label>
            <select
              value={formData.category}
              onChange={(e) => setFormData({ ...formData, category: e.target.value })}
              className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
              disabled={loading}
              required
            >
              {CATEGORIES.map((cat) => (
                <option key={cat} value={cat}>{cat}</option>
              ))}
            </select>
          </div>

          {/* ì„¤ëª… */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-2">
              ì„¤ëª…
            </label>
            <textarea
              value={formData.description}
              onChange={(e) => setFormData({ ...formData, description: e.target.value })}
              className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
              placeholder="ë©”ë‰´ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
              rows={3}
              disabled={loading}
            />
          </div>

          {/* ì´ë¯¸ì§€ ì—…ë¡œë“œ */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-2">
              ë©”ë‰´ ì´ë¯¸ì§€
            </label>

            {imagePreview ? (
              <div className="relative">
                <img
                  src={imagePreview}
                  alt="ë©”ë‰´ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°"
                  className="w-full h-48 object-cover rounded-lg"
                />
                <button
                  type="button"
                  onClick={removeImage}
                  className="absolute top-2 right-2 p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors shadow-lg"
                  disabled={loading}
                >
                  <X className="w-4 h-4" />
                </button>
              </div>
            ) : (
              <label className="flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-orange-500 hover:bg-orange-50 transition-colors">
                <div className="flex flex-col items-center justify-center pt-5 pb-6">
                  <ImageIcon className="w-12 h-12 text-gray-400 mb-3" />
                  <p className="text-sm text-gray-600 font-semibold">í´ë¦­í•˜ì—¬ ì´ë¯¸ì§€ ì—…ë¡œë“œ</p>
                  <p className="text-xs text-gray-500 mt-1">PNG, JPG (ìµœëŒ€ 10MB)</p>
                </div>
                <input
                  type="file"
                  accept="image/*"
                  onChange={handleImageSelect}
                  className="hidden"
                  disabled={loading}
                />
              </label>
            )}
          </div>

          {/* ë²„íŠ¼ */}
          <div className="flex gap-3 pt-4">
            <button
              type="button"
              onClick={onClose}
              className="flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition-colors"
              disabled={loading}
            >
              ì·¨ì†Œ
            </button>
            <button
              type="submit"
              className="flex-1 px-6 py-3 bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-lg font-semibold hover:from-orange-600 hover:to-amber-600 transition-all shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
              disabled={loading}
            >
              {uploading ? (
                <>
                  <Upload className="w-5 h-5 animate-bounce" />
                  ì—…ë¡œë“œ ì¤‘...
                </>
              ) : loading ? (
                <>
                  <Loader2 className="w-5 h-5 animate-spin" />
                  ì €ì¥ ì¤‘...
                </>
              ) : (
                mode === 'create' ? 'ì¶”ê°€' : 'ìˆ˜ì •'
              )}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
}
</file>

<file path="src/components/bartender/BartenderOrderDetailModal.jsx">
import { X, User, Calendar, FileText } from 'lucide-react';

export default function BartenderOrderDetailModal({ order, onClose }) {
  const formatDateTime = (date) => {
    if (!date) return '-';
    return new Date(date).toLocaleDateString('ko-KR', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto">
        {/* í—¤ë” */}
        <div className="sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between rounded-t-2xl">
          <h2 className="text-2xl font-bold text-gray-900">ì£¼ë¬¸ ìƒì„¸</h2>
          <button
            onClick={onClose}
            className="p-2 hover:bg-gray-100 rounded-full transition-colors"
          >
            <X className="w-5 h-5 text-gray-500" />
          </button>
        </div>

        {/* ë‚´ìš© */}
        <div className="p-6 space-y-6">
          {/* ì£¼ë¬¸ ì •ë³´ */}
          <div className="space-y-3">
            <div className="flex items-center gap-3 text-gray-700">
              <User className="w-5 h-5 text-orange-500" />
              <div>
                <p className="text-sm text-gray-500">ì£¼ë¬¸ì</p>
                <p className="font-semibold">{order.userName}</p>
              </div>
            </div>

            <div className="flex items-center gap-3 text-gray-700">
              <Calendar className="w-5 h-5 text-orange-500" />
              <div>
                <p className="text-sm text-gray-500">ì£¼ë¬¸ì¼ì‹œ</p>
                <p className="font-semibold">{formatDateTime(order.createdAt)}</p>
              </div>
            </div>
          </div>

          {/* ì£¼ë¬¸ í•­ëª© */}
          <div>
            <h3 className="text-sm font-semibold text-gray-700 mb-3">ì£¼ë¬¸ í•­ëª©</h3>
            <div className="bg-gray-50 rounded-lg overflow-hidden">
              <table className="w-full">
                <thead className="bg-gray-100">
                  <tr>
                    <th className="px-4 py-2 text-left text-sm font-semibold text-gray-700">ë©”ë‰´</th>
                    <th className="px-4 py-2 text-center text-sm font-semibold text-gray-700">ìˆ˜ëŸ‰</th>
                    <th className="px-4 py-2 text-right text-sm font-semibold text-gray-700">ê¸ˆì•¡</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-gray-200">
                  {order.items.map((item, index) => (
                    <tr key={index}>
                      <td className="px-4 py-3">
                        <p className="font-medium text-gray-900">{item.menuName}</p>
                        <p className="text-sm text-gray-500">{item.price.toLocaleString()}ì›</p>
                      </td>
                      <td className="px-4 py-3 text-center text-gray-900">
                        {item.quantity}
                      </td>
                      <td className="px-4 py-3 text-right font-semibold text-gray-900">
                        {item.total.toLocaleString()}ì›
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>

          {/* ì´ì•¡ */}
          <div className="bg-gradient-to-r from-orange-50 to-amber-50 rounded-lg p-4">
            <div className="flex items-center justify-between">
              <span className="text-lg font-semibold text-gray-900">ì´ ê¸ˆì•¡</span>
              <span className="text-2xl font-bold text-orange-600">
                {order.totalAmount.toLocaleString()}ì›
              </span>
            </div>
          </div>

          {/* ë©”ëª¨ */}
          {order.memo && (
            <div>
              <div className="flex items-center gap-2 mb-2">
                <FileText className="w-5 h-5 text-orange-500" />
                <h3 className="text-sm font-semibold text-gray-700">ìš”ì²­ ì‚¬í•­</h3>
              </div>
              <div className="bg-gray-50 rounded-lg p-4">
                <p className="text-gray-700 whitespace-pre-wrap">{order.memo}</p>
              </div>
            </div>
          )}

          {/* ë‹«ê¸° ë²„íŠ¼ */}
          <button
            onClick={onClose}
            className="w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-lg font-semibold hover:from-orange-600 hover:to-amber-600 transition-all shadow-lg"
          >
            ë‹«ê¸°
          </button>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/bartender/BartenderOrderModal.jsx">
import { useState } from 'react';
import { X, Loader2, ShoppingCart } from 'lucide-react';

export default function BartenderOrderModal({ cart, onClose, onSubmit }) {
  const [loading, setLoading] = useState(false);
  const [memo, setMemo] = useState('');

  const totalAmount = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

  const handleSubmit = async (e) => {
    e.preventDefault();

    if (cart.length === 0) {
      alert('ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤');
      return;
    }

    setLoading(true);
    try {
      await onSubmit(cart, memo);
      onClose();
    } catch (error) {
      console.error('âŒ ì£¼ë¬¸ ì‹¤íŒ¨:', error);
      alert('ì£¼ë¬¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\nì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto">
        {/* í—¤ë” */}
        <div className="sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between rounded-t-2xl">
          <h2 className="text-2xl font-bold text-gray-900 flex items-center gap-2">
            <ShoppingCart className="w-6 h-6 text-orange-500" />
            ì£¼ë¬¸ í™•ì¸
          </h2>
          <button
            onClick={onClose}
            className="p-2 hover:bg-gray-100 rounded-full transition-colors"
            disabled={loading}
          >
            <X className="w-5 h-5 text-gray-500" />
          </button>
        </div>

        {/* ì£¼ë¬¸ ë‚´ì—­ */}
        <form onSubmit={handleSubmit} className="p-6 space-y-6">
          {/* ì£¼ë¬¸ í•­ëª© */}
          <div>
            <h3 className="text-sm font-semibold text-gray-700 mb-3">ì£¼ë¬¸ í•­ëª©</h3>
            <div className="space-y-3">
              {cart.map((item, index) => (
                <div key={index} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <div className="flex-1">
                    <p className="font-semibold text-gray-900">{item.menuName}</p>
                    <p className="text-sm text-gray-600">
                      {item.price.toLocaleString()}ì› Ã— {item.quantity}
                    </p>
                  </div>
                  <p className="font-bold text-orange-600">
                    {(item.price * item.quantity).toLocaleString()}ì›
                  </p>
                </div>
              ))}
            </div>
          </div>

          {/* ì´ì•¡ */}
          <div className="border-t border-gray-200 pt-4">
            <div className="flex items-center justify-between">
              <span className="text-lg font-semibold text-gray-900">ì´ ê¸ˆì•¡</span>
              <span className="text-2xl font-bold text-orange-600">
                {totalAmount.toLocaleString()}ì›
              </span>
            </div>
          </div>

          {/* ë©”ëª¨ */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-2">
              ìš”ì²­ ì‚¬í•­ (ì„ íƒ)
            </label>
            <textarea
              value={memo}
              onChange={(e) => setMemo(e.target.value)}
              className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
              placeholder="ì£¼ë¬¸ ì‹œ ë°”í…ë”ì—ê²Œ ì „ë‹¬í•  ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
              rows={3}
              disabled={loading}
            />
          </div>

          {/* ë²„íŠ¼ */}
          <div className="flex gap-3 pt-4">
            <button
              type="button"
              onClick={onClose}
              className="flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition-colors"
              disabled={loading}
            >
              ì·¨ì†Œ
            </button>
            <button
              type="submit"
              className="flex-1 px-6 py-3 bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-lg font-semibold hover:from-orange-600 hover:to-amber-600 transition-all shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
              disabled={loading}
            >
              {loading ? (
                <>
                  <Loader2 className="w-5 h-5 animate-spin" />
                  ì£¼ë¬¸ ì¤‘...
                </>
              ) : (
                `${totalAmount.toLocaleString()}ì› ì£¼ë¬¸í•˜ê¸°`
              )}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
}
</file>

<file path="src/components/common/MainLayout.jsx">
// components/common/MainLayout.jsx
import { Outlet } from 'react-router-dom';
import BottomNav from './BottomNav';

export default function MainLayout() {
  return (
    <div className="min-h-screen bg-gray-50">
      {/* í˜ì´ì§€ ì»¨í…ì¸  */}
      <Outlet />
      
      {/* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ - ëª¨ë“  í˜ì´ì§€ì— ê³µí†µ ì ìš© */}
      <BottomNav />
    </div>
  );
}
</file>

<file path="src/components/common/Modal.jsx">
import { X } from 'lucide-react';

const Modal = ({ isOpen, onClose, title, children }) => {
  if (!isOpen) return null;
  
  return (
    <div 
      className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4"
      onClick={onClose}
    >
      <div
        className="bg-white rounded-2xl max-w-2xl w-full max-w-[calc(100vw-2rem)] max-h-[90vh] overflow-y-auto"
        onClick={(e) => e.stopPropagation()}
      >
        <div className="flex items-center justify-between p-6 border-b sticky top-0 bg-white">
          <h2 className="text-xl font-bold">{title}</h2>
          <button onClick={onClose} className="p-2 hover:bg-gray-100 rounded-lg">
            <X className="w-5 h-5" />
          </button>
        </div>
        <div className="p-6">{children}</div>
      </div>
    </div>
  );
};

export default Modal;
</file>

<file path="src/components/reservations/CancelReservationModal.jsx">
// src/components/reservation/CancelReservationModal.jsx
import Modal from '../common/Modal';
import { formatDate } from '../../utils/dateUtils';

const getNights = (checkIn, checkOut) => {
  const inDate = new Date(checkIn);
  const outDate = new Date(checkOut);
  const diff = outDate.getTime() - inDate.getTime();
  return Math.round(diff / (1000 * 60 * 60 * 24));
};

const CancelReservationModal = ({ isOpen, onClose, reservation, onConfirm }) => {
  if (!reservation) return null;

  const nights = getNights(reservation.checkIn, reservation.checkOut);

  return (
    <Modal isOpen={isOpen} onClose={onClose} title="ì˜ˆì•½ ì·¨ì†Œ">
      <div className="space-y-4">
        <div className="bg-gray-50 rounded-xl p-4 border text-sm text-gray-700 space-y-2">
          <div className="flex justify-between">
            <span className="text-gray-500">ì²´í¬ì¸</span>
            <span className="font-semibold">{formatDate(new Date(reservation.checkIn))}</span>
          </div>
          <div className="flex justify-between">
            <span className="text-gray-500">ì²´í¬ì•„ì›ƒ</span>
            <span className="font-semibold">{formatDate(new Date(reservation.checkOut))}</span>
          </div>
          <div className="flex justify-between">
            <span className="text-gray-500">ìˆ™ë°•</span>
            <span className="font-semibold">{nights}ë°•</span>
          </div>

          {/* ê²ŒìŠ¤íŠ¸ë©´ ì´ˆëŒ€ì í‘œì‹œ (ìˆì„ ë•Œë§Œ) */}
          {reservation.hostDisplayName && reservation.type === 'guest' && (
            <div className="flex justify-between pt-2 border-t border-gray-200">
              <span className="text-gray-500">ì´ˆëŒ€ì</span>
              <span className="font-semibold">{reservation.hostDisplayName}</span>
            </div>
          )}
        </div>

        <div className="text-center text-gray-800 font-medium">
          ì •ë§ ì´ ì˜ˆì•½ì„ ì·¨ì†Œí• ê¹Œìš”?
        </div>

        <div className="flex gap-2 pt-2">
          <button
            onClick={onClose}
            className="flex-1 py-3 rounded-xl border border-gray-300 text-gray-700 hover:bg-gray-50"
          >
            ì•„ë‹ˆì˜¤
          </button>
          <button
            onClick={() => onConfirm(reservation)}
            className="flex-1 py-3 rounded-xl bg-red-500 text-white font-semibold hover:bg-red-600"
          >
            ì˜ˆì•½ ì·¨ì†Œ
          </button>
        </div>
      </div>
    </Modal>
  );
};

export default CancelReservationModal;
</file>

<file path="src/components/reservations/CreateMealGatheringModal.jsx">
import { useState, useEffect } from 'react';
import { X, Clock, MapPin, Users, Search } from 'lucide-react';
import Modal from '../common/Modal';

/**
 * ì‹ì‚¬ ëª¨ì„ ìƒì„± ëª¨ë‹¬
 */
const CreateMealGatheringModal = ({
  isOpen,
  onClose,
  onConfirm,
  date,
  mealType, // "lunch" | "dinner"
  currentUser,
  profiles // ì˜¤ëŠ˜ ì˜ˆì•½ì´ ìˆëŠ” ì‚¬ëŒë“¤
}) => {
  const [title, setTitle] = useState('');
  const [departureTime, setDepartureTime] = useState('');
  const [location, setLocation] = useState('');
  const [selectedParticipants, setSelectedParticipants] = useState([]);
  const [searchQuery, setSearchQuery] = useState('');
  const [showDropdown, setShowDropdown] = useState(false);

  // ì´ˆê¸°í™”
  useEffect(() => {
    if (isOpen) {
      const defaultTitle = mealType === 'lunch' ? 'ì ì‹¬ ëª¨ì„' : 'ì €ë… ëª¨ì„';
      setTitle(defaultTitle);
      setDepartureTime('');
      setLocation('');
      setSelectedParticipants([currentUser.id]); // ì£¼ìµœì ìë™ í¬í•¨
      setSearchQuery('');
      setShowDropdown(false);
    }
  }, [isOpen, mealType, currentUser]);

  // ê²€ìƒ‰ í•„í„°ë§
  const filteredProfiles = Object.entries(profiles || {})
    .filter(([userId, profile]) => {
      if (!searchQuery.trim()) return false;
      if (selectedParticipants.includes(userId)) return false; // ì´ë¯¸ ì„ íƒëœ ì‚¬ëŒ ì œì™¸

      const query = searchQuery.toLowerCase();
      const displayName = profile.displayName?.toLowerCase() || '';
      return displayName.includes(query);
    });

  // ì°¸ì—¬ì ì¶”ê°€
  const addParticipant = (userId) => {
    if (!selectedParticipants.includes(userId)) {
      setSelectedParticipants(prev => [...prev, userId]);
    }
    setSearchQuery('');
    setShowDropdown(false);
  };

  // ì°¸ì—¬ì ì œê±°
  const removeParticipant = (userId) => {
    if (userId === currentUser.id) return; // ì£¼ìµœìëŠ” ì œê±° ë¶ˆê°€
    setSelectedParticipants(prev => prev.filter(id => id !== userId));
  };

  // ì €ì¥
  const handleSubmit = () => {
    if (!title.trim()) {
      alert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    onConfirm({
      title: title.trim(),
      departureTime,
      location,
      participants: selectedParticipants
    });
  };

  if (!isOpen) return null;

  const mealTypeLabel = mealType === 'lunch' ? 'ì ì‹¬' : 'ì €ë…';
  const dateObj = new Date(date);
  const dateLabel = `${dateObj.getMonth() + 1}ì›” ${dateObj.getDate()}ì¼`;

  return (
    <Modal isOpen={isOpen} onClose={onClose} title={`${mealTypeLabel} ëª¨ì„ ìƒì„±`}>
      <div className="space-y-4 max-w-full overflow-x-hidden">
        {/* ë‚ ì§œ ì •ë³´ */}
        <div className="bg-blue-50 border-2 border-blue-200 rounded-xl p-3 text-center">
          <div className="text-sm font-semibold text-blue-900">
            {dateLabel} {mealTypeLabel}
          </div>
        </div>

        {/* ì œëª© */}
        <div>
          <label className="block text-sm font-semibold text-gray-700 mb-2">
            ì œëª©
          </label>
          <input
            type="text"
            value={title}
            onChange={(e) => setTitle(e.target.value)}
            placeholder="ì˜ˆ: ê·¼ì²˜ ì¤‘ì‹ë‹¹ ê°€ì‹¤ ë¶„"
            className="w-full px-4 py-2.5 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none"
          />
        </div>

        {/* ì£¼ìµœì */}
        <div>
          <label className="block text-sm font-semibold text-gray-700 mb-2">
            ì£¼ìµœì
          </label>
          <div className="px-4 py-2.5 bg-gray-50 border-2 border-gray-200 rounded-xl text-gray-700">
            {currentUser.displayName || currentUser.email}
          </div>
        </div>

        {/* ì‹œê°„ & ì¥ì†Œ (í•œ í–‰) */}
        <div className="grid grid-cols-2 gap-3">
          {/* ì¶œë°œì‹œê°„ */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-1">
              <Clock className="w-4 h-4" />
              ì‹œê°„ (ì„ íƒ)
            </label>
            <input
              type="time"
              value={departureTime}
              onChange={(e) => setDepartureTime(e.target.value)}
              className="w-full px-3 py-2.5 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none"
            />
          </div>

          {/* ì¥ì†Œ */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-1">
              <MapPin className="w-4 h-4" />
              ì¥ì†Œ (ì„ íƒ)
            </label>
            <input
              type="text"
              value={location}
              onChange={(e) => setLocation(e.target.value)}
              placeholder="ì¡°ê°•308í˜¸ ì•"
              className="w-full px-3 py-2.5 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none"
            />
          </div>
        </div>

        {/* ì°¸ì—¬ì */}
        <div>
          <label className="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2">
            <Users className="w-4 h-4" />
            ì°¸ì—¬ì ({selectedParticipants.length}ëª…)
          </label>

          {/* ì„ íƒëœ ì°¸ì—¬ì í‘œì‹œ */}
          {selectedParticipants.length > 0 && (
            <div className="flex flex-wrap gap-2 mb-3">
              {selectedParticipants.map((userId) => {
                const profile = profiles[userId];
                if (!profile) return null;

                const isHost = userId === currentUser.id;

                return (
                  <div
                    key={userId}
                    className="flex items-center gap-2 px-3 py-1.5 bg-green-50 border border-green-300 rounded-full"
                  >
                    {/* í”„ë¡œí•„ ì´ë¯¸ì§€ */}
                    {profile.profileImage ? (
                      <img
                        src={profile.profileImage}
                        alt={profile.displayName}
                        className="w-6 h-6 rounded-full object-cover"
                      />
                    ) : (
                      <div className="w-6 h-6 rounded-full bg-gray-300 flex items-center justify-center text-white text-xs font-bold">
                        {profile.displayName?.[0] || '?'}
                      </div>
                    )}

                    {/* ì´ë¦„ */}
                    <span className="text-sm font-semibold text-gray-900">
                      {profile.displayName || 'ì´ë¦„ ì—†ìŒ'}
                    </span>

                    {/* ì£¼ìµœì í‘œì‹œ */}
                    {isHost && (
                      <span className="px-1.5 py-0.5 bg-blue-500 text-white text-xs rounded-full">
                        ì£¼ìµœ
                      </span>
                    )}

                    {/* ì œê±° ë²„íŠ¼ */}
                    {!isHost && (
                      <button
                        onClick={() => removeParticipant(userId)}
                        className="ml-1 p-0.5 hover:bg-red-100 rounded-full transition-colors"
                      >
                        <X className="w-3.5 h-3.5 text-red-600" />
                      </button>
                    )}
                  </div>
                );
              })}
            </div>
          )}

          {/* ê²€ìƒ‰ Input */}
          <div className="relative">
            <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" />
            <input
              type="text"
              value={searchQuery}
              onChange={(e) => {
                setSearchQuery(e.target.value);
                setShowDropdown(e.target.value.trim() !== '');
              }}
              onFocus={() => searchQuery.trim() && setShowDropdown(true)}
              placeholder="ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰í•˜ì—¬ ì¶”ê°€"
              className="w-full pl-9 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            />

            {/* ê²€ìƒ‰ ê²°ê³¼ ë“œë¡­ë‹¤ìš´ */}
            {showDropdown && searchQuery && (
              <div className="absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-48 overflow-y-auto">
                {filteredProfiles.length > 0 ? (
                  filteredProfiles.map(([userId, profile]) => (
                    <button
                      key={userId}
                      onClick={() => addParticipant(userId)}
                      className="w-full flex items-center gap-3 p-3 text-left hover:bg-gray-50 transition-colors"
                    >
                      {/* í”„ë¡œí•„ ì´ë¯¸ì§€ */}
                      {profile.profileImage ? (
                        <img
                          src={profile.profileImage}
                          alt={profile.displayName}
                          className="w-8 h-8 rounded-full object-cover"
                        />
                      ) : (
                        <div className="w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center text-white text-sm font-bold">
                          {profile.displayName?.[0] || '?'}
                        </div>
                      )}

                      {/* ì´ë¦„ */}
                      <span className="font-semibold text-gray-900">
                        {profile.displayName || 'ì´ë¦„ ì—†ìŒ'}
                      </span>
                    </button>
                  ))
                ) : (
                  <div className="p-3 text-center text-sm text-gray-400">
                    ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤
                  </div>
                )}
              </div>
            )}
          </div>
        </div>

        {/* ë²„íŠ¼ */}
        <div className="grid grid-cols-2 gap-3 pt-2">
          <button
            onClick={onClose}
            className="px-4 py-2.5 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-colors"
          >
            ì·¨ì†Œ
          </button>
          <button
            onClick={handleSubmit}
            className="px-4 py-2.5 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-colors"
          >
            ìƒì„±
          </button>
        </div>
      </div>
    </Modal>
  );
};

export default CreateMealGatheringModal;
</file>

<file path="src/components/reservations/GatheringDetailModal.jsx">
import { X, Clock, MapPin, Users } from 'lucide-react';
import Modal from '../common/Modal';

/**
 * ëª¨ì„ ì°¸ì—¬ì ìƒì„¸ ëª¨ë‹¬
 */
const GatheringDetailModal = ({ isOpen, onClose, gathering, profiles }) => {
  if (!isOpen || !gathering) return null;

  const mealTypeLabel = gathering.mealType === 'lunch' ? 'ì ì‹¬' : 'ì €ë…';
  const mealTypeColor = gathering.mealType === 'lunch' ? 'green' : 'orange';

  return (
    <Modal isOpen={isOpen} onClose={onClose} title={null}>
      <div className="max-w-full overflow-x-hidden">
        {/* í—¤ë” */}
        <div className="flex items-center justify-between mb-4">
          <div>
            <h3 className="text-lg font-bold text-gray-900">{gathering.title}</h3>
            <div className="text-sm text-gray-600 mt-1">
              <span className={`px-2 py-0.5 bg-${mealTypeColor}-100 text-${mealTypeColor}-700 rounded-full font-semibold`}>
                {mealTypeLabel}
              </span>
              <span className="ml-2">ì£¼ìµœ: {gathering.hostName}</span>
            </div>
          </div>
          <button
            onClick={onClose}
            className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
          >
            <X className="w-5 h-5" />
          </button>
        </div>

        {/* ì •ë³´ */}
        <div className="space-y-3 mb-5">
          {gathering.departureTime && (
            <div className="flex items-center gap-2 text-sm text-gray-700">
              <Clock className="w-4 h-4 text-gray-500" />
              <span>{gathering.departureTime}</span>
            </div>
          )}

          {gathering.location && (
            <div className="flex items-center gap-2 text-sm text-gray-700">
              <MapPin className="w-4 h-4 text-gray-500" />
              <span>{gathering.location}</span>
            </div>
          )}

          <div className="flex items-center gap-2 text-sm text-gray-700">
            <Users className="w-4 h-4 text-gray-500" />
            <span>{gathering.participants?.length || 0}ëª… ì°¸ì—¬</span>
          </div>
        </div>

        {/* ì°¸ì—¬ì ëª©ë¡ */}
        <div>
          <h4 className="text-sm font-semibold text-gray-700 mb-3">ì°¸ì—¬ì</h4>
          <div className="space-y-2 max-h-64 overflow-y-auto">
            {gathering.participants?.map((participantId, index) => {
              const profile = profiles[participantId];
              if (!profile) return null;

              const isHost = participantId === gathering.hostId;

              return (
                <div
                  key={participantId}
                  className="flex items-center gap-3 p-3 bg-gray-50 rounded-xl"
                >
                  {/* í”„ë¡œí•„ ì´ë¯¸ì§€ */}
                  <div className="flex-shrink-0">
                    {profile.profileImage ? (
                      <img
                        src={profile.profileImage}
                        alt={profile.displayName}
                        className="w-10 h-10 rounded-full object-cover"
                      />
                    ) : (
                      <div className="w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center text-white font-bold">
                        {profile.displayName?.[0] || '?'}
                      </div>
                    )}
                  </div>

                  {/* ì •ë³´ */}
                  <div className="flex-1 min-w-0">
                    <div className="font-semibold text-gray-900 flex items-center gap-2">
                      {profile.displayName || 'ì´ë¦„ ì—†ìŒ'}
                      {isHost && (
                        <span className="px-2 py-0.5 bg-blue-500 text-white text-xs rounded-full">
                          ì£¼ìµœ
                        </span>
                      )}
                    </div>
                    {profile.phone && (
                      <div className="text-sm text-gray-500">{profile.phone}</div>
                    )}
                  </div>

                  {/* ìˆœë²ˆ */}
                  <div className="flex-shrink-0 w-7 h-7 rounded-full bg-gray-200 flex items-center justify-center font-bold text-gray-600 text-sm">
                    {index + 1}
                  </div>
                </div>
              );
            })}
          </div>
        </div>

        {/* ë‹«ê¸° ë²„íŠ¼ */}
        <div className="mt-5">
          <button
            onClick={onClose}
            className="w-full px-4 py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-colors"
          >
            ë‹«ê¸°
          </button>
        </div>
      </div>
    </Modal>
  );
};

export default GatheringDetailModal;
</file>

<file path="src/components/reservations/MealGatheringCard.jsx">
import { Clock, MapPin, Users, Trash2 } from 'lucide-react';

/**
 * ì‹ì‚¬ ëª¨ì„ ì¹´ë“œ
 * - í´ë¦­í•˜ë©´ ì°¸ì—¬/ì·¨ì†Œ í† ê¸€ (ì£¼ìµœì ì•„ë‹Œ ê²½ìš°)
 * - ì£¼ìµœìëŠ” ì‚­ì œ ë²„íŠ¼ í‘œì‹œ
 */
const MealGatheringCard = ({
  gathering,
  profiles,
  currentUserId,
  onToggleParticipation,
  onDelete,
  onViewDetail
}) => {
  const isHost = gathering.hostId === currentUserId;
  const isParticipant = gathering.participants?.includes(currentUserId);
  const participantCount = gathering.participants?.length || 0;

  const handleCardClick = (e) => {
    // ì‚­ì œ ë²„íŠ¼ í´ë¦­ì€ ë¬´ì‹œ
    if (e.target.closest('.delete-button')) {
      return;
    }

    if (isHost) {
      // ì£¼ìµœìëŠ” ìƒì„¸ë³´ê¸°
      onViewDetail(gathering);
    } else {
      // ì£¼ìµœìê°€ ì•„ë‹ˆë©´ ì°¸ì—¬/ì·¨ì†Œ í† ê¸€
      onToggleParticipation(gathering);
    }
  };

  const handleDeleteClick = (e) => {
    e.stopPropagation();
    if (confirm(`"${gathering.title}" ëª¨ì„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
      onDelete(gathering.id);
    }
  };

  return (
    <div
      className={`relative p-4 rounded-xl border-2 transition-all cursor-pointer ${
        isParticipant
          ? 'bg-green-50 border-green-300 hover:bg-green-100'
          : 'bg-white border-gray-200 hover:border-gray-300 hover:bg-gray-50'
      }`}
      onClick={handleCardClick}
    >
      {/* ì£¼ìµœì ì‚­ì œ ë²„íŠ¼ */}
      {isHost && (
        <button
          onClick={handleDeleteClick}
          className="delete-button absolute top-3 right-3 p-1.5 bg-red-100 hover:bg-red-200 text-red-600 rounded-lg transition-colors"
          title="ëª¨ì„ ì‚­ì œ"
        >
          <Trash2 className="w-4 h-4" />
        </button>
      )}

      {/* ì œëª© */}
      <div className="mb-2 pr-8">
        <h4 className="font-bold text-gray-900 text-base mb-1">
          {gathering.title}
        </h4>
        <div className="text-xs text-gray-500">
          ì£¼ìµœ: {gathering.hostName}
          {isHost && (
            <span className="ml-2 px-2 py-0.5 bg-blue-100 text-blue-700 rounded-full font-semibold">
              ì£¼ìµœì
            </span>
          )}
        </div>
      </div>

      {/* ì‹œê°„ & ì¥ì†Œ (í•œ ì¤„) */}
      {(gathering.departureTime || gathering.location) && (
        <div className="flex items-center gap-3 text-sm text-gray-600 mb-3 flex-wrap">
          {gathering.departureTime && (
            <div className="flex items-center gap-1">
              <Clock className="w-4 h-4 flex-shrink-0" />
              <span>{gathering.departureTime}</span>
            </div>
          )}

          {gathering.location && (
            <div className="flex items-center gap-1">
              <MapPin className="w-4 h-4 flex-shrink-0" />
              <span className="truncate">{gathering.location}</span>
            </div>
          )}
        </div>
      )}

      {/* ì°¸ì—¬ì */}
      <div className="flex items-center justify-between pt-3 border-t border-gray-200">
        {/* ì°¸ì—¬ì í”„ë¡œí•„ ì‚¬ì§„ */}
        <div className="flex items-center gap-1">
          {gathering.participants?.slice(0, 5).map((participantId) => {
            const profile = profiles[participantId];
            return (
              <div key={participantId} className="relative">
                {profile?.profileImage ? (
                  <img
                    src={profile.profileImage}
                    alt={profile.displayName || 'ì°¸ì—¬ì'}
                    className="w-8 h-8 rounded-full object-cover ring-2 ring-white"
                  />
                ) : (
                  <div className="w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center text-white text-xs font-bold ring-2 ring-white">
                    {profile?.displayName?.[0] || '?'}
                  </div>
                )}
              </div>
            );
          })}
          {participantCount > 5 && (
            <div className="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 text-xs font-bold ring-2 ring-white">
              +{participantCount - 5}
            </div>
          )}
        </div>

        {/* ì°¸ì—¬ ì¸ì› */}
        <div className="flex items-center gap-1 text-sm font-semibold text-gray-700">
          <Users className="w-4 h-4" />
          <span>{participantCount}ëª…</span>
        </div>
      </div>

      {/* ì°¸ì—¬ ìƒíƒœ ì•ˆë‚´ */}
      <div className="mt-3 text-center text-xs">
        {isHost ? (
          <span className="text-blue-600 font-semibold">
            í´ë¦­í•˜ì—¬ ì°¸ì—¬ì í™•ì¸
          </span>
        ) : isParticipant ? (
          <span className="text-green-600 font-semibold">
            ì°¸ì—¬ ì¤‘ â€¢ í´ë¦­í•˜ë©´ ì·¨ì†Œ
          </span>
        ) : (
          <span className="text-gray-500">
            í´ë¦­í•˜ì—¬ ì°¸ì—¬
          </span>
        )}
      </div>
    </div>
  );
};

export default MealGatheringCard;
</file>

<file path="src/components/reservations/MealGatheringModal.jsx">
import { useState, useEffect } from 'react';
import { X, Plus, Utensils } from 'lucide-react';
import Modal from '../common/Modal';
import MealGatheringCard from './MealGatheringCard';
import CreateMealGatheringModal from './CreateMealGatheringModal';
import GatheringDetailModal from './GatheringDetailModal';
import mealGatheringService from '../../services/mealGatheringService';
import { formatDate } from '../../utils/dateUtils';

/**
 * ì‹ì‚¬ ëª¨ë‹¬
 * - ì ì‹¬/ì €ë… í–‰ìœ¼ë¡œ êµ¬ë¶„
 * - ê° ëª¨ì„ ì¹´ë“œ í‘œì‹œ
 * - + ë²„íŠ¼ìœ¼ë¡œ ëª¨ì„ ìƒì„±
 */
const MealGatheringModal = ({
  isOpen,
  onClose,
  date,
  spaceId,
  currentUser,
  profiles,
  reservations = [] // ì˜¤ëŠ˜ ì˜ˆì•½ì´ ìˆëŠ” ì‚¬ëŒ ëª©ë¡
}) => {
  const [gatherings, setGatherings] = useState({ lunch: [], dinner: [] });
  const [showCreateModal, setShowCreateModal] = useState(false);
  const [createMealType, setCreateMealType] = useState(null);
  const [loading, setLoading] = useState(false);
  const [showDetailModal, setShowDetailModal] = useState(false);
  const [selectedGathering, setSelectedGathering] = useState(null);

  // ì˜¤ëŠ˜ ì˜ˆì•½ì´ ìˆëŠ” ì‚¬ëŒë§Œ í•„í„°ë§ (ì£¼ìµœìëŠ” í•­ìƒ í¬í•¨)
  const todayProfiles = reservations.reduce((acc, reservation) => {
    if (profiles[reservation.userId]) {
      acc[reservation.userId] = profiles[reservation.userId];
    }
    return acc;
  }, {});

  // í˜„ì¬ ì‚¬ìš©ì(ì£¼ìµœì)ëŠ” ì˜ˆì•½ ì—†ì–´ë„ í•­ìƒ í¬í•¨
  if (currentUser && profiles[currentUser.id]) {
    todayProfiles[currentUser.id] = profiles[currentUser.id];
  }

  // ëª¨ì„ ë¡œë“œ
  useEffect(() => {
    if (isOpen && date && spaceId) {
      loadGatherings();
    }
  }, [isOpen, date, spaceId]);

  const loadGatherings = async () => {
    setLoading(true);
    try {
      const dateStr = formatDate(date);
      const data = await mealGatheringService.getGatheringsByDate(spaceId, dateStr);
      setGatherings(data);
    } catch (error) {
      console.error('ëª¨ì„ ë¡œë“œ ì‹¤íŒ¨:', error);
    } finally {
      setLoading(false);
    }
  };

  // ëª¨ì„ ìƒì„± ëª¨ë‹¬ ì—´ê¸°
  const handleOpenCreate = (mealType) => {
    setCreateMealType(mealType);
    setShowCreateModal(true);
  };

  // ëª¨ì„ ìƒì„±
  const handleCreateGathering = async (gatheringData) => {
    try {
      const dateStr = formatDate(date);

      await mealGatheringService.createGathering(spaceId, {
        date: dateStr,
        mealType: createMealType,
        title: gatheringData.title,
        hostId: currentUser.id,
        hostName: currentUser.displayName || currentUser.email,
        departureTime: gatheringData.departureTime,
        location: gatheringData.location,
        participants: gatheringData.participants
      });

      // ëª¨ì„ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
      await loadGatherings();

      // ëª¨ë‹¬ ë‹«ê¸°
      setShowCreateModal(false);
      setCreateMealType(null);
    } catch (error) {
      console.error('ëª¨ì„ ìƒì„± ì‹¤íŒ¨:', error);
      alert('ëª¨ì„ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  };

  // ì°¸ì—¬/ì·¨ì†Œ í† ê¸€
  const handleToggleParticipation = async (gathering) => {
    try {
      const isParticipant = gathering.participants?.includes(currentUser.id);

      if (isParticipant) {
        // ì°¸ì—¬ ì·¨ì†Œ
        await mealGatheringService.leaveGathering(spaceId, gathering.id, currentUser.id);
      } else {
        // ì°¸ì—¬
        await mealGatheringService.joinGathering(spaceId, gathering.id, currentUser.id);
      }

      // ëª¨ì„ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
      await loadGatherings();
    } catch (error) {
      console.error('ì°¸ì—¬ í† ê¸€ ì‹¤íŒ¨:', error);
      alert('ì°¸ì—¬ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  };

  // ëª¨ì„ ì‚­ì œ
  const handleDeleteGathering = async (gatheringId) => {
    try {
      await mealGatheringService.deleteGathering(spaceId, gatheringId);

      // ëª¨ì„ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
      await loadGatherings();
    } catch (error) {
      console.error('ëª¨ì„ ì‚­ì œ ì‹¤íŒ¨:', error);
      alert('ëª¨ì„ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  };

  // ëª¨ì„ ìƒì„¸ë³´ê¸°
  const handleViewDetail = (gathering) => {
    setSelectedGathering(gathering);
    setShowDetailModal(true);
  };

  if (!isOpen || !date) return null;

  const dateObj = new Date(date);
  const dateLabel = `${dateObj.getMonth() + 1}ì›” ${dateObj.getDate()}ì¼`;

  return (
    <>
      <Modal isOpen={isOpen} onClose={onClose} title={null}>
        <div className="max-h-[80vh] overflow-y-auto max-w-full overflow-x-hidden">
          {/* í—¤ë” */}
          <div className="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between -mx-6 -mt-6 mb-6 z-10">
            <div className="flex items-center gap-3">
              <Utensils className="w-6 h-6 text-blue-600" />
              <div>
                <h3 className="text-xl font-bold text-gray-900">ì‹ì‚¬</h3>
                <div className="text-sm text-gray-600">{dateLabel}</div>
              </div>
            </div>
            <button
              onClick={onClose}
              className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
            >
              <X className="w-5 h-5" />
            </button>
          </div>

          {loading ? (
            <div className="py-12 text-center text-gray-400">
              ë¡œë”© ì¤‘...
            </div>
          ) : (
            <div className="space-y-8">
              {/* ì ì‹¬ */}
              <div>
                <div className="flex items-center justify-between mb-4">
                  <h4 className="text-lg font-bold text-green-700 flex items-center gap-2">
                    <span className="w-3 h-3 rounded-full bg-green-500"></span>
                    ì ì‹¬ ({gatherings.lunch.length}ê°œ ëª¨ì„)
                  </h4>
                  <button
                    onClick={() => handleOpenCreate('lunch')}
                    className="p-2 bg-green-500 hover:bg-green-600 text-white rounded-full shadow-lg transition-all hover:scale-110"
                    title="ì ì‹¬ ëª¨ì„ ìƒì„±"
                  >
                    <Plus className="w-5 h-5" />
                  </button>
                </div>

                {gatherings.lunch.length > 0 ? (
                  <div className="grid grid-cols-1 gap-3">
                    {gatherings.lunch.map((gathering) => (
                      <MealGatheringCard
                        key={gathering.id}
                        gathering={gathering}
                        profiles={profiles}
                        currentUserId={currentUser.id}
                        onToggleParticipation={handleToggleParticipation}
                        onDelete={handleDeleteGathering}
                        onViewDetail={handleViewDetail}
                      />
                    ))}
                  </div>
                ) : (
                  <div className="py-8 text-center bg-gray-50 rounded-xl border-2 border-dashed border-gray-300">
                    <div className="text-gray-400 mb-2">ì ì‹¬ ëª¨ì„ì´ ì—†ìŠµë‹ˆë‹¤</div>
                    <button
                      onClick={() => handleOpenCreate('lunch')}
                      className="text-green-600 hover:text-green-700 font-semibold text-sm"
                    >
                      + ëª¨ì„ ë§Œë“¤ê¸°
                    </button>
                  </div>
                )}
              </div>

              {/* ì €ë… */}
              <div>
                <div className="flex items-center justify-between mb-4">
                  <h4 className="text-lg font-bold text-orange-700 flex items-center gap-2">
                    <span className="w-3 h-3 rounded-full bg-orange-500"></span>
                    ì €ë… ({gatherings.dinner.length}ê°œ ëª¨ì„)
                  </h4>
                  <button
                    onClick={() => handleOpenCreate('dinner')}
                    className="p-2 bg-orange-500 hover:bg-orange-600 text-white rounded-full shadow-lg transition-all hover:scale-110"
                    title="ì €ë… ëª¨ì„ ìƒì„±"
                  >
                    <Plus className="w-5 h-5" />
                  </button>
                </div>

                {gatherings.dinner.length > 0 ? (
                  <div className="grid grid-cols-1 gap-3">
                    {gatherings.dinner.map((gathering) => (
                      <MealGatheringCard
                        key={gathering.id}
                        gathering={gathering}
                        profiles={profiles}
                        currentUserId={currentUser.id}
                        onToggleParticipation={handleToggleParticipation}
                        onDelete={handleDeleteGathering}
                        onViewDetail={handleViewDetail}
                      />
                    ))}
                  </div>
                ) : (
                  <div className="py-8 text-center bg-gray-50 rounded-xl border-2 border-dashed border-gray-300">
                    <div className="text-gray-400 mb-2">ì €ë… ëª¨ì„ì´ ì—†ìŠµë‹ˆë‹¤</div>
                    <button
                      onClick={() => handleOpenCreate('dinner')}
                      className="text-orange-600 hover:text-orange-700 font-semibold text-sm"
                    >
                      + ëª¨ì„ ë§Œë“¤ê¸°
                    </button>
                  </div>
                )}
              </div>
            </div>
          )}
        </div>
      </Modal>

      {/* ëª¨ì„ ìƒì„± ëª¨ë‹¬ */}
      <CreateMealGatheringModal
        isOpen={showCreateModal}
        onClose={() => {
          setShowCreateModal(false);
          setCreateMealType(null);
        }}
        onConfirm={handleCreateGathering}
        date={formatDate(date)}
        mealType={createMealType}
        currentUser={currentUser}
        profiles={todayProfiles}
      />

      {/* ëª¨ì„ ìƒì„¸ ëª¨ë‹¬ */}
      <GatheringDetailModal
        isOpen={showDetailModal}
        onClose={() => {
          setShowDetailModal(false);
          setSelectedGathering(null);
        }}
        gathering={selectedGathering}
        profiles={profiles}
      />
    </>
  );
};

export default MealGatheringModal;
</file>

<file path="src/components/reservations/MealIndicator.jsx">
/**
 * í”„ë¡œí•„ ì•„ë°”íƒ€ì— í‘œì‹œë˜ëŠ” ì‹ì‚¬ í‘œì‹œ ì  2ê°œ
 * - ì™¼ìª½: ì ì‹¬ (ì´ˆë¡ìƒ‰)
 * - ì˜¤ë¥¸ìª½: ì €ë… (ì£¼í™©ìƒ‰)
 */
const MealIndicator = ({ lunch, dinner, className = "" }) => {
  // ë‘˜ ë‹¤ ì—†ìœ¼ë©´ í‘œì‹œ ì•ˆ í•¨
  if (!lunch && !dinner) return null;

  return (
    <div className={`absolute -bottom-0.5 -right-0.5 flex gap-0.5 ${className}`}>
      {/* ì ì‹¬ ì  */}
      <div
        className={`w-2.5 h-2.5 rounded-full border-2 border-white shadow-sm ${
          lunch ? 'bg-green-500' : 'bg-gray-300'
        }`}
        title="ì ì‹¬"
      />
      {/* ì €ë… ì  */}
      <div
        className={`w-2.5 h-2.5 rounded-full border-2 border-white shadow-sm ${
          dinner ? 'bg-orange-500' : 'bg-gray-300'
        }`}
        title="ì €ë…"
      />
    </div>
  );
};

export default MealIndicator;
</file>

<file path="src/components/settings/SettlementScheduleSettings.jsx">
// src/components/settings/SettlementScheduleSettings.jsx
import { useState, useEffect } from 'react';
import { Calendar, Clock, Save } from 'lucide-react';

const SettlementScheduleSettings = ({ spaceId, settings, onSave }) => {
  const [scheduleSettings, setScheduleSettings] = useState({
    enabled: false,
    frequency: 'weekly', // 'weekly', 'monthly', 'yearly'
    weeklyDay: 1, // 0=ì¼ìš”ì¼, 1=ì›”ìš”ì¼, ..., 6=í† ìš”ì¼
    monthlyDay: 1, // 1-31
    yearlyMonth: 1, // 1-12
    yearlyDay: 1, // 1-31
    time: '18:00', // HH:mm
  });

  const [saving, setSaving] = useState(false);

  useEffect(() => {
    if (settings) {
      setScheduleSettings(prev => ({
        ...prev,
        ...settings,
      }));
    }
  }, [settings]);

  const handleToggleEnabled = () => {
    setScheduleSettings(prev => ({
      ...prev,
      enabled: !prev.enabled
    }));
  };

  const handleFrequencyChange = (frequency) => {
    setScheduleSettings(prev => ({
      ...prev,
      frequency
    }));
  };

  const handleSave = async () => {
    // ìœ íš¨ì„± ê²€ì‚¬
    if (scheduleSettings.enabled) {
      const [hours, minutes] = scheduleSettings.time.split(':');
      if (!hours || !minutes || parseInt(hours) > 23 || parseInt(minutes) > 59) {
        alert('ì˜¬ë°”ë¥¸ ì‹œê°„ì„ ì…ë ¥í•´ì£¼ì„¸ìš” (00:00 ~ 23:59)');
        return;
      }

      if (scheduleSettings.frequency === 'monthly') {
        if (scheduleSettings.monthlyDay < 1 || scheduleSettings.monthlyDay > 31) {
          alert('ì˜¬ë°”ë¥¸ ë‚ ì§œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” (1 ~ 31ì¼)');
          return;
        }
      }

      if (scheduleSettings.frequency === 'yearly') {
        if (scheduleSettings.yearlyMonth < 1 || scheduleSettings.yearlyMonth > 12) {
          alert('ì˜¬ë°”ë¥¸ ì›”ì„ ì…ë ¥í•´ì£¼ì„¸ìš” (1 ~ 12ì›”)');
          return;
        }
        if (scheduleSettings.yearlyDay < 1 || scheduleSettings.yearlyDay > 31) {
          alert('ì˜¬ë°”ë¥¸ ë‚ ì§œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” (1 ~ 31ì¼)');
          return;
        }
      }
    }

    setSaving(true);
    try {
      await onSave(scheduleSettings);
      alert('ì •ì‚° ìë™í™” ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
    } catch (error) {
      console.error('ì„¤ì • ì €ì¥ ì‹¤íŒ¨:', error);
      alert('ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setSaving(false);
    }
  };

  const weekDays = [
    { value: 0, label: 'ì¼ìš”ì¼' },
    { value: 1, label: 'ì›”ìš”ì¼' },
    { value: 2, label: 'í™”ìš”ì¼' },
    { value: 3, label: 'ìˆ˜ìš”ì¼' },
    { value: 4, label: 'ëª©ìš”ì¼' },
    { value: 5, label: 'ê¸ˆìš”ì¼' },
    { value: 6, label: 'í† ìš”ì¼' },
  ];

  // ë‹¤ìŒ ì‹¤í–‰ ì‹œê°„ ê³„ì‚°
  const getNextRunTime = () => {
    if (!scheduleSettings.enabled) return null;

    const now = new Date();
    const [hours, minutes] = scheduleSettings.time.split(':');
    let nextRun = new Date();
    nextRun.setHours(parseInt(hours), parseInt(minutes), 0, 0);

    if (scheduleSettings.frequency === 'weekly') {
      const currentDay = now.getDay();
      const targetDay = scheduleSettings.weeklyDay;
      let daysToAdd = targetDay - currentDay;

      // ì´ë¯¸ ì§€ë‚œ ê²½ìš° ë‹¤ìŒ ì£¼
      if (daysToAdd < 0 || (daysToAdd === 0 && now >= nextRun)) {
        daysToAdd += 7;
      }

      nextRun.setDate(now.getDate() + daysToAdd);
    } else if (scheduleSettings.frequency === 'monthly') {
      nextRun.setDate(scheduleSettings.monthlyDay);

      // ì´ë¯¸ ì§€ë‚œ ê²½ìš° ë‹¤ìŒ ë‹¬
      if (now >= nextRun) {
        nextRun.setMonth(nextRun.getMonth() + 1);
      }
    } else if (scheduleSettings.frequency === 'yearly') {
      nextRun.setMonth(scheduleSettings.yearlyMonth - 1);
      nextRun.setDate(scheduleSettings.yearlyDay);

      // ì´ë¯¸ ì§€ë‚œ ê²½ìš° ë‚´ë…„
      if (now >= nextRun) {
        nextRun.setFullYear(nextRun.getFullYear() + 1);
      }
    }

    return nextRun;
  };

  const nextRunTime = getNextRunTime();

  return (
    <div className="space-y-6">
      {/* í—¤ë” */}
      <div className="flex items-center justify-between">
        <div className="flex items-center gap-2">
          <Calendar className="w-6 h-6 text-blue-600" />
          <h2 className="text-xl font-bold text-gray-900">ì •ì‚° ìë™í™” ì„¤ì •</h2>
        </div>
        <button
          onClick={handleSave}
          disabled={saving}
          className="flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white rounded-lg font-semibold transition-colors"
        >
          <Save className="w-4 h-4" />
          {saving ? 'ì €ì¥ ì¤‘...' : 'ì €ì¥'}
        </button>
      </div>

      <p className="text-sm text-gray-600">
        ì •ì‚°ì„ ìë™ìœ¼ë¡œ ë§ˆê°í•  ì£¼ê¸°ì™€ ì‹œê°„ì„ ì„¤ì •í•©ë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ê°€ê¹Œìš´ ì‹œê°„ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </p>

      {/* ìë™í™” í™œì„±í™” */}
      <div className="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
        <div className="flex items-center justify-between">
          <div>
            <h3 className="text-lg font-bold text-gray-900 mb-2">âš™ï¸ ìë™í™” í™œì„±í™”</h3>
            <p className="text-sm text-gray-600">
              ì„¤ì •ëœ ì‹œê°„ì— ìë™ìœ¼ë¡œ ì •ì‚°ì„ ë§ˆê°í•©ë‹ˆë‹¤
            </p>
          </div>
          <label className="relative inline-flex items-center cursor-pointer">
            <input
              type="checkbox"
              checked={scheduleSettings.enabled}
              onChange={handleToggleEnabled}
              className="sr-only peer"
            />
            <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
          </label>
        </div>
      </div>

      {scheduleSettings.enabled && (
        <>
          {/* ì •ì‚° ì£¼ê¸° ì„ íƒ */}
          <div className="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
            <h3 className="text-lg font-bold text-gray-900 mb-4">ğŸ“… ì •ì‚° ì£¼ê¸°</h3>

            <div className="grid grid-cols-1 sm:grid-cols-3 gap-3 mb-6">
              <button
                onClick={() => handleFrequencyChange('weekly')}
                className={`p-4 rounded-lg border-2 font-semibold transition-all ${
                  scheduleSettings.frequency === 'weekly'
                    ? 'border-blue-600 bg-blue-50 text-blue-700'
                    : 'border-gray-200 hover:border-gray-300 text-gray-700'
                }`}
              >
                ë§¤ì£¼
              </button>
              <button
                onClick={() => handleFrequencyChange('monthly')}
                className={`p-4 rounded-lg border-2 font-semibold transition-all ${
                  scheduleSettings.frequency === 'monthly'
                    ? 'border-blue-600 bg-blue-50 text-blue-700'
                    : 'border-gray-200 hover:border-gray-300 text-gray-700'
                }`}
              >
                ë§¤ë‹¬
              </button>
              <button
                onClick={() => handleFrequencyChange('yearly')}
                className={`p-4 rounded-lg border-2 font-semibold transition-all ${
                  scheduleSettings.frequency === 'yearly'
                    ? 'border-blue-600 bg-blue-50 text-blue-700'
                    : 'border-gray-200 hover:border-gray-300 text-gray-700'
                }`}
              >
                ë§¤ë…„
              </button>
            </div>

            {/* ë§¤ì£¼ - ìš”ì¼ ì„ íƒ */}
            {scheduleSettings.frequency === 'weekly' && (
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-3">
                  ë§ˆê° ìš”ì¼
                </label>
                <div className="grid grid-cols-4 sm:grid-cols-7 gap-2">
                  {weekDays.map(day => (
                    <button
                      key={day.value}
                      onClick={() => setScheduleSettings(prev => ({ ...prev, weeklyDay: day.value }))}
                      className={`p-3 rounded-lg font-semibold transition-all ${
                        scheduleSettings.weeklyDay === day.value
                          ? 'bg-blue-600 text-white'
                          : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                      }`}
                    >
                      {day.label.substring(0, 1)}
                    </button>
                  ))}
                </div>
              </div>
            )}

            {/* ë§¤ë‹¬ - ë‚ ì§œ ì„ íƒ */}
            {scheduleSettings.frequency === 'monthly' && (
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-3">
                  ë§ˆê° ë‚ ì§œ
                </label>
                <input
                  type="number"
                  min="1"
                  max="31"
                  value={scheduleSettings.monthlyDay}
                  onChange={(e) => setScheduleSettings(prev => ({
                    ...prev,
                    monthlyDay: parseInt(e.target.value) || 1
                  }))}
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg font-semibold"
                  placeholder="1 ~ 31"
                />
                <p className="text-xs text-gray-500 mt-2">
                  ë§¤ë‹¬ {scheduleSettings.monthlyDay}ì¼ì— ì •ì‚°ì´ ë§ˆê°ë©ë‹ˆë‹¤
                </p>
              </div>
            )}

            {/* ë§¤ë…„ - ì›”/ì¼ ì„ íƒ */}
            {scheduleSettings.frequency === 'yearly' && (
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-3">
                    ì›”
                  </label>
                  <input
                    type="number"
                    min="1"
                    max="12"
                    value={scheduleSettings.yearlyMonth}
                    onChange={(e) => setScheduleSettings(prev => ({
                      ...prev,
                      yearlyMonth: parseInt(e.target.value) || 1
                    }))}
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg font-semibold"
                    placeholder="1 ~ 12"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-3">
                    ì¼
                  </label>
                  <input
                    type="number"
                    min="1"
                    max="31"
                    value={scheduleSettings.yearlyDay}
                    onChange={(e) => setScheduleSettings(prev => ({
                      ...prev,
                      yearlyDay: parseInt(e.target.value) || 1
                    }))}
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg font-semibold"
                    placeholder="1 ~ 31"
                  />
                </div>
                <p className="text-xs text-gray-500 col-span-2 mt-2">
                  ë§¤ë…„ {scheduleSettings.yearlyMonth}ì›” {scheduleSettings.yearlyDay}ì¼ì— ì •ì‚°ì´ ë§ˆê°ë©ë‹ˆë‹¤
                </p>
              </div>
            )}
          </div>

          {/* ë§ˆê° ì‹œê°„ */}
          <div className="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
            <h3 className="text-lg font-bold text-gray-900 mb-4">
              <Clock className="w-5 h-5 inline-block mr-2" />
              ë§ˆê° ì‹œê°„
            </h3>

            <input
              type="time"
              value={scheduleSettings.time}
              onChange={(e) => setScheduleSettings(prev => ({ ...prev, time: e.target.value }))}
              className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg font-semibold"
            />

            <p className="text-xs text-gray-500 mt-3">
              ì„¤ì •ëœ ì‹œê°„ì— ìë™ìœ¼ë¡œ ì •ì‚°ì´ ë§ˆê°ë©ë‹ˆë‹¤
            </p>
          </div>

          {/* ë‹¤ìŒ ì‹¤í–‰ ì‹œê°„ í‘œì‹œ */}
          {nextRunTime && (
            <div className="bg-blue-50 border border-blue-200 rounded-xl p-4">
              <h4 className="text-sm font-semibold text-blue-900 mb-2">ğŸ“ ë‹¤ìŒ ì •ì‚° ë§ˆê° ì˜ˆì •</h4>
              <p className="text-lg font-bold text-blue-700">
                {nextRunTime.toLocaleDateString('ko-KR', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric',
                  weekday: 'long'
                })} {nextRunTime.toLocaleTimeString('ko-KR', {
                  hour: '2-digit',
                  minute: '2-digit'
                })}
              </p>
              <p className="text-xs text-blue-600 mt-2">
                â±ï¸ ì•½ {Math.ceil((nextRunTime - new Date()) / (1000 * 60 * 60))}ì‹œê°„ í›„
              </p>
            </div>
          )}

          {/* ì£¼ì˜ì‚¬í•­ */}
          <div className="bg-yellow-50 border border-yellow-200 rounded-xl p-4">
            <h4 className="text-sm font-semibold text-yellow-900 mb-2">âš ï¸ ì£¼ì˜ì‚¬í•­</h4>
            <ul className="text-xs text-yellow-700 space-y-1">
              <li>â€¢ ìë™ ë§ˆê°ì€ ë§¤ì‹œê°„ ì •ê°ì— ì²´í¬ë©ë‹ˆë‹¤ (Â±5ë¶„ ì˜¤ì°¨ ê°€ëŠ¥)</li>
              <li>â€¢ ì´ë¯¸ ë§ˆê°ëœ ì •ì‚°ì€ ë‹¤ì‹œ ë§ˆê°ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤</li>
              <li>â€¢ í…ŒìŠ¤íŠ¸ ì‹œ 10ë¶„ í›„ ì‹œê°„ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
              <li>â€¢ ì„œë²„ ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ ì‹¤í–‰ë˜ë¯€ë¡œ ì‹œê°„ëŒ€ë¥¼ í™•ì¸í•˜ì„¸ìš”</li>
            </ul>
          </div>
        </>
      )}
    </div>
  );
};

export default SettlementScheduleSettings;
</file>

<file path="src/components/space/CreateSpaceModal.jsx">
// src/components/space/CreateSpaceModal.jsx
import { useState } from 'react';
import { X, Home, AlertCircle } from 'lucide-react';

const CreateSpaceModal = ({ isOpen, onClose, onSubmit, isLoading }) => {
  const [spaceName, setSpaceName] = useState('');
  const [error, setError] = useState('');

  if (!isOpen) return null;

  const handleSubmit = async () => {
    // ìœ íš¨ì„± ê²€ì‚¬
    if (!spaceName.trim()) {
      setError('ë°© ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
      return;
    }

    if (spaceName.trim().length < 2) {
      setError('ë°© ì´ë¦„ì€ 2ê¸€ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤');
      return;
    }

    if (spaceName.trim().length > 30) {
      setError('ë°© ì´ë¦„ì€ 30ê¸€ì ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤');
      return;
    }

    setError('');
    await onSubmit(spaceName.trim());
  };

  const handleClose = () => {
    setSpaceName('');
    setError('');
    onClose();
  };

  return (
    <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden">
        {/* í—¤ë” */}
        <div className="bg-gradient-to-r from-blue-500 to-blue-600 p-6 text-white">
          <div className="flex items-center justify-between mb-2">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center">
                <Home className="w-6 h-6" />
              </div>
              <h2 className="text-xl font-bold">ë°© ìƒì„± ì‹ ì²­</h2>
            </div>
            <button
              onClick={handleClose}
              disabled={isLoading}
              className="p-1 hover:bg-white/20 rounded-lg transition-colors disabled:opacity-50"
            >
              <X className="w-6 h-6" />
            </button>
          </div>
          <p className="text-sm text-blue-100">
            ìƒˆë¡œìš´ ë°©ì„ ë§Œë“¤ì–´ ë©¤ë²„ë“¤ê³¼ í•¨ê»˜ ì‚¬ìš©í•˜ì„¸ìš”
          </p>
        </div>

        {/* ë³¸ë¬¸ */}
        <div className="p-6">
          {/* ì•ˆë‚´ ë©”ì‹œì§€ */}
          <div className="mb-6 bg-blue-50 border border-blue-200 rounded-xl p-4">
            <div className="flex items-start gap-3">
              <AlertCircle className="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" />
              <div className="text-sm text-blue-800">
                <p className="font-medium mb-2">ë°© ìƒì„± ì•ˆë‚´</p>
                <ul className="space-y-1 text-blue-700">
                  <li>â€¢ ì‹ ì²­ í›„ ê´€ë¦¬ì ìŠ¹ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</li>
                  <li>â€¢ ìŠ¹ì¸ ì™„ë£Œ ì‹œ ìë™ìœ¼ë¡œ ë°©ì´ ìƒì„±ë©ë‹ˆë‹¤</li>
                  <li>â€¢ ìƒì„±ëœ ë°©ì˜ ê´€ë¦¬ìê°€ ë©ë‹ˆë‹¤</li>
                </ul>
              </div>
            </div>
          </div>

          {/* ì…ë ¥ í•„ë“œ */}
          <div className="mb-6">
            <label className="block text-sm font-medium text-gray-700 mb-2">
              ë°© ì´ë¦„ <span className="text-red-500">*</span>
            </label>
            <input
              type="text"
              value={spaceName}
              onChange={(e) => {
                setSpaceName(e.target.value);
                setError('');
              }}
              onKeyPress={(e) => {
                if (e.key === 'Enter' && !isLoading) {
                  handleSubmit();
                }
              }}
              placeholder="ì˜ˆ: ë¼ìš´ì§€ 1ì¸µ"
              maxLength={30}
              disabled={isLoading}
              className={`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 transition-all
                ${error
                  ? 'border-red-500 focus:ring-red-200'
                  : 'border-gray-300 focus:ring-blue-200'}
                disabled:bg-gray-50 disabled:cursor-not-allowed`}
            />
            {error && (
              <p className="mt-2 text-sm text-red-600 flex items-center gap-1">
                <AlertCircle className="w-4 h-4" />
                {error}
              </p>
            )}
            <p className="mt-2 text-xs text-gray-500">
              {spaceName.length}/30 ê¸€ì
            </p>
          </div>

          {/* ë²„íŠ¼ */}
          <div className="flex gap-3">
            <button
              onClick={handleClose}
              disabled={isLoading}
              className="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            >
              ì·¨ì†Œ
            </button>
            <button
              onClick={handleSubmit}
              disabled={isLoading || !spaceName.trim()}
              className="flex-1 px-4 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg font-medium hover:from-blue-600 hover:to-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl"
            >
              {isLoading ? (
                <div className="flex items-center justify-center gap-2">
                  <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                  <span>ì‹ ì²­ ì¤‘...</span>
                </div>
              ) : (
                'ì‹ ì²­í•˜ê¸°'
              )}
            </button>
          </div>
        </div>
      </div>
    </div>
  );
};

export default CreateSpaceModal;
</file>

<file path="src/components/tour/TourAutoLauncher.jsx">
// src/components/tour/TourAutoLauncher.jsx
import { useEffect, useState } from 'react';
import { useLocation } from 'react-router-dom';
import { useTour } from '../../contexts/TourContext';
import { TOUR_IDS } from '../../data/tourData';

/**
 * ë¡œê·¸ì¸ í›„ ìë™ìœ¼ë¡œ íˆ¬ì–´ë¥¼ ì‹¤í–‰í•˜ëŠ” ì»´í¬ë„ŒíŠ¸
 * íŠ¹ì • í˜ì´ì§€ ë°©ë¬¸ ì‹œ í•´ë‹¹ í˜ì´ì§€ì˜ íˆ¬ì–´ë¥¼ ìë™ ì‹¤í–‰
 */
const TourAutoLauncher = () => {
  const location = useLocation();
  const { isTourCompleted, startTour, loading } = useTour();
  const [hasLaunched, setHasLaunched] = useState(false);

  useEffect(() => {
    if (loading || hasLaunched) return;

    // ê° í˜ì´ì§€ë³„ íˆ¬ì–´ ë§¤í•‘
    const pageTourMap = {
      '/': TOUR_IDS.MEAL_CHECK, // í™ˆ í˜ì´ì§€ -> ë°¥ ì²´í¬ íˆ¬ì–´
      '/settlement': TOUR_IDS.SETTLEMENT, // ì •ì‚° í˜ì´ì§€ -> ì •ì‚° íˆ¬ì–´
    };

    const tourId = pageTourMap[location.pathname];

    // í•´ë‹¹ í˜ì´ì§€ì— íˆ¬ì–´ê°€ ìˆê³ , ì•„ì§ ì™„ë£Œí•˜ì§€ ì•Šì•˜ìœ¼ë©´ ì‹¤í–‰
    if (tourId && !isTourCompleted(tourId)) {
      // ì•½ê°„ì˜ ë”œë ˆì´ë¥¼ ì¤˜ì„œ í˜ì´ì§€ê°€ ì™„ì „íˆ ë¡œë“œëœ í›„ ì‹¤í–‰
      const timer = setTimeout(() => {
        startTour(tourId);
        setHasLaunched(true);
      }, 1000);

      return () => clearTimeout(timer);
    }
  }, [location.pathname, loading, isTourCompleted, startTour, hasLaunched]);

  return null; // UIë¥¼ ë Œë”ë§í•˜ì§€ ì•ŠìŒ
};

export default TourAutoLauncher;
</file>

<file path="src/components/tour/TourOverlay.jsx">
// src/components/tour/TourOverlay.jsx
import { useEffect, useState, useRef } from 'react';
import { X, ChevronLeft, ChevronRight, Check, Utensils } from 'lucide-react';
import { useTour } from '../../contexts/TourContext';
import tours from '../../data/tourData';

const TourOverlay = () => {
  const { activeTour, currentStep, nextStep, prevStep, endTour } = useTour();
  const [highlightRect, setHighlightRect] = useState(null);
  const [tooltipPosition, setTooltipPosition] = useState({ top: 0, left: 0 });
  const tooltipRef = useRef(null);

  const tourData = activeTour ? tours[activeTour] : null;
  const currentStepData = tourData?.steps[currentStep];
  const isLastStep = currentStep === (tourData?.steps.length - 1);
  const isFirstStep = currentStep === 0;

  // í•˜ì´ë¼ì´íŠ¸í•  ìš”ì†Œ ì°¾ê¸° ë° ìœ„ì¹˜ ê³„ì‚°
  useEffect(() => {
    const updatePosition = () => {
      try {
        // highlightSelectorê°€ ì—†ëŠ” ê²½ìš° (ì¤‘ì•™ ë°°ì¹˜)
        if (!currentStepData?.highlightSelector) {
          setHighlightRect(null);

          // ì¤‘ì•™ ë°°ì¹˜ë¥¼ ìœ„í•œ íˆ´íŒ ìœ„ì¹˜ ê³„ì‚°
          if (tooltipRef.current && currentStepData?.position === 'center') {
            const tooltipRect = tooltipRef.current.getBoundingClientRect();
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;

            setTooltipPosition({
              top: viewportHeight / 2 - tooltipRect.height / 2,
              left: viewportWidth / 2 - tooltipRect.width / 2,
            });
          }
          return;
        }

        const element = document.querySelector(currentStepData.highlightSelector);
        if (element) {
          const rect = element.getBoundingClientRect();
          setHighlightRect({
            top: rect.top,
            left: rect.left,
            width: rect.width,
            height: rect.height,
          });

          // íˆ´íŒ ìœ„ì¹˜ ê³„ì‚°
          if (tooltipRef.current) {
            const tooltipRect = tooltipRef.current.getBoundingClientRect();
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;

            let top = 0;
            let left = rect.left + rect.width / 2 - tooltipRect.width / 2;

            // ìœ„ì¹˜ì— ë”°ë¼ íˆ´íŒ ë°°ì¹˜
            if (currentStepData.position === 'top') {
              top = rect.top - tooltipRect.height - 20;
            } else if (currentStepData.position === 'bottom') {
              top = rect.bottom + 20;
            } else if (currentStepData.position === 'center') {
              // ì¤‘ì•™ ë°°ì¹˜
              top = viewportHeight / 2 - tooltipRect.height / 2;
              left = viewportWidth / 2 - tooltipRect.width / 2;
            } else {
              // ìë™ ë°°ì¹˜: í™”ë©´ ì¤‘ì•™ ê¸°ì¤€ìœ¼ë¡œ ìœ„/ì•„ë˜ ê²°ì •
              if (rect.top > viewportHeight / 2) {
                top = rect.top - tooltipRect.height - 20;
              } else {
                top = rect.bottom + 20;
              }
            }

            // ì¢Œìš° ê²½ê³„ ì²´í¬ (centerê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ)
            if (currentStepData.position !== 'center') {
              if (left < 20) left = 20;
              if (left + tooltipRect.width > viewportWidth - 20) {
                left = viewportWidth - tooltipRect.width - 20;
              }

              // ìƒí•˜ ê²½ê³„ ì²´í¬
              if (top < 20) top = 20;
              if (top + tooltipRect.height > viewportHeight - 20) {
                top = viewportHeight - tooltipRect.height - 20;
              }
            }

            setTooltipPosition({ top, left });
          }
        } else {
          setHighlightRect(null);
        }
      } catch (error) {
        console.error('ìš”ì†Œ ì°¾ê¸° ì‹¤íŒ¨:', error);
        setHighlightRect(null);
      }
    };

    updatePosition();

    // í™”ë©´ í¬ê¸° ë³€ê²½ ì‹œ ì¬ê³„ì‚°
    window.addEventListener('resize', updatePosition);
    window.addEventListener('scroll', updatePosition);

    return () => {
      window.removeEventListener('resize', updatePosition);
      window.removeEventListener('scroll', updatePosition);
    };
  }, [currentStepData, currentStep]);

  // ESC í‚¤ë¡œ íˆ¬ì–´ ì¢…ë£Œ
  useEffect(() => {
    const handleEsc = (e) => {
      if (e.key === 'Escape') {
        endTour(false);
      }
    };

    window.addEventListener('keydown', handleEsc);
    return () => window.removeEventListener('keydown', handleEsc);
  }, [endTour]);

  if (!tourData || !currentStepData) return null;

  const handlePrimaryAction = () => {
    if (isLastStep) {
      endTour(true);
    } else {
      nextStep();
    }
  };

  const handleSecondaryAction = () => {
    if (isFirstStep) {
      endTour(false);
    } else {
      prevStep();
    }
  };

  return (
    <div className="fixed inset-0 z-[9999]">
      {/* ì–´ë‘ìš´ ë°°ê²½ */}
      <div
        className="absolute inset-0 bg-black transition-opacity duration-300"
        style={{ opacity: 0.7 }}
        onClick={() => endTour(false)}
      />

      {/* Spotlight íš¨ê³¼ */}
      {highlightRect && (
        <>
          {/* í•˜ì´ë¼ì´íŠ¸ ì˜ì—­ (í´ë¦­ ê°€ëŠ¥í•˜ê²Œ) */}
          <div
            className="absolute pointer-events-auto"
            style={{
              top: highlightRect.top - 8,
              left: highlightRect.left - 8,
              width: highlightRect.width + 16,
              height: highlightRect.height + 16,
              boxShadow: '0 0 0 4px rgba(59, 130, 246, 0.5), 0 0 0 9999px rgba(0, 0, 0, 0.7)',
              borderRadius: '12px',
              transition: 'all 0.3s ease',
            }}
          />

          {/* í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ */}
          <div
            className="absolute pointer-events-none animate-ping"
            style={{
              top: highlightRect.top - 8,
              left: highlightRect.left - 8,
              width: highlightRect.width + 16,
              height: highlightRect.height + 16,
              border: '2px solid rgba(59, 130, 246, 0.6)',
              borderRadius: '12px',
            }}
          />
        </>
      )}

      {/* íˆ¬ì–´ ì¹´ë“œ */}
      <div
        ref={tooltipRef}
        className="absolute bg-white rounded-2xl shadow-2xl max-w-md w-[90vw] pointer-events-auto"
        style={{
          top: highlightRect ? `${tooltipPosition.top}px` : '50%',
          left: highlightRect ? `${tooltipPosition.left}px` : '50%',
          transform: highlightRect ? 'none' : 'translate(-50%, -50%)',
          transition: 'all 0.3s ease',
        }}
      >
        {/* ë‹«ê¸° ë²„íŠ¼ */}
        <button
          onClick={() => endTour(false)}
          className="absolute top-4 right-4 w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors z-10"
        >
          <X className="w-5 h-5 text-gray-500" />
        </button>

        {/* ì§„í–‰ í‘œì‹œê¸° */}
        <div className="px-6 pt-6 pb-4">
          <div className="flex items-center gap-2 mb-4">
            {tourData.steps.map((_, index) => (
              <div
                key={index}
                className={`h-1.5 flex-1 rounded-full transition-all ${
                  index === currentStep
                    ? 'bg-blue-600'
                    : index < currentStep
                    ? 'bg-blue-300'
                    : 'bg-gray-200'
                }`}
              />
            ))}
          </div>

          {/* íˆ¬ì–´ ì œëª© */}
          <p className="text-xs text-blue-600 font-semibold mb-1">
            {tourData.title} â€¢ {currentStep + 1}/{tourData.steps.length}
          </p>
          <h3 className="text-xl font-bold text-gray-900 mb-2">
            {currentStepData.title}
          </h3>
        </div>

        {/* ë‚´ìš© */}
        <div className="px-6 pb-6">
          <p className="text-gray-700 leading-relaxed whitespace-pre-line mb-6">
            {currentStepData.content}
          </p>

          {/* ì•„ì´ì½˜ í‘œì‹œ (ìˆëŠ” ê²½ìš°) */}
          {currentStepData.showIcon && (
            <div className="flex items-center justify-center mb-6 py-8 bg-amber-50 rounded-lg">
              <div className="relative">
                <Utensils className="w-16 h-16 text-amber-600" />
                {currentStepData.showIcon === 'utensils-with-badges' && (
                  <>
                    {/* ì ì‹¬ ë°°ì§€ (ë…¹ìƒ‰) */}
                    <div className="absolute -top-1 -left-1 w-5 h-5 bg-green-500 rounded-full border-2 border-white flex items-center justify-center">
                      <div className="w-2 h-2 bg-white rounded-full" />
                    </div>
                    {/* ì €ë… ë°°ì§€ (ì£¼í™©ìƒ‰) */}
                    <div className="absolute -bottom-1 -right-1 w-5 h-5 bg-orange-500 rounded-full border-2 border-white flex items-center justify-center">
                      <div className="w-2 h-2 bg-white rounded-full" />
                    </div>
                  </>
                )}
              </div>
            </div>
          )}

          {/* ì´ë¯¸ì§€ (ìˆëŠ” ê²½ìš°) */}
          {currentStepData.image && (
            <img
              src={currentStepData.image}
              alt={currentStepData.title}
              className="w-full rounded-lg mb-6"
            />
          )}

          {/* ì•¡ì…˜ ë²„íŠ¼ */}
          <div className="flex items-center gap-3">
            <button
              onClick={handleSecondaryAction}
              className="flex-1 px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold rounded-xl transition-colors"
            >
              {isFirstStep ? 'ê±´ë„ˆë›°ê¸°' : 'ì´ì „'}
            </button>
            <button
              onClick={handlePrimaryAction}
              className="flex-1 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-xl transition-colors flex items-center justify-center gap-2"
            >
              {isLastStep ? (
                <>
                  <Check className="w-5 h-5" />
                  ì™„ë£Œ
                </>
              ) : (
                <>
                  ë‹¤ìŒ
                  <ChevronRight className="w-5 h-5" />
                </>
              )}
            </button>
          </div>
        </div>
      </div>
    </div>
  );
};

export default TourOverlay;
</file>

<file path="src/contexts/TourContext.jsx">
// src/contexts/TourContext.jsx
import { createContext, useContext, useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { useAuth } from '../hooks/useAuth';
import tourService from '../services/tourService';
import tours from '../data/tourData';

const TourContext = createContext();

export const useTour = () => {
  const context = useContext(TourContext);
  if (!context) {
    throw new Error('useTour must be used within TourProvider');
  }
  return context;
};

export const TourProvider = ({ children }) => {
  const navigate = useNavigate();
  const { user, isLoggedIn } = useAuth();
  const [activeTour, setActiveTour] = useState(null);
  const [currentStep, setCurrentStep] = useState(0);
  const [completedTours, setCompletedTours] = useState([]);
  const [loading, setLoading] = useState(true);

  // ì‚¬ìš©ìê°€ ì™„ë£Œí•œ íˆ¬ì–´ ëª©ë¡ ë¡œë“œ
  useEffect(() => {
    if (user?.id) {
      loadCompletedTours();
    } else {
      setLoading(false);
    }
  }, [user]);

  const loadCompletedTours = async () => {
    try {
      setLoading(true);
      const completed = await tourService.getCompletedTours(user.id);
      setCompletedTours(completed);
    } catch (error) {
      console.error('íˆ¬ì–´ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
    } finally {
      setLoading(false);
    }
  };

  // íˆ¬ì–´ ì‹œì‘
  const startTour = (tourId) => {
    const tourData = tours[tourId];
    if (!tourData) {
      console.error('íˆ¬ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', tourId);
      return;
    }

    // íˆ¬ì–´ì˜ ì²« ë²ˆì§¸ ìŠ¤í…ì— navigationPathê°€ ìˆìœ¼ë©´ í•´ë‹¹ í˜ì´ì§€ë¡œ ì´ë™
    const firstStep = tourData.steps[0];
    if (firstStep?.navigationPath) {
      navigate(firstStep.navigationPath);
      // í˜ì´ì§€ ì´ë™ í›„ ì•½ê°„ì˜ ë”œë ˆì´ë¥¼ ì¤˜ì„œ í˜ì´ì§€ê°€ ë¡œë“œëœ í›„ íˆ¬ì–´ ì‹œì‘
      setTimeout(() => {
        setActiveTour(tourId);
        setCurrentStep(0);
      }, 500);
    } else {
      setActiveTour(tourId);
      setCurrentStep(0);
    }
  };

  // ë‹¤ìŒ ë‹¨ê³„
  const nextStep = () => {
    const nextStepIndex = currentStep + 1;
    const tourData = tours[activeTour];

    if (!tourData || nextStepIndex >= tourData.steps.length) {
      setCurrentStep((prev) => prev + 1);
      return;
    }

    const nextStepData = tourData.steps[nextStepIndex];

    // ë‹¤ìŒ ìŠ¤í…ì— navigationPathê°€ ìˆìœ¼ë©´ í˜ì´ì§€ ì´ë™
    if (nextStepData?.navigationPath) {
      navigate(nextStepData.navigationPath);
      // í˜ì´ì§€ ì´ë™ í›„ ì•½ê°„ì˜ ë”œë ˆì´ë¥¼ ì¤˜ì„œ í˜ì´ì§€ê°€ ë¡œë“œëœ í›„ ìŠ¤í… ë³€ê²½
      setTimeout(() => {
        setCurrentStep(nextStepIndex);
      }, 500);
    } else {
      setCurrentStep(nextStepIndex);
    }
  };

  // ì´ì „ ë‹¨ê³„
  const prevStep = () => {
    const prevStepIndex = Math.max(0, currentStep - 1);
    const tourData = tours[activeTour];

    if (!tourData) {
      setCurrentStep(prevStepIndex);
      return;
    }

    const prevStepData = tourData.steps[prevStepIndex];

    // ì´ì „ ìŠ¤í…ì— navigationPathê°€ ìˆìœ¼ë©´ í˜ì´ì§€ ì´ë™
    if (prevStepData?.navigationPath) {
      navigate(prevStepData.navigationPath);
      // í˜ì´ì§€ ì´ë™ í›„ ì•½ê°„ì˜ ë”œë ˆì´ë¥¼ ì¤˜ì„œ í˜ì´ì§€ê°€ ë¡œë“œëœ í›„ ìŠ¤í… ë³€ê²½
      setTimeout(() => {
        setCurrentStep(prevStepIndex);
      }, 500);
    } else {
      setCurrentStep(prevStepIndex);
    }
  };

  // íˆ¬ì–´ ì¢…ë£Œ
  const endTour = async (markAsCompleted = true) => {
    if (markAsCompleted && activeTour && user?.id) {
      try {
        await tourService.markTourAsCompleted(user.id, activeTour);
        setCompletedTours((prev) => [...prev, activeTour]);
      } catch (error) {
        console.error('íˆ¬ì–´ ì™„ë£Œ ì €ì¥ ì‹¤íŒ¨:', error);
      }
    }
    setActiveTour(null);
    setCurrentStep(0);
  };

  // íˆ¬ì–´ë¥¼ ì™„ë£Œí–ˆëŠ”ì§€ í™•ì¸
  const isTourCompleted = (tourId) => {
    return completedTours.includes(tourId);
  };

  // íˆ¬ì–´ ë‹¤ì‹œ ë³´ê¸°
  const resetTour = async (tourId) => {
    if (user?.id) {
      try {
        await tourService.resetTour(user.id, tourId);
        setCompletedTours((prev) => prev.filter((id) => id !== tourId));
      } catch (error) {
        console.error('íˆ¬ì–´ ë¦¬ì…‹ ì‹¤íŒ¨:', error);
      }
    }
  };

  const value = {
    activeTour,
    currentStep,
    completedTours,
    loading,
    startTour,
    nextStep,
    prevStep,
    endTour,
    isTourCompleted,
    resetTour,
  };

  return <TourContext.Provider value={value}>{children}</TourContext.Provider>;
};
</file>

<file path="src/data/tourData.js">
// src/data/tourData.js

export const TOUR_IDS = {
  MEAL_CHECK: 'meal-check-v1',
  SETTLEMENT: 'settlement-v1',
};

export const tours = {
  [TOUR_IDS.MEAL_CHECK]: {
    id: TOUR_IDS.MEAL_CHECK,
    title: 'ë°¥ ì²´í¬ ê¸°ëŠ¥',
    description: 'ë§¤ì¼ ë°¥ì„ ë¨¹ì„ì§€ ì²´í¬í•˜ê³ , ì°¸ì—¬ ì¸ì›ì„ í™•ì¸í•´ë³´ì„¸ìš”!',
    version: '1.0',
    steps: [
      {
        title: 'ë°¥ ì²´í¬ ê¸°ëŠ¥ì„ ì‹œì‘í•©ë‹ˆë‹¤',
        content: 'ì˜ˆì•½ í˜ì´ì§€ì—ì„œ ë°¥ ì²´í¬ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”.\nìº˜ë¦°ë”ë¥¼ í†µí•´ ë§¤ì¼ ì ì‹¬ê³¼ ì €ë…ì„ ê´€ë¦¬í•´ë³´ì„¸ìš”!',
        image: null,
        highlightSelector: null,
        position: 'center',
        primaryAction: 'ì‹œì‘í•˜ê¸°',
        secondaryAction: 'ê±´ë„ˆë›°ê¸°',
        navigationPath: '/', // ì˜ˆì•½ í˜ì´ì§€ë¡œ ì´ë™
      },
      {
        title: 'ë°¥ ì²´í¬ ë²„íŠ¼ ì°¾ê¸°',
        content: 'ìº˜ë¦°ë”ì˜ ê° ë‚ ì§œ ì˜†ì— ìˆëŠ” í¬í¬ ì•„ì´ì½˜ì„ ëˆŒëŸ¬ë³´ì„¸ìš”.\nê·¸ ë‚ ì˜ ë°¥ ì²´í¬ í™”ë©´ì´ ì—´ë¦½ë‹ˆë‹¤.',
        showIcon: 'utensils',
        highlightSelector: null,
        position: 'center',
        primaryAction: 'ë‹¤ìŒ',
        secondaryAction: 'ê±´ë„ˆë›°ê¸°',
      },
      {
        title: 'ì ì‹¬/ì €ë… ì„ íƒí•˜ê¸°',
        content: 'ì ì‹¬ ë˜ëŠ” ì €ë… ì¹´ë“œë¥¼ ì„ íƒí•˜ë©´\nì°¸ì—¬ì ëª©ë¡ì„ í™•ì¸í•˜ê³  ì°¸ì—¬/ì·¨ì†Œí•  ìˆ˜ ìˆì–´ìš”.',
        image: null,
        highlightSelector: '.meal-section-tabs',
        position: 'top',
        primaryAction: 'ë‹¤ìŒ',
        secondaryAction: 'ì´ì „',
      },
      {
        title: 'ì°¸ì—¬ì í™•ì¸í•˜ê¸°',
        content: 'ëˆ„ê°€ ë°¥ì„ ë¨¹ëŠ”ì§€ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•˜ê³ ,\ní•˜ë‹¨ ë²„íŠ¼ìœ¼ë¡œ ì°¸ì—¬í•˜ê±°ë‚˜ ì·¨ì†Œí•  ìˆ˜ ìˆì–´ìš”.\n\nì²´í¬í•œ ë‚´ìš©ì€ ìº˜ë¦°ë”ì˜ í¬í¬ ì•„ì´ì½˜ì— í‘œì‹œë˜ì–´\nì–¸ì œë“ ì§€ ë‚´ ì‹ì‚¬ ì¼ì •ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!',
        showIcon: 'utensils-with-badges',
        highlightSelector: null,
        position: 'center',
        primaryAction: 'ì™„ë£Œ',
        secondaryAction: 'ì´ì „',
      },
    ],
  },

  [TOUR_IDS.SETTLEMENT]: {
    id: TOUR_IDS.SETTLEMENT,
    title: 'ì •ì‚° ê¸°ëŠ¥',
    description: 'ì˜ìˆ˜ì¦ì„ ë“±ë¡í•˜ê³  ìë™ìœ¼ë¡œ ì •ì‚°í•´ë³´ì„¸ìš”!',
    version: '1.0',
    steps: [
      {
        title: 'ì •ì‚° ê¸°ëŠ¥ì„ ì‹œì‘í•©ë‹ˆë‹¤',
        content: 'ì •ì‚° í˜ì´ì§€ì—ì„œ ì˜ìˆ˜ì¦ì„ ë“±ë¡í•˜ê³ \nìë™ìœ¼ë¡œ ì •ì‚°í•  ìˆ˜ ìˆì–´ìš”!',
        image: null,
        highlightSelector: null,
        position: 'center',
        primaryAction: 'ì‹œì‘í•˜ê¸°',
        secondaryAction: 'ê±´ë„ˆë›°ê¸°',
        navigationPath: '/settlement', // ì •ì‚° í˜ì´ì§€ë¡œ ì´ë™
      },
      {
        title: 'ë‚´ ì •ì‚° í˜„í™©',
        content: 'ì´ë²ˆ ì£¼ ë‚´ê°€ ë‚¸ ê¸ˆì•¡ê³¼ ë¶€ë‹´ì•¡ì„ í™•ì¸í•˜ê³ ,\nì •ì‚° ê²°ê³¼ë¥¼ í•œëˆˆì— ë³¼ ìˆ˜ ìˆì–´ìš”.',
        image: null,
        highlightSelector: '.bg-gradient-to-br.from-blue-500.to-blue-600',
        position: 'bottom',
        primaryAction: 'ë‹¤ìŒ',
        secondaryAction: 'ê±´ë„ˆë›°ê¸°',
      },
      {
        title: 'ë‚´ ì°¸ì—¬ë‚´ì—­ í™•ì¸',
        content: '"ë‚´ ì°¸ì—¬ë‚´ì—­" íƒ­ì—ì„œëŠ”\në‚´ê°€ ë¶„ë‹´ìë¡œ í¬í•¨ëœ ì˜ìˆ˜ì¦ë§Œ ë³¼ ìˆ˜ ìˆì–´ìš”.\në‚´ê°€ ë‚¼ ê¸ˆì•¡ì„ ë¹ ë¥´ê²Œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!',
        image: null,
        highlightSelector: '[data-tour="my-receipts-tab"]',
        position: 'bottom',
        primaryAction: 'ë‹¤ìŒ',
        secondaryAction: 'ì´ì „',
      },
      {
        title: 'ì˜ìˆ˜ì¦ ì œì¶œ ë²„íŠ¼',
        content: 'ìš°ì¸¡ í•˜ë‹¨ì˜ "+ ì˜ìˆ˜ì¦ ì œì¶œ" ë²„íŠ¼ì„ ëˆŒëŸ¬\nì˜ìˆ˜ì¦ì„ ì œì¶œí•  ìˆ˜ ìˆì–´ìš”.',
        image: null,
        highlightSelector: '[data-tour="submit-receipt-button"]',
        position: 'top',
        primaryAction: 'ë‹¤ìŒ',
        secondaryAction: 'ì´ì „',
      },
      {
        title: 'ì˜ìˆ˜ì¦ ì œì¶œ í˜ì´ì§€',
        content: 'ì˜ìˆ˜ì¦ ì œì¶œ í˜ì´ì§€ì—ì„œ\në‹¤ì–‘í•œ ì •ë³´ë¥¼ ì…ë ¥í•  ìˆ˜ ìˆì–´ìš”.',
        image: null,
        highlightSelector: null,
        position: 'center',
        primaryAction: 'ë‹¤ìŒ',
        secondaryAction: 'ì´ì „',
        navigationPath: '/settlement/submit',
      },
      {
        title: 'ê·€ì†ì¼ ì„ íƒ',
        content: 'ì˜ìˆ˜ì¦ì˜ ê·€ì†ì¼ì„ ì„ íƒí•  ìˆ˜ ìˆì–´ìš”.\nê³¼ê±° ë‚ ì§œë„ ì„ íƒ ê°€ëŠ¥í•˜ë©°, í•´ë‹¹ ì£¼ì°¨ê°€ ë§ˆê°ë˜ì—ˆìœ¼ë©´\nìë™ìœ¼ë¡œ ì •ì‚° ê°€ëŠ¥í•œ ì£¼ì°¨ì— ë“±ë¡ë©ë‹ˆë‹¤.',
        image: null,
        highlightSelector: '[data-tour="belongs-date-input"]',
        position: 'bottom',
        primaryAction: 'ë‹¤ìŒ',
        secondaryAction: 'ì´ì „',
      },
      {
        title: 'ì˜ìˆ˜ì¦ ì‚¬ì§„ ì²¨ë¶€',
        content: 'ì˜ìˆ˜ì¦ ì‚¬ì§„ì„ ì°ê±°ë‚˜ ê°¤ëŸ¬ë¦¬ì—ì„œ ì„ íƒí•˜ì„¸ìš”.\në‚˜ì¤‘ì— í™•ì¸í•  ë•Œ í¸ë¦¬í•©ë‹ˆë‹¤!',
        image: null,
        highlightSelector: '.receipt-image-upload',
        position: 'bottom',
        primaryAction: 'ë‹¤ìŒ',
        secondaryAction: 'ì´ì „',
      },
      {
        title: 'ëˆ ë‚¸ ì‚¬ëŒ ì„ íƒ',
        content: 'ì‹¤ì œë¡œ ëˆì„ ë‚¸ ì‚¬ëŒì„ ì„ íƒí•˜ì„¸ìš”.\nê¸°ë³¸ê°’ì€ ë³¸ì¸ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆì–´ìš”.',
        image: null,
        highlightSelector: '.paid-by-section',
        position: 'bottom',
        primaryAction: 'ë‹¤ìŒ',
        secondaryAction: 'ì´ì „',
      },
      {
        title: 'í•­ëª©ë³„ ë¶„ë‹´ì ì„¤ì •',
        content: 'ê° í•­ëª©ë§ˆë‹¤ ëˆ„ê°€ ë¹„ìš©ì„ ë¶„ë‹´í• ì§€ ì„ íƒí•  ìˆ˜ ìˆì–´ìš”.\në³¸ì¸ì€ ìë™ìœ¼ë¡œ ì¶”ê°€ë˜ë©°, X ë²„íŠ¼ìœ¼ë¡œ ì œì™¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
        image: null,
        highlightSelector: '.item-split-section',
        position: 'top',
        primaryAction: 'ì™„ë£Œ',
        secondaryAction: 'ì´ì „',
      },
    ],
  },
};

export default tours;
</file>

<file path="src/hooks/useReservations.js">
import { useState, useEffect, useCallback } from 'react';
import useStore from '../store/useStore';
import reservationService from '../services/reservationService';
import authService from '../services/authService';

export const useReservations = (spaceId, currentWeekStart) => {
  const { reservations, setReservations, addProfiles } = useStore();
  const [loading, setLoading] = useState(false);
  
  const fetchReservations = useCallback(async () => {
    if (!spaceId || !currentWeekStart) return;

    setLoading(true);
    try {
      // í˜„ì¬ ì£¼ + ì´ì „ ì£¼ + ë‹¤ìŒ ì£¼ (ì´ 3ì£¼) ë¡œë“œ
      const prevWeekStart = new Date(currentWeekStart);
      prevWeekStart.setDate(prevWeekStart.getDate() - 7);

      const nextWeekStart = new Date(currentWeekStart);
      nextWeekStart.setDate(nextWeekStart.getDate() + 7);

      // 3ì£¼ì¹˜ ë°ì´í„°ë¥¼ ë³‘ë ¬ë¡œ ë¡œë“œ
      const [prevWeekResult, currentWeekResult, nextWeekResult] = await Promise.all([
        reservationService.getReservations(spaceId, prevWeekStart),
        reservationService.getReservations(spaceId, currentWeekStart),
        reservationService.getReservations(spaceId, nextWeekStart)
      ]);

      // 3ì£¼ì¹˜ ë°ì´í„° ë³‘í•©
      const allReservations = {
        ...prevWeekResult.reservations,
        ...currentWeekResult.reservations,
        ...nextWeekResult.reservations
      };

      // ì¤‘ë³µ ì œê±°ëœ userIds
      const allUserIds = Array.from(new Set([
        ...prevWeekResult.userIds,
        ...currentWeekResult.userIds,
        ...nextWeekResult.userIds
      ]));

      console.log('ğŸ“¥ ì˜ˆì•½ ë°ì´í„° 3ì£¼ì¹˜ ë¡œë“œ:', Object.keys(allReservations).length, 'ê°œ ë‚ ì§œ');
      setReservations(allReservations);

      // í”„ë¡œí•„ ê°€ì ¸ì˜¤ê¸° (ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰)
      if (allUserIds.length > 0) {
        try {
          const profiles = await authService.getUserProfiles(allUserIds);
          console.log('ğŸ‘¥ í”„ë¡œí•„ ë¡œë“œ:', Object.keys(profiles).length, 'ëª…');
          addProfiles(profiles);
        } catch (error) {
          console.warn('âš ï¸ í”„ë¡œí•„ ë¡œë“œ ì‹¤íŒ¨ (ì˜ˆì•½ì€ name í•„ë“œ ì‚¬ìš©):', error.message);
        }
      }
    } catch (error) {
      console.error('âŒ Failed to fetch reservations:', error);
    } finally {
      setLoading(false);
    }
  }, [spaceId, currentWeekStart, setReservations, addProfiles]);
  
  useEffect(() => {
    fetchReservations();
  }, [fetchReservations]);
  
  const createReservation = async (reservationData) => {
    await reservationService.createReservation(spaceId, reservationData);
    await fetchReservations();
  };
  
  const cancelReservation = async (reservationId) => {
    await reservationService.cancelReservation(spaceId, reservationId);
    await fetchReservations();
  };
  
  return { reservations, loading, createReservation, cancelReservation, refresh: fetchReservations };
};
</file>

<file path="src/index.css">
@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  /* ë¼ì´íŠ¸ ëª¨ë“œ ë‹¨ì¼ */
  --brand: #2563eb;
  --brand-weak: #dbeafe;
  --bg: #f8fafc;
  --surface: #ffffff;
  --text: #0f172a;
  --muted: #64748b;
  --ok: #10b981;
  --warn: #f59e0b;
  --radius: 14px;
  --shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
}

body {
  margin: 0;
  font-family: Pretendard, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto',
    system-ui, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background: var(--bg);
  color: var(--text);
  line-height: 1.5;
}

/* Safe-area support for iOS */
.safe-area-top {
  padding-top: env(safe-area-inset-top);
}

.safe-area-bottom {
  padding-bottom: env(safe-area-inset-bottom);
}

/* Details/Summary ìŠ¤íƒ€ì¼ */
details summary {
  list-style: none;
  cursor: pointer;
}

details summary::-webkit-details-marker {
  display: none;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-fadeIn {
  animation: fadeIn 0.3s ease-out;
}
</file>

<file path="src/pages/BartenderManagePage.jsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Plus, ArrowLeft, Edit2, Trash2, Power, PowerOff } from 'lucide-react';
import { useAuth } from '../hooks/useAuth';
import useStore from '../store/useStore';
import bartenderService from '../services/bartenderService';
import BartenderMenuFormModal from '../components/bartender/BartenderMenuFormModal';
import LoginOverlay from '../components/auth/LoginOverlay';
import { canManageSpace } from '../utils/permissions';

const BartenderManagePage = () => {
  const navigate = useNavigate();
  const { user, isLoggedIn } = useAuth();
  const { selectedSpace } = useStore();

  const [menus, setMenus] = useState([]);
  const [isLoading, setIsLoading] = useState(true);
  const [showFormModal, setShowFormModal] = useState(false);
  const [formMode, setFormMode] = useState('create'); // 'create' | 'edit'
  const [selectedMenu, setSelectedMenu] = useState(null);
  const [categoryFilter, setCategoryFilter] = useState('all');

  // ê¶Œí•œ í™•ì¸
  const hasPermission = selectedSpace?.userType && canManageSpace(selectedSpace.userType);

  useEffect(() => {
    if (selectedSpace?.id) {
      loadMenus();
    }
  }, [selectedSpace]);

  const loadMenus = async () => {
    setIsLoading(true);
    try {
      const data = await bartenderService.getMenus(selectedSpace.id);
      setMenus(data);
    } catch (error) {
      console.error('ë©”ë‰´ ì¡°íšŒ ì‹¤íŒ¨:', error);
      alert('ë©”ë‰´ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setIsLoading(false);
    }
  };

  const handleCreateMenu = () => {
    setFormMode('create');
    setSelectedMenu(null);
    setShowFormModal(true);
  };

  const handleEditMenu = (menu) => {
    setFormMode('edit');
    setSelectedMenu(menu);
    setShowFormModal(true);
  };

  const handleSaveMenu = async (menuData) => {
    try {
      if (formMode === 'create') {
        await bartenderService.createMenu(selectedSpace.id, menuData);
        alert('ë©”ë‰´ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
      } else {
        await bartenderService.updateMenu(selectedSpace.id, selectedMenu.id, menuData);
        alert('ë©”ë‰´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
      }
      loadMenus();
    } catch (error) {
      console.error('ë©”ë‰´ ì €ì¥ ì‹¤íŒ¨:', error);
      throw error;
    }
  };

  const handleDeleteMenu = async (menuId, menuName) => {
    if (!window.confirm(`"${menuName}" ë©”ë‰´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
      return;
    }

    try {
      await bartenderService.deleteMenu(selectedSpace.id, menuId);
      alert('ë©”ë‰´ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
      loadMenus();
    } catch (error) {
      console.error('ë©”ë‰´ ì‚­ì œ ì‹¤íŒ¨:', error);
      alert('ë©”ë‰´ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  };

  const handleToggleAvailability = async (menuId) => {
    try {
      await bartenderService.toggleMenuAvailability(selectedSpace.id, menuId);
      loadMenus();
    } catch (error) {
      console.error('íŒë§¤ ê°€ëŠ¥ ì—¬ë¶€ ë³€ê²½ ì‹¤íŒ¨:', error);
      alert('íŒë§¤ ê°€ëŠ¥ ì—¬ë¶€ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  };

  // ì¹´í…Œê³ ë¦¬ ëª©ë¡ ì¶”ì¶œ
  const categories = ['all', ...new Set(menus.map(m => m.category))];

  // ì¹´í…Œê³ ë¦¬ë³„ í•„í„°ë§
  const filteredMenus = categoryFilter === 'all'
    ? menus
    : menus.filter(m => m.category === categoryFilter);

  // ë¡œê·¸ì¸ í™•ì¸
  if (!isLoggedIn) {
    return <LoginOverlay />;
  }

  // ê¶Œí•œ í™•ì¸
  if (!hasPermission) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center p-4">
        <div className="bg-white rounded-xl p-8 text-center shadow-xl max-w-md">
          <div className="text-6xl mb-4">ğŸš«</div>
          <h2 className="text-2xl font-bold text-gray-900 mb-2">ì ‘ê·¼ ê¶Œí•œ ì—†ìŒ</h2>
          <p className="text-gray-600 mb-6">
            ë©”ë‰´ ê´€ë¦¬ëŠ” ë§¤ë‹ˆì €/ë¶€ë§¤ë‹ˆì €ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.
          </p>
          <button
            onClick={() => navigate('/bartender/menu')}
            className="px-6 py-3 bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-lg font-semibold hover:from-orange-600 hover:to-amber-600 transition-all shadow-lg"
          >
            ë©”ë‰´íŒìœ¼ë¡œ ëŒì•„ê°€ê¸°
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 pb-6">
      {/* í—¤ë” */}
      <div className="bg-gradient-to-r from-orange-500 to-amber-500 text-white p-6 shadow-lg">
        <div className="max-w-4xl mx-auto">
          <div className="flex items-center gap-4 mb-4">
            <button
              onClick={() => navigate('/bartender/menu')}
              className="p-2 hover:bg-white/20 rounded-full transition-colors"
            >
              <ArrowLeft className="w-6 h-6" />
            </button>
            <h1 className="text-2xl font-bold flex-1">ë©”ë‰´ ê´€ë¦¬</h1>
            <button
              onClick={handleCreateMenu}
              className="flex items-center gap-2 px-4 py-2 bg-white text-orange-600 rounded-lg font-semibold hover:bg-orange-50 transition-colors shadow-md"
            >
              <Plus className="w-5 h-5" />
              ë©”ë‰´ ì¶”ê°€
            </button>
          </div>

          {/* ì¹´í…Œê³ ë¦¬ í•„í„° */}
          <div className="flex gap-2 overflow-x-auto pb-2">
            {categories.map((category) => (
              <button
                key={category}
                onClick={() => setCategoryFilter(category)}
                className={`px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition-all ${
                  categoryFilter === category
                    ? 'bg-white text-orange-600 shadow-md'
                    : 'bg-white/20 text-white hover:bg-white/30'
                }`}
              >
                {category === 'all' ? 'ì „ì²´' : category}
              </button>
            ))}
          </div>
        </div>
      </div>

      {/* ë©”ë‰´ ëª©ë¡ */}
      <div className="max-w-4xl mx-auto px-4 mt-6">
        {isLoading ? (
          <div className="text-center py-12">
            <div className="inline-block w-8 h-8 border-4 border-orange-500 border-t-transparent rounded-full animate-spin mb-4"></div>
            <p className="text-gray-600">ë©”ë‰´ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
          </div>
        ) : filteredMenus.length === 0 ? (
          <div className="text-center py-12">
            <div className="text-6xl mb-4">ğŸ¸</div>
            <p className="text-gray-600 mb-4">
              {categoryFilter === 'all' ? 'ë“±ë¡ëœ ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.' : `${categoryFilter} ì¹´í…Œê³ ë¦¬ì— ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.`}
            </p>
            <button
              onClick={handleCreateMenu}
              className="px-6 py-3 bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-lg font-semibold hover:from-orange-600 hover:to-amber-600 transition-all shadow-lg"
            >
              ì²« ë©”ë‰´ ì¶”ê°€í•˜ê¸°
            </button>
          </div>
        ) : (
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            {filteredMenus.map((menu) => (
              <div
                key={menu.id}
                className={`bg-white rounded-xl shadow-md overflow-hidden transition-all hover:shadow-lg ${
                  !menu.available ? 'opacity-60' : ''
                }`}
              >
                <div className="flex">
                  {/* ë©”ë‰´ ì´ë¯¸ì§€ */}
                  <div className="w-32 h-32 flex-shrink-0 bg-gray-200">
                    {menu.imageUrl ? (
                      <img
                        src={menu.imageUrl}
                        alt={menu.menuName}
                        className="w-full h-full object-cover"
                      />
                    ) : (
                      <div className="w-full h-full flex items-center justify-center text-4xl">
                        ğŸ¸
                      </div>
                    )}
                  </div>

                  {/* ë©”ë‰´ ì •ë³´ */}
                  <div className="flex-1 p-4 flex flex-col justify-between">
                    <div>
                      <div className="flex items-start justify-between mb-1">
                        <h3 className="font-bold text-lg text-gray-900">{menu.menuName}</h3>
                        <span className="text-sm px-2 py-1 bg-orange-100 text-orange-700 rounded font-semibold">
                          {menu.category}
                        </span>
                      </div>
                      <p className="text-lg font-bold text-orange-600 mb-2">
                        {menu.price.toLocaleString()}ì›
                      </p>
                      {menu.description && (
                        <p className="text-sm text-gray-600 line-clamp-2">{menu.description}</p>
                      )}
                    </div>

                    {/* ì•¡ì…˜ ë²„íŠ¼ */}
                    <div className="flex items-center gap-2 mt-3">
                      <button
                        onClick={() => handleToggleAvailability(menu.id)}
                        className={`flex items-center gap-1 px-3 py-1.5 rounded-lg font-semibold text-sm transition-colors ${
                          menu.available
                            ? 'bg-green-100 text-green-700 hover:bg-green-200'
                            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                        }`}
                      >
                        {menu.available ? (
                          <>
                            <Power className="w-4 h-4" />
                            íŒë§¤ì¤‘
                          </>
                        ) : (
                          <>
                            <PowerOff className="w-4 h-4" />
                            í’ˆì ˆ
                          </>
                        )}
                      </button>
                      <button
                        onClick={() => handleEditMenu(menu)}
                        className="flex items-center gap-1 px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg font-semibold text-sm hover:bg-blue-200 transition-colors"
                      >
                        <Edit2 className="w-4 h-4" />
                        ìˆ˜ì •
                      </button>
                      <button
                        onClick={() => handleDeleteMenu(menu.id, menu.menuName)}
                        className="flex items-center gap-1 px-3 py-1.5 bg-red-100 text-red-700 rounded-lg font-semibold text-sm hover:bg-red-200 transition-colors"
                      >
                        <Trash2 className="w-4 h-4" />
                        ì‚­ì œ
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        )}
      </div>

      {/* ë©”ë‰´ í¼ ëª¨ë‹¬ */}
      {showFormModal && (
        <BartenderMenuFormModal
          mode={formMode}
          menu={selectedMenu}
          onClose={() => setShowFormModal(false)}
          onSave={handleSaveMenu}
          currentUser={user}
        />
      )}
    </div>
  );
};

export default BartenderManagePage;
</file>

<file path="src/pages/BartenderMenuPage.jsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { ArrowLeft, Settings, ShoppingCart, Plus, Minus, ClipboardList } from 'lucide-react';
import { useAuth } from '../hooks/useAuth';
import useStore from '../store/useStore';
import bartenderService from '../services/bartenderService';
import BartenderOrderModal from '../components/bartender/BartenderOrderModal';
import LoginOverlay from '../components/auth/LoginOverlay';
import { canManageSpace } from '../utils/permissions';

const BartenderMenuPage = () => {
  const navigate = useNavigate();
  const { user, isLoggedIn } = useAuth();
  const { selectedSpace } = useStore();

  const [menus, setMenus] = useState([]);
  const [isLoading, setIsLoading] = useState(true);
  const [categoryFilter, setCategoryFilter] = useState('all');
  const [cart, setCart] = useState([]);
  const [showOrderModal, setShowOrderModal] = useState(false);

  const hasManagePermission = selectedSpace?.userType && canManageSpace(selectedSpace.userType);

  useEffect(() => {
    if (selectedSpace?.id) {
      loadMenus();
    }
  }, [selectedSpace]);

  const loadMenus = async () => {
    setIsLoading(true);
    try {
      const data = await bartenderService.getAvailableMenus(selectedSpace.id);
      setMenus(data);
    } catch (error) {
      console.error('ë©”ë‰´ ì¡°íšŒ ì‹¤íŒ¨:', error);
      alert('ë©”ë‰´ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setIsLoading(false);
    }
  };

  // ì¹´í…Œê³ ë¦¬ ëª©ë¡ ì¶”ì¶œ (ìˆœì„œ ìœ ì§€)
  const uniqueCategories = [...new Set(menus.map(m => m.category))];
  const categoryOrder = { 'LOW': 1, 'MID': 2, 'HIGH': 3 };
  const sortedCategories = uniqueCategories.sort((a, b) =>
    (categoryOrder[a] || 999) - (categoryOrder[b] || 999)
  );
  const categories = ['all', ...sortedCategories];

  // ì¹´í…Œê³ ë¦¬ë³„ í•„í„°ë§ ë° ì •ë ¬
  const filteredMenus = (categoryFilter === 'all'
    ? menus
    : menus.filter(m => m.category === categoryFilter)
  ).sort((a, b) => {
    // ì¹´í…Œê³ ë¦¬ ìš°ì„  ì •ë ¬ (LOW, MID, HIGH ìˆœ)
    const categoryOrder = { 'LOW': 1, 'MID': 2, 'HIGH': 3 };
    const categoryDiff = (categoryOrder[a.category] || 999) - (categoryOrder[b.category] || 999);
    if (categoryDiff !== 0) return categoryDiff;

    // ê°™ì€ ì¹´í…Œê³ ë¦¬ ë‚´ì—ì„œëŠ” ìƒì„±ì¼ ìµœì‹ ìˆœ
    return (b.createdAt || 0) - (a.createdAt || 0);
  });

  // ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€
  const addToCart = (menu) => {
    const existingItem = cart.find(item => item.menuId === menu.id);
    if (existingItem) {
      setCart(cart.map(item =>
        item.menuId === menu.id
          ? { ...item, quantity: item.quantity + 1 }
          : item
      ));
    } else {
      setCart([...cart, {
        menuId: menu.id,
        menuName: menu.menuName,
        price: menu.price,
        quantity: 1
      }]);
    }
  };

  // ì¥ë°”êµ¬ë‹ˆì—ì„œ ì œê±°
  const removeFromCart = (menuId) => {
    const existingItem = cart.find(item => item.menuId === menuId);
    if (existingItem && existingItem.quantity > 1) {
      setCart(cart.map(item =>
        item.menuId === menuId
          ? { ...item, quantity: item.quantity - 1 }
          : item
      ));
    } else {
      setCart(cart.filter(item => item.menuId !== menuId));
    }
  };

  // íŠ¹ì • ë©”ë‰´ì˜ ì¥ë°”êµ¬ë‹ˆ ìˆ˜ëŸ‰ ì¡°íšŒ
  const getCartQuantity = (menuId) => {
    const item = cart.find(item => item.menuId === menuId);
    return item ? item.quantity : 0;
  };

  // ì¥ë°”êµ¬ë‹ˆ ì´ ìˆ˜ëŸ‰
  const cartTotalQuantity = cart.reduce((sum, item) => sum + item.quantity, 0);

  // ì£¼ë¬¸í•˜ê¸°
  const handleSubmitOrder = async (cart, memo) => {
    const orderData = {
      userId: user.id,
      userName: user.displayName || user.name,
      items: cart,
      memo: memo
    };

    await bartenderService.createOrder(selectedSpace.id, orderData);
    alert('ì£¼ë¬¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\në°”í…ë”ì—ê²Œ ì•Œë¦¼ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
    setCart([]);
  };

  // ë¡œê·¸ì¸ í™•ì¸
  if (!isLoggedIn) {
    return <LoginOverlay />;
  }

  return (
    <div className="min-h-screen bg-gray-50 pb-24">
      {/* í—¤ë” */}
      <div className="bg-gradient-to-r from-orange-500 to-amber-500 text-white p-6 shadow-lg">
        <div className="max-w-4xl mx-auto">
          <div className="flex items-center gap-4 mb-4">
            <button
              onClick={() => navigate('/more')}
              className="p-2 hover:bg-white/20 rounded-full transition-colors"
            >
              <ArrowLeft className="w-6 h-6" />
            </button>
            <h1 className="text-2xl font-bold flex-1">ë°”í…ë” ë©”ë‰´</h1>
            <button
              onClick={() => navigate('/bartender/orders')}
              className="p-2 hover:bg-white/20 rounded-full transition-colors"
              title="ì£¼ë¬¸ ë‚´ì—­"
            >
              <ClipboardList className="w-6 h-6" />
            </button>
            {hasManagePermission && (
              <button
                onClick={() => navigate('/bartender/manage')}
                className="p-2 hover:bg-white/20 rounded-full transition-colors"
                title="ë©”ë‰´ ê´€ë¦¬"
              >
                <Settings className="w-6 h-6" />
              </button>
            )}
          </div>

          {/* ì¹´í…Œê³ ë¦¬ í•„í„° */}
          <div className="flex gap-2 overflow-x-auto pb-2 scrollbar-hide">
            {categories.map((category) => (
              <button
                key={category}
                onClick={() => setCategoryFilter(category)}
                className={`px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition-all ${
                  categoryFilter === category
                    ? 'bg-white text-orange-600 shadow-md'
                    : 'bg-white/20 text-white hover:bg-white/30'
                }`}
              >
                {category === 'all' ? 'ì „ì²´' : category}
              </button>
            ))}
          </div>
        </div>
      </div>

      {/* ë©”ë‰´ ëª©ë¡ */}
      <div className="max-w-4xl mx-auto px-4 mt-6">
        {isLoading ? (
          <div className="text-center py-12">
            <div className="inline-block w-8 h-8 border-4 border-orange-500 border-t-transparent rounded-full animate-spin mb-4"></div>
            <p className="text-gray-600">ë©”ë‰´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
          </div>
        ) : filteredMenus.length === 0 ? (
          <div className="text-center py-12">
            <div className="text-6xl mb-4">ğŸ¸</div>
            <p className="text-gray-600 mb-4">
              {categoryFilter === 'all' ? 'íŒë§¤ ì¤‘ì¸ ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.' : `${categoryFilter} ì¹´í…Œê³ ë¦¬ì— ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.`}
            </p>
            {hasManagePermission && (
              <button
                onClick={() => navigate('/bartender/manage')}
                className="px-6 py-3 bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-lg font-semibold hover:from-orange-600 hover:to-amber-600 transition-all shadow-lg"
              >
                ë©”ë‰´ ê´€ë¦¬ë¡œ ì´ë™
              </button>
            )}
          </div>
        ) : (
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            {filteredMenus.map((menu) => {
              const quantity = getCartQuantity(menu.id);
              return (
                <div
                  key={menu.id}
                  className="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-all"
                >
                  {/* ë©”ë‰´ ì´ë¯¸ì§€ */}
                  <div className="h-48 bg-gray-200 relative">
                    {menu.imageUrl ? (
                      <img
                        src={menu.imageUrl}
                        alt={menu.menuName}
                        className="w-full h-full object-cover"
                      />
                    ) : (
                      <div className="w-full h-full flex items-center justify-center text-6xl">
                        ğŸ¸
                      </div>
                    )}
                    {quantity > 0 && (
                      <div className="absolute top-2 right-2 bg-orange-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold shadow-lg">
                        {quantity}
                      </div>
                    )}
                  </div>

                  {/* ë©”ë‰´ ì •ë³´ */}
                  <div className="p-4">
                    <div className="flex items-start justify-between mb-2">
                      <h3 className="font-bold text-lg text-gray-900 flex-1">{menu.menuName}</h3>
                      <span className="text-xs px-2 py-1 bg-orange-100 text-orange-700 rounded font-semibold ml-2">
                        {menu.category}
                      </span>
                    </div>
                    <p className="text-xl font-bold text-orange-600 mb-2">
                      {menu.price.toLocaleString()}ì›
                    </p>
                    {menu.description && (
                      <p className="text-sm text-gray-600 line-clamp-2 mb-3">{menu.description}</p>
                    )}

                    {/* ì¥ë°”êµ¬ë‹ˆ ë²„íŠ¼ */}
                    {quantity === 0 ? (
                      <button
                        onClick={() => addToCart(menu)}
                        className="w-full px-4 py-2 bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-lg font-semibold hover:from-orange-600 hover:to-amber-600 transition-all shadow flex items-center justify-center gap-2"
                      >
                        <Plus className="w-5 h-5" />
                        ë‹´ê¸°
                      </button>
                    ) : (
                      <div className="flex items-center gap-2">
                        <button
                          onClick={() => removeFromCart(menu.id)}
                          className="flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors flex items-center justify-center"
                        >
                          <Minus className="w-5 h-5" />
                        </button>
                        <span className="text-xl font-bold text-gray-900 min-w-[3rem] text-center">
                          {quantity}
                        </span>
                        <button
                          onClick={() => addToCart(menu)}
                          className="flex-1 px-4 py-2 bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-lg font-semibold hover:from-orange-600 hover:to-amber-600 transition-all shadow flex items-center justify-center"
                        >
                          <Plus className="w-5 h-5" />
                        </button>
                      </div>
                    )}
                  </div>
                </div>
              );
            })}
          </div>
        )}
      </div>

      {/* í”Œë¡œíŒ… ì¥ë°”êµ¬ë‹ˆ ë²„íŠ¼ */}
      {cart.length > 0 && (
        <div className="fixed bottom-6 right-6 z-40">
          <button
            onClick={() => setShowOrderModal(true)}
            className="relative bg-gradient-to-r from-orange-500 to-amber-500 text-white p-4 rounded-full shadow-2xl hover:from-orange-600 hover:to-amber-600 transition-all hover:scale-110"
          >
            <ShoppingCart className="w-6 h-6" />
            <span className="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">
              {cartTotalQuantity}
            </span>
          </button>
        </div>
      )}

      {/* ì£¼ë¬¸ ëª¨ë‹¬ */}
      {showOrderModal && (
        <BartenderOrderModal
          cart={cart}
          onClose={() => setShowOrderModal(false)}
          onSubmit={handleSubmitOrder}
        />
      )}
    </div>
  );
};

export default BartenderMenuPage;
</file>

<file path="src/pages/BartenderOrderListPage.jsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { ArrowLeft, User, Calendar, ShoppingCart } from 'lucide-react';
import { useAuth } from '../hooks/useAuth';
import useStore from '../store/useStore';
import bartenderService from '../services/bartenderService';
import BartenderOrderDetailModal from '../components/bartender/BartenderOrderDetailModal';
import LoginOverlay from '../components/auth/LoginOverlay';

const BartenderOrderListPage = () => {
  const navigate = useNavigate();
  const { isLoggedIn } = useAuth();
  const { selectedSpace } = useStore();

  const [orders, setOrders] = useState([]);
  const [isLoading, setIsLoading] = useState(true);
  const [selectedOrder, setSelectedOrder] = useState(null);

  useEffect(() => {
    if (selectedSpace?.id) {
      loadOrders();
    }
  }, [selectedSpace]);

  const loadOrders = async () => {
    setIsLoading(true);
    try {
      const data = await bartenderService.getOrders(selectedSpace.id);
      setOrders(data);
    } catch (error) {
      console.error('ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:', error);
      alert('ì£¼ë¬¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setIsLoading(false);
    }
  };

  const formatDateTime = (date) => {
    if (!date) return '-';
    return new Date(date).toLocaleDateString('ko-KR', {
      month: 'long',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });
  };

  const formatDateOnly = (date) => {
    if (!date) return '-';
    return new Date(date).toLocaleDateString('ko-KR', {
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
  };

  // ë‚ ì§œë³„ ê·¸ë£¹í™”
  const groupedOrders = orders.reduce((groups, order) => {
    const dateKey = formatDateOnly(order.createdAt);
    if (!groups[dateKey]) {
      groups[dateKey] = [];
    }
    groups[dateKey].push(order);
    return groups;
  }, {});

  // ë¡œê·¸ì¸ í™•ì¸
  if (!isLoggedIn) {
    return <LoginOverlay />;
  }

  return (
    <div className="min-h-screen bg-gray-50 pb-6">
      {/* í—¤ë” */}
      <div className="bg-gradient-to-r from-orange-500 to-amber-500 text-white p-6 shadow-lg">
        <div className="max-w-4xl mx-auto">
          <div className="flex items-center gap-4">
            <button
              onClick={() => navigate('/bartender/menu')}
              className="p-2 hover:bg-white/20 rounded-full transition-colors"
            >
              <ArrowLeft className="w-6 h-6" />
            </button>
            <h1 className="text-2xl font-bold">ì£¼ë¬¸ ë‚´ì—­</h1>
          </div>
        </div>
      </div>

      {/* ì£¼ë¬¸ ëª©ë¡ */}
      <div className="max-w-4xl mx-auto px-4 mt-6">
        {isLoading ? (
          <div className="text-center py-12">
            <div className="inline-block w-8 h-8 border-4 border-orange-500 border-t-transparent rounded-full animate-spin mb-4"></div>
            <p className="text-gray-600">ì£¼ë¬¸ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
          </div>
        ) : orders.length === 0 ? (
          <div className="text-center py-12">
            <div className="text-6xl mb-4">ğŸ“‹</div>
            <p className="text-gray-600 mb-4">ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            <button
              onClick={() => navigate('/bartender/menu')}
              className="px-6 py-3 bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-lg font-semibold hover:from-orange-600 hover:to-amber-600 transition-all shadow-lg"
            >
              ë©”ë‰´íŒìœ¼ë¡œ ì´ë™
            </button>
          </div>
        ) : (
          <div className="space-y-6">
            {Object.entries(groupedOrders).map(([date, dateOrders]) => (
              <div key={date}>
                {/* ë‚ ì§œ í—¤ë” */}
                <h2 className="text-lg font-bold text-gray-900 mb-3 flex items-center gap-2">
                  <Calendar className="w-5 h-5 text-orange-500" />
                  {date}
                </h2>

                {/* í•´ë‹¹ ë‚ ì§œì˜ ì£¼ë¬¸ë“¤ */}
                <div className="space-y-3">
                  {dateOrders.map((order) => (
                    <div
                      key={order.id}
                      onClick={() => setSelectedOrder(order)}
                      className="bg-white rounded-xl shadow-md p-4 hover:shadow-lg transition-all cursor-pointer"
                    >
                      <div className="flex items-start justify-between mb-3">
                        <div className="flex items-center gap-2">
                          <User className="w-5 h-5 text-orange-500" />
                          <span className="font-semibold text-gray-900">{order.userName}</span>
                        </div>
                        <span className="text-sm text-gray-500">{formatDateTime(order.createdAt)}</span>
                      </div>

                      {/* ì£¼ë¬¸ í•­ëª© ìš”ì•½ */}
                      <div className="flex items-center gap-2 mb-3 text-sm text-gray-600">
                        <ShoppingCart className="w-4 h-4" />
                        <span>
                          {order.items.map(item => `${item.menuName} Ã—${item.quantity}`).join(', ')}
                        </span>
                      </div>

                      {/* ì´ì•¡ */}
                      <div className="flex items-center justify-between pt-3 border-t border-gray-200">
                        <span className="text-sm font-semibold text-gray-700">ì´ ê¸ˆì•¡</span>
                        <span className="text-lg font-bold text-orange-600">
                          {order.totalAmount.toLocaleString()}ì›
                        </span>
                      </div>

                      {/* ë©”ëª¨ (ìˆëŠ” ê²½ìš°) */}
                      {order.memo && (
                        <div className="mt-3 pt-3 border-t border-gray-200">
                          <p className="text-sm text-gray-600 line-clamp-2">
                            <span className="font-semibold">ìš”ì²­ì‚¬í•­:</span> {order.memo}
                          </p>
                        </div>
                      )}
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>
        )}
      </div>

      {/* ì£¼ë¬¸ ìƒì„¸ ëª¨ë‹¬ */}
      {selectedOrder && (
        <BartenderOrderDetailModal
          order={selectedOrder}
          onClose={() => setSelectedOrder(null)}
        />
      )}
    </div>
  );
};

export default BartenderOrderListPage;
</file>

<file path="src/pages/EmailTestPage.jsx">
import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { ArrowLeft, Mail, Send } from 'lucide-react';

export default function EmailTestPage() {
  const navigate = useNavigate();
  const [loading, setLoading] = useState(false);
  const [result, setResult] = useState(null);
  const [error, setError] = useState(null);
  const [recipient, setRecipient] = useState('reshw@naver.com');

  const testEmail = async (type) => {
    setLoading(true);
    setResult(null);
    setError(null);

    try {
      console.log(`ğŸ“§ í…ŒìŠ¤íŠ¸ ì´ë©”ì¼ ë°œì†¡ ì‹œì‘ (${type})...`);

      let emailData = {
        type: type,
        spaceName: 'ì¡°ê°•308í˜¸ (í…ŒìŠ¤íŠ¸)',
        recipients: {
          to: recipient,
          cc: []
        }
      };

      // íƒ€ì…ë³„ í…ŒìŠ¤íŠ¸ ë°ì´í„°
      if (type === 'guest_reservation') {
        emailData = {
          ...emailData,
          name: 'í™ê¸¸ë™',
          phone: '010-1234-5678',
          checkIn: new Date(),
          checkOut: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000),
          gender: 'ë‚¨ì„±',
          birthYear: '1990',
          hostDisplayName: 'ê¹€ì£¼ì£¼',
          memo: 'ì´ê²ƒì€ í…ŒìŠ¤íŠ¸ ì˜ˆì•½ì…ë‹ˆë‹¤.',
          pricePerNight: 30000
        };
      } else if (type === 'praise') {
        emailData = {
          ...emailData,
          userName: 'í…ŒìŠ¤íŠ¸ ìœ ì €',
          category: 'ì²­ì†Œ',
          itemName: 'í™”ì¥ì‹¤',
          originalText: 'í…ŒìŠ¤íŠ¸ ì¹­ì°¬ ë‚´ìš©ì…ë‹ˆë‹¤. ì²­ì†Œë¥¼ ì •ë§ ê¹¨ë—í•˜ê²Œ í•´ì£¼ì…¨ì–´ìš”!',
          refinedText: 'í™”ì¥ì‹¤ ì²­ì†Œë¥¼ ì •ë§ ê¹¨ë—í•˜ê²Œ í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.',
          eventDate: new Date(),
          imageUrl: null
        };
      } else if (type === 'settlement') {
        emailData = {
          ...emailData,
          paidByName: 'ê¹€ë‚©ë¶€',
          submittedByName: 'ì´ë“±ë¡',
          submittedAt: new Date(),
          totalAmount: 50000,
          items: [
            { itemName: 'ìƒìˆ˜', amount: 20000, splitAmong: ['A', 'B', 'C'] },
            { itemName: 'ì»¤í”¼', amount: 30000, splitAmong: ['A', 'B'] }
          ],
          memo: 'í…ŒìŠ¤íŠ¸ ì˜ìˆ˜ì¦ì…ë‹ˆë‹¤.',
          imageUrl: null
        };
      } else if (type === 'expense') {
        emailData = {
          ...emailData,
          userName: 'ë°•ì²­êµ¬',
          usedAt: new Date(),
          createdAt: new Date(),
          totalAmount: 75000,
          items: [
            { itemName: 'ì²­ì†Œìš©í’ˆ', itemPrice: 25000, itemQty: 2, itemSpec: 'ëŒ€í˜•', total: 50000 },
            { itemName: 'í™”ì¥ì§€', itemPrice: 12500, itemQty: 2, itemSpec: '6ë¡¤', total: 25000 }
          ],
          memo: 'í…ŒìŠ¤íŠ¸ ìš´ì˜ë¹„ ì²­êµ¬ì…ë‹ˆë‹¤.',
          imageUrl: null
        };
      }

      console.log('ë°œì†¡í•  ë°ì´í„°:', emailData);

      const response = await fetch('/.netlify/functions/send-email', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(emailData)
      });

      console.log('ì‘ë‹µ ìƒíƒœ:', response.status);

      const responseText = await response.text();
      console.log('ì‘ë‹µ ë³¸ë¬¸ (raw):', responseText);

      let data;
      try {
        data = JSON.parse(responseText);
        console.log('ì‘ë‹µ ë°ì´í„° (parsed):', data);
      } catch (parseError) {
        console.error('JSON íŒŒì‹± ì‹¤íŒ¨:', parseError);
        throw new Error(`ì„œë²„ ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨: ${responseText}`);
      }

      if (!response.ok) {
        throw new Error(data.error || 'ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨');
      }

      setResult({
        success: true,
        message: 'ì´ë©”ì¼ì´ ì„±ê³µì ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!',
        data: data
      });

      console.log('âœ… ì´ë©”ì¼ ë°œì†¡ ì„±ê³µ:', data);
    } catch (err) {
      console.error('âŒ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨:', err);
      setError(err.message);
      setResult({
        success: false,
        message: err.message
      });
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 pb-20">
      {/* í—¤ë” */}
      <div className="bg-gradient-to-r from-slate-800 to-slate-700 border-b border-slate-600/30 sticky top-0 z-10 shadow-lg">
        <div className="max-w-2xl mx-auto px-4 py-4">
          <div className="flex items-center gap-3">
            <button
              onClick={() => navigate(-1)}
              className="p-2 hover:bg-white/10 rounded-lg transition-colors"
            >
              <ArrowLeft className="w-5 h-5 text-white" />
            </button>
            <div>
              <h1 className="text-xl font-bold text-white">ì´ë©”ì¼ í…ŒìŠ¤íŠ¸</h1>
              <p className="text-sm text-slate-300">Resend ì´ë©”ì¼ ë°œì†¡ í…ŒìŠ¤íŠ¸</p>
            </div>
          </div>
        </div>
      </div>

      {/* í…ŒìŠ¤íŠ¸ ì˜ì—­ */}
      <div className="max-w-2xl mx-auto px-4 py-6">
        {/* ìˆ˜ì‹ ì ì…ë ¥ */}
        <div className="bg-gradient-to-br from-slate-800/80 to-slate-700/50 backdrop-blur-sm border border-slate-600/30 rounded-xl p-6 shadow-lg mb-6">
          <label className="block text-sm font-medium text-slate-300 mb-2">
            <Mail className="w-4 h-4 inline mr-2" />
            ìˆ˜ì‹ ì ì´ë©”ì¼
          </label>
          <input
            type="email"
            value={recipient}
            onChange={(e) => setRecipient(e.target.value)}
            placeholder="test@example.com"
            className="w-full px-4 py-3 bg-slate-700/50 border border-slate-600/30 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500/50"
          />
        </div>

        {/* í…ŒìŠ¤íŠ¸ ë²„íŠ¼ë“¤ */}
        <div className="bg-gradient-to-br from-slate-800/80 to-slate-700/50 backdrop-blur-sm border border-slate-600/30 rounded-xl p-6 shadow-lg mb-6">
          <h2 className="text-lg font-bold text-white mb-4">í…ŒìŠ¤íŠ¸ ì´ë©”ì¼ ë°œì†¡</h2>
          <div className="space-y-3">
            <button
              onClick={() => testEmail('guest_reservation')}
              disabled={loading}
              className="w-full px-4 py-3 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white rounded-lg font-medium transition-all disabled:opacity-50 flex items-center justify-center gap-2"
            >
              <Send className="w-4 h-4" />
              ê²ŒìŠ¤íŠ¸ ì˜ˆì•½ ì´ë©”ì¼ í…ŒìŠ¤íŠ¸
            </button>

            <button
              onClick={() => testEmail('praise')}
              disabled={loading}
              className="w-full px-4 py-3 bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white rounded-lg font-medium transition-all disabled:opacity-50 flex items-center justify-center gap-2"
            >
              <Send className="w-4 h-4" />
              ì¹­ì°¬ ì ‘ìˆ˜ ì´ë©”ì¼ í…ŒìŠ¤íŠ¸
            </button>

            <button
              onClick={() => testEmail('settlement')}
              disabled={loading}
              className="w-full px-4 py-3 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg font-medium transition-all disabled:opacity-50 flex items-center justify-center gap-2"
            >
              <Send className="w-4 h-4" />
              ì •ì‚° ì ‘ìˆ˜ ì´ë©”ì¼ í…ŒìŠ¤íŠ¸
            </button>

            <button
              onClick={() => testEmail('expense')}
              disabled={loading}
              className="w-full px-4 py-3 bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white rounded-lg font-medium transition-all disabled:opacity-50 flex items-center justify-center gap-2"
            >
              <Send className="w-4 h-4" />
              ìš´ì˜ë¹„ ì²­êµ¬ ì´ë©”ì¼ í…ŒìŠ¤íŠ¸
            </button>
          </div>
        </div>

        {/* ë¡œë”© ìƒíƒœ */}
        {loading && (
          <div className="bg-blue-500/10 border border-blue-500/30 rounded-xl p-6 mb-6">
            <div className="flex items-center gap-3">
              <div className="w-6 h-6 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
              <p className="text-blue-300">ì´ë©”ì¼ ë°œì†¡ ì¤‘...</p>
            </div>
          </div>
        )}

        {/* ì„±ê³µ ë©”ì‹œì§€ */}
        {result && result.success && (
          <div className="bg-green-500/10 border border-green-500/30 rounded-xl p-6 mb-6">
            <div className="text-green-300">
              <p className="font-bold mb-2">âœ… ë°œì†¡ ì„±ê³µ!</p>
              <p className="text-sm">{result.message}</p>
              {result.data && (
                <pre className="mt-3 text-xs bg-black/30 p-3 rounded overflow-auto">
                  {JSON.stringify(result.data, null, 2)}
                </pre>
              )}
            </div>
          </div>
        )}

        {/* ì—ëŸ¬ ë©”ì‹œì§€ */}
        {result && !result.success && (
          <div className="bg-red-500/10 border border-red-500/30 rounded-xl p-6 mb-6">
            <div className="text-red-300">
              <p className="font-bold mb-2">âŒ ë°œì†¡ ì‹¤íŒ¨</p>
              <p className="text-sm">{result.message}</p>
            </div>
          </div>
        )}

        {/* ì•ˆë‚´ */}
        <div className="bg-blue-500/10 border border-blue-500/30 rounded-xl p-4">
          <div className="text-sm text-blue-300">
            <p className="font-medium mb-2">ğŸ’¡ í…ŒìŠ¤íŠ¸ ì•ˆë‚´</p>
            <ul className="space-y-1 text-blue-200/80">
              <li>â€¢ ê° ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ í•´ë‹¹ íƒ€ì…ì˜ í…ŒìŠ¤íŠ¸ ì´ë©”ì¼ì´ ë°œì†¡ë©ë‹ˆë‹¤.</li>
              <li>â€¢ ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ ì½˜ì†”ì—ì„œ ìƒì„¸ ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
              <li>â€¢ Netlify Functionsê°€ ë°°í¬ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</li>
              <li>â€¢ RESEND_API_KEY í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/GuestPolicySettingsPage.jsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import useStore from '../store/useStore';
import spaceSettingsService from '../services/spaceSettingsService';
import { canManageSpace } from '../utils/permissions';
import { ArrowLeft, DollarSign, CreditCard, User, Building, Save, Info } from 'lucide-react';

export default function GuestPolicySettingsPage() {
  const navigate = useNavigate();
  const { user, selectedSpace } = useStore();
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);

  // í¼ ë°ì´í„°
  const [formData, setFormData] = useState({
    accountBank: '',
    accountNumber: '',
    accountHolder: '',
    guestPricePerNight: 30000, // ê¸°ë³¸ê°’ 30,000ì›
  });

  // ê¶Œí•œ ì²´í¬ ë° ì´ˆê¸° ë°ì´í„° ë¡œë“œ
  useEffect(() => {
    if (!user || !selectedSpace) {
      alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
      navigate('/');
      return;
    }

    const spaceId = selectedSpace.id || selectedSpace.spaceId;
    const userSpaceData = user.spaceAccess?.find(s => s.spaceId === spaceId);

    if (!userSpaceData || !canManageSpace(userSpaceData.userType)) {
      alert('ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. (ë§¤ë‹ˆì € ì´ìƒë§Œ ì ‘ê·¼ ê°€ëŠ¥)');
      navigate('/');
      return;
    }

    loadGuestPolicy();
  }, [user, selectedSpace, navigate]);

  const loadGuestPolicy = async () => {
    try {
      setLoading(true);
      const spaceId = selectedSpace.id || selectedSpace.spaceId;
      const data = await spaceSettingsService.getGuestPolicy(spaceId);

      setFormData({
        accountBank: data.accountBank || '',
        accountNumber: data.accountNumber || '',
        accountHolder: data.accountHolder || '',
        guestPricePerNight: data.guestPricePerNight || 30000,
      });
    } catch (error) {
      console.error('ê²ŒìŠ¤íŠ¸ ì •ì±… ë¡œë“œ ì‹¤íŒ¨:', error);
      // ì—ëŸ¬ê°€ ë°œìƒí•´ë„ ê¸°ë³¸ê°’ ì‚¬ìš©
    } finally {
      setLoading(false);
    }
  };

  const handleInputChange = (field, value) => {
    setFormData(prev => ({
      ...prev,
      [field]: value
    }));
  };

  const handleSave = async () => {
    // ìœ íš¨ì„± ê²€ì‚¬
    if (!formData.accountBank?.trim()) {
      alert('ì€í–‰ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    if (!formData.accountNumber?.trim()) {
      alert('ê³„ì¢Œë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    if (!formData.accountHolder?.trim()) {
      alert('ì˜ˆê¸ˆì£¼ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    if (!formData.guestPricePerNight || formData.guestPricePerNight <= 0) {
      alert('1ë°• ìš”ê¸ˆì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    const confirmed = window.confirm(
      'ê²ŒìŠ¤íŠ¸ ì •ì±…ì„ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì €ì¥ í›„ ì˜ˆì•½ ì‹œ ì•Œë¦¼í†¡ì— ë°˜ì˜ë©ë‹ˆë‹¤.'
    );
    if (!confirmed) return;

    try {
      setSaving(true);
      const spaceId = selectedSpace.id || selectedSpace.spaceId;

      await spaceSettingsService.updateGuestPolicy(
        spaceId,
        {
          accountBank: formData.accountBank.trim(),
          accountNumber: formData.accountNumber.trim(),
          accountHolder: formData.accountHolder.trim(),
          guestPricePerNight: parseInt(formData.guestPricePerNight),
        },
        user.id,
        user.displayName || user.name
      );

      alert('ê²ŒìŠ¤íŠ¸ ì •ì±…ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! âœ…');
      await loadGuestPolicy();
    } catch (error) {
      console.error('ê²ŒìŠ¤íŠ¸ ì •ì±… ì €ì¥ ì‹¤íŒ¨:', error);
      alert('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
      setSaving(false);
    }
  };

  const formatCurrency = (value) => {
    if (!value) return '';
    return parseInt(value).toLocaleString('ko-KR');
  };

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gray-50">
        <div className="text-center">
          <div className="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-gray-600">ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 pb-24">
      {/* í—¤ë” */}
      <div className="bg-gradient-to-br from-blue-500 to-indigo-600 text-white sticky top-0 z-10 shadow-lg">
        <div className="max-w-2xl mx-auto px-4 py-4">
          <div className="flex items-center gap-3">
            <button
              onClick={() => navigate('/space/manage')}
              className="p-2 hover:bg-white/10 rounded-lg transition-colors"
            >
              <ArrowLeft className="w-5 h-5" />
            </button>
            <div className="flex-1">
              <h1 className="text-xl font-bold flex items-center gap-2">
                <DollarSign className="w-6 h-6" />
                ê²ŒìŠ¤íŠ¸ ì •ì±… ê´€ë¦¬
              </h1>
              <p className="text-sm text-white/80 mt-1">
                {selectedSpace?.spaceName || selectedSpace?.name}
              </p>
            </div>
          </div>
        </div>
      </div>

      {/* ì•ˆë‚´ */}
      <div className="max-w-2xl mx-auto px-4 py-4">
        <div className="bg-blue-50 border border-blue-200 rounded-xl p-4">
          <div className="flex items-start gap-3">
            <Info className="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" />
            <div className="text-sm text-blue-900">
              <p className="font-semibold mb-2">ğŸ’¡ ê²ŒìŠ¤íŠ¸ ì •ì±… ì•ˆë‚´</p>
              <ul className="space-y-1 text-blue-800">
                <li>â€¢ ê²ŒìŠ¤íŠ¸ ì˜ˆì•½ ì‹œ ì•ˆë‚´ë  ê³„ì¢Œ ì •ë³´ì™€ 1ë°• ìš”ê¸ˆì„ ì„¤ì •í•©ë‹ˆë‹¤.</li>
                <li>â€¢ ì„¤ì •í•œ ì •ë³´ëŠ” ì˜ˆì•½ í™•ì¸ ì•Œë¦¼í†¡ì— ìë™ìœ¼ë¡œ í¬í•¨ë©ë‹ˆë‹¤.</li>
                <li>â€¢ ë§¤ë‹ˆì € ì´ìƒë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      {/* ì…ê¸ˆ ê³„ì¢Œ ì •ë³´ */}
      <div className="max-w-2xl mx-auto px-4">
        <div className="bg-white rounded-xl shadow-sm p-6 mb-4">
          <h2 className="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
            <CreditCard className="w-5 h-5 text-blue-600" />
            ì…ê¸ˆ ê³„ì¢Œ ì •ë³´
          </h2>

          <div className="space-y-4">
            {/* ì€í–‰ëª… */}
            <div>
              <label className="block text-sm font-semibold text-gray-700 mb-2">
                <Building className="w-4 h-4 inline mr-1" />
                ì€í–‰ëª…
              </label>
              <input
                type="text"
                value={formData.accountBank}
                onChange={(e) => handleInputChange('accountBank', e.target.value)}
                placeholder="ì˜ˆ: ì¹´ì¹´ì˜¤ë±…í¬"
                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>

            {/* ê³„ì¢Œë²ˆí˜¸ */}
            <div>
              <label className="block text-sm font-semibold text-gray-700 mb-2">
                <CreditCard className="w-4 h-4 inline mr-1" />
                ê³„ì¢Œë²ˆí˜¸
              </label>
              <input
                type="text"
                value={formData.accountNumber}
                onChange={(e) => handleInputChange('accountNumber', e.target.value)}
                placeholder="ì˜ˆ: 7942-24-38529"
                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>

            {/* ì˜ˆê¸ˆì£¼ */}
            <div>
              <label className="block text-sm font-semibold text-gray-700 mb-2">
                <User className="w-4 h-4 inline mr-1" />
                ì˜ˆê¸ˆì£¼
              </label>
              <input
                type="text"
                value={formData.accountHolder}
                onChange={(e) => handleInputChange('accountHolder', e.target.value)}
                placeholder="ì˜ˆ: í™ê¸¸ë™"
                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>
          </div>
        </div>

        {/* ê²ŒìŠ¤íŠ¸ ìš”ê¸ˆ */}
        <div className="bg-white rounded-xl shadow-sm p-6 mb-4">
          <h2 className="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
            <DollarSign className="w-5 h-5 text-blue-600" />
            ê²ŒìŠ¤íŠ¸ ìš”ê¸ˆ
          </h2>

          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-2">
              1ë°• ìš”ê¸ˆ (ì›)
            </label>
            <div className="relative">
              <input
                type="number"
                value={formData.guestPricePerNight}
                onChange={(e) => handleInputChange('guestPricePerNight', e.target.value)}
                placeholder="30000"
                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 pr-12"
              />
              <span className="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500">
                ì›
              </span>
            </div>
            {formData.guestPricePerNight && (
              <p className="text-sm text-gray-600 mt-2">
                ğŸ’° 1ë°•ë‹¹ <strong className="text-blue-600">{formatCurrency(formData.guestPricePerNight)}ì›</strong>
              </p>
            )}
          </div>
        </div>

        {/* ë¯¸ë¦¬ë³´ê¸° */}
        <div className="bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl shadow-sm p-6 mb-6">
          <h3 className="text-sm font-bold text-gray-700 mb-3">ğŸ“± ì•Œë¦¼í†¡ ë¯¸ë¦¬ë³´ê¸°</h3>
          <div className="bg-white rounded-lg p-4 border border-gray-200 text-sm space-y-2">
            <p className="text-gray-800">
              <strong>ì…ê¸ˆ ê³„ì¢Œ:</strong> {formData.accountBank || '(ì€í–‰ëª…)'} {formData.accountNumber || '(ê³„ì¢Œë²ˆí˜¸)'}
            </p>
            <p className="text-gray-800">
              <strong>ì˜ˆê¸ˆì£¼:</strong> {formData.accountHolder || '(ì˜ˆê¸ˆì£¼)'}
            </p>
            <p className="text-gray-800">
              <strong>1ë°• ìš”ê¸ˆ:</strong> {formatCurrency(formData.guestPricePerNight) || '30,000'}ì›
            </p>
            <p className="text-xs text-gray-500 mt-3">
              * ì‹¤ì œ ì•Œë¦¼í†¡ì—ì„œëŠ” ìˆ™ë°•ì¼ìˆ˜ì— ë”°ë¼ ì´ ê¸ˆì•¡ì´ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.
            </p>
          </div>
        </div>

        {/* ì €ì¥ ë²„íŠ¼ */}
        <button
          onClick={handleSave}
          disabled={saving}
          className="w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
        >
          {saving ? (
            <>
              <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
              <span>ì €ì¥ ì¤‘...</span>
            </>
          ) : (
            <>
              <Save className="w-5 h-5" />
              <span>ì €ì¥í•˜ê¸°</span>
            </>
          )}
        </button>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/IntroductionPage.jsx">
// src/pages/IntroductionPage.jsx
import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import {
  ChevronLeft,
  Calendar,
  Receipt,
  Heart,
  Wallet,
  Bell,
  Users,
  Settings,
  CheckCircle,
  ArrowRight,
  Zap,
  Clock,
  TrendingUp,
  MessageSquare,
  Shield,
  Smartphone,
  BarChart3
} from 'lucide-react';

const IntroductionPage = () => {
  const navigate = useNavigate();
  const [activeTab, setActiveTab] = useState('overview');

  const features = [
    {
      id: 'reservation',
      icon: Calendar,
      title: 'ì˜ˆì•½ ê´€ë¦¬',
      color: 'blue',
      gradient: 'from-blue-500 to-blue-600',
      description: 'ì§ê´€ì ì¸ ì˜ˆì•½ ì‹œìŠ¤í…œ',
      details: [
        'ë¦¬ìŠ¤íŠ¸í˜•/ë‹¬ë ¥í˜• ì´ì¤‘ ë·°',
        'ë‚¨ë…€ êµ¬ë¶„ í†µê³„',
        'ì£¼ì£¼/ê²ŒìŠ¤íŠ¸ ë¶„ë¥˜',
        '3ì£¼ì¹˜ ë¯¸ë¦¬ë³´ê¸°',
        'ë‚´ ì˜ˆì•½ ìš°ì„  í‘œì‹œ',
        'ì›í„°ì¹˜ ì˜ˆì•½ ì·¨ì†Œ'
      ],
      highlights: [
        'ì „ì£¼/í˜„ì¬ì£¼/ë‹¤ìŒì£¼ ë™ì‹œ ë¡œë“œë¡œ ë¹ ë¥¸ ë„¤ë¹„ê²Œì´ì…˜',
        'ì˜ˆì•½ì ìƒì„¸ ëª¨ë‹¬ë¡œ ì „ì²´ í˜„í™© í•œëˆˆì—',
        'ì„±ë³„ ì•„ì´ì½˜ìœ¼ë¡œ í•œëˆˆì— íŒŒì•…'
      ]
    },
    {
      id: 'settlement',
      icon: Receipt,
      title: 'ì •ì‚° ì‹œìŠ¤í…œ',
      color: 'green',
      gradient: 'from-green-500 to-green-600',
      description: 'ì™„ì „ ìë™í™” ì •ì‚°',
      details: [
        'ì˜ìˆ˜ì¦ ì‚¬ì§„ ì—…ë¡œë“œ',
        'ìë™ ë¶„ë‹´ê¸ˆ ê³„ì‚°',
        'ì£¼ì°¨ë³„ ì •ì‚° ê´€ë¦¬',
        'í…Œì´ë¸”/ì¹´ë“œ ì´ì¤‘ ë·°',
        'ì´ë¯¸ì§€/CSV ë‹¤ìš´ë¡œë“œ',
        'ìŠ¤ì¼€ì¤„ ìë™ ë§ˆê°'
      ],
      highlights: [
        'ìŠ¤í˜ì´ìŠ¤ë³„ ë§ì¶¤ ìŠ¤ì¼€ì¤„ ì„¤ì • (ë§¤ì£¼/ë§¤ë‹¬/ë§¤ë…„)',
        'Netlify Scheduled Functionsë¡œ ë¬´ë£Œ ìë™í™”',
        'ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™”ë¡œ í•­ìƒ ì •í™•í•œ ì •ì‚°'
      ]
    },
    {
      id: 'praise',
      icon: Heart,
      title: 'ì¹­ì°¬ ì‹œìŠ¤í…œ',
      color: 'pink',
      gradient: 'from-pink-500 to-pink-600',
      description: 'ê°ì‚¬ì™€ ì¹­ì°¬ ì „ë‹¬',
      details: [
        'ìµëª…/ì‹¤ëª… ì„ íƒ ê°€ëŠ¥',
        'ì‚¬ì§„ ì²¨ë¶€ ì§€ì›',
        'ìŠ¤í˜ì´ìŠ¤ë³„ ì¹­ì°¬ ëª¨ìŒ',
        'í‘¸ì‹œ ì•Œë¦¼ ë°œì†¡',
        'ê°ì • ì´ëª¨ì§€ ì§€ì›',
        'íƒ€ì„ë¼ì¸ ë·°'
      ],
      highlights: [
        'OpenAI GPT-4ë¡œ ì•…ì„± ëŒ“ê¸€ í•„í„°ë§',
        'í‘¸ì‹œ ì•Œë¦¼ìœ¼ë¡œ ì¦‰ì‹œ ì „ë‹¬',
        'ë”°ëœ»í•œ ì»¤ë®¤ë‹ˆí‹° ë¬¸í™” ì¡°ì„±'
      ]
    },
    {
      id: 'expense',
      icon: Wallet,
      title: 'ìš´ì˜ë¹„ ê´€ë¦¬',
      color: 'purple',
      gradient: 'from-purple-500 to-purple-600',
      description: 'íˆ¬ëª…í•œ ìš´ì˜ë¹„ ê´€ë¦¬',
      details: [
        'ìš´ì˜ë¹„ ì²­êµ¬ ìš”ì²­',
        'ìŠ¹ì¸/ê±°ë¶€ í”„ë¡œì„¸ìŠ¤',
        'ì¹´í…Œê³ ë¦¬ë³„ ë¶„ë¥˜',
        'ì›”ë³„ í†µê³„',
        'ì˜ìˆ˜ì¦ ì²¨ë¶€',
        'ì´ë ¥ ê´€ë¦¬'
      ],
      highlights: [
        'ë§¤ë‹ˆì € ìŠ¹ì¸ ì‹œìŠ¤í…œìœ¼ë¡œ íˆ¬ëª…ì„± í™•ë³´',
        'ì›”ë³„ ì§€ì¶œ í˜„í™© í•œëˆˆì—',
        'ì¹´í…Œê³ ë¦¬ë³„ ë¶„ì„'
      ]
    },
    {
      id: 'notification',
      icon: Bell,
      title: 'ì•Œë¦¼ ì‹œìŠ¤í…œ',
      color: 'orange',
      gradient: 'from-orange-500 to-orange-600',
      description: 'ë‹¤ì±„ë„ ì•Œë¦¼ ë°œì†¡',
      details: [
        'ì•Œë¦¼í†¡ ì—°ë™ (NHN)',
        'ì´ë©”ì¼ ì•Œë¦¼ (Resend)',
        'í‘¸ì‹œ ì•Œë¦¼',
        'ì •ì‚° ì™„ë£Œ ìë™ ë°œì†¡',
        'ë§ì¶¤ í…œí”Œë¦¿',
        'ë°œì†¡ ì´ë ¥ ê´€ë¦¬'
      ],
      highlights: [
        'ì •ì‚° ì™„ë£Œ ì‹œ ìë™ ì•Œë¦¼í†¡ ë°œì†¡',
        'ì´ë©”ì¼ ì„¤ì •ìœ¼ë¡œ ì›í•˜ëŠ” ì•Œë¦¼ë§Œ',
        'ì‹¤ì‹œê°„ í‘¸ì‹œë¡œ ë†“ì¹˜ì§€ ì•ŠëŠ” ì†Œì‹'
      ]
    },
    {
      id: 'management',
      icon: Users,
      title: 'ìŠ¤í˜ì´ìŠ¤ ê´€ë¦¬',
      color: 'indigo',
      gradient: 'from-indigo-500 to-indigo-600',
      description: 'ê°•ë ¥í•œ ê´€ë¦¬ ê¸°ëŠ¥',
      details: [
        'ë©¤ë²„ ê¶Œí•œ ê´€ë¦¬',
        'ê²ŒìŠ¤íŠ¸ ì •ì±… ì„¤ì •',
        'ì´ˆëŒ€ ì½”ë“œ ì‹œìŠ¤í…œ',
        'ìŠ¤í˜ì´ìŠ¤ ì„¤ì •',
        'ë§¤ë‹ˆì € ì–‘ë„',
        'ë‹¤ì¤‘ ìŠ¤í˜ì´ìŠ¤ ì§€ì›'
      ],
      highlights: [
        'ë“œë˜ê·¸ ì•¤ ë“œë¡­ìœ¼ë¡œ ìŠ¤í˜ì´ìŠ¤ ìˆœì„œ ë³€ê²½',
        'ì—­í• ë³„ ê¶Œí•œ ì„¸ë°€ ì„¤ì •',
        'ê²ŒìŠ¤íŠ¸ ìë™ í™•ì¸ ë° ì•Œë¦¼'
      ]
    }
  ];

  const techStack = [
    { name: 'React 19', icon: 'âš›ï¸', desc: 'ìµœì‹  React ê¸°ëŠ¥ í™œìš©' },
    { name: 'Firebase', icon: 'ğŸ”¥', desc: 'Realtime Database & Auth' },
    { name: 'Netlify', icon: 'âš¡', desc: 'ë¬´ë£Œ Scheduled Functions' },
    { name: 'Tailwind CSS', icon: 'ğŸ¨', desc: 'ëª¨ë°”ì¼ ìµœì í™” UI' },
    { name: 'OpenAI GPT-4', icon: 'ğŸ¤–', desc: 'ì§€ëŠ¥í˜• ì½˜í…ì¸  í•„í„°' },
    { name: 'NHN Cloud', icon: 'ğŸ’¬', desc: 'ì•Œë¦¼í†¡ ì—°ë™' },
    { name: 'Resend', icon: 'ğŸ“§', desc: 'íŠ¸ëœì­ì…”ë„ ì´ë©”ì¼' },
    { name: 'Cloudinary', icon: 'ğŸ“¸', desc: 'ì´ë¯¸ì§€ ìµœì í™”' }
  ];

  const stats = [
    { label: 'ì£¼ìš” ê¸°ëŠ¥', value: '6+', icon: Zap },
    { label: 'ìë™í™” í”„ë¡œì„¸ìŠ¤', value: '5+', icon: Clock },
    { label: 'ì•Œë¦¼ ì±„ë„', value: '3', icon: MessageSquare },
    { label: 'ëª¨ë°”ì¼ ìµœì í™”', value: '100%', icon: Smartphone }
  ];

  return (
    <div className="min-h-screen bg-gradient-to-b from-gray-50 to-white pb-20">
      {/* í—¤ë” */}
      <div className="bg-gradient-to-br from-blue-600 via-blue-700 to-purple-600 text-white sticky top-0 z-30 shadow-lg">
        <div className="max-w-2xl mx-auto px-4 py-4">
          <div className="flex items-center gap-3">
            <button
              onClick={() => navigate(-1)}
              className="p-2 hover:bg-white/10 rounded-lg transition-colors"
            >
              <ChevronLeft className="w-5 h-5" />
            </button>
            <div>
              <h1 className="text-xl font-bold">ë¼ìš´ì§€ ì•± ì†Œê°œ</h1>
              <p className="text-xs text-white/80 mt-0.5">ê³µìœ  ì˜¤í”¼ìŠ¤ë¥¼ ìœ„í•œ ì˜¬ì¸ì› ì†”ë£¨ì…˜</p>
            </div>
          </div>
        </div>
      </div>

      {/* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */}
      <div className="sticky top-[72px] z-20 bg-white border-b shadow-sm">
        <div className="max-w-2xl mx-auto px-4">
          <div className="flex overflow-x-auto hide-scrollbar">
            {[
              { id: 'overview', label: 'ê°œìš”', icon: BarChart3 },
              { id: 'features', label: 'ì£¼ìš” ê¸°ëŠ¥', icon: Zap },
              { id: 'tech', label: 'ê¸°ìˆ  ìŠ¤íƒ', icon: Settings }
            ].map(tab => (
              <button
                key={tab.id}
                onClick={() => setActiveTab(tab.id)}
                className={`flex items-center gap-2 px-4 py-3 border-b-2 transition-colors whitespace-nowrap ${
                  activeTab === tab.id
                    ? 'border-blue-600 text-blue-600'
                    : 'border-transparent text-gray-600 hover:text-gray-900'
                }`}
              >
                <tab.icon className="w-4 h-4" />
                <span className="font-semibold text-sm">{tab.label}</span>
              </button>
            ))}
          </div>
        </div>
      </div>

      <div className="max-w-2xl mx-auto px-4 py-6">
        {/* ê°œìš” íƒ­ */}
        {activeTab === 'overview' && (
          <div className="space-y-6 animate-fadeIn">
            {/* íˆì–´ë¡œ ì„¹ì…˜ */}
            <div className="bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl p-6 text-white shadow-xl">
              <div className="flex items-center gap-3 mb-4">
                <div className="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                  <Smartphone className="w-7 h-7" />
                </div>
                <div>
                  <h2 className="text-2xl font-bold">ë¼ìš´ì§€ ì•±</h2>
                  <p className="text-white/90 text-sm">All-in-One Space Management</p>
                </div>
              </div>
              <p className="text-white/90 leading-relaxed">
                ê³µìœ  ì˜¤í”¼ìŠ¤ì™€ ë¼ìš´ì§€ ìš´ì˜ì„ ìœ„í•œ ì™„ì „í•œ ë””ì§€í„¸ ì†”ë£¨ì…˜ì…ë‹ˆë‹¤.
                ì˜ˆì•½ë¶€í„° ì •ì‚°, ì¹­ì°¬, ìš´ì˜ë¹„ ê´€ë¦¬ê¹Œì§€ ëª¨ë“  ê²ƒì„ í•œ ê³³ì—ì„œ.
              </p>
            </div>

            {/* í†µê³„ ì¹´ë“œ */}
            <div className="grid grid-cols-2 gap-3">
              {stats.map((stat, idx) => (
                <div key={idx} className="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                  <div className="flex items-center gap-2 mb-2">
                    <stat.icon className="w-4 h-4 text-blue-600" />
                    <span className="text-xs text-gray-600">{stat.label}</span>
                  </div>
                  <div className="text-2xl font-bold text-gray-900">{stat.value}</div>
                </div>
              ))}
            </div>

            {/* ì£¼ìš” íŠ¹ì§• */}
            <div className="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
              <h3 className="font-bold text-lg mb-4 flex items-center gap-2">
                <Shield className="w-5 h-5 text-blue-600" />
                ì™œ ë¼ìš´ì§€ ì•±ì¸ê°€ìš”?
              </h3>
              <div className="space-y-3">
                {[
                  'ì™„ì „ ìë™í™”ëœ ì •ì‚° ì‹œìŠ¤í…œìœ¼ë¡œ ì‹œê°„ ì ˆì•½',
                  'íˆ¬ëª…í•œ ìš´ì˜ë¹„ ê´€ë¦¬ë¡œ ì‹ ë¢° êµ¬ì¶•',
                  'ë‹¤ì±„ë„ ì•Œë¦¼ìœ¼ë¡œ ë†“ì¹˜ëŠ” ì†Œì‹ ì—†ìŒ',
                  'ëª¨ë°”ì¼ ìµœì í™”ë¡œ ì–¸ì œ ì–´ë””ì„œë‚˜ ì ‘ê·¼',
                  'ë¬´ë£Œ ìë™í™” ì¸í”„ë¼ë¡œ ë¹„ìš© ì ˆê°',
                  'ì§€ì†ì ì¸ ì—…ë°ì´íŠ¸ì™€ ê°œì„ '
                ].map((item, idx) => (
                  <div key={idx} className="flex items-start gap-3">
                    <CheckCircle className="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5" />
                    <span className="text-gray-700">{item}</span>
                  </div>
                ))}
              </div>
            </div>
          </div>
        )}

        {/* ì£¼ìš” ê¸°ëŠ¥ íƒ­ */}
        {activeTab === 'features' && (
          <div className="space-y-4 animate-fadeIn">
            {features.map((feature, idx) => (
              <div
                key={feature.id}
                className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-md transition-shadow"
              >
                <div className={`bg-gradient-to-r ${feature.gradient} p-4 text-white`}>
                  <div className="flex items-center gap-3">
                    <div className="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                      <feature.icon className="w-7 h-7" />
                    </div>
                    <div className="flex-1">
                      <h3 className="text-xl font-bold">{feature.title}</h3>
                      <p className="text-white/90 text-sm">{feature.description}</p>
                    </div>
                  </div>
                </div>

                <div className="p-4 space-y-4">
                  {/* ì£¼ìš” ê¸°ëŠ¥ */}
                  <div>
                    <h4 className="font-semibold text-sm text-gray-700 mb-2">ì£¼ìš” ê¸°ëŠ¥</h4>
                    <div className="grid grid-cols-2 gap-2">
                      {feature.details.map((detail, i) => (
                        <div key={i} className="flex items-center gap-2 text-sm text-gray-600">
                          <div className="w-1.5 h-1.5 bg-blue-500 rounded-full"></div>
                          <span>{detail}</span>
                        </div>
                      ))}
                    </div>
                  </div>

                  {/* í•˜ì´ë¼ì´íŠ¸ */}
                  <div className="bg-yellow-50 rounded-lg p-3 border border-yellow-200">
                    <h4 className="font-semibold text-sm text-yellow-900 mb-2 flex items-center gap-2">
                      <Zap className="w-4 h-4" />
                      í•µì‹¬ í¬ì¸íŠ¸
                    </h4>
                    <div className="space-y-2">
                      {feature.highlights.map((highlight, i) => (
                        <div key={i} className="flex items-start gap-2">
                          <ArrowRight className="w-4 h-4 text-yellow-700 flex-shrink-0 mt-0.5" />
                          <span className="text-sm text-yellow-900">{highlight}</span>
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        )}

        {/* ê¸°ìˆ  ìŠ¤íƒ íƒ­ */}
        {activeTab === 'tech' && (
          <div className="space-y-6 animate-fadeIn">
            <div className="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
              <h3 className="font-bold text-lg mb-4 flex items-center gap-2">
                <TrendingUp className="w-5 h-5 text-blue-600" />
                ìµœì‹  ê¸°ìˆ  ìŠ¤íƒ
              </h3>
              <p className="text-gray-600 mb-6 text-sm">
                ì•ˆì •ì„±ê³¼ ì„±ëŠ¥ì„ ìœ„í•´ ê²€ì¦ëœ ìµœì‹  ê¸°ìˆ ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
              </p>

              <div className="grid grid-cols-1 gap-3">
                {techStack.map((tech, idx) => (
                  <div
                    key={idx}
                    className="flex items-center gap-4 p-4 bg-gradient-to-r from-gray-50 to-white rounded-xl border border-gray-100 hover:shadow-md transition-shadow"
                  >
                    <div className="text-3xl">{tech.icon}</div>
                    <div className="flex-1">
                      <div className="font-semibold text-gray-900">{tech.name}</div>
                      <div className="text-sm text-gray-600">{tech.desc}</div>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            {/* ì•„í‚¤í…ì²˜ í•˜ì´ë¼ì´íŠ¸ */}
            <div className="bg-gradient-to-br from-purple-50 to-blue-50 rounded-xl p-6 border border-purple-200">
              <h3 className="font-bold text-lg mb-4 text-purple-900">ì•„í‚¤í…ì²˜ íŠ¹ì§•</h3>
              <div className="space-y-3">
                {[
                  {
                    title: 'ì„œë²„ë¦¬ìŠ¤ ì•„í‚¤í…ì²˜',
                    desc: 'Netlify Functionsë¡œ ë¹„ìš© íš¨ìœ¨ì ì¸ ë°±ì—”ë“œ'
                  },
                  {
                    title: 'ì‹¤ì‹œê°„ ë°ì´í„°ë² ì´ìŠ¤',
                    desc: 'Firebase Firestoreë¡œ ì¦‰ê°ì ì¸ ë™ê¸°í™”'
                  },
                  {
                    title: 'ìŠ¤ì¼€ì¤„ ìë™í™”',
                    desc: 'Cron ì‘ì—…ìœ¼ë¡œ ì •ì‚° ìë™ ë§ˆê°'
                  },
                  {
                    title: 'ì´ë¯¸ì§€ ìµœì í™”',
                    desc: 'Cloudinary CDNìœ¼ë¡œ ë¹ ë¥¸ ë¡œë”©'
                  },
                  {
                    title: 'ëª¨ë°”ì¼ ìš°ì„ ',
                    desc: 'Progressive Web App (PWA) ì§€ì›'
                  }
                ].map((item, idx) => (
                  <div key={idx} className="bg-white rounded-lg p-4 shadow-sm">
                    <div className="font-semibold text-purple-900 mb-1">{item.title}</div>
                    <div className="text-sm text-purple-700">{item.desc}</div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        )}
      </div>

      <style>{`
        .hide-scrollbar::-webkit-scrollbar {
          display: none;
        }
        .hide-scrollbar {
          -ms-overflow-style: none;
          scrollbar-width: none;
        }
        @keyframes fadeIn {
          from {
            opacity: 0;
            transform: translateY(10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        .animate-fadeIn {
          animation: fadeIn 0.3s ease-out;
        }
      `}</style>
    </div>
  );
};

export default IntroductionPage;
</file>

<file path="src/pages/MigrationPage.jsx">
import { useState } from 'react';
import { Play, AlertTriangle, CheckCircle, Key } from 'lucide-react';
import { runMigration, runMigrationConfirmed } from '../services/migrateExpenses';

const MigrationPage = () => {
  const [spaceId, setSpaceId] = useState('');
  const [isRunning, setIsRunning] = useState(false);
  const [logs, setLogs] = useState([]);
  const [result, setResult] = useState(null);
  
  // ì½˜ì†” ì¶œë ¥ì„ í™”ë©´ì— í‘œì‹œ
  const addLog = (message, type = 'info') => {
    setLogs(prev => [...prev, { message, type, time: new Date() }]);
  };
  
  // Dry Run ì‹¤í–‰
  const handleDryRun = async () => {
    if (!spaceId.trim()) {
      alert('ë°© ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }
    
    setIsRunning(true);
    setLogs([]);
    setResult(null);
    
    try {
      addLog('ğŸ” Dry Run ì‹œì‘...', 'info');
      addLog(`ğŸ“ ë°© ì½”ë“œ: ${spaceId}`, 'info');
      
      const previewResult = await runMigration(spaceId);
      
      setResult(previewResult);
      addLog('âœ… Dry Run ì™„ë£Œ!', 'success');
      addLog(`ğŸ“Š ë°œê²¬ëœ ê·¸ë£¹: ${previewResult.groups}ê°œ`, 'info');
      addLog(`ğŸ“„ ê¸°ì¡´ ë¬¸ì„œ: ${previewResult.oldDocs}ê°œ`, 'info');
      addLog(`ğŸ“„ ìƒˆ ë¬¸ì„œ: ${previewResult.newDocs}ê°œ`, 'info');
      addLog(`ğŸ’¾ ì ˆê°: ${previewResult.oldDocs - previewResult.newDocs}ê°œ`, 'success');
      
    } catch (error) {
      console.error('Dry Run ì‹¤íŒ¨:', error);
      addLog(`âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
    } finally {
      setIsRunning(false);
    }
  };
  
  // ì‹¤ì œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
  const handleRealRun = async () => {
    if (!spaceId.trim()) {
      alert('ë°© ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }
    
    if (!result || result.dryRun !== true) {
      alert('ë¨¼ì € Dry Runì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”.');
      return;
    }
    
    const confirmed = window.confirm(
      `âš ï¸ ì£¼ì˜: ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!\n\n` +
      `ë°© ì½”ë“œ: ${spaceId}\n` +
      `ì‚­ì œë  ë¬¸ì„œ: ${result.oldDocs}ê°œ\n` +
      `ìƒì„±ë  ë¬¸ì„œ: ${result.newDocs}ê°œ\n\n` +
      `ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`
    );
    
    if (!confirmed) return;
    
    const doubleCheck = window.confirm(
      'ì •ë§ë¡œ ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\në°±ì—…ì€ ì™„ë£Œí•˜ì…¨ë‚˜ìš”?'
    );
    
    if (!doubleCheck) return;
    
    setIsRunning(true);
    setLogs([]);
    
    try {
      addLog('ğŸš€ ì‹¤ì œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘...', 'info');
      
      const finalResult = await runMigrationConfirmed(spaceId);
      
      setResult(finalResult);
      addLog('ğŸ‰ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ!', 'success');
      addLog(`âœ… ${finalResult.oldDocs}ê°œ â†’ ${finalResult.newDocs}ê°œ`, 'success');
      
      setTimeout(() => {
        alert('ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.');
        window.location.reload();
      }, 2000);
      
    } catch (error) {
      console.error('ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨:', error);
      addLog(`âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
      alert('ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨! Firebase Consoleì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
    } finally {
      setIsRunning(false);
    }
  };
  
  const getLogColor = (type) => {
    switch (type) {
      case 'success': return 'text-green-400';
      case 'error': return 'text-red-400';
      case 'warning': return 'text-yellow-400';
      default: return 'text-gray-300';
    }
  };
  
  return (
    <div className="min-h-screen bg-gray-50 p-4">
      <div className="max-w-4xl mx-auto">
        {/* í—¤ë” */}
        <div className="bg-white rounded-xl shadow-sm p-6 mb-6">
          <h1 className="text-2xl font-bold text-gray-900 mb-2">
            ğŸ’¾ Expense ë§ˆì´ê·¸ë ˆì´ì…˜
          </h1>
          <p className="text-gray-600">
            í•­ëª©ë³„ ê°œë³„ ë¬¸ì„œ â†’ ì²­êµ¬ë³„ ë‹¨ì¼ ë¬¸ì„œë¡œ êµ¬ì¡° ë³€ê²½
          </p>
        </div>
        
        {/* ê²½ê³  */}
        <div className="bg-yellow-50 border-2 border-yellow-200 rounded-xl p-4 mb-6">
          <div className="flex items-start gap-3">
            <AlertTriangle className="w-6 h-6 text-yellow-600 flex-shrink-0 mt-1" />
            <div>
              <h3 className="font-bold text-yellow-900 mb-2">âš ï¸ ì£¼ì˜ì‚¬í•­</h3>
              <ul className="text-sm text-yellow-800 space-y-1">
                <li>â€¢ ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</li>
                <li>â€¢ ë°˜ë“œì‹œ Firebase Consoleì—ì„œ ë°±ì—…ì„ ë¨¼ì € ì§„í–‰í•˜ì„¸ìš”.</li>
                <li>â€¢ Dry Runìœ¼ë¡œ ì¶©ë¶„íˆ ê²€í† í•œ í›„ ì‹¤í–‰í•˜ì„¸ìš”.</li>
                <li>â€¢ ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤‘ì—ëŠ” ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ì²­êµ¬ë¥¼ ìƒì„±í•˜ë©´ ì•ˆë©ë‹ˆë‹¤.</li>
              </ul>
            </div>
          </div>
        </div>
        
        {/* ë°© ì½”ë“œ ì…ë ¥ */}
        <div className="bg-white rounded-xl shadow-sm p-6 mb-6">
          <label className="flex items-center gap-2 text-gray-700 font-semibold mb-3">
            <Key className="w-5 h-5 text-blue-600" />
            ë°© ì½”ë“œ (Space ID)
          </label>
          <input
            type="text"
            value={spaceId}
            onChange={(e) => setSpaceId(e.target.value)}
            placeholder="ì˜ˆ: 308308"
            disabled={isRunning}
            className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg font-mono focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed"
          />
          <p className="text-sm text-gray-500 mt-2">
            ğŸ’¡ Firebaseì˜ Space IDë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 308308)
          </p>
        </div>
        
        {/* ë²„íŠ¼ */}
        <div className="grid grid-cols-2 gap-4 mb-6">
          <button
            onClick={handleDryRun}
            disabled={isRunning || !spaceId.trim()}
            className="py-4 px-6 bg-blue-600 text-white rounded-xl font-bold text-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
          >
            <Play className="w-5 h-5" />
            1ë‹¨ê³„: Dry Run (ë¯¸ë¦¬ë³´ê¸°)
          </button>
          
          <button
            onClick={handleRealRun}
            disabled={isRunning || !result || result.dryRun !== true}
            className="py-4 px-6 bg-red-600 text-white rounded-xl font-bold text-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
          >
            <AlertTriangle className="w-5 h-5" />
            2ë‹¨ê³„: ì‹¤ì œ ì‹¤í–‰
          </button>
        </div>
        
        {/* ê²°ê³¼ */}
        {result && (
          <div className="bg-white rounded-xl shadow-sm p-6 mb-6">
            <h3 className="text-lg font-bold text-gray-900 mb-4">ğŸ“Š ê²°ê³¼</h3>
            <div className="grid grid-cols-3 gap-4 text-center">
              <div className="bg-blue-50 rounded-lg p-4 border-2 border-blue-200">
                <div className="text-3xl font-bold text-blue-600">{result.groups}</div>
                <div className="text-sm text-gray-600 mt-1 font-semibold">ì²­êµ¬ ê·¸ë£¹</div>
              </div>
              <div className="bg-gray-50 rounded-lg p-4 border-2 border-gray-200">
                <div className="text-3xl font-bold text-gray-600">{result.oldDocs}</div>
                <div className="text-sm text-gray-600 mt-1 font-semibold">ê¸°ì¡´ ë¬¸ì„œ</div>
              </div>
              <div className="bg-green-50 rounded-lg p-4 border-2 border-green-200">
                <div className="text-3xl font-bold text-green-600">{result.newDocs}</div>
                <div className="text-sm text-gray-600 mt-1 font-semibold">ìƒˆ ë¬¸ì„œ</div>
              </div>
            </div>
            <div className="mt-4 text-center">
              <div className="inline-flex items-center gap-2 px-4 py-2 bg-green-50 text-green-700 rounded-lg font-semibold border-2 border-green-200">
                <CheckCircle className="w-5 h-5" />
                {result.oldDocs - result.newDocs}ê°œ ë¬¸ì„œ ì ˆê°
              </div>
            </div>
          </div>
        )}
        
        {/* ë¡œê·¸ */}
        {logs.length > 0 && (
          <div className="bg-white rounded-xl shadow-sm p-6">
            <h3 className="text-lg font-bold text-gray-900 mb-4">ğŸ“ ë¡œê·¸</h3>
            <div className="bg-gray-900 rounded-lg p-4 font-mono text-sm max-h-96 overflow-y-auto">
              {logs.map((log, index) => (
                <div key={index} className={getLogColor(log.type)}>
                  {log.message}
                </div>
              ))}
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

export default MigrationPage;
</file>

<file path="src/pages/PraisePage.jsx">
// pages/PraisePage.jsx
import { useState, useEffect } from 'react';
import { Plus, CheckCircle, Clock, Filter } from 'lucide-react';
import { useAuth } from '../hooks/useAuth';
import useStore from '../store/useStore';
import praiseService from '../services/praiseService';
import PraiseModal from '../components/praise/PraiseModal';
import PraiseCard from '../components/praise/PraiseCard';
import LoginOverlay from '../components/auth/LoginOverlay';

export default function PraisePage() {
  const { user, isLoggedIn } = useAuth();
  const { selectedSpace } = useStore();
  const [praises, setPraises] = useState([]);
  const [loading, setLoading] = useState(true);
  const [showModal, setShowModal] = useState(false);
  const [statusFilter, setStatusFilter] = useState('approved');
  const [categoryFilter, setCategoryFilter] = useState('all');

  const isManager = selectedSpace?.userType === 'manager' || selectedSpace?.userType === 'vice-manager';

  useEffect(() => {
    loadPraises();
  }, [selectedSpace, statusFilter, categoryFilter]);

  const loadPraises = async () => {
    if (!selectedSpace) {
      setLoading(false);
      return;
    }
    
    setLoading(true);
    try {
      const data = await praiseService.list(selectedSpace.id, statusFilter);
      
      // ì¹´í…Œê³ ë¦¬ í•„í„° ì ìš©
      const filtered = categoryFilter === 'all' 
        ? data 
        : data.filter(p => p.category === categoryFilter);
      
      setPraises(filtered);
    } catch (error) {
      console.error('ì¹­ì°¬ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
    } finally {
      setLoading(false);
    }
  };

  // ì£¼ê°„ ì œë³´ íšŸìˆ˜ ê³„ì‚°
  const getWeeklyCount = (userId) => {
    const today = new Date();
    const weekStart = new Date(today);
    weekStart.setDate(today.getDate() - today.getDay() + 1);
    weekStart.setHours(0, 0, 0, 0);

    return praises.filter(p => {
      const createdDate = p.createdAt?.toDate?.() || new Date(p.createdAt);
      return p.userId === userId && createdDate >= weekStart;
    }).length;
  };

  const handleApprove = async (praiseId) => {
    try {
      await praiseService.approve(selectedSpace.id, praiseId, user.id);
      loadPraises();
    } catch (error) {
      console.error('ìŠ¹ì¸ ì‹¤íŒ¨:', error);
    }
  };

  const handleReject = async (praiseId) => {
    try {
      await praiseService.reject(selectedSpace.id, praiseId);
      loadPraises();
    } catch (error) {
      console.error('ê±°ë¶€ ì‹¤íŒ¨:', error);
    }
  };

  const handleUpdate = async (praiseId, updates) => {
    try {
      await praiseService.update(selectedSpace.id, praiseId, updates);
      loadPraises();
    } catch (error) {
      console.error('ìˆ˜ì • ì‹¤íŒ¨:', error);
      throw error;
    }
  };

  if (!isLoggedIn) {
    return <LoginOverlay />;
  }

  if (!selectedSpace) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center px-4">
        <div className="text-center">
          <div className="text-2xl mb-4">ğŸ </div>
          <p className="text-gray-600 mb-2">ìŠ¤í˜ì´ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
          <p className="text-sm text-gray-500">ì˜ˆì•½ í˜ì´ì§€ì—ì„œ ìŠ¤í˜ì´ìŠ¤ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 pb-32">
      {/* í—¤ë” */}
      <header className="sticky top-0 z-10 bg-white border-b border-gray-200 shadow-sm">
        <div className="max-w-[600px] mx-auto px-4 py-4">
          <h1 className="text-xl font-bold text-gray-900">âœ¨ {selectedSpace.spaceName} ì¹­ì°¬</h1>
          <p className="text-sm text-gray-600 mt-1">ë”°ëœ»í•œ ë§ˆìŒì„ ë‚˜ëˆ ì£¼ì„¸ìš”</p>
        </div>
      </header>

      {/* ìƒíƒœ í•„í„° íƒ­ (ê´€ë¦¬ìë§Œ) */}
      {isManager && (
        <div className="max-w-[600px] mx-auto px-4 py-3">
          <div className="flex gap-2 bg-white p-1 rounded-lg border border-gray-200">
            <button
              onClick={() => setStatusFilter('approved')}
              className={`flex-1 py-2 px-3 rounded-md text-sm font-medium transition-all ${
                statusFilter === 'approved'
                  ? 'bg-blue-500 text-white shadow-sm'
                  : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'
              }`}
            >
              <CheckCircle size={16} className="inline mr-1" />
              ìŠ¹ì¸ë¨
            </button>
            <button
              onClick={() => setStatusFilter('pending')}
              className={`flex-1 py-2 px-3 rounded-md text-sm font-medium transition-all ${
                statusFilter === 'pending'
                  ? 'bg-amber-500 text-white shadow-sm'
                  : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'
              }`}
            >
              <Clock size={16} className="inline mr-1" />
              ëŒ€ê¸°ì¤‘
            </button>
          </div>
        </div>
      )}

      {/* ì¹´í…Œê³ ë¦¬ í•„í„° */}
      <div className="max-w-[600px] mx-auto px-4 py-2">
        <div className="flex gap-2 overflow-x-auto">
          <button
            onClick={() => setCategoryFilter('all')}
            className={`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all ${
              categoryFilter === 'all'
                ? 'bg-gray-900 text-white'
                : 'bg-white text-gray-600 border border-gray-300 hover:bg-gray-50'
            }`}
          >
            ì „ì²´
          </button>
          <button
            onClick={() => setCategoryFilter('ë¬¼í’ˆê¸°ë¶€')}
            className={`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all ${
              categoryFilter === 'ë¬¼í’ˆê¸°ë¶€'
                ? 'bg-blue-500 text-white'
                : 'bg-white text-gray-600 border border-gray-300 hover:bg-gray-50'
            }`}
          >
            ğŸ ë¬¼í’ˆê¸°ë¶€
          </button>
          <button
            onClick={() => setCategoryFilter('ì²­ì†Œì •ë¦¬')}
            className={`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all ${
              categoryFilter === 'ì²­ì†Œì •ë¦¬'
                ? 'bg-green-500 text-white'
                : 'bg-white text-gray-600 border border-gray-300 hover:bg-gray-50'
            }`}
          >
            ğŸ§¹ ì²­ì†Œì •ë¦¬
          </button>
          <button
            onClick={() => setCategoryFilter('ê¸°íƒ€')}
            className={`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all ${
              categoryFilter === 'ê¸°íƒ€'
                ? 'bg-purple-500 text-white'
                : 'bg-white text-gray-600 border border-gray-300 hover:bg-gray-50'
            }`}
          >
            âœ¨ ê¸°íƒ€
          </button>
        </div>
      </div>

      {/* ì¹­ì°¬ ëª©ë¡ */}
      <div className="max-w-[600px] mx-auto px-4 py-4 space-y-3">
        {loading ? (
          <div className="text-center py-8 text-gray-500">ë¡œë”© ì¤‘...</div>
        ) : praises.length === 0 ? (
          <div className="text-center py-8 text-gray-500">
            {statusFilter === 'pending' ? 'ëŒ€ê¸° ì¤‘ì¸ ì¹­ì°¬ì´ ì—†ìŠµë‹ˆë‹¤' : 'ì•„ì§ ì¹­ì°¬ì´ ì—†ìŠµë‹ˆë‹¤'}
          </div>
        ) : (
          praises.map((praise) => (
            <PraiseCard
              key={praise.id}
              praise={praise}
              isManager={isManager}
              weeklyCount={getWeeklyCount(praise.userId)}
              onApprove={handleApprove}
              onReject={handleReject}
              onUpdate={handleUpdate}
            />
          ))
        )}
      </div>

      {/* í”Œë¡œíŒ… ë²„íŠ¼ */}
      <button
        onClick={() => setShowModal(true)}
        className="fixed right-4 w-14 h-14 bg-blue-500 hover:bg-blue-600 text-white rounded-full shadow-lg flex items-center justify-center transition-all active:scale-95 z-50"
        style={{ bottom: 'calc(5rem + env(safe-area-inset-bottom))' }}
      >
        <Plus size={24} />
      </button>

      {/* ì¹­ì°¬ ë“±ë¡ ëª¨ë‹¬ */}
      {showModal && (
        <PraiseModal
          onClose={() => setShowModal(false)}
          onSuccess={() => {
            setShowModal(false);
            loadPraises();
          }}
        />
      )}
    </div>
  );
}
</file>

<file path="src/pages/ReservationStatsPage.jsx">
// src/pages/ReservationStatsPage.jsx
import { useState, useEffect, useMemo } from 'react';
import { useNavigate } from 'react-router-dom';
import {
  ChevronLeft,
  Trophy,
  Calendar,
  Users,
  TrendingUp,
  Award,
  Target,
  UserPlus,
  Medal
} from 'lucide-react';
import { useAuth } from '../hooks/useAuth';
import useStore from '../store/useStore';
import reservationService from '../services/reservationService';
import authService from '../services/authService';
import { formatDate } from '../utils/dateUtils';

const ReservationStatsPage = () => {
  const navigate = useNavigate();
  const { user } = useAuth();
  const { selectedSpace } = useStore();
  const [loading, setLoading] = useState(true);
  const [reservations, setReservations] = useState([]);
  const [profiles, setProfiles] = useState({});
  const [period, setPeriod] = useState('thisMonth'); // thisMonth, lastMonth, all
  const [members, setMembers] = useState([]);

  useEffect(() => {
    if (selectedSpace?.id) {
      loadData();
    }
  }, [selectedSpace?.id, period]);

  const loadData = async () => {
    setLoading(true);
    try {
      const spaceId = selectedSpace.id || selectedSpace.spaceId;

      // ê¸°ê°„ ê³„ì‚°
      const today = new Date();
      today.setHours(23, 59, 59, 999);
      let startDate = null;
      let endDate = new Date(today);

      if (period === 'thisMonth') {
        startDate = new Date(today.getFullYear(), today.getMonth(), 1);
        startDate.setHours(0, 0, 0, 0);
      } else if (period === 'lastMonth') {
        startDate = new Date(today.getFullYear(), today.getMonth() - 1, 1);
        startDate.setHours(0, 0, 0, 0);
        endDate = new Date(today.getFullYear(), today.getMonth(), 0);
        endDate.setHours(23, 59, 59, 999);
      }
      // period === 'all'ì´ë©´ startDate = null, endDate = today

      console.log('ğŸ“Š ê¸°ê°„:', period, startDate, endDate);

      // ì˜ˆì•½ ë°ì´í„° ë¡œë“œ
      const allReservations = await reservationService.getAllReservations(
        spaceId,
        startDate,
        endDate
      );

      console.log('ğŸ“‹ ë¡œë“œëœ ì˜ˆì•½ ìˆ˜:', allReservations.length);

      // ë©¤ë²„ ëª©ë¡ ì¡°íšŒ
      const membersList = selectedSpace?.members || [];
      setMembers(membersList);

      // í”„ë¡œí•„ ì¡°íšŒ
      const userIds = [...new Set(allReservations.map(r => r.userId))];
      const profilesData = await authService.getUserProfiles(userIds);

      setReservations(allReservations);
      setProfiles(profilesData);
    } catch (error) {
      console.error('í†µê³„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
    } finally {
      setLoading(false);
    }
  };

  // ì›”ìš”ì¼ êµ¬í•˜ê¸°
  const getMonday = (date) => {
    const d = new Date(date);
    const day = d.getDay();
    const diff = d.getDate() - day + (day === 0 ? -6 : 1);
    return new Date(d.setDate(diff));
  };

  // í†µê³„ ê³„ì‚°
  const stats = useMemo(() => {
    if (!user) return null;

    // ë‚´ ì˜ˆì•½ í†µê³„ (ì˜ˆì•½ ê±´ìˆ˜ê°€ ì•„ë‹ˆë¼ ìˆ™ë°• ì¼ìˆ˜ë¡œ ê³„ì‚°)
    const myReservations = reservations.filter(r => String(r.userId) === String(user.id));
    const myStayCount = myReservations.reduce((sum, r) => sum + (r.nights || 1), 0);

    // ê²ŒìŠ¤íŠ¸ íƒ€ì… í™•ì¸ (ì´ˆëŒ€ëœ ê²ŒìŠ¤íŠ¸ì¸ì§€)
    const guestReservations = myReservations.filter(r => r.type === 'guest');
    const myGuestCount = guestReservations.length;

    // ì‚¬ìš©ìë³„ ìˆ™ë°• ì¼ìˆ˜ (nights í•©ê³„)
    const userStayCount = {};
    reservations.forEach(r => {
      if (!userStayCount[r.userId]) {
        userStayCount[r.userId] = 0;
      }
      userStayCount[r.userId] += (r.nights || 1);
    });

    // ì‚¬ìš©ìë³„ ê²ŒìŠ¤íŠ¸ ì´ˆëŒ€ í†µê³„ (hostId ê¸°ì¤€)
    const userGuestInvites = {}; // ì´ˆëŒ€í•œ ê²ŒìŠ¤íŠ¸ ìˆ˜
    const userGuestInviteNights = {}; // ê²ŒìŠ¤íŠ¸ë“¤ì˜ ì´ ìˆ™ë°• ì¼ìˆ˜

    reservations.forEach(r => {
      if (r.type === 'guest' && r.hostId) {
        if (!userGuestInvites[r.hostId]) {
          userGuestInvites[r.hostId] = 0;
          userGuestInviteNights[r.hostId] = 0;
        }
        userGuestInvites[r.hostId]++;
        userGuestInviteNights[r.hostId] += (r.nights || 1);
      }
    });

    // ì£¼ì£¼ë§Œ í•„í„°ë§ (ê²ŒìŠ¤íŠ¸ ì œì™¸)
    const shareholderMembers = members.filter(m =>
      ['shareholder', 'manager', 'vice-manager'].includes(m.userType)
    );
    const shareholderIds = shareholderMembers.map(m => m.userId);

    // ì£¼ì£¼ ë­í‚¹ (ìˆ™ë°• ì¼ìˆ˜ ê¸°ì¤€)
    const shareholderRanking = Object.entries(userStayCount)
      .filter(([userId]) => shareholderIds.includes(userId))
      .sort((a, b) => b[1] - a[1])
      .map(([userId, count], index) => ({
        rank: index + 1,
        userId,
        count,
        profile: profiles[userId] || {}
      }));

    // ê²ŒìŠ¤íŠ¸ ì´ˆëŒ€ ë­í‚¹ (ì£¼ì£¼ë§Œ, ìˆ™ë°• ì¼ìˆ˜ë¡œ ì •ë ¬)
    const guestInviteRanking = Object.entries(userGuestInviteNights)
      .filter(([userId]) => shareholderIds.includes(userId))
      .sort((a, b) => b[1] - a[1]) // ìˆ™ë°• ì¼ìˆ˜ë¡œ ì •ë ¬
      .map(([userId, nights], index) => ({
        rank: index + 1,
        userId,
        nights, // ì´ ìˆ™ë°• ì¼ìˆ˜
        count: userGuestInvites[userId] || 0, // ê²ŒìŠ¤íŠ¸ ìˆ˜
        profile: profiles[userId] || {}
      }));

    // ë‚´ ìˆœìœ„
    const myStayRank = shareholderRanking.findIndex(r => String(r.userId) === String(user.id)) + 1;
    const myInviteRank = guestInviteRanking.findIndex(r => String(r.userId) === String(user.id)) + 1;

    // ë‚´ê°€ ì´ˆëŒ€í•œ ê²ŒìŠ¤íŠ¸ í†µê³„
    const myInviteCount = userGuestInvites[user.id] || 0;
    const myInviteNights = userGuestInviteNights[user.id] || 0;

    return {
      myStayCount,
      myGuestCount,
      myInviteCount,
      myInviteNights,
      myStayRank: myStayRank || '-',
      myInviteRank: myInviteRank || '-',
      shareholderRanking,
      guestInviteRanking,
      totalReservations: reservations.length,
      totalShareholders: shareholderIds.length
    };
  }, [reservations, profiles, user, members]);

  const getPeriodLabel = () => {
    if (period === 'thisMonth') return 'ì´ë²ˆ ë‹¬';
    if (period === 'lastMonth') return 'ì§€ë‚œ ë‹¬';
    return 'ì „ì²´ ê¸°ê°„';
  };

  const getRankColor = (rank) => {
    if (rank === 1) return 'text-yellow-600';
    if (rank === 2) return 'text-gray-500';
    if (rank === 3) return 'text-orange-600';
    return 'text-gray-700';
  };

  const getRankIcon = (rank) => {
    if (rank === 1) return <Trophy className="w-5 h-5 text-yellow-600" />;
    if (rank === 2) return <Medal className="w-5 h-5 text-gray-500" />;
    if (rank === 3) return <Award className="w-5 h-5 text-orange-600" />;
    return <div className="w-5 h-5 flex items-center justify-center text-xs font-bold">{rank}</div>;
  };

  if (loading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="text-center">
          <div className="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-gray-600">í†µê³„ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-b from-gray-50 to-white pb-20">
      {/* í—¤ë” */}
      <div className="bg-gradient-to-br from-purple-500 via-purple-600 to-purple-700 text-white sticky top-0 z-10">
        <div className="max-w-2xl mx-auto px-4 py-4">
          <div className="flex items-center gap-3 mb-4">
            <button
              onClick={() => navigate(-1)}
              className="p-2 hover:bg-white/10 rounded-lg transition-colors"
            >
              <ChevronLeft className="w-5 h-5" />
            </button>
            <div className="flex items-center gap-2">
              <Trophy className="w-5 h-5" />
              <h1 className="text-xl font-bold">ì˜ˆì•½ í†µê³„</h1>
            </div>
          </div>

          {/* ê¸°ê°„ ì„ íƒ */}
          <div className="flex gap-2">
            <button
              onClick={() => setPeriod('thisMonth')}
              className={`flex-1 py-2 rounded-lg font-medium transition-colors ${
                period === 'thisMonth'
                  ? 'bg-white text-purple-600'
                  : 'bg-white/20 hover:bg-white/30'
              }`}
            >
              ì´ë²ˆ ë‹¬
            </button>
            <button
              onClick={() => setPeriod('lastMonth')}
              className={`flex-1 py-2 rounded-lg font-medium transition-colors ${
                period === 'lastMonth'
                  ? 'bg-white text-purple-600'
                  : 'bg-white/20 hover:bg-white/30'
              }`}
            >
              ì§€ë‚œ ë‹¬
            </button>
            <button
              onClick={() => setPeriod('all')}
              className={`flex-1 py-2 rounded-lg font-medium transition-colors ${
                period === 'all'
                  ? 'bg-white text-purple-600'
                  : 'bg-white/20 hover:bg-white/30'
              }`}
            >
              ì „ì²´
            </button>
          </div>
        </div>
      </div>

      <div className="max-w-2xl mx-auto px-4 py-6 space-y-6">
        {/* ë‚´ í†µê³„ */}
        <div className="bg-white rounded-xl shadow-lg p-6 border-2 border-purple-200">
          <div className="flex items-center gap-2 mb-4">
            <Target className="w-5 h-5 text-purple-600" />
            <h2 className="text-lg font-bold text-gray-900">ë‚´ í†µê³„ ({getPeriodLabel()})</h2>
          </div>

          <div className="grid grid-cols-2 gap-4">
            <div className="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4">
              <div className="flex items-center gap-2 mb-2">
                <Calendar className="w-4 h-4 text-blue-600" />
                <span className="text-xs font-medium text-blue-700">ìˆ™ë°• ì¼ìˆ˜</span>
              </div>
              <div className="text-2xl font-bold text-blue-900">{stats?.myStayCount || 0}ë°•</div>
              <div className="text-xs text-blue-600 mt-1">
                {typeof stats?.myStayRank === 'number' ? `${stats.myStayRank}ìœ„` : 'ìˆœìœ„ ì—†ìŒ'}
              </div>
            </div>

            <div className="bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-4">
              <div className="flex items-center gap-2 mb-2">
                <UserPlus className="w-4 h-4 text-green-600" />
                <span className="text-xs font-medium text-green-700">ê²ŒìŠ¤íŠ¸ ì´ˆëŒ€</span>
              </div>
              <div className="text-2xl font-bold text-green-900">
                {stats?.myInviteNights || 0}ë°•
              </div>
              <div className="text-xs text-green-600 mt-1">
                {stats?.myInviteCount || 0}ëª… ì´ˆëŒ€ Â· {typeof stats?.myInviteRank === 'number' ? `${stats.myInviteRank}ìœ„` : 'ìˆœìœ„ ì—†ìŒ'}
              </div>
            </div>
          </div>
        </div>

        {/* ìˆ™ë°• íšŸìˆ˜ ë­í‚¹ */}
        <div className="bg-white rounded-xl shadow-lg p-6">
          <div className="flex items-center gap-2 mb-4">
            <TrendingUp className="w-5 h-5 text-blue-600" />
            <h2 className="text-lg font-bold text-gray-900">ìˆ™ë°• ë­í‚¹ (ì£¼ì£¼)</h2>
          </div>

          {stats?.shareholderRanking && stats.shareholderRanking.length > 0 ? (
            <div className="space-y-2">
              {stats.shareholderRanking.slice(0, 10).map((item) => (
                <div
                  key={item.userId}
                  className={`flex items-center gap-3 p-3 rounded-lg transition-colors ${
                    String(item.userId) === String(user.id)
                      ? 'bg-purple-50 border-2 border-purple-300'
                      : 'bg-gray-50 hover:bg-gray-100'
                  }`}
                >
                  <div className="flex-shrink-0">
                    {getRankIcon(item.rank)}
                  </div>

                  <div className="flex items-center gap-2 flex-1 min-w-0">
                    {item.profile.profileImage ? (
                      <img
                        src={item.profile.profileImage}
                        alt={item.profile.displayName}
                        className="w-8 h-8 rounded-full object-cover"
                      />
                    ) : (
                      <div className="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
                        <span className="text-xs font-bold text-blue-600">
                          {item.profile.displayName?.[0] || '?'}
                        </span>
                      </div>
                    )}
                    <span className="font-semibold text-gray-900 truncate">
                      {item.profile.displayName || 'ì•Œ ìˆ˜ ì—†ìŒ'}
                    </span>
                    {String(item.userId) === String(user.id) && (
                      <span className="text-xs bg-purple-600 text-white px-2 py-0.5 rounded-full">ë‚˜</span>
                    )}
                  </div>

                  <div className="text-right">
                    <div className="text-lg font-bold text-gray-900">{item.count}ë°•</div>
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <div className="text-center py-8 text-gray-500">
              <Calendar className="w-12 h-12 mx-auto mb-2 text-gray-300" />
              <p>ì•„ì§ ì˜ˆì•½ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</p>
            </div>
          )}
        </div>

        {/* ê²ŒìŠ¤íŠ¸ ì´ˆëŒ€ ë­í‚¹ */}
        <div className="bg-white rounded-xl shadow-lg p-6">
          <div className="flex items-center gap-2 mb-4">
            <Users className="w-5 h-5 text-green-600" />
            <h2 className="text-lg font-bold text-gray-900">ê²ŒìŠ¤íŠ¸ ì´ˆëŒ€ ë­í‚¹ (ì£¼ì£¼)</h2>
          </div>

          {stats?.guestInviteRanking && stats.guestInviteRanking.length > 0 ? (
            <div className="space-y-2">
              {stats.guestInviteRanking.slice(0, 10).map((item) => (
                <div
                  key={item.userId}
                  className={`flex items-center gap-3 p-3 rounded-lg transition-colors ${
                    String(item.userId) === String(user.id)
                      ? 'bg-purple-50 border-2 border-purple-300'
                      : 'bg-gray-50 hover:bg-gray-100'
                  }`}
                >
                  <div className="flex-shrink-0">
                    {getRankIcon(item.rank)}
                  </div>

                  <div className="flex items-center gap-2 flex-1 min-w-0">
                    {item.profile.profileImage ? (
                      <img
                        src={item.profile.profileImage}
                        alt={item.profile.displayName}
                        className="w-8 h-8 rounded-full object-cover"
                      />
                    ) : (
                      <div className="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center">
                        <span className="text-xs font-bold text-green-600">
                          {item.profile.displayName?.[0] || '?'}
                        </span>
                      </div>
                    )}
                    <span className="font-semibold text-gray-900 truncate">
                      {item.profile.displayName || 'ì•Œ ìˆ˜ ì—†ìŒ'}
                    </span>
                    {String(item.userId) === String(user.id) && (
                      <span className="text-xs bg-purple-600 text-white px-2 py-0.5 rounded-full">ë‚˜</span>
                    )}
                  </div>

                  <div className="text-right">
                    <div className="text-lg font-bold text-gray-900">{item.nights}ë°•</div>
                    <div className="text-xs text-gray-500">({item.count}ëª…)</div>
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <div className="text-center py-8 text-gray-500">
              <Users className="w-12 h-12 mx-auto mb-2 text-gray-300" />
              <p>ì•„ì§ ê²ŒìŠ¤íŠ¸ ì´ˆëŒ€ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</p>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

export default ReservationStatsPage;
</file>

<file path="src/pages/SettlementSchedulePage.jsx">
// src/pages/SettlementSchedulePage.jsx
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { ArrowLeft } from 'lucide-react';
import { doc, getDoc, setDoc } from 'firebase/firestore';
import { db } from '../config/firebase';
import { useAuth } from '../hooks/useAuth';
import useStore from '../store/useStore';
import LoginOverlay from '../components/auth/LoginOverlay';
import Loading from '../components/common/Loading';
import SettlementScheduleSettings from '../components/settings/SettlementScheduleSettings';
import { canManageSpace } from '../utils/permissions';

const SettlementSchedulePage = () => {
  const navigate = useNavigate();
  const { user, isLoggedIn } = useAuth();
  const { selectedSpace } = useStore();

  const [settings, setSettings] = useState(null);
  const [loading, setLoading] = useState(true);

  // ê¶Œí•œ ì²´í¬
  const isManager = selectedSpace?.userType && canManageSpace(selectedSpace.userType);

  useEffect(() => {
    if (!isLoggedIn) return;

    if (!isManager) {
      alert('ì •ì‚° ì„¤ì • ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
      navigate('/more');
      return;
    }

    loadSettings();
  }, [selectedSpace, isLoggedIn, isManager]);

  const loadSettings = async () => {
    if (!selectedSpace?.id) return;

    try {
      setLoading(true);

      const settingsRef = doc(db, 'spaces', selectedSpace.id, 'settings', 'settlement');
      const settingsSnap = await getDoc(settingsRef);

      if (settingsSnap.exists()) {
        setSettings(settingsSnap.data());
      } else {
        // ê¸°ë³¸ê°’ ì„¤ì •
        const defaultSettings = {
          enabled: false,
          frequency: 'weekly',
          weeklyDay: 1, // ì›”ìš”ì¼
          monthlyDay: 1,
          yearlyMonth: 1,
          yearlyDay: 1,
          time: '18:00',
        };
        setSettings(defaultSettings);
      }
    } catch (error) {
      console.error('ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
      alert('ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setLoading(false);
    }
  };

  const handleSave = async (newSettings) => {
    if (!selectedSpace?.id) return;

    try {
      const settingsRef = doc(db, 'spaces', selectedSpace.id, 'settings', 'settlement');

      // Firestoreì— ì €ì¥
      await setDoc(settingsRef, {
        ...newSettings,
        updatedAt: new Date(),
        updatedBy: user.id,
      });

      console.log('âœ… ì •ì‚° ìë™í™” ì„¤ì • ì €ì¥ ì™„ë£Œ:', newSettings);

      // ë¡œì»¬ state ì—…ë°ì´íŠ¸
      setSettings(newSettings);
    } catch (error) {
      console.error('âŒ ì„¤ì • ì €ì¥ ì‹¤íŒ¨:', error);
      throw error;
    }
  };

  if (!isLoggedIn) {
    return <LoginOverlay />;
  }

  if (!isManager) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gray-50">
        <div className="text-center">
          <h2 className="text-2xl font-bold text-gray-900 mb-4">ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤</h2>
          <p className="text-gray-600 mb-6">ì •ì‚° ì„¤ì •ì€ ë§¤ë‹ˆì €ë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
          <button
            onClick={() => navigate('/more')}
            className="px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors"
          >
            ëŒì•„ê°€ê¸°
          </button>
        </div>
      </div>
    );
  }

  if (loading) {
    return <Loading />;
  }

  return (
    <div className="min-h-screen bg-gray-50 pb-24">
      {/* í—¤ë” */}
      <div className="bg-white border-b border-gray-200 sticky top-0 z-10">
        <div className="px-4 py-4">
          <div className="flex items-center gap-3">
            <button
              onClick={() => navigate('/more')}
              className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
            >
              <ArrowLeft className="w-6 h-6 text-gray-700" />
            </button>
            <div>
              <h1 className="text-xl font-bold text-gray-900">ì •ì‚° ìë™í™” ì„¤ì •</h1>
              <p className="text-sm text-gray-600">{selectedSpace?.spaceName}</p>
            </div>
          </div>
        </div>
      </div>

      {/* ì„¤ì • ì»¨í…ì¸  */}
      <div className="max-w-4xl mx-auto p-4">
        <SettlementScheduleSettings
          spaceId={selectedSpace?.id}
          settings={settings}
          onSave={handleSave}
        />
      </div>
    </div>
  );
};

export default SettlementSchedulePage;
</file>

<file path="src/pages/SettlementSettingsPage.jsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import useStore from '../store/useStore';
import spaceSettingsService from '../services/spaceSettingsService';
import { canManageSpace } from '../utils/permissions';
import { ArrowLeft, DollarSign, CreditCard, User, Building, Save, Info, AlertCircle } from 'lucide-react';

export default function SettlementSettingsPage() {
  const navigate = useNavigate();
  const { user, selectedSpace } = useStore();
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);

  // í¼ ë°ì´í„°
  const [formData, setFormData] = useState({
    accountBank_settle: '',
    accountNumber_settle: '',
    accountHolder_settle: '',
  });

  // ê¶Œí•œ ì²´í¬ ë° ì´ˆê¸° ë°ì´í„° ë¡œë“œ
  useEffect(() => {
    if (!user || !selectedSpace) {
      alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
      navigate('/');
      return;
    }

    const spaceId = selectedSpace.id || selectedSpace.spaceId;
    const userSpaceData = user.spaceAccess?.find(s => s.spaceId === spaceId);

    if (!userSpaceData || !canManageSpace(userSpaceData.userType)) {
      alert('ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. (ë§¤ë‹ˆì € ì´ìƒë§Œ ì ‘ê·¼ ê°€ëŠ¥)');
      navigate('/');
      return;
    }

    loadSettlementAccount();
  }, [user, selectedSpace, navigate]);

  const loadSettlementAccount = async () => {
    try {
      setLoading(true);
      const spaceId = selectedSpace.id || selectedSpace.spaceId;
      const data = await spaceSettingsService.getSettlementAccount(spaceId);

      setFormData({
        accountBank_settle: data.accountBank_settle || '',
        accountNumber_settle: data.accountNumber_settle || '',
        accountHolder_settle: data.accountHolder_settle || '',
      });
    } catch (error) {
      console.error('ì •ì‚° ê³„ì¢Œ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
      // ì—ëŸ¬ê°€ ë°œìƒí•´ë„ ë¹ˆ ê°’ìœ¼ë¡œ ê³„ì† ì§„í–‰
    } finally {
      setLoading(false);
    }
  };

  const handleInputChange = (field, value) => {
    setFormData(prev => ({
      ...prev,
      [field]: value
    }));
  };

  const handleSave = async () => {
    // ìœ íš¨ì„± ê²€ì‚¬
    if (!formData.accountBank_settle?.trim()) {
      alert('ì€í–‰ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    if (!formData.accountNumber_settle?.trim()) {
      alert('ê³„ì¢Œë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    if (!formData.accountHolder_settle?.trim()) {
      alert('ì˜ˆê¸ˆì£¼ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    const confirmed = window.confirm(
      'ì •ì‚° ê³„ì¢Œ ì •ë³´ë¥¼ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì €ì¥ í›„ ì •ì‚° ì•Œë¦¼í†¡ì— ì´ ê³„ì¢Œ ì •ë³´ê°€ ì‚¬ìš©ë©ë‹ˆë‹¤.'
    );
    if (!confirmed) return;

    try {
      setSaving(true);
      const spaceId = selectedSpace.id || selectedSpace.spaceId;

      await spaceSettingsService.updateSettlementAccount(
        spaceId,
        {
          accountBank_settle: formData.accountBank_settle.trim(),
          accountNumber_settle: formData.accountNumber_settle.trim(),
          accountHolder_settle: formData.accountHolder_settle.trim(),
        },
        user.id,
        user.displayName || user.name
      );

      alert('ì •ì‚° ê³„ì¢Œ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
      await loadSettlementAccount();
    } catch (error) {
      console.error('ì •ì‚° ê³„ì¢Œ ì •ë³´ ì €ì¥ ì‹¤íŒ¨:', error);
      alert('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
      setSaving(false);
    }
  };

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900">
        <div className="text-center">
          <div className="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-slate-300">ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 pb-20">
      {/* í—¤ë” */}
      <div className="bg-gradient-to-r from-slate-800 to-slate-700 border-b border-slate-600/30 sticky top-0 z-10 shadow-lg">
        <div className="max-w-2xl mx-auto px-4 py-4">
          <div className="flex items-center gap-3">
            <button
              onClick={() => navigate('/space/manage')}
              className="p-2 hover:bg-white/10 rounded-lg transition-colors"
            >
              <ArrowLeft className="w-5 h-5 text-white" />
            </button>
            <div className="flex-1">
              <h1 className="text-xl font-bold text-white flex items-center gap-2">
                <DollarSign className="w-6 h-6" />
                ì •ì‚° ê³„ì¢Œ ê´€ë¦¬
              </h1>
              <p className="text-sm text-slate-300 mt-1">
                {selectedSpace?.spaceName || selectedSpace?.name}
              </p>
            </div>
          </div>
        </div>
      </div>

      {/* ì•ˆë‚´ */}
      <div className="max-w-2xl mx-auto px-4 py-6">
        <div className="bg-blue-500/10 border border-blue-500/30 rounded-xl p-4 mb-6">
          <div className="flex items-start gap-3">
            <Info className="w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5" />
            <div className="text-sm text-blue-300">
              <p className="font-semibold mb-2">ì •ì‚° ê³„ì¢Œ ì•ˆë‚´</p>
              <ul className="space-y-1 text-blue-200/80">
                <li>â€¢ ì •ì‚° ì•Œë¦¼í†¡ì— ì‚¬ìš©ë  ê³„ì¢Œ ì •ë³´ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.</li>
                <li>â€¢ ê²ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ ê³„ì¢Œì™€ ë³„ë„ë¡œ ê´€ë¦¬ë˜ì–´ ìš´ì˜ìƒ í˜¼ë™ì„ ë°©ì§€í•©ë‹ˆë‹¤.</li>
                <li>â€¢ ë§¤ë‹ˆì € ì´ìƒë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
              </ul>
            </div>
          </div>
        </div>

        <div className="bg-yellow-500/10 border border-yellow-500/30 rounded-xl p-4 mb-6">
          <div className="flex items-start gap-3">
            <AlertCircle className="w-5 h-5 text-yellow-400 flex-shrink-0 mt-0.5" />
            <div className="text-sm text-yellow-300">
              <p className="font-semibold mb-2">ê²ŒìŠ¤íŠ¸ ê³„ì¢Œì™€ì˜ ì°¨ì´ì </p>
              <ul className="space-y-1 text-yellow-200/80">
                <li>â€¢ <strong>ê²ŒìŠ¤íŠ¸ ê³„ì¢Œ</strong>: ê²ŒìŠ¤íŠ¸ ì˜ˆì•½ ì‹œ ì…ê¸ˆ ì•ˆë‚´ìš©</li>
                <li>â€¢ <strong>ì •ì‚° ê³„ì¢Œ</strong>: ì£¼ì£¼/ë§¤ë‹ˆì € ì •ì‚° ì‹œ ì†¡ê¸ˆ ì•ˆë‚´ìš©</li>
              </ul>
            </div>
          </div>
        </div>

        {/* ì •ì‚° ê³„ì¢Œ ì •ë³´ */}
        <div className="bg-gradient-to-br from-slate-800/80 to-slate-700/50 backdrop-blur-sm border border-slate-600/30 rounded-xl p-6 shadow-lg mb-6">
          <h2 className="text-lg font-bold text-white mb-4 flex items-center gap-2">
            <CreditCard className="w-5 h-5 text-blue-400" />
            ì •ì‚° ê³„ì¢Œ ì •ë³´
          </h2>

          <div className="space-y-4">
            {/* ì€í–‰ëª… */}
            <div>
              <label className="block text-sm font-medium text-slate-300 mb-2">
                <Building className="w-4 h-4 inline mr-1" />
                ì€í–‰ëª…
              </label>
              <input
                type="text"
                value={formData.accountBank_settle}
                onChange={(e) => handleInputChange('accountBank_settle', e.target.value)}
                placeholder="ì˜ˆ: ì¹´ì¹´ì˜¤ë±…í¬"
                className="w-full px-4 py-3 bg-slate-700/50 border border-slate-600/30 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500/50"
              />
            </div>

            {/* ê³„ì¢Œë²ˆí˜¸ */}
            <div>
              <label className="block text-sm font-medium text-slate-300 mb-2">
                <CreditCard className="w-4 h-4 inline mr-1" />
                ê³„ì¢Œë²ˆí˜¸
              </label>
              <input
                type="text"
                value={formData.accountNumber_settle}
                onChange={(e) => handleInputChange('accountNumber_settle', e.target.value)}
                placeholder="ì˜ˆ: 7942-24-38529"
                className="w-full px-4 py-3 bg-slate-700/50 border border-slate-600/30 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500/50"
              />
            </div>

            {/* ì˜ˆê¸ˆì£¼ */}
            <div>
              <label className="block text-sm font-medium text-slate-300 mb-2">
                <User className="w-4 h-4 inline mr-1" />
                ì˜ˆê¸ˆì£¼
              </label>
              <input
                type="text"
                value={formData.accountHolder_settle}
                onChange={(e) => handleInputChange('accountHolder_settle', e.target.value)}
                placeholder="ì˜ˆ: í™ê¸¸ë™"
                className="w-full px-4 py-3 bg-slate-700/50 border border-slate-600/30 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500/50"
              />
            </div>
          </div>
        </div>

        {/* ë¯¸ë¦¬ë³´ê¸° */}
        <div className="bg-gradient-to-br from-slate-800/50 to-slate-700/30 backdrop-blur-sm border border-slate-600/30 rounded-xl p-6 shadow-lg mb-6">
          <h3 className="text-sm font-bold text-slate-300 mb-3">ì •ì‚° ì•Œë¦¼í†¡ ë¯¸ë¦¬ë³´ê¸°</h3>
          <div className="bg-slate-900/50 rounded-lg p-4 border border-slate-600/30 text-sm space-y-2">
            <p className="text-slate-200">
              <strong>ì…ê¸ˆ ê³„ì¢Œ:</strong> {formData.accountBank_settle || '(ì€í–‰ëª…)'} {formData.accountNumber_settle || '(ê³„ì¢Œë²ˆí˜¸)'}
            </p>
            <p className="text-slate-200">
              <strong>ì˜ˆê¸ˆì£¼:</strong> {formData.accountHolder_settle || '(ì˜ˆê¸ˆì£¼)'}
            </p>
            <p className="text-xs text-slate-400 mt-3">
              * ì‹¤ì œ ì •ì‚° ì•Œë¦¼í†¡ì—ì„œëŠ” ì´ ê³„ì¢Œë¡œ ì •ì‚°ê¸ˆì„ ì†¡ê¸ˆí•˜ë„ë¡ ì•ˆë‚´ë©ë‹ˆë‹¤.
            </p>
          </div>
        </div>

        {/* ì €ì¥ ë²„íŠ¼ */}
        <button
          onClick={handleSave}
          disabled={saving}
          className="w-full py-4 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
        >
          {saving ? (
            <>
              <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
              <span>ì €ì¥ ì¤‘...</span>
            </>
          ) : (
            <>
              <Save className="w-5 h-5" />
              <span>ì €ì¥í•˜ê¸°</span>
            </>
          )}
        </button>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/TermsOfServicePage.jsx">
import React from 'react';
import { useNavigate } from 'react-router-dom';
import { ArrowLeft } from 'lucide-react';

const TermsOfServicePage = () => {
  const navigate = useNavigate();

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900">
      {/* í—¤ë” */}
      <div className="sticky top-0 z-10 bg-slate-900/80 backdrop-blur-lg border-b border-white/10">
        <div className="max-w-4xl mx-auto px-4 py-4 flex items-center gap-4">
          <button
            onClick={() => navigate(-1)}
            className="p-2 hover:bg-white/10 rounded-lg transition-colors"
          >
            <ArrowLeft className="w-5 h-5 text-white" />
          </button>
          <h1 className="text-xl font-bold text-white">ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€</h1>
        </div>
      </div>

      {/* ë³¸ë¬¸ */}
      <div className="max-w-4xl mx-auto px-4 py-8">
        <div className="bg-white/10 backdrop-blur-lg rounded-xl border border-white/20 shadow-2xl p-6 md:p-8">
          <div className="space-y-8 text-white">
            {/* ì œ1ì¡° */}
            <section className="space-y-4">
              <h2 className="text-2xl font-bold text-white border-b border-white/20 pb-3">
                ì œ1ì¡° (ëª©ì )
              </h2>
              <p className="text-gray-300 leading-relaxed">
                ì´ ì•½ê´€ì€ ì œì´ì—ì´ì¹˜308(ì´í•˜ "íšŒì‚¬")ì´ ì œê³µí•˜ëŠ” ê²Œí•˜(ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤) ì˜ˆì•½ ì„œë¹„ìŠ¤(ì´í•˜ "ì„œë¹„ìŠ¤")ì˜ 
                ì´ìš©ê³¼ ê´€ë ¨í•˜ì—¬ íšŒì‚¬ì™€ ì´ìš©ìì˜ ê¶Œë¦¬, ì˜ë¬´ ë° ì±…ì„ì‚¬í•­, ì„œë¹„ìŠ¤ ì´ìš©ì¡°ê±´ ë° ì ˆì°¨ ë“±ì„ ê·œì •í•¨ì„ 
                ëª©ì ìœ¼ë¡œ í•©ë‹ˆë‹¤.
              </p>
            </section>

            {/* ì œ2ì¡° */}
            <section className="space-y-4">
              <h2 className="text-2xl font-bold text-white border-b border-white/20 pb-3">
                ì œ2ì¡° (ì •ì˜)
              </h2>
              <div className="space-y-3">
                <p className="text-gray-300">ì´ ì•½ê´€ì—ì„œ ì‚¬ìš©í•˜ëŠ” ìš©ì–´ì˜ ì •ì˜ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:</p>
                <ol className="space-y-3 pl-6">
                  <li className="text-gray-300">
                    <span className="font-semibold text-white">1. "ì„œë¹„ìŠ¤"</span>ë€ íšŒì›ì´ ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ë¥¼ 
                    ì´ìš©í•  ìˆ˜ ìˆë„ë¡ íšŒì‚¬ê°€ ì œê³µí•˜ëŠ” ëª¨ë°”ì¼ ê¸°ë°˜ ì˜ˆì•½ ê´€ë¦¬ ì‹œìŠ¤í…œì„ ë§í•©ë‹ˆë‹¤.
                  </li>
                  <li className="text-gray-300">
                    <span className="font-semibold text-white">2. "íšŒì›"</span>ì´ë€ ë³¸ ì•½ê´€ì— ë”°ë¼ íšŒì‚¬ì™€ 
                    ì´ìš©ê³„ì•½ì„ ì²´ê²°í•˜ê³  ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” ìë¥¼ ë§í•©ë‹ˆë‹¤.
                  </li>
                  <li className="text-gray-300">
                    <span className="font-semibold text-white">3. "ì£¼ì£¼(Shareholder)"</span>ë€ ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ì˜ 
                    ì§€ë¶„ì„ ì†Œìœ í•˜ê³  ë¬´ë£Œë¡œ ì˜ˆì•½ ë° ì´ìš©ì´ ê°€ëŠ¥í•œ íšŒì›ì„ ë§í•©ë‹ˆë‹¤.
                  </li>
                  <li className="text-gray-300">
                    <span className="font-semibold text-white">4. "ê²ŒìŠ¤íŠ¸(Guest)"</span>ë€ ì£¼ì£¼ì˜ ì´ˆëŒ€ë¥¼ ë°›ì•„ 
                    ìœ ë£Œë¡œ ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” íšŒì›ì„ ë§í•©ë‹ˆë‹¤.
                  </li>
                  <li className="text-gray-300">
                    <span className="font-semibold text-white">5. "ë§¤ë‹ˆì €(Manager)"</span>ë€ ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ì˜ 
                    ì „ë°˜ì ì¸ ìš´ì˜ ë° ê´€ë¦¬ ê¶Œí•œì„ ê°€ì§„ íšŒì›ì„ ë§í•©ë‹ˆë‹¤.
                  </li>
                  <li className="text-gray-300">
                    <span className="font-semibold text-white">6. "ë¶€ë§¤ë‹ˆì €(Vice-Manager)"</span>ë€ ë§¤ë‹ˆì €ë¥¼ 
                    ë³´ì¡°í•˜ì—¬ ì œí•œëœ ê´€ë¦¬ ê¶Œí•œì„ ê°€ì§„ íšŒì›ì„ ë§í•©ë‹ˆë‹¤.
                  </li>
                  <li className="text-gray-300">
                    <span className="font-semibold text-white">7. "ì˜ˆì•½"</span>ì´ë€ íšŒì›ì´ íŠ¹ì • ê¸°ê°„ ë™ì•ˆ 
                    ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ë¥¼ ì´ìš©í•˜ê¸° ìœ„í•´ ì„œë¹„ìŠ¤ë¥¼ í†µí•´ ì‹ ì²­í•˜ê³  í™•ì •ëœ ìƒíƒœë¥¼ ë§í•©ë‹ˆë‹¤.
                  </li>
                  <li className="text-gray-300">
                    <span className="font-semibold text-white">8. "ìŠ¤í˜ì´ìŠ¤(Space)"</span>ë€ ì„œë¹„ìŠ¤ ë‚´ì—ì„œ 
                    íŠ¹ì • ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ë¥¼ êµ¬ë¶„í•˜ê¸° ìœ„í•œ ë…ë¦½ëœ ë‹¨ìœ„ë¥¼ ë§í•©ë‹ˆë‹¤.
                  </li>
                </ol>
              </div>
            </section>

            {/* ì œ3ì¡° */}
            <section className="space-y-4">
              <h2 className="text-2xl font-bold text-white border-b border-white/20 pb-3">
                ì œ3ì¡° (ì•½ê´€ì˜ íš¨ë ¥ ë° ë³€ê²½)
              </h2>
              <ol className="space-y-3 pl-6">
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘ </span> ì´ ì•½ê´€ì€ ì„œë¹„ìŠ¤ í™”ë©´ì— ê²Œì‹œí•˜ê±°ë‚˜ 
                  ê¸°íƒ€ì˜ ë°©ë²•ìœ¼ë¡œ íšŒì›ì—ê²Œ ê³µì§€í•¨ìœ¼ë¡œì¨ íš¨ë ¥ì´ ë°œìƒí•©ë‹ˆë‹¤.
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘¡</span> íšŒì‚¬ëŠ” í•„ìš”í•œ ê²½ìš° ê´€ë ¨ ë²•ë ¹(ì•½ê´€ì˜ ê·œì œì— 
                  ê´€í•œ ë²•ë¥ , ì •ë³´í†µì‹ ë§ ì´ìš©ì´‰ì§„ ë° ì •ë³´ë³´í˜¸ ë“±ì— ê´€í•œ ë²•ë¥  ë“±)ì„ ìœ„ë°°í•˜ì§€ ì•ŠëŠ” ë²”ìœ„ì—ì„œ 
                  ë³¸ ì•½ê´€ì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘¢</span> ì•½ê´€ì´ ë³€ê²½ë˜ëŠ” ê²½ìš° íšŒì‚¬ëŠ” ë³€ê²½ ì‚¬í•­ì„ 
                  ì‹œí–‰ì¼ 7ì¼ ì „ë¶€í„° ì„œë¹„ìŠ¤ ë‚´ ê³µì§€ì‚¬í•­ì„ í†µí•´ ê³µì§€í•©ë‹ˆë‹¤. ë‹¤ë§Œ, íšŒì›ì—ê²Œ ë¶ˆë¦¬í•œ ì•½ê´€ì˜ ë³€ê²½ì¸ 
                  ê²½ìš°ì—ëŠ” ì‹œí–‰ì¼ 30ì¼ ì „ë¶€í„° ê³µì§€í•˜ë©°, íšŒì›ì˜ ì´ë©”ì¼ë¡œë„ ê°œë³„ í†µì§€í•©ë‹ˆë‹¤.
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘£</span> íšŒì›ì€ ë³€ê²½ëœ ì•½ê´€ì— ë™ì˜í•˜ì§€ ì•Šì„ ê²½ìš° 
                  ì„œë¹„ìŠ¤ ì´ìš©ì„ ì¤‘ë‹¨í•˜ê³  ì´ìš©ê³„ì•½ì„ í•´ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³€ê²½ëœ ì•½ê´€ì˜ íš¨ë ¥ ë°œìƒì¼ ì´í›„ì—ë„ 
                  ì„œë¹„ìŠ¤ë¥¼ ê³„ì† ì´ìš©í•˜ëŠ” ê²½ìš°ì—ëŠ” ì•½ê´€ì˜ ë³€ê²½ì‚¬í•­ì— ë™ì˜í•œ ê²ƒìœ¼ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤.
                </li>
              </ol>
            </section>

            {/* ì œ4ì¡° */}
            <section className="space-y-4">
              <h2 className="text-2xl font-bold text-white border-b border-white/20 pb-3">
                ì œ4ì¡° (ì´ìš©ê³„ì•½ì˜ ì²´ê²°)
              </h2>
              <ol className="space-y-3 pl-6">
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘ </span> ì´ìš©ê³„ì•½ì€ íšŒì›ì´ ë˜ê³ ì í•˜ëŠ” ìê°€ 
                  ì•½ê´€ì˜ ë‚´ìš©ì— ë™ì˜ë¥¼ í•œ ë‹¤ìŒ ì¹´ì¹´ì˜¤ ì†Œì…œ ë¡œê·¸ì¸ì„ í†µí•´ íšŒì›ê°€ì…ì„ ì‹ ì²­í•˜ê³ , 
                  íšŒì‚¬ê°€ ì´ë¥¼ ìŠ¹ë‚™í•¨ìœ¼ë¡œì¨ ì²´ê²°ë©ë‹ˆë‹¤.
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘¡</span> íšŒì‚¬ëŠ” íšŒì›ê°€ì…ì‹ ì²­ìì˜ ì‹ ì²­ì— ëŒ€í•˜ì—¬ 
                  ì„œë¹„ìŠ¤ ì´ìš©ì„ ìŠ¹ë‚™í•¨ì„ ì›ì¹™ìœ¼ë¡œ í•©ë‹ˆë‹¤. ë‹¤ë§Œ, ë‹¤ìŒ ê° í˜¸ì— í•´ë‹¹í•˜ëŠ” ì‹ ì²­ì— ëŒ€í•˜ì—¬ëŠ” 
                  ìŠ¹ë‚™ì„ í•˜ì§€ ì•Šê±°ë‚˜ ì‚¬í›„ì— ì´ìš©ê³„ì•½ì„ í•´ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
                  <ul className="list-disc pl-6 mt-2 space-y-1">
                    <li>ì‹¤ëª…ì´ ì•„ë‹ˆê±°ë‚˜ íƒ€ì¸ì˜ ëª…ì˜ë¥¼ ë„ìš©í•œ ê²½ìš°</li>
                    <li>í—ˆìœ„ì˜ ì •ë³´ë¥¼ ê¸°ì¬í•˜ê±°ë‚˜, íšŒì‚¬ê°€ ì œì‹œí•˜ëŠ” ë‚´ìš©ì„ ê¸°ì¬í•˜ì§€ ì•Šì€ ê²½ìš°</li>
                    <li>ë§Œ 14ì„¸ ë¯¸ë§Œ ë¯¸ì„±ë…„ìê°€ ë²•ì •ëŒ€ë¦¬ì¸ì˜ ë™ì˜ë¥¼ ì–»ì§€ ì•„ë‹ˆí•œ ê²½ìš°</li>
                    <li>ì´ìš©ìì˜ ê·€ì±…ì‚¬ìœ ë¡œ ì¸í•˜ì—¬ ìŠ¹ì¸ì´ ë¶ˆê°€ëŠ¥í•˜ê±°ë‚˜ ê¸°íƒ€ ê·œì •í•œ ì œë°˜ ì‚¬í•­ì„ ìœ„ë°˜í•˜ë©° ì‹ ì²­í•˜ëŠ” ê²½ìš°</li>
                    <li>ì„œë¹„ìŠ¤ ê´€ë ¨ ì„¤ë¹„ì˜ ì—¬ìœ ê°€ ì—†ê±°ë‚˜, ê¸°ìˆ ìƒ ë˜ëŠ” ì—…ë¬´ìƒ ë¬¸ì œê°€ ìˆëŠ” ê²½ìš°</li>
                  </ul>
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘¢</span> íšŒì›ê°€ì…ê³„ì•½ì˜ ì„±ë¦½ ì‹œê¸°ëŠ” íšŒì‚¬ì˜ 
                  ìŠ¹ë‚™ì´ íšŒì›ì—ê²Œ ë„ë‹¬í•œ ì‹œì ìœ¼ë¡œ í•©ë‹ˆë‹¤.
                </li>
              </ol>
            </section>

            {/* ì œ5ì¡° */}
            <section className="space-y-4">
              <h2 className="text-2xl font-bold text-white border-b border-white/20 pb-3">
                ì œ5ì¡° (íšŒì› ì •ë³´ì˜ ì œê³µ ë° ë³€ê²½)
              </h2>
              <ol className="space-y-3 pl-6">
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘ </span> íšŒì›ì€ ì„œë¹„ìŠ¤ ì´ìš©ì„ ìœ„í•´ ë‹¤ìŒì˜ ì •ë³´ë¥¼ 
                  ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤:
                  <ul className="list-disc pl-6 mt-2 space-y-1">
                    <li>í•„ìˆ˜ì •ë³´: ì¹´ì¹´ì˜¤ ê³„ì • ì •ë³´(ì´ë¦„, ì´ë©”ì¼), íœ´ëŒ€í° ë²ˆí˜¸, ì„±ë³„, ì¶œìƒì—°ë„</li>
                    <li>ì„ íƒì •ë³´: í”„ë¡œí•„ ì´ë¯¸ì§€, ì˜ˆì•½ ë©”ëª¨</li>
                  </ul>
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘¡</span> íšŒì›ì€ íšŒì›ê°€ì… ì‹œ ë“±ë¡í•œ ì •ë³´ì— ë³€ê²½ì´ 
                  ìˆëŠ” ê²½ìš°, ì¦‰ì‹œ ì„œë¹„ìŠ¤ ë‚´ ì„¤ì • ë©”ë‰´ë¥¼ í†µí•´ ìˆ˜ì •í•˜ê±°ë‚˜ íšŒì‚¬ì— í†µì§€í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘¢</span> íšŒì›ì´ ì œ2í•­ì˜ ë³€ê²½ì‚¬í•­ì„ ìˆ˜ì •í•˜ì§€ 
                  ì•Šì•„ ë°œìƒí•œ ë¶ˆì´ìµì— ëŒ€í•˜ì—¬ íšŒì‚¬ëŠ” ì±…ì„ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.
                </li>
              </ol>
            </section>

            {/* ì œ6ì¡° */}
            <section className="space-y-4">
              <h2 className="text-2xl font-bold text-white border-b border-white/20 pb-3">
                ì œ6ì¡° (íšŒì›ì˜ ìœ í˜• ë° ê¶Œí•œ)
              </h2>
              <ol className="space-y-3 pl-6">
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘ </span> ì£¼ì£¼ëŠ” ë‹¤ìŒì˜ ê¶Œí•œì„ ê°€ì§‘ë‹ˆë‹¤:
                  <ul className="list-disc pl-6 mt-2 space-y-1">
                    <li>ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ ë¬´ë£Œ ì˜ˆì•½ ë° ì´ìš©</li>
                    <li>ê²ŒìŠ¤íŠ¸ ì´ˆëŒ€ ë° ì˜ˆì•½ ëŒ€ë¦¬</li>
                    <li>ìì‹ ì˜ ì˜ˆì•½ ë‚´ì—­ ì¡°íšŒ ë° ê´€ë¦¬</li>
                  </ul>
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘¡</span> ê²ŒìŠ¤íŠ¸ëŠ” ë‹¤ìŒì˜ ê¶Œí•œì„ ê°€ì§‘ë‹ˆë‹¤:
                  <ul className="list-disc pl-6 mt-2 space-y-1">
                    <li>ì£¼ì£¼ì˜ ì´ˆëŒ€ë¥¼ í†µí•œ ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ ìœ ë£Œ ì˜ˆì•½ ë° ì´ìš©</li>
                    <li>ìì‹ ì˜ ì˜ˆì•½ ë‚´ì—­ ì¡°íšŒ</li>
                  </ul>
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘¢</span> ë§¤ë‹ˆì €ëŠ” ë‹¤ìŒì˜ ê¶Œí•œì„ ê°€ì§‘ë‹ˆë‹¤:
                  <ul className="list-disc pl-6 mt-2 space-y-1">
                    <li>ëª¨ë“  íšŒì›ì˜ ì˜ˆì•½ ë‚´ì—­ ì¡°íšŒ ë° ê´€ë¦¬</li>
                    <li>íšŒì› ì •ë³´ ì—´ëŒ (ê°œì¸ì •ë³´ ë³´í˜¸ë²• ì¤€ìˆ˜ ë²”ìœ„ ë‚´)</li>
                    <li>ì˜ˆì•½ ì·¨ì†Œ ë° ë³€ê²½</li>
                    <li>ìŠ¤í˜ì´ìŠ¤ ì„¤ì • ê´€ë¦¬</li>
                  </ul>
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘£</span> ë¶€ë§¤ë‹ˆì €ëŠ” ë§¤ë‹ˆì €ì˜ ê¶Œí•œ ì¤‘ íšŒì‚¬ê°€ 
                  ì§€ì •í•œ ì œí•œëœ ê¶Œí•œì„ ê°€ì§‘ë‹ˆë‹¤.
                </li>
              </ol>
            </section>

            {/* ì œ7ì¡° */}
            <section className="space-y-4">
              <h2 className="text-2xl font-bold text-white border-b border-white/20 pb-3">
                ì œ7ì¡° (ì˜ˆì•½ ë° ì´ìš©)
              </h2>
              <ol className="space-y-3 pl-6">
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘ </span> íšŒì›ì€ ì„œë¹„ìŠ¤ë¥¼ í†µí•´ ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ 
                  ì´ìš© ì˜ˆì•½ì„ ì‹ ì²­í•  ìˆ˜ ìˆìœ¼ë©°, ì˜ˆì•½ì€ ë‹¤ìŒì˜ ì •ë³´ë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤:
                  <ul className="list-disc pl-6 mt-2 space-y-1">
                    <li>íˆ¬ìˆ™ê° ì´ë¦„ ë° ì—°ë½ì²˜</li>
                    <li>ì²´í¬ì¸ ë° ì²´í¬ì•„ì›ƒ ì¼ì</li>
                    <li>íˆ¬ìˆ™ ì¸ì›</li>
                    <li>ê¸°íƒ€ íŠ¹ì´ì‚¬í•­ (ì„ íƒ)</li>
                  </ul>
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘¡</span> ì˜ˆì•½ ì‹ ì²­ì´ ì™„ë£Œë˜ë©´ íšŒì›ì—ê²Œ ì˜ˆì•½ í™•ì¸ 
                  ì•Œë¦¼í†¡ ë˜ëŠ” SMSê°€ ë°œì†¡ë©ë‹ˆë‹¤.
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘¢</span> ì˜ˆì•½ì˜ ì·¨ì†Œ ë° ë³€ê²½ì€ ë‹¤ìŒê³¼ ê°™ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤:
                  <ul className="list-disc pl-6 mt-2 space-y-1">
                    <li>ì£¼ì£¼ ë° ê²ŒìŠ¤íŠ¸: ì²´í¬ì¸ ì˜ˆì •ì¼ 3ì¼ ì „ê¹Œì§€ ë¬´ë£Œ ì·¨ì†Œ ê°€ëŠ¥</li>
                    <li>ì²´í¬ì¸ ì˜ˆì •ì¼ 3ì¼ ì´ë‚´: ì·¨ì†Œ ìˆ˜ìˆ˜ë£Œ ë¶€ê³¼ ê°€ëŠ¥</li>
                    <li>ë§¤ë‹ˆì € ë° ë¶€ë§¤ë‹ˆì €: ë¶ˆê°€í”¼í•œ ì‚¬ìœ  ë°œìƒ ì‹œ ì˜ˆì•½ ì·¨ì†Œ ê°€ëŠ¥ (ì‚¬ì „ í†µì§€ í•„ìˆ˜)</li>
                  </ul>
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘£</span> ì˜ˆì•½ì´ ì¤‘ë³µë˜ê±°ë‚˜ ì‹œì„¤ ì´ìš©ì´ ë¶ˆê°€ëŠ¥í•œ 
                  ìƒí™©ì´ ë°œìƒí•œ ê²½ìš°, íšŒì‚¬ëŠ” ë¨¼ì € ì˜ˆì•½í•œ íšŒì›ì—ê²Œ ìš°ì„ ê¶Œì„ ë¶€ì—¬í•©ë‹ˆë‹¤.
                </li>
              </ol>
            </section>

            {/* ì œ8ì¡° */}
            <section className="space-y-4">
              <h2 className="text-2xl font-bold text-white border-b border-white/20 pb-3">
                ì œ8ì¡° (ì´ìš© ìš”ê¸ˆ)
              </h2>
              <ol className="space-y-3 pl-6">
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘ </span> ì£¼ì£¼, ë§¤ë‹ˆì €, ë¶€ë§¤ë‹ˆì €ì˜ ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ 
                  ì´ìš©ì€ ë¬´ë£Œì…ë‹ˆë‹¤.
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘¡</span> ê²ŒìŠ¤íŠ¸ì˜ ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ ì´ìš©ì€ ì£¼ì£¼ê°€ 
                  ì •í•œ ìš”ê¸ˆ ì •ì±…ì— ë”°ë¼ ìœ ë£Œë¡œ ì œê³µë©ë‹ˆë‹¤.
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘¢</span> ì´ìš© ìš”ê¸ˆì˜ ê²°ì œ ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
                  <ul className="list-disc pl-6 mt-2 space-y-1">
                    <li>ê³„ì¢Œì´ì²´</li>
                    <li>ê¸°íƒ€ íšŒì‚¬ê°€ ì§€ì •í•˜ëŠ” ê²°ì œ ìˆ˜ë‹¨</li>
                  </ul>
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘£</span> ìš”ê¸ˆ ì •ì±…ì€ ì£¼ì£¼ ê°„ í˜‘ì˜ë¥¼ í†µí•´ 
                  ë³€ê²½ë  ìˆ˜ ìˆìœ¼ë©°, ë³€ê²½ ì‹œ ì‚¬ì „ì— ê³µì§€ë©ë‹ˆë‹¤.
                </li>
              </ol>
            </section>

            {/* ì œ9ì¡° */}
            <section className="space-y-4">
              <h2 className="text-2xl font-bold text-white border-b border-white/20 pb-3">
                ì œ9ì¡° (íšŒì›ì˜ ì˜ë¬´)
              </h2>
              <ol className="space-y-3 pl-6">
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘ </span> íšŒì›ì€ ë‹¤ìŒ ê° í˜¸ì˜ í–‰ìœ„ë¥¼ í•˜ì—¬ì„œëŠ” 
                  ì•ˆ ë©ë‹ˆë‹¤:
                  <ul className="list-disc pl-6 mt-2 space-y-1">
                    <li>íƒ€ì¸ì˜ ì •ë³´ ë„ìš©</li>
                    <li>íšŒì‚¬ ë˜ëŠ” ì œ3ìì˜ ì§€ì‹ì¬ì‚°ê¶Œ ì¹¨í•´</li>
                    <li>íšŒì‚¬ ë˜ëŠ” ì œ3ìì˜ ëª…ì˜ˆë¥¼ ì†ìƒì‹œí‚¤ê±°ë‚˜ ì—…ë¬´ë¥¼ ë°©í•´í•˜ëŠ” í–‰ìœ„</li>
                    <li>ì„œë¹„ìŠ¤ë¥¼ í†µí•´ ì–»ì€ ì •ë³´ì˜ ë¬´ë‹¨ ë³µì œ, ë°°í¬, ìƒì—…ì  ì´ìš©</li>
                    <li>ì™¸ì„¤ ë˜ëŠ” í­ë ¥ì ì¸ ë©”ì‹œì§€, í™”ìƒ, ìŒì„± ë“±ì˜ ê³µê°œ ë˜ëŠ” ê²Œì‹œ</li>
                    <li>íšŒì‚¬ì˜ ë™ì˜ ì—†ì´ ì˜ë¦¬ë¥¼ ëª©ì ìœ¼ë¡œ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” í–‰ìœ„</li>
                    <li>ê¸°íƒ€ ë¶ˆë²•ì ì´ê±°ë‚˜ ë¶€ë‹¹í•œ í–‰ìœ„</li>
                  </ul>
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘¡</span> íšŒì›ì€ ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ ì´ìš© ì‹œ ë‹¤ìŒ ì‚¬í•­ì„ 
                  ì¤€ìˆ˜í•´ì•¼ í•©ë‹ˆë‹¤:
                  <ul className="list-disc pl-6 mt-2 space-y-1">
                    <li>ì‹œì„¤ë¬¼ ë° ë¹„í’ˆì˜ íŒŒì† ë˜ëŠ” ë¶„ì‹¤ ë°©ì§€</li>
                    <li>ì†ŒìŒ ë° ì“°ë ˆê¸° ê´€ë¦¬ ë“± ì´ì›ƒì— ëŒ€í•œ ë°°ë ¤</li>
                    <li>í™”ì¬ ì˜ˆë°© ë° ì•ˆì „ ìˆ˜ì¹™ ì¤€ìˆ˜</li>
                    <li>ë°˜ë ¤ë™ë¬¼ ë™ë°˜ ì‹œ ì‚¬ì „ í˜‘ì˜ ë° í”¼í•´ ë°©ì§€</li>
                  </ul>
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘¢</span> íšŒì›ì´ ì œ1í•­ ë° ì œ2í•­ì„ ìœ„ë°˜í•˜ì—¬ 
                  ë°œìƒí•œ ì†í•´ì— ëŒ€í•´ì„œëŠ” íšŒì›ì´ ì±…ì„ì„ ì§‘ë‹ˆë‹¤.
                </li>
              </ol>
            </section>

            {/* ì œ10ì¡° */}
            <section className="space-y-4">
              <h2 className="text-2xl font-bold text-white border-b border-white/20 pb-3">
                ì œ10ì¡° (íšŒì‚¬ì˜ ì˜ë¬´)
              </h2>
              <ol className="space-y-3 pl-6">
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘ </span> íšŒì‚¬ëŠ” ê´€ë ¨ ë²•ë ¹ê³¼ ë³¸ ì•½ê´€ì´ ê¸ˆì§€í•˜ê±°ë‚˜ 
                  ê³µì„œì–‘ì†ì— ë°˜í•˜ëŠ” í–‰ìœ„ë¥¼ í•˜ì§€ ì•Šìœ¼ë©°, ê³„ì†ì ì´ê³  ì•ˆì •ì ìœ¼ë¡œ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ê¸° ìœ„í•˜ì—¬ 
                  ìµœì„ ì„ ë‹¤í•©ë‹ˆë‹¤.
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘¡</span> íšŒì‚¬ëŠ” íšŒì›ì´ ì•ˆì „í•˜ê²Œ ì„œë¹„ìŠ¤ë¥¼ 
                  ì´ìš©í•  ìˆ˜ ìˆë„ë¡ ê°œì¸ì •ë³´(ì‹ ìš©ì •ë³´ í¬í•¨) ë³´í˜¸ë¥¼ ìœ„í•´ ë³´ì•ˆì‹œìŠ¤í…œì„ ê°–ì¶”ì–´ì•¼ í•˜ë©° 
                  ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ì„ ê³µì‹œí•˜ê³  ì¤€ìˆ˜í•©ë‹ˆë‹¤.
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘¢</span> íšŒì‚¬ëŠ” ì„œë¹„ìŠ¤ ì´ìš©ê³¼ ê´€ë ¨í•˜ì—¬ 
                  íšŒì›ìœ¼ë¡œë¶€í„° ì œê¸°ëœ ì˜ê²¬ì´ë‚˜ ë¶ˆë§Œì´ ì •ë‹¹í•˜ë‹¤ê³  ì¸ì •í•  ê²½ìš° ì´ë¥¼ ì²˜ë¦¬í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤. 
                  íšŒì›ì´ ì œê¸°í•œ ì˜ê²¬ì´ë‚˜ ë¶ˆë§Œì‚¬í•­ì— ëŒ€í•´ì„œëŠ” ê²Œì‹œíŒì„ í™œìš©í•˜ê±°ë‚˜ ì´ë©”ì¼ ë“±ì„ í†µí•˜ì—¬ 
                  íšŒì›ì—ê²Œ ì²˜ë¦¬ê³¼ì • ë° ê²°ê³¼ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤.
                </li>
              </ol>
            </section>

            {/* ì œ11ì¡° */}
            <section className="space-y-4">
              <h2 className="text-2xl font-bold text-white border-b border-white/20 pb-3">
                ì œ11ì¡° (ì„œë¹„ìŠ¤ ì œê³µì˜ ì¤‘ë‹¨)
              </h2>
              <ol className="space-y-3 pl-6">
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘ </span> íšŒì‚¬ëŠ” ë‹¤ìŒ ê° í˜¸ì˜ ê²½ìš°ì— ì„œë¹„ìŠ¤ ì œê³µì„ 
                  ì¼ì‹œì ìœ¼ë¡œ ì¤‘ë‹¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
                  <ul className="list-disc pl-6 mt-2 space-y-1">
                    <li>ì»´í“¨í„° ë“± ì •ë³´í†µì‹ ì„¤ë¹„ì˜ ë³´ìˆ˜ì ê²€, êµì²´ ë° ê³ ì¥, í†µì‹ ì˜ ë‘ì ˆ ë“±ì˜ ì‚¬ìœ ê°€ ë°œìƒí•œ ê²½ìš°</li>
                    <li>ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ”ë° í•„ìš”í•œ ê¸°ê°„í†µì‹ ì‚¬ì—…ìê°€ ì „ê¸°í†µì‹  ì„œë¹„ìŠ¤ë¥¼ ì¤‘ì§€í•œ ê²½ìš°</li>
                    <li>êµ­ê°€ë¹„ìƒì‚¬íƒœ, ì •ì „, ì„œë¹„ìŠ¤ ì„¤ë¹„ì˜ ì¥ì•  ë˜ëŠ” ì„œë¹„ìŠ¤ ì´ìš©ì˜ í­ì£¼ ë“±ìœ¼ë¡œ ì •ìƒì ì¸ ì„œë¹„ìŠ¤ ì œê³µì´ ë¶ˆê°€ëŠ¥í•œ ê²½ìš°</li>
                    <li>ê¸°íƒ€ ë¶ˆê°€í•­ë ¥ì  ì‚¬ìœ ê°€ ìˆëŠ” ê²½ìš°</li>
                  </ul>
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘¡</span> íšŒì‚¬ëŠ” ì œ1í•­ì˜ ì‚¬ìœ ë¡œ ì„œë¹„ìŠ¤ ì œê³µì´ 
                  ì¤‘ë‹¨ëœ ê²½ìš° ì´ë¥¼ ì‚¬ì „ì— í†µì§€í•©ë‹ˆë‹¤. ë‹¤ë§Œ, íšŒì‚¬ê°€ í†µì œí•  ìˆ˜ ì—†ëŠ” ì‚¬ìœ ë¡œ ì¸í•œ ì„œë¹„ìŠ¤ ì¤‘ë‹¨ì˜ 
                  ê²½ìš°ì—ëŠ” ì‚¬í›„ì— í†µì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </li>
              </ol>
            </section>

            {/* ì œ12ì¡° */}
            <section className="space-y-4">
              <h2 className="text-2xl font-bold text-white border-b border-white/20 pb-3">
                ì œ12ì¡° (ê³„ì•½ í•´ì§€ ë° ì´ìš© ì œí•œ)
              </h2>
              <ol className="space-y-3 pl-6">
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘ </span> íšŒì›ì€ ì–¸ì œë“ ì§€ ì„œë¹„ìŠ¤ ë‚´ ì„¤ì • ë©”ë‰´ 
                  ë˜ëŠ” íšŒì‚¬ì— ì—°ë½í•˜ì—¬ ì´ìš©ê³„ì•½ í•´ì§€ë¥¼ ì‹ ì²­í•  ìˆ˜ ìˆìœ¼ë©°, íšŒì‚¬ëŠ” ê´€ë ¨ ë²•ë ¹ ë“±ì´ ì •í•˜ëŠ” ë°”ì— 
                  ë”°ë¼ ì´ë¥¼ ì¦‰ì‹œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘¡</span> íšŒì›ì´ ê³„ì•½ì„ í•´ì§€í•˜ëŠ” ê²½ìš°, ê´€ë ¨ë²• 
                  ë° ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ì— ë”°ë¼ íšŒì‚¬ê°€ íšŒì›ì •ë³´ë¥¼ ë³´ìœ í•˜ëŠ” ê²½ìš°ë¥¼ ì œì™¸í•˜ê³ ëŠ” í•´ì§€ ì¦‰ì‹œ íšŒì›ì˜ 
                  ëª¨ë“  ë°ì´í„°ëŠ” ì†Œë©¸ë©ë‹ˆë‹¤.
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘¢</span> íšŒì‚¬ëŠ” íšŒì›ì´ ë‹¤ìŒ ê° í˜¸ì˜ ì‚¬ìœ ì— 
                  í•´ë‹¹í•˜ëŠ” ê²½ìš° ì‚¬ì „ í†µë³´ í›„ ì´ìš©ê³„ì•½ì„ í•´ì§€í•˜ê±°ë‚˜ ì¼ì • ê¸°ê°„ ì„œë¹„ìŠ¤ ì´ìš©ì„ ì œí•œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
                  <ul className="list-disc pl-6 mt-2 space-y-1">
                    <li>íƒ€ì¸ì˜ ëª…ì˜ë¥¼ ë„ìš©í•œ ê²½ìš°</li>
                    <li>ì„œë¹„ìŠ¤ ìš´ì˜ì„ ê³ ì˜ë¡œ ë°©í•´í•œ ê²½ìš°</li>
                    <li>ê°€ì… ì‹ ì²­ ì‹œ í—ˆìœ„ ë‚´ìš©ì„ ë“±ë¡í•œ ê²½ìš°</li>
                    <li>ë³¸ ì•½ê´€ì„ í¬í•¨í•˜ì—¬ ê¸°íƒ€ íšŒì‚¬ê°€ ì •í•œ ì´ìš©ì¡°ê±´ì— ìœ„ë°˜í•œ ê²½ìš°</li>
                  </ul>
                </li>
              </ol>
            </section>

            {/* ì œ13ì¡° */}
            <section className="space-y-4">
              <h2 className="text-2xl font-bold text-white border-b border-white/20 pb-3">
                ì œ13ì¡° (ì†í•´ë°°ìƒ)
              </h2>
              <ol className="space-y-3 pl-6">
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘ </span> íšŒì‚¬ëŠ” ì„œë¹„ìŠ¤ì™€ ê´€ë ¨í•˜ì—¬ íšŒì›ì—ê²Œ 
                  ì–´ë– í•œ ì†í•´ê°€ ë°œìƒí•˜ë”ë¼ë„ íšŒì‚¬ì˜ ê³ ì˜ ë˜ëŠ” ì¤‘ê³¼ì‹¤ì— ì˜í•œ ê²½ìš°ë¥¼ ì œì™¸í•˜ê³ ëŠ” ì´ì— ëŒ€í•˜ì—¬ 
                  ì±…ì„ì„ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘¡</span> íšŒì›ì´ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•¨ì— ìˆì–´ 
                  í–‰í•œ ë¶ˆë²•í–‰ìœ„ë‚˜ ë³¸ ì•½ê´€ ìœ„ë°˜í–‰ìœ„ë¡œ ì¸í•˜ì—¬ íšŒì‚¬ê°€ ë‹¹í•´ íšŒì› ì´ì™¸ì˜ ì œ3ìë¡œë¶€í„° ì†í•´ë°°ìƒ 
                  ì²­êµ¬ ë˜ëŠ” ì†Œì†¡ì„ ë¹„ë¡¯í•œ ê°ì¢… ì´ì˜ì œê¸°ë¥¼ ë°›ëŠ” ê²½ìš° ë‹¹í•´ íšŒì›ì€ ìì‹ ì˜ ì±…ì„ê³¼ ë¹„ìš©ìœ¼ë¡œ 
                  íšŒì‚¬ë¥¼ ë©´ì±…ì‹œì¼œì•¼ í•˜ë©°, íšŒì‚¬ê°€ ë©´ì±…ë˜ì§€ ëª»í•œ ê²½ìš° ë‹¹í•´ íšŒì›ì€ ê·¸ë¡œ ì¸í•˜ì—¬ íšŒì‚¬ì— ë°œìƒí•œ 
                  ëª¨ë“  ì†í•´ë¥¼ ë°°ìƒí•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.
                </li>
              </ol>
            </section>

            {/* ì œ14ì¡° */}
            <section className="space-y-4">
              <h2 className="text-2xl font-bold text-white border-b border-white/20 pb-3">
                ì œ14ì¡° (ë©´ì±…ì¡°í•­)
              </h2>
              <ol className="space-y-3 pl-6">
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘ </span> íšŒì‚¬ëŠ” ì²œì¬ì§€ë³€, ì „ìŸ, ê¸°ê°„í†µì‹ ì‚¬ì—…ìì˜ 
                  ì„œë¹„ìŠ¤ ì¤‘ì§€ ë˜ëŠ” ì´ì— ì¤€í•˜ëŠ” ë¶ˆê°€í•­ë ¥ìœ¼ë¡œ ì¸í•˜ì—¬ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•  ìˆ˜ ì—†ëŠ” ê²½ìš°ì—ëŠ” 
                  ì„œë¹„ìŠ¤ ì œê³µì— ê´€í•œ ì±…ì„ì´ ë©´ì œë©ë‹ˆë‹¤.
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘¡</span> íšŒì‚¬ëŠ” íšŒì›ì˜ ê·€ì±…ì‚¬ìœ ë¡œ ì¸í•œ 
                  ì„œë¹„ìŠ¤ ì´ìš©ì˜ ì¥ì• ì— ëŒ€í•˜ì—¬ëŠ” ì±…ì„ì„ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘¢</span> íšŒì‚¬ëŠ” íšŒì›ì´ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì—¬ 
                  ê¸°ëŒ€í•˜ëŠ” ìˆ˜ìµì„ ì–»ì§€ ëª»í•œ ê²ƒì— ëŒ€í•˜ì—¬ ì±…ì„ì„ ì§€ì§€ ì•Šìœ¼ë©°, ì„œë¹„ìŠ¤ë¥¼ í†µí•˜ì—¬ ì–»ì€ ìë£Œë¡œ 
                  ì¸í•œ ì†í•´ì— ê´€í•˜ì—¬ ì±…ì„ì„ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘£</span> íšŒì‚¬ëŠ” íšŒì› ìƒí˜¸ê°„ ë˜ëŠ” íšŒì›ê³¼ 
                  ì œ3ì ìƒí˜¸ê°„ì— ì„œë¹„ìŠ¤ë¥¼ ë§¤ê°œë¡œ ë°œìƒí•œ ë¶„ìŸì— ëŒ€í•´ì„œëŠ” ê°œì…í•  ì˜ë¬´ê°€ ì—†ìœ¼ë©° ì´ë¡œ ì¸í•œ 
                  ì†í•´ë¥¼ ë°°ìƒí•  ì±…ì„ë„ ì—†ìŠµë‹ˆë‹¤.
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘¤</span> íšŒì‚¬ëŠ” ë¬´ë£Œë¡œ ì œê³µë˜ëŠ” ì„œë¹„ìŠ¤ 
                  ì´ìš©ê³¼ ê´€ë ¨í•˜ì—¬ ê´€ë ¨ ë²•ë ¹ì— íŠ¹ë³„í•œ ê·œì •ì´ ì—†ëŠ” í•œ ì±…ì„ì„ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.
                </li>
              </ol>
            </section>

            {/* ì œ15ì¡° */}
            <section className="space-y-4">
              <h2 className="text-2xl font-bold text-white border-b border-white/20 pb-3">
                ì œ15ì¡° (ë¶„ìŸ í•´ê²°)
              </h2>
              <ol className="space-y-3 pl-6">
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘ </span> íšŒì‚¬ëŠ” íšŒì›ìœ¼ë¡œë¶€í„° ì œì¶œë˜ëŠ” ë¶ˆë§Œì‚¬í•­ 
                  ë° ì˜ê²¬ì„ ìš°ì„ ì ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤. ë‹¤ë§Œ, ì‹ ì†í•œ ì²˜ë¦¬ê°€ ê³¤ë€í•œ ê²½ìš°ì—ëŠ” íšŒì›ì—ê²Œ ê·¸ ì‚¬ìœ ì™€ 
                  ì²˜ë¦¬ì¼ì •ì„ ì¦‰ì‹œ í†µë³´í•©ë‹ˆë‹¤.
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘¡</span> íšŒì‚¬ì™€ íšŒì› ê°„ ë°œìƒí•œ ë¶„ìŸì€ 
                  ì „ìë¬¸ì„œ ë° ì „ìê±°ë˜ ê¸°ë³¸ë²•ì— ì˜í•´ ì„¤ì¹˜ëœ ì „ìë¬¸ì„œÂ·ì „ìê±°ë˜ë¶„ìŸì¡°ì •ìœ„ì›íšŒì˜ ì¡°ì •ì— ë”°ë¥¼ 
                  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </li>
              </ol>
            </section>

            {/* ì œ16ì¡° */}
            <section className="space-y-4">
              <h2 className="text-2xl font-bold text-white border-b border-white/20 pb-3">
                ì œ16ì¡° (ì¤€ê±°ë²• ë° ê´€í• ë²•ì›)
              </h2>
              <ol className="space-y-3 pl-6">
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘ </span> ë³¸ ì•½ê´€ì€ ëŒ€í•œë¯¼êµ­ ë²•ë¥ ì— ë”°ë¼ 
                  ê·œìœ¨ë˜ê³  í•´ì„ë©ë‹ˆë‹¤.
                </li>
                <li className="text-gray-300">
                  <span className="font-semibold text-white">â‘¡</span> íšŒì‚¬ì™€ íšŒì› ê°„ ë°œìƒí•œ ë¶„ìŸì— ê´€í•œ 
                  ì†Œì†¡ì€ ë¯¼ì‚¬ì†Œì†¡ë²•ìƒì˜ ê´€í• ë²•ì›ì— ì œê¸°í•©ë‹ˆë‹¤.
                </li>
              </ol>
            </section>

            {/* ë¶€ì¹™ */}
            <section className="space-y-4 pt-4 border-t border-white/20">
              <h2 className="text-2xl font-bold text-white">ë¶€ì¹™</h2>
              <div className="bg-gradient-to-r from-blue-500/20 to-purple-500/20 rounded-lg p-6 border border-white/20">
                <div className="space-y-2 text-gray-300">
                  <p><span className="font-semibold text-white">ì œ1ì¡° (ì‹œí–‰ì¼)</span></p>
                  <p>ë³¸ ì•½ê´€ì€ 2024ë…„ 12ì›” 25ì¼ë¶€í„° ì‹œí–‰ë©ë‹ˆë‹¤.</p>
                  <p className="mt-4"><span className="font-semibold text-white">ì œ2ì¡° (ê²½ê³¼ì¡°ì¹˜)</span></p>
                  <p>ë³¸ ì•½ê´€ ì‹œí–‰ ì „ì— ê°€ì…í•œ íšŒì›ì— ëŒ€í•´ì„œë„ ë³¸ ì•½ê´€ì´ ì ìš©ë©ë‹ˆë‹¤.</p>
                </div>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>
  );
};

export default TermsOfServicePage;
</file>

<file path="src/pages/TransferManagerPage.jsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { collection, getDocs, doc, updateDoc, writeBatch } from 'firebase/firestore';
import { db } from '../config/firebase';
import useStore from '../store/useStore';
import { USER_TYPES, USER_TYPE_LABELS } from '../utils/constants';
import { canManageSpace } from '../utils/permissions';
import { ArrowLeft, ShieldAlert, Crown, AlertTriangle } from 'lucide-react';

export default function TransferManagerPage() {
  const navigate = useNavigate();
  const { user, selectedSpace } = useStore();
  const [members, setMembers] = useState([]);
  const [loading, setLoading] = useState(true);
  const [transferring, setTransferring] = useState(false);
  const [selectedMember, setSelectedMember] = useState(null);
  const [confirmationStep, setConfirmationStep] = useState(0);

  // ê¶Œí•œ ì²´í¬ - ë§¤ë‹ˆì €ë§Œ ì ‘ê·¼ ê°€ëŠ¥
  useEffect(() => {
    if (!user || !selectedSpace) {
      alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
      navigate('/');
      return;
    }

    const spaceId = selectedSpace.id || selectedSpace.spaceId;
    const userSpaceData = user.spaceAccess?.find(s => s.spaceId === spaceId);
    
    // ë§¤ë‹ˆì €ë§Œ ê¶Œí•œ ì–‘ë„ ê°€ëŠ¥
    if (!userSpaceData || userSpaceData.userType !== USER_TYPES.MANAGER) {
      alert('ë§¤ë‹ˆì €ë§Œ ê¶Œí•œì„ ì–‘ë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      navigate('/space/manage');
      return;
    }
  }, [user, selectedSpace, navigate]);

  // ë©¤ë²„ ëª©ë¡ ë¡œë“œ (ë³¸ì¸ ì œì™¸)
  useEffect(() => {
    if (!selectedSpace?.id) return;
    loadMembers();
  }, [selectedSpace]);

  const loadMembers = async () => {
    try {
      setLoading(true);
      const spaceId = selectedSpace.id || selectedSpace.spaceId;
      
      const assignedUsersRef = collection(db, `spaces/${spaceId}/assignedUsers`);
      const snapshot = await getDocs(assignedUsersRef);
      
      const memberList = [];
      snapshot.forEach(doc => {
        // ë³¸ì¸ ì œì™¸
        if (doc.id === user.id) return;
        
        const data = doc.data();
        memberList.push({
          userId: doc.id,
          displayName: data.displayName || 'ì´ë¦„ ì—†ìŒ',
          email: data.email || '',
          userType: data.userType || 'guest',
          profileImage: data.profileImage || ''
        });
      });

      // ë¶€ë§¤ë‹ˆì €, ì£¼ì£¼ ìš°ì„  ì •ë ¬
      memberList.sort((a, b) => {
        const order = {
          [USER_TYPES.VICE_MANAGER]: 1,
          [USER_TYPES.SHAREHOLDER]: 2,
          [USER_TYPES.GUEST]: 3
        };
        return (order[a.userType] || 99) - (order[b.userType] || 99);
      });

      setMembers(memberList);
    } catch (error) {
      console.error('ë©¤ë²„ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
      alert('ë©¤ë²„ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setLoading(false);
    }
  };

  // ê¶Œí•œ ì–‘ë„ ì‹¤í–‰
  const handleTransfer = async () => {
    if (!selectedMember) return;

    try {
      setTransferring(true);
      const spaceId = selectedSpace.id || selectedSpace.spaceId;

      console.log('ğŸ‘‘ ë§¤ë‹ˆì € ê¶Œí•œ ì–‘ë„ ì‹œì‘:', {
        from: user.id,
        to: selectedMember.userId,
        spaceId
      });

      const batch = writeBatch(db);

      // 1. ìƒˆ ë§¤ë‹ˆì €ë¡œ ê¶Œí•œ ë³€ê²½
      const newManagerSpaceRef = doc(db, `spaces/${spaceId}/assignedUsers`, selectedMember.userId);
      batch.update(newManagerSpaceRef, {
        userType: USER_TYPES.MANAGER
      });

      const newManagerUserRef = doc(db, `users/${selectedMember.userId}/spaceAccess`, spaceId);
      batch.update(newManagerUserRef, {
        userType: USER_TYPES.MANAGER,
        updatedAt: new Date().toISOString()
      });

      // 2. ê¸°ì¡´ ë§¤ë‹ˆì €ë¥¼ ë¶€ë§¤ë‹ˆì €ë¡œ ë³€ê²½
      const oldManagerSpaceRef = doc(db, `spaces/${spaceId}/assignedUsers`, user.id);
      batch.update(oldManagerSpaceRef, {
        userType: USER_TYPES.VICE_MANAGER
      });

      const oldManagerUserRef = doc(db, `users/${user.id}/spaceAccess`, spaceId);
      batch.update(oldManagerUserRef, {
        userType: USER_TYPES.VICE_MANAGER,
        updatedAt: new Date().toISOString()
      });

      await batch.commit();

      console.log('âœ… ë§¤ë‹ˆì € ê¶Œí•œ ì–‘ë„ ì™„ë£Œ');

      alert(`${selectedMember.displayName}ë‹˜ì—ê²Œ ë§¤ë‹ˆì € ê¶Œí•œì´ ì–‘ë„ë˜ì—ˆìŠµë‹ˆë‹¤.\n\në‹¹ì‹ ì€ ì´ì œ ë¶€ë§¤ë‹ˆì €ì…ë‹ˆë‹¤.`);
      
      // í™ˆìœ¼ë¡œ ì´ë™ (ê¶Œí•œì´ ë³€ê²½ë˜ì—ˆìœ¼ë¯€ë¡œ)
      navigate('/');
      
      // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ê¶Œí•œ ì¬í™•ì¸
      setTimeout(() => {
        window.location.reload();
      }, 500);

    } catch (error) {
      console.error('âŒ ê¶Œí•œ ì–‘ë„ ì‹¤íŒ¨:', error);
      alert('ê¶Œí•œ ì–‘ë„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
      setTransferring(false);
    }
  };

  // í™•ì¸ ë‹¨ê³„ë³„ ë©”ì‹œì§€
  const getConfirmationMessage = () => {
    if (confirmationStep === 1) {
      return `ì •ë§ë¡œ ${selectedMember?.displayName}ë‹˜ì—ê²Œ ë§¤ë‹ˆì € ê¶Œí•œì„ ì–‘ë„í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
    }
    if (confirmationStep === 2) {
      return `âš ï¸ ìµœì¢… í™•ì¸\n\në§¤ë‹ˆì € ê¶Œí•œì„ ì–‘ë„í•˜ë©´:\nâ€¢ ë‹¹ì‹ ì€ ë¶€ë§¤ë‹ˆì €ë¡œ ë³€ê²½ë©ë‹ˆë‹¤\nâ€¢ ìŠ¤í˜ì´ìŠ¤ ê´€ë¦¬ ê¶Œí•œì´ ì œí•œë©ë‹ˆë‹¤\nâ€¢ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤\n\nê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
    }
    return '';
  };

  const handleConfirm = () => {
    if (confirmationStep === 0) {
      if (!selectedMember) {
        alert('ì–‘ë„ë°›ì„ ë©¤ë²„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      setConfirmationStep(1);
    } else if (confirmationStep === 1) {
      if (window.confirm(getConfirmationMessage())) {
        setConfirmationStep(2);
      }
    } else if (confirmationStep === 2) {
      if (window.confirm(getConfirmationMessage())) {
        handleTransfer();
      }
    }
  };

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900">
        <div className="text-center">
          <div className="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-slate-300">ë©¤ë²„ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 pb-20">
      {/* í—¤ë” */}
      <div className="bg-gradient-to-r from-slate-800 to-slate-700 border-b border-slate-600/30 sticky top-0 z-10 shadow-lg">
        <div className="max-w-2xl mx-auto px-4 py-4">
          <div className="flex items-center gap-3">
            <button
              onClick={() => navigate('/space/manage')}
              className="p-2 hover:bg-white/10 rounded-lg transition-colors"
            >
              <ArrowLeft className="w-5 h-5 text-white" />
            </button>
            <div>
              <h1 className="text-xl font-bold text-white flex items-center gap-2">
                <Crown className="w-5 h-5 text-yellow-400" />
                ë§¤ë‹ˆì € ê¶Œí•œ ì–‘ë„
              </h1>
              <p className="text-sm text-slate-300">{selectedSpace?.spaceName || ''}</p>
            </div>
          </div>
        </div>
      </div>

      {/* ê²½ê³  ë©”ì‹œì§€ */}
      <div className="max-w-2xl mx-auto px-4 py-6">
        <div className="bg-red-500/10 border border-red-500/30 rounded-xl p-4 mb-6">
          <div className="flex items-start gap-3">
            <AlertTriangle className="w-5 h-5 text-red-400 flex-shrink-0 mt-0.5" />
            <div className="text-sm text-red-300">
              <p className="font-medium mb-2">âš ï¸ ì¤‘ìš”í•œ ì•ˆë‚´</p>
              <ul className="space-y-1 text-red-200/80">
                <li>â€¢ ë§¤ë‹ˆì € ê¶Œí•œì„ ì–‘ë„í•˜ë©´ ë‹¹ì‹ ì€ <strong>ë¶€ë§¤ë‹ˆì €</strong>ë¡œ ë³€ê²½ë©ë‹ˆë‹¤.</li>
                <li>â€¢ ì´ ì‘ì—…ì€ <strong>ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</strong>.</li>
                <li>â€¢ ì‹ ì¤‘í•˜ê²Œ ì„ íƒí•´ì£¼ì„¸ìš”.</li>
              </ul>
            </div>
          </div>
        </div>

        {/* ë©¤ë²„ ì„ íƒ */}
        <div className="mb-6">
          <h2 className="text-lg font-semibold text-white mb-3">
            ìƒˆë¡œìš´ ë§¤ë‹ˆì € ì„ íƒ
          </h2>
          
          {members.length === 0 ? (
            <div className="bg-slate-800/50 border border-slate-600/30 rounded-xl p-8 text-center">
              <ShieldAlert className="w-12 h-12 text-slate-400 mx-auto mb-3" />
              <p className="text-slate-300">ì–‘ë„í•  ìˆ˜ ìˆëŠ” ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
              <p className="text-sm text-slate-400 mt-2">
                ë¨¼ì € ë©¤ë²„ë¥¼ ì´ˆëŒ€í•˜ê±°ë‚˜ ì¶”ê°€í•´ì£¼ì„¸ìš”.
              </p>
            </div>
          ) : (
            <div className="space-y-3">
              {members.map((member) => (
                <button
                  key={member.userId}
                  onClick={() => setSelectedMember(member)}
                  className={`w-full bg-gradient-to-br from-slate-800/80 to-slate-700/50 backdrop-blur-sm border rounded-xl p-4 shadow-lg transition-all ${
                    selectedMember?.userId === member.userId
                      ? 'border-blue-500 ring-2 ring-blue-500/50'
                      : 'border-slate-600/30 hover:border-slate-500/50'
                  }`}
                >
                  <div className="flex items-center gap-3">
                    {/* í”„ë¡œí•„ */}
                    {member.profileImage ? (
                      <img
                        src={member.profileImage}
                        alt={member.displayName}
                        className="w-12 h-12 rounded-full object-cover"
                      />
                    ) : (
                      <div className="w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-lg">
                        {member.displayName.charAt(0)}
                      </div>
                    )}

                    {/* ì •ë³´ */}
                    <div className="flex-1 text-left">
                      <h3 className="font-semibold text-white">
                        {member.displayName}
                      </h3>
                      {member.email && (
                        <p className="text-sm text-slate-400">{member.email}</p>
                      )}
                    </div>

                    {/* í˜„ì¬ ê¶Œí•œ */}
                    <div className={`px-3 py-1.5 rounded-lg text-sm font-medium ${
                      member.userType === USER_TYPES.VICE_MANAGER
                        ? 'bg-orange-500/20 text-orange-300 border border-orange-500/30'
                        : member.userType === USER_TYPES.SHAREHOLDER
                        ? 'bg-blue-500/20 text-blue-300 border border-blue-500/30'
                        : 'bg-slate-500/20 text-slate-300 border border-slate-500/30'
                    }`}>
                      {USER_TYPE_LABELS[member.userType]}
                    </div>

                    {/* ì„ íƒ í‘œì‹œ */}
                    {selectedMember?.userId === member.userId && (
                      <div className="w-6 h-6 rounded-full bg-blue-500 flex items-center justify-center">
                        <Crown className="w-4 h-4 text-white" />
                      </div>
                    )}
                  </div>
                </button>
              ))}
            </div>
          )}
        </div>

        {/* í™•ì¸ ë‹¨ê³„ í‘œì‹œ */}
        {confirmationStep > 0 && selectedMember && (
          <div className="mb-6 bg-yellow-500/10 border border-yellow-500/30 rounded-xl p-4">
            <p className="text-yellow-300 text-sm">
              <strong>í™•ì¸ ë‹¨ê³„ {confirmationStep}/2</strong>
              <br />
              {selectedMember.displayName}ë‹˜ì„ ìƒˆ ë§¤ë‹ˆì €ë¡œ ì„ íƒí–ˆìŠµë‹ˆë‹¤.
            </p>
          </div>
        )}

        {/* ì‹¤í–‰ ë²„íŠ¼ */}
        <button
          onClick={handleConfirm}
          disabled={!selectedMember || transferring}
          className="w-full px-6 py-4 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-xl font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
        >
          {transferring ? (
            <>
              <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
              <span>ê¶Œí•œ ì–‘ë„ ì¤‘...</span>
            </>
          ) : (
            <>
              <Crown className="w-5 h-5" />
              <span>
                {confirmationStep === 0 && 'ê³„ì†í•˜ê¸°'}
                {confirmationStep === 1 && 'ë‹¤ìŒ ë‹¨ê³„'}
                {confirmationStep === 2 && 'ìµœì¢… í™•ì¸ ë° ì–‘ë„'}
              </span>
            </>
          )}
        </button>

        {/* ì·¨ì†Œ ë²„íŠ¼ */}
        {confirmationStep > 0 && (
          <button
            onClick={() => setConfirmationStep(0)}
            disabled={transferring}
            className="w-full mt-3 px-6 py-3 bg-slate-600/50 hover:bg-slate-600/70 text-white rounded-xl font-medium transition-colors disabled:opacity-50"
          >
            ì²˜ìŒë¶€í„° ë‹¤ì‹œ
          </button>
        )}

        {/* ì•ˆë‚´ */}
        <div className="mt-6 bg-blue-500/10 border border-blue-500/30 rounded-xl p-4">
          <div className="text-sm text-blue-300">
            <p className="font-medium mb-2">ğŸ’¡ ê¶Œí•œ ì–‘ë„ ì•ˆë‚´</p>
            <ul className="space-y-1 text-blue-200/80">
              <li>â€¢ ì–‘ë„ í›„ì—ëŠ” ìƒˆ ë§¤ë‹ˆì €ë§Œ ë‹¤ì‹œ ê¶Œí•œì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
              <li>â€¢ ë¶€ë§¤ë‹ˆì €ë¡œ ë³€ê²½ë˜ë©´ ì¼ë¶€ ê´€ë¦¬ ê¸°ëŠ¥ì´ ì œí•œë©ë‹ˆë‹¤.</li>
              <li>â€¢ ì–‘ë„ í›„ ì¦‰ì‹œ ì ìš©ë˜ë©°, í˜ì´ì§€ê°€ ìƒˆë¡œê³ ì¹¨ë©ë‹ˆë‹¤.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/UserGuidePage.jsx">
// src/pages/UserGuidePage.jsx
import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import {
  ChevronLeft,
  Calendar,
  Heart,
  Receipt,
  Wallet,
  Bell,
  UserCheck,
  CheckCircle2,
  XCircle,
  ChevronRight,
  Mail,
  Users
} from 'lucide-react';

const UserGuidePage = () => {
  const navigate = useNavigate();
  const [expandedSection, setExpandedSection] = useState(null);

  const toggleSection = (id) => {
    setExpandedSection(expandedSection === id ? null : id);
  };

  const guides = [
    {
      id: 'start',
      icon: UserCheck,
      title: 'ì‹œì‘í•˜ê¸°',
      color: 'blue',
      steps: [
        {
          title: '1. ì´ˆëŒ€ ì½”ë“œ ë°›ê¸°',
          content: 'ë¼ìš´ì§€ ê´€ë¦¬ìë¡œë¶€í„° ì´ˆëŒ€ ë§í¬ë¥¼ ë°›ìœ¼ì„¸ìš”. ì¹´ì¹´ì˜¤í†¡ì´ë‚˜ ë¬¸ìë¡œ ê³µìœ ë©ë‹ˆë‹¤.'
        },
        {
          title: '2. ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸',
          content: 'ì´ˆëŒ€ ë§í¬ë¥¼ í´ë¦­í•˜ë©´ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í™”ë©´ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. ì¹´ì¹´ì˜¤ ê³„ì •ìœ¼ë¡œ ê°„í¸í•˜ê²Œ ê°€ì…í•  ìˆ˜ ìˆì–´ìš”.'
        },
        {
          title: '3. í”„ë¡œí•„ ë“±ë¡',
          content: 'ì´ë¦„, ì„±ë³„, ìƒë…„ ë“± ê¸°ë³¸ ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´ ê°€ì…ì´ ì™„ë£Œë©ë‹ˆë‹¤.'
        },
        {
          title: '4. ë¼ìš´ì§€ ì…ì¥',
          content: 'ìë™ìœ¼ë¡œ ë¼ìš´ì§€ì— ì…ì¥ë˜ë©°, ë°”ë¡œ ì˜ˆì•½ê³¼ ë‹¤ë¥¸ ê¸°ëŠ¥ë“¤ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
        }
      ]
    },
    {
      id: 'reservation',
      icon: Calendar,
      title: 'ì˜ˆì•½í•˜ê¸°',
      color: 'green',
      steps: [
        {
          title: 'ì˜ˆì•½ í™”ë©´ í™•ì¸',
          content: 'í•˜ë‹¨ ë©”ë‰´ì˜ "ì¼ì •" íƒ­ì„ ëˆ„ë¥´ë©´ ì£¼ê°„ ì˜ˆì•½ í˜„í™©ì„ ë³¼ ìˆ˜ ìˆì–´ìš”. ë¦¬ìŠ¤íŠ¸í˜•ê³¼ ë‹¬ë ¥í˜• ë‘ ê°€ì§€ ë³´ê¸°ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.'
        },
        {
          title: 'ë‚ ì§œ ì„ íƒ',
          content: 'ì›í•˜ëŠ” ë‚ ì§œë¥¼ í´ë¦­í•˜ì„¸ìš”. ì´ë¯¸ ì˜ˆì•½ì´ ìˆëŠ” ë‚ ì§œëŠ” ì˜ˆì•½ì ìˆ˜ì™€ ì„±ë³„ ë¶„í¬ê°€ í‘œì‹œë©ë‹ˆë‹¤.'
        },
        {
          title: 'ì˜ˆì•½ ë“±ë¡',
          content: 'ë‚ ì§œë¥¼ ì„ íƒí•˜ë©´ ì˜ˆì•½ í™•ì¸ ì°½ì´ ë‚˜íƒ€ë‚˜ìš”. "ì˜ˆì•½í•˜ê¸°" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì™„ë£Œ!'
        },
        {
          title: 'ë‚´ ì˜ˆì•½ í™•ì¸',
          content: 'ë‚´ê°€ ì˜ˆì•½í•œ ë‚ ì§œëŠ” ë…¹ìƒ‰ìœ¼ë¡œ í‘œì‹œë˜ê³ , ë¦¬ìŠ¤íŠ¸ì—ì„œ í•­ìƒ ë§¨ ì•ì— ë‚˜íƒ€ë‚©ë‹ˆë‹¤.'
        },
        {
          title: 'ì˜ˆì•½ ì·¨ì†Œ',
          content: 'ì´ë¯¸ ì˜ˆì•½í•œ ë‚ ì§œë¥¼ ë‹¤ì‹œ í´ë¦­í•˜ë©´ "ì˜ˆì•½ ì·¨ì†Œ" ë²„íŠ¼ì´ ë‚˜íƒ€ë‚˜ìš”. ì–¸ì œë“  ì·¨ì†Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
        }
      ]
    },
    {
      id: 'praise',
      icon: Heart,
      title: 'ì¹­ì°¬í•˜ê¸°',
      color: 'pink',
      steps: [
        {
          title: 'ì¹­ì°¬ íƒ­ ì´ë™',
          content: 'í•˜ë‹¨ ë©”ë‰´ì—ì„œ í•˜íŠ¸ ì•„ì´ì½˜ì˜ "ì¹­ì°¬" íƒ­ì„ ì„ íƒí•˜ì„¸ìš”.'
        },
        {
          title: 'ì¹­ì°¬ ëŒ€ìƒ ì„ íƒ',
          content: 'ê°™ì€ ë¼ìš´ì§€ ë©¤ë²„ ì¤‘ ì¹­ì°¬í•˜ê³  ì‹¶ì€ ì‚¬ëŒì„ ì„ íƒí•˜ì„¸ìš”. ì—¬ëŸ¬ ëª…ì„ ë™ì‹œì— ì„ íƒí•  ìˆ˜ ìˆì–´ìš”.'
        },
        {
          title: 'ì¹­ì°¬ ë‚´ìš© ì‘ì„±',
          content: 'ì¹­ì°¬ ë©”ì‹œì§€ë¥¼ ììœ ë¡­ê²Œ ì‘ì„±í•˜ì„¸ìš”. ì§§ì€ í•œ ë§ˆë””ë„, ê¸´ ê°ì‚¬ ì¸ì‚¬ë„ ì¢‹ì•„ìš”!'
        },
        {
          title: 'ì¹­ì°¬ ë³´ë‚´ê¸°',
          content: '"ë³´ë‚´ê¸°" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì¹­ì°¬ì´ ì „ë‹¬ë©ë‹ˆë‹¤. ë°›ëŠ” ì‚¬ëŒì—ê²Œ ì´ë©”ì¼ ì•Œë¦¼ë„ ê°ˆ ìˆ˜ ìˆì–´ìš”.'
        },
        {
          title: 'ë°›ì€ ì¹­ì°¬ í™•ì¸',
          content: 'ì¹­ì°¬ í˜ì´ì§€ ìƒë‹¨ì—ì„œ ë‚´ê°€ ë°›ì€ ì¹­ì°¬ ê°œìˆ˜ì™€ ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
        }
      ]
    },
    {
      id: 'settlement',
      icon: Receipt,
      title: 'ì •ì‚° í™•ì¸',
      color: 'purple',
      steps: [
        {
          title: 'ì •ì‚° íƒ­ ì´ë™',
          content: 'í•˜ë‹¨ ë©”ë‰´ì˜ "ì •ì‚°" íƒ­ì„ ì„ íƒí•˜ë©´ ì£¼ê°„ ì •ì‚° ë‚´ì—­ì„ ë³¼ ìˆ˜ ìˆì–´ìš”.'
        },
        {
          title: 'ì£¼ê°„ ì •ì‚° í™•ì¸',
          content: 'ì›”ìš”ì¼ë¶€í„° ì¼ìš”ì¼ê¹Œì§€ í•œ ì£¼ ë‹¨ìœ„ë¡œ ì •ì‚°ì´ ì§„í–‰ë©ë‹ˆë‹¤. ì¢Œìš° í™”ì‚´í‘œë¡œ ì´ì „/ë‹¤ìŒ ì£¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.'
        },
        {
          title: 'ë‚´ ì •ì‚° ê¸ˆì•¡',
          content: 'ìƒë‹¨ ì¹´ë“œì—ì„œ ë‚´ê°€ ë‚¸ ê¸ˆì•¡, ì¨ì•¼ í•  ê¸ˆì•¡, ìµœì¢… ì •ì‚°ì•¡ì„ í•œëˆˆì— í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.'
        },
        {
          title: 'ì˜ìˆ˜ì¦ ì œì¶œ (ì£¼ì£¼ë§Œ)',
          content: 'ì£¼ì£¼ë¼ë©´ "ì˜ìˆ˜ì¦ ì œì¶œ" ë²„íŠ¼ìœ¼ë¡œ ê³µë™ êµ¬ë§¤í•œ ë¬¼í’ˆì˜ ì˜ìˆ˜ì¦ì„ ë“±ë¡í•  ìˆ˜ ìˆì–´ìš”. ì‚¬ì§„ì„ ì°ê³  í•­ëª©ê³¼ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”.'
        },
        {
          title: 'ì¹´ë“œ/í…Œì´ë¸” ë³´ê¸°',
          content: 'ì •ì‚° ë‚´ì—­ì„ ì¹´ë“œí˜•ê³¼ í…Œì´ë¸”í˜• ë‘ ê°€ì§€ë¡œ ë³¼ ìˆ˜ ìˆì–´ìš”. ì·¨í–¥ì— ë§ê²Œ ì„ íƒí•˜ì„¸ìš”.'
        }
      ]
    },
    {
      id: 'expense',
      icon: Wallet,
      title: 'ê³µìš© ìš´ì˜ë¹„',
      color: 'orange',
      steps: [
        {
          title: 'ìš´ì˜ë¹„ íƒ­ ì´ë™',
          content: 'í•˜ë‹¨ ë©”ë‰´ì˜ "ìš´ì˜ë¹„" íƒ­ì„ ì„ íƒí•˜ì„¸ìš”.'
        },
        {
          title: 'ì‹ ì²­ ë‚´ì—­ í™•ì¸',
          content: 'í˜„ì¬ê¹Œì§€ ì‹ ì²­ëœ ìš´ì˜ë¹„ ì§€ì¶œ ë‚´ì—­ì„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”. ìŠ¹ì¸/ëŒ€ê¸°/ê±°ì ˆ ìƒíƒœê°€ í‘œì‹œë©ë‹ˆë‹¤.'
        },
        {
          title: 'ì‹ ì²­í•˜ê¸° (ì£¼ì£¼ë§Œ)',
          content: 'ì£¼ì£¼ë¼ë©´ "+" ë²„íŠ¼ìœ¼ë¡œ ìš´ì˜ë¹„ ì‚¬ìš©ì„ ì‹ ì²­í•  ìˆ˜ ìˆì–´ìš”. í•­ëª©, ê¸ˆì•¡, ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'
        },
        {
          title: 'ìŠ¹ì¸ í™•ì¸',
          content: 'ê´€ë¦¬ìê°€ ìŠ¹ì¸í•˜ë©´ ìƒíƒœê°€ "ìŠ¹ì¸ë¨"ìœ¼ë¡œ ë°”ë€Œì–´ìš”. ê±°ì ˆëœ ê²½ìš° ì‚¬ìœ ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
        }
      ]
    },
    {
      id: 'settings',
      icon: Bell,
      title: 'ì•Œë¦¼ ì„¤ì •',
      color: 'indigo',
      steps: [
        {
          title: 'ë”ë³´ê¸° ë©”ë‰´',
          content: 'í•˜ë‹¨ ë©”ë‰´ì˜ "ë”ë³´ê¸°" íƒ­ì„ ì„ íƒí•˜ì„¸ìš”.'
        },
        {
          title: 'ì´ë©”ì¼ ì•Œë¦¼ ì„¤ì •',
          content: '"ê°œì¸ì •ë³´ ìˆ˜ì •" ë©”ë‰´ì—ì„œ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ë“±ë¡í•˜ê³  ì•Œë¦¼ ì„¤ì •ì„ ì¡°ì •í•  ìˆ˜ ìˆì–´ìš”.'
        },
        {
          title: 'ë°›ì„ ìˆ˜ ìˆëŠ” ì•Œë¦¼',
          content: 'ì¹­ì°¬ ë°›ìŒ, ì •ì‚° ë§ˆê°, ìš´ì˜ë¹„ ì‹ ì²­/ìŠ¹ì¸ ë“± ë‹¤ì–‘í•œ ì•Œë¦¼ì„ ì´ë©”ì¼ë¡œ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
        },
        {
          title: 'ì•Œë¦¼ ë„ê¸°',
          content: 'ì›í•˜ì§€ ì•ŠëŠ” ì•Œë¦¼ì€ ì–¸ì œë“  ì„¤ì •ì—ì„œ ëŒ ìˆ˜ ìˆì–´ìš”.'
        }
      ]
    }
  ];

  const faqs = [
    {
      q: 'ê²ŒìŠ¤íŠ¸ì™€ ì£¼ì£¼ì˜ ì°¨ì´ëŠ”?',
      a: 'ì£¼ì£¼ëŠ” ë¼ìš´ì§€ ìš´ì˜ì— ì°¸ì—¬í•˜ë©° ì˜ìˆ˜ì¦ ì œì¶œê³¼ ìš´ì˜ë¹„ ì‹ ì²­ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ê²ŒìŠ¤íŠ¸ëŠ” ì˜ˆì•½ê³¼ ì¹­ì°¬ ë“± ê¸°ë³¸ ê¸°ëŠ¥ë§Œ ì´ìš©í•  ìˆ˜ ìˆì–´ìš”. ê¶Œí•œì€ ê´€ë¦¬ìê°€ ì„¤ì •í•©ë‹ˆë‹¤.'
    },
    {
      q: 'ì˜ˆì•½ì„ ê¹œë¹¡í–ˆëŠ”ë° ë‹¹ì¼ ì˜ˆì•½ ê°€ëŠ¥í•œê°€ìš”?',
      a: 'ë„¤, ë‹¹ì¼ì—ë„ ì˜ˆì•½ê³¼ ì·¨ì†Œê°€ ììœ ë¡­ê²Œ ê°€ëŠ¥í•©ë‹ˆë‹¤. ë‹¤ë§Œ ë¼ìš´ì§€ë§ˆë‹¤ ì •ì±…ì´ ë‹¤ë¥¼ ìˆ˜ ìˆìœ¼ë‹ˆ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.'
    },
    {
      q: 'ì •ì‚°ì€ ìë™ìœ¼ë¡œ ë˜ë‚˜ìš”?',
      a: 'ë„¤, ë§¤ì£¼ ì •í•´ì§„ ì‹œê°„(ë³´í†µ ì›”ìš”ì¼ ì €ë…)ì— ìë™ìœ¼ë¡œ ë§ˆê°ë©ë‹ˆë‹¤. ë§ˆê° ì „ê¹Œì§€ ì˜ìˆ˜ì¦ì„ ì œì¶œí•˜ë©´ í•´ë‹¹ ì£¼ ì •ì‚°ì— ë°˜ì˜ë¼ìš”.'
    },
    {
      q: 'ì¹­ì°¬ì„ ë³´ë‚´ë©´ ìƒëŒ€ë°©ì´ ëˆ„ê°€ ë³´ëƒˆëŠ”ì§€ ì•Œ ìˆ˜ ìˆë‚˜ìš”?',
      a: 'ë„¤, ì¹­ì°¬ì„ ë°›ì€ ì‚¬ëŒì€ ëˆ„ê°€ ë³´ëƒˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”. ì§„ì‹¬ ì–´ë¦° ì¹­ì°¬ì„ ë‚˜ëˆ ë³´ì„¸ìš”!'
    },
    {
      q: 'íƒˆí‡´í•˜ê³  ì‹¶ì–´ìš”',
      a: 'ë”ë³´ê¸° > ê³„ì • > íšŒì› íƒˆí‡´ ë©”ë‰´ì—ì„œ íƒˆí‡´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íƒˆí‡´ ì‹œ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ë‹ˆ ì‹ ì¤‘í•˜ê²Œ ê²°ì •í•˜ì„¸ìš”.'
    },
    {
      q: 'ë¬¸ì˜ì‚¬í•­ì€ ì–´ë””ë¡œ í•˜ë‚˜ìš”?',
      a: 'ë¼ìš´ì§€ ìš´ì˜ì— ê´€í•œ ë¬¸ì˜ëŠ” ê´€ë¦¬ìì—ê²Œ, ì•± ì‚¬ìš© ë¬¸ì œëŠ” í•˜ë‹¨ì˜ ë¬¸ì˜í•˜ê¸° ë²„íŠ¼ì„ ì´ìš©í•´ì£¼ì„¸ìš”.'
    }
  ];

  const getColorClasses = (color) => {
    const colors = {
      blue: {
        bg: 'bg-blue-50',
        border: 'border-blue-200',
        icon: 'text-blue-600',
        iconBg: 'bg-blue-100',
        accent: 'bg-blue-500'
      },
      green: {
        bg: 'bg-green-50',
        border: 'border-green-200',
        icon: 'text-green-600',
        iconBg: 'bg-green-100',
        accent: 'bg-green-500'
      },
      pink: {
        bg: 'bg-pink-50',
        border: 'border-pink-200',
        icon: 'text-pink-600',
        iconBg: 'bg-pink-100',
        accent: 'bg-pink-500'
      },
      purple: {
        bg: 'bg-purple-50',
        border: 'border-purple-200',
        icon: 'text-purple-600',
        iconBg: 'bg-purple-100',
        accent: 'bg-purple-500'
      },
      orange: {
        bg: 'bg-orange-50',
        border: 'border-orange-200',
        icon: 'text-orange-600',
        iconBg: 'bg-orange-100',
        accent: 'bg-orange-500'
      },
      indigo: {
        bg: 'bg-indigo-50',
        border: 'border-indigo-200',
        icon: 'text-indigo-600',
        iconBg: 'bg-indigo-100',
        accent: 'bg-indigo-500'
      }
    };
    return colors[color] || colors.blue;
  };

  return (
    <div className="min-h-screen bg-gradient-to-b from-gray-50 to-white pb-20">
      {/* í—¤ë” */}
      <div className="bg-white border-b sticky top-0 z-10">
        <div className="max-w-2xl mx-auto px-4 py-4">
          <div className="flex items-center gap-3">
            <button
              onClick={() => navigate(-1)}
              className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
            >
              <ChevronLeft className="w-5 h-5" />
            </button>
            <div className="flex items-center gap-2">
              <Users className="w-5 h-5 text-blue-600" />
              <h1 className="text-xl font-bold">ì‚¬ìš© ê°€ì´ë“œ</h1>
            </div>
          </div>
        </div>
      </div>

      {/* ì¸íŠ¸ë¡œ */}
      <div className="max-w-2xl mx-auto px-4 py-6">
        <div className="bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-2xl p-6 shadow-lg mb-6">
          <h2 className="text-2xl font-bold mb-2">ë¼ìš´ì§€ ì´ìš© ê°€ì´ë“œ</h2>
          <p className="text-blue-50 leading-relaxed">
            ë¼ìš´ì§€ë¥¼ ì²˜ìŒ ì´ìš©í•˜ì‹œë‚˜ìš”? ì˜ˆì•½ë¶€í„° ì •ì‚°ê¹Œì§€, ëª¨ë“  ê¸°ëŠ¥ì„ ì‰½ê²Œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´í•´ë“œë¦´ê²Œìš”.
          </p>
        </div>

        {/* ê°€ì´ë“œ ì„¹ì…˜ë“¤ */}
        <div className="space-y-4 mb-8">
          {guides.map((guide) => {
            const Icon = guide.icon;
            const colors = getColorClasses(guide.color);
            const isExpanded = expandedSection === guide.id;

            return (
              <div key={guide.id} className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                <button
                  onClick={() => toggleSection(guide.id)}
                  className="w-full p-4 flex items-center justify-between hover:bg-gray-50 transition-colors"
                >
                  <div className="flex items-center gap-3">
                    <div className={`w-12 h-12 rounded-xl ${colors.iconBg} flex items-center justify-center`}>
                      <Icon className={`w-6 h-6 ${colors.icon}`} />
                    </div>
                    <h3 className="font-bold text-lg text-gray-900">{guide.title}</h3>
                  </div>
                  <ChevronRight
                    className={`w-5 h-5 text-gray-400 transition-transform ${isExpanded ? 'rotate-90' : ''}`}
                  />
                </button>

                {isExpanded && (
                  <div className={`border-t ${colors.border} ${colors.bg} p-4`}>
                    <div className="space-y-4">
                      {guide.steps.map((step, idx) => (
                        <div key={idx} className="flex gap-3">
                          <div className={`w-6 h-6 rounded-full ${colors.accent} flex items-center justify-center flex-shrink-0 mt-0.5`}>
                            <CheckCircle2 className="w-4 h-4 text-white" />
                          </div>
                          <div className="flex-1">
                            <h4 className="font-semibold text-gray-900 mb-1">{step.title}</h4>
                            <p className="text-sm text-gray-600 leading-relaxed">{step.content}</p>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            );
          })}
        </div>

        {/* FAQ ì„¹ì…˜ */}
        <div className="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-6">
          <div className="flex items-center gap-2 mb-4">
            <Mail className="w-5 h-5 text-blue-600" />
            <h2 className="text-xl font-bold">ìì£¼ ë¬»ëŠ” ì§ˆë¬¸</h2>
          </div>
          <div className="space-y-4">
            {faqs.map((faq, idx) => (
              <div key={idx} className="border-b border-gray-100 last:border-0 pb-4 last:pb-0">
                <h4 className="font-semibold text-gray-900 mb-2 flex items-start gap-2">
                  <span className="text-blue-600 font-bold">Q.</span>
                  <span>{faq.q}</span>
                </h4>
                <p className="text-sm text-gray-600 leading-relaxed pl-6">{faq.a}</p>
              </div>
            ))}
          </div>
        </div>

        {/* ë„ì›€ë§ ì¹´ë“œ */}
        <div className="bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl p-6 border border-gray-200">
          <h3 className="font-bold text-gray-900 mb-2">ì¶”ê°€ ë„ì›€ì´ í•„ìš”í•˜ì‹ ê°€ìš”?</h3>
          <p className="text-sm text-gray-600 mb-4">
            ì‚¬ìš© ì¤‘ ë¬¸ì œê°€ ë°œìƒí•˜ê±°ë‚˜ ê¶ê¸ˆí•œ ì ì´ ìˆë‹¤ë©´ ë¼ìš´ì§€ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.
          </p>
          <div className="flex gap-2">
            <button
              onClick={() => navigate('/more')}
              className="flex-1 bg-blue-600 text-white py-2.5 rounded-lg font-medium hover:bg-blue-700 transition-colors"
            >
              ì„¤ì •ìœ¼ë¡œ ì´ë™
            </button>
            <button
              onClick={() => navigate('/introduction')}
              className="flex-1 bg-white text-gray-700 py-2.5 rounded-lg font-medium hover:bg-gray-50 transition-colors border border-gray-200"
            >
              ì•± ì†Œê°œ ë³´ê¸°
            </button>
          </div>
        </div>
      </div>
    </div>
  );
};

export default UserGuidePage;
</file>

<file path="src/services/adminSettingsService.js">
// src/services/adminSettingsService.js
import { doc, getDoc, setDoc } from 'firebase/firestore';
import { db } from '../config/firebase';

/**
 * ì–´ë“œë¯¼ ì„¤ì • ì„œë¹„ìŠ¤
 */
const adminSettingsService = {
  /**
   * ìŠˆí¼ì–´ë“œë¯¼ ì´ë©”ì¼ ì„¤ì • ì¡°íšŒ
   */
  async getAdminEmailSettings() {
    try {
      const settingsRef = doc(db, 'admin_settings', 'email_notifications');
      const settingsDoc = await getDoc(settingsRef);

      if (!settingsDoc.exists()) {
        // ê¸°ë³¸ê°’ ë°˜í™˜
        return {
          adminEmail: '',
          spaceCreationNotifications: true,
          alimtalkNotifications: true
        };
      }

      return settingsDoc.data();
    } catch (error) {
      console.error('âŒ ì–´ë“œë¯¼ ì´ë©”ì¼ ì„¤ì • ì¡°íšŒ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ìŠˆí¼ì–´ë“œë¯¼ ì´ë©”ì¼ ì„¤ì • ì—…ë°ì´íŠ¸
   */
  async updateAdminEmailSettings(settings) {
    try {
      console.log('ğŸ’¾ ì–´ë“œë¯¼ ì´ë©”ì¼ ì„¤ì • ì—…ë°ì´íŠ¸:', settings);

      const settingsRef = doc(db, 'admin_settings', 'email_notifications');

      const updateData = {
        ...settings,
        updatedAt: new Date()
      };

      await setDoc(settingsRef, updateData, { merge: true });

      console.log('âœ… ì–´ë“œë¯¼ ì´ë©”ì¼ ì„¤ì • ì—…ë°ì´íŠ¸ ì™„ë£Œ');

      return { success: true };
    } catch (error) {
      console.error('âŒ ì–´ë“œë¯¼ ì´ë©”ì¼ ì„¤ì • ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ìŠˆí¼ì–´ë“œë¯¼ ì´ë©”ì¼ë¡œ ì•Œë¦¼ ë°œì†¡
   */
  async sendAdminNotification(type, data) {
    try {
      // ì–´ë“œë¯¼ ì´ë©”ì¼ ì„¤ì • ì¡°íšŒ
      const settings = await this.getAdminEmailSettings();

      if (!settings.adminEmail) {
        console.warn('âš ï¸ ì–´ë“œë¯¼ ì´ë©”ì¼ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
        return { success: false, message: 'ì–´ë“œë¯¼ ì´ë©”ì¼ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.' };
      }

      // ì•Œë¦¼ íƒ€ì…ë³„ í™œì„±í™” ì²´í¬
      if (type === 'space_creation_request' && !settings.spaceCreationNotifications) {
        console.log('â„¹ï¸ ë°© ìƒì„± ì•Œë¦¼ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
        return { success: false, message: 'ë°© ìƒì„± ì•Œë¦¼ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.' };
      }

      // Netlify Function í˜¸ì¶œ
      const response = await fetch('/.netlify/functions/send-email', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          type,
          ...data,
          recipients: {
            to: settings.adminEmail
          }
        }),
      });

      if (!response.ok) {
        throw new Error(`ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨: ${response.statusText}`);
      }

      const result = await response.json();
      console.log('âœ… ì–´ë“œë¯¼ ì•Œë¦¼ ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ:', result);

      return { success: true, result };
    } catch (error) {
      console.error('âŒ ì–´ë“œë¯¼ ì•Œë¦¼ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨:', error);
      // ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨ëŠ” ì „ì²´ í”„ë¡œì„¸ìŠ¤ë¥¼ ì¤‘ë‹¨í•˜ì§€ ì•ŠìŒ
      return { success: false, error: error.message };
    }
  }
};

export default adminSettingsService;
</file>

<file path="src/services/bartenderService.js">
import {
  collection,
  doc,
  getDocs,
  getDoc,
  setDoc,
  addDoc,
  updateDoc,
  deleteDoc,
  query,
  where,
  orderBy,
  Timestamp
} from 'firebase/firestore';
import { db } from '../config/firebase';

/**
 * Order ID ìƒì„± (íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜)
 * í˜•ì‹: YYYY-MM-DDTHHMM
 * ì˜ˆ: 2026-01-03T1430
 */
const generateOrderId = (date = new Date()) => {
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  const hours = String(date.getHours()).padStart(2, '0');
  const minutes = String(date.getMinutes()).padStart(2, '0');

  return `${year}-${month}-${day}T${hours}${minutes}`;
};

const bartenderService = {
  // ============================================
  // ë©”ë‰´ ê´€ë¦¬
  // ============================================

  /**
   * ìŠ¤í˜ì´ìŠ¤ì˜ ëª¨ë“  ë©”ë‰´ ì¡°íšŒ
   */
  async getMenus(spaceId) {
    try {
      console.log('ğŸ¸ ë©”ë‰´ ëª©ë¡ ì¡°íšŒ:', spaceId);

      const menuRef = collection(db, 'spaces', spaceId, 'BartenderMenu');
      const q = query(menuRef, orderBy('createdAt', 'desc'));
      const snapshot = await getDocs(q);

      const menus = [];
      snapshot.forEach((doc) => {
        menus.push({
          id: doc.id,
          ...doc.data(),
          createdAt: doc.data().createdAt?.toDate(),
          updatedAt: doc.data().updatedAt?.toDate(),
        });
      });

      console.log('âœ… ë©”ë‰´ ëª©ë¡ ì¡°íšŒ ì™„ë£Œ:', menus.length);
      return menus;
    } catch (error) {
      console.error('âŒ ë©”ë‰´ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * íŒë§¤ ê°€ëŠ¥í•œ ë©”ë‰´ë§Œ ì¡°íšŒ
   */
  async getAvailableMenus(spaceId) {
    try {
      console.log('ğŸ¸ íŒë§¤ ê°€ëŠ¥í•œ ë©”ë‰´ ì¡°íšŒ:', spaceId);

      const menuRef = collection(db, 'spaces', spaceId, 'BartenderMenu');
      const q = query(
        menuRef,
        where('available', '==', true),
        orderBy('createdAt', 'desc')
      );
      const snapshot = await getDocs(q);

      const menus = [];
      snapshot.forEach((doc) => {
        menus.push({
          id: doc.id,
          ...doc.data(),
          createdAt: doc.data().createdAt?.toDate(),
          updatedAt: doc.data().updatedAt?.toDate(),
        });
      });

      console.log('âœ… íŒë§¤ ê°€ëŠ¥í•œ ë©”ë‰´ ì¡°íšŒ ì™„ë£Œ:', menus.length);
      return menus;
    } catch (error) {
      console.error('âŒ íŒë§¤ ê°€ëŠ¥í•œ ë©”ë‰´ ì¡°íšŒ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * íŠ¹ì • ë©”ë‰´ ì¡°íšŒ
   */
  async getMenuById(spaceId, menuId) {
    try {
      console.log('ğŸ¸ ë©”ë‰´ ìƒì„¸ ì¡°íšŒ:', { spaceId, menuId });

      const menuRef = doc(db, 'spaces', spaceId, 'BartenderMenu', menuId);
      const snapshot = await getDoc(menuRef);

      if (!snapshot.exists()) {
        throw new Error('ë©”ë‰´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }

      const data = {
        id: snapshot.id,
        ...snapshot.data(),
        createdAt: snapshot.data().createdAt?.toDate(),
        updatedAt: snapshot.data().updatedAt?.toDate(),
      };

      console.log('âœ… ë©”ë‰´ ìƒì„¸ ì¡°íšŒ ì™„ë£Œ');
      return data;
    } catch (error) {
      console.error('âŒ ë©”ë‰´ ìƒì„¸ ì¡°íšŒ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ë©”ë‰´ ìƒì„±
   * @param {string} spaceId - ìŠ¤í˜ì´ìŠ¤ ID
   * @param {Object} menuData - ë©”ë‰´ ë°ì´í„°
   * @param {string} menuData.menuName - ë©”ë‰´ëª…
   * @param {number} menuData.price - ê°€ê²©
   * @param {string} menuData.category - ì¹´í…Œê³ ë¦¬
   * @param {string} menuData.description - ì„¤ëª… (ì„ íƒ)
   * @param {string} menuData.imageUrl - ì´ë¯¸ì§€ URL (ì„ íƒ)
   * @param {string} menuData.createdBy - ìƒì„±ì ID
   * @param {string} menuData.createdByName - ìƒì„±ì ì´ë¦„
   */
  async createMenu(spaceId, menuData) {
    try {
      console.log('ğŸ¸ ë©”ë‰´ ìƒì„±:', { spaceId, menuData });

      const { menuName, price, category, description, imageUrl, createdBy, createdByName } = menuData;

      const now = new Date();
      const createdAt = Timestamp.fromDate(now);

      const menuRef = collection(db, 'spaces', spaceId, 'BartenderMenu');
      const newMenuData = {
        menuName: menuName,
        price: price,
        category: category,
        description: description || '',
        imageUrl: imageUrl || '',
        available: true,
        createdAt: createdAt,
        createdBy: createdBy,
        createdByName: createdByName,
        updatedAt: null,
        updatedBy: null,
        updatedByName: null,
      };

      const docRef = await addDoc(menuRef, newMenuData);

      console.log('âœ… ë©”ë‰´ ìƒì„± ì™„ë£Œ:', docRef.id);
      return { id: docRef.id, ...newMenuData, createdAt: now };
    } catch (error) {
      console.error('âŒ ë©”ë‰´ ìƒì„± ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ë©”ë‰´ ìˆ˜ì •
   */
  async updateMenu(spaceId, menuId, menuData) {
    try {
      console.log('ğŸ¸ ë©”ë‰´ ìˆ˜ì •:', { spaceId, menuId, menuData });

      const { menuName, price, category, description, imageUrl, updatedBy, updatedByName } = menuData;

      const now = new Date();
      const updatedAt = Timestamp.fromDate(now);

      const menuRef = doc(db, 'spaces', spaceId, 'BartenderMenu', menuId);

      await updateDoc(menuRef, {
        menuName: menuName,
        price: price,
        category: category,
        description: description || '',
        imageUrl: imageUrl || '',
        updatedAt: updatedAt,
        updatedBy: updatedBy,
        updatedByName: updatedByName,
      });

      console.log('âœ… ë©”ë‰´ ìˆ˜ì • ì™„ë£Œ');
      return true;
    } catch (error) {
      console.error('âŒ ë©”ë‰´ ìˆ˜ì • ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ë©”ë‰´ ì‚­ì œ
   */
  async deleteMenu(spaceId, menuId) {
    try {
      console.log('ğŸ¸ ë©”ë‰´ ì‚­ì œ:', { spaceId, menuId });

      const menuRef = doc(db, 'spaces', spaceId, 'BartenderMenu', menuId);
      await deleteDoc(menuRef);

      console.log('âœ… ë©”ë‰´ ì‚­ì œ ì™„ë£Œ');
      return true;
    } catch (error) {
      console.error('âŒ ë©”ë‰´ ì‚­ì œ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ë©”ë‰´ íŒë§¤ ê°€ëŠ¥ ì—¬ë¶€ í† ê¸€
   */
  async toggleMenuAvailability(spaceId, menuId) {
    try {
      console.log('ğŸ¸ ë©”ë‰´ íŒë§¤ ê°€ëŠ¥ ì—¬ë¶€ í† ê¸€:', { spaceId, menuId });

      const menuRef = doc(db, 'spaces', spaceId, 'BartenderMenu', menuId);
      const menuSnap = await getDoc(menuRef);

      if (!menuSnap.exists()) {
        throw new Error('ë©”ë‰´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }

      const currentAvailability = menuSnap.data().available;
      await updateDoc(menuRef, {
        available: !currentAvailability,
        updatedAt: Timestamp.fromDate(new Date()),
      });

      console.log('âœ… ë©”ë‰´ íŒë§¤ ê°€ëŠ¥ ì—¬ë¶€ í† ê¸€ ì™„ë£Œ:', !currentAvailability);
      return !currentAvailability;
    } catch (error) {
      console.error('âŒ ë©”ë‰´ íŒë§¤ ê°€ëŠ¥ ì—¬ë¶€ í† ê¸€ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  // ============================================
  // ì£¼ë¬¸ ê´€ë¦¬
  // ============================================

  /**
   * ìŠ¤í˜ì´ìŠ¤ì˜ ëª¨ë“  ì£¼ë¬¸ ì¡°íšŒ
   */
  async getOrders(spaceId) {
    try {
      console.log('ğŸ¸ ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒ:', spaceId);

      const orderRef = collection(db, 'spaces', spaceId, 'BartenderOrder');
      const q = query(orderRef, orderBy('createdAt', 'desc'));
      const snapshot = await getDocs(q);

      const orders = [];
      snapshot.forEach((doc) => {
        orders.push({
          id: doc.id,
          ...doc.data(),
          createdAt: doc.data().createdAt?.toDate(),
        });
      });

      console.log('âœ… ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒ ì™„ë£Œ:', orders.length);
      return orders;
    } catch (error) {
      console.error('âŒ ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * íŠ¹ì • ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ
   */
  async getOrderById(spaceId, orderId) {
    try {
      console.log('ğŸ¸ ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ:', { spaceId, orderId });

      const orderRef = doc(db, 'spaces', spaceId, 'BartenderOrder', orderId);
      const snapshot = await getDoc(orderRef);

      if (!snapshot.exists()) {
        throw new Error('ì£¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }

      const data = {
        id: snapshot.id,
        ...snapshot.data(),
        createdAt: snapshot.data().createdAt?.toDate(),
      };

      console.log('âœ… ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ ì™„ë£Œ');
      return data;
    } catch (error) {
      console.error('âŒ ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ì£¼ë¬¸ ìƒì„±
   * @param {string} spaceId - ìŠ¤í˜ì´ìŠ¤ ID
   * @param {Object} orderData - ì£¼ë¬¸ ë°ì´í„°
   * @param {string} orderData.userId - ì£¼ë¬¸ì ID
   * @param {string} orderData.userName - ì£¼ë¬¸ì ì´ë¦„
   * @param {Array} orderData.items - ì£¼ë¬¸ í•­ëª© ë°°ì—´
   * @param {string} orderData.items[].menuId - ë©”ë‰´ ID
   * @param {string} orderData.items[].menuName - ë©”ë‰´ëª…
   * @param {number} orderData.items[].price - ë‹¨ê°€
   * @param {number} orderData.items[].quantity - ìˆ˜ëŸ‰
   * @param {string} orderData.memo - ë©”ëª¨ (ì„ íƒ)
   */
  async createOrder(spaceId, orderData) {
    try {
      console.log('ğŸ¸ ì£¼ë¬¸ ìƒì„±:', { spaceId, orderData });

      const { userId, userName, items, memo } = orderData;

      // ID ìƒì„± (í˜„ì¬ ì‹œê° ê¸°ì¤€)
      const now = new Date();
      const orderId = generateOrderId(now);
      const createdAt = Timestamp.fromDate(now);

      // ì´ì•¡ ê³„ì‚°
      const totalAmount = items.reduce((sum, item) => {
        return sum + (item.price * item.quantity);
      }, 0);

      // ì£¼ë¬¸ ë¬¸ì„œ ìƒì„±
      const orderRef = doc(db, 'spaces', spaceId, 'BartenderOrder', orderId);
      const newOrderData = {
        userId: userId,
        userName: userName,
        createdAt: createdAt,
        memo: memo || '',
        items: items.map(item => ({
          menuId: item.menuId,
          menuName: item.menuName,
          price: item.price,
          quantity: item.quantity,
          total: item.price * item.quantity,
        })),
        totalAmount: totalAmount,
        status: 'completed',
      };

      await setDoc(orderRef, newOrderData);

      console.log('âœ… ì£¼ë¬¸ ìƒì„± ì™„ë£Œ:', orderId);

      // ì´ë©”ì¼ ì•Œë¦¼ ë°œì†¡
      try {
        console.log('ğŸ“§ ë°”í…ë” ì£¼ë¬¸ ì´ë©”ì¼ ë°œì†¡ ì‹œì‘...');

        // ìŠ¤í˜ì´ìŠ¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const spaceDocRef = doc(db, 'spaces', spaceId);
        const spaceDoc = await getDoc(spaceDocRef);
        const spaceData = spaceDoc.exists() ? spaceDoc.data() : {};

        // ì´ë©”ì¼ ì•Œë¦¼ ì„¤ì • ê°€ì ¸ì˜¤ê¸°
        const emailSettingsRef = doc(db, `spaces/${spaceId}/settings`, 'email');
        const emailSettingsDoc = await getDoc(emailSettingsRef);
        const emailSettings = emailSettingsDoc.exists() ? emailSettingsDoc.data() : null;

        console.log('ì´ë©”ì¼ ì•Œë¦¼ ì„¤ì •:', emailSettings);

        if (emailSettings?.bartender_order?.enabled && emailSettings.bartender_order.recipients.length > 0) {
          console.log('ğŸ“§ ë°”í…ë” ì£¼ë¬¸ ì´ë©”ì¼ ë°œì†¡ ì‹œì‘');

          const emailResponse = await fetch('/.netlify/functions/send-email', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              type: 'bartender_order',
              userName: userName,
              orderedAt: now,
              totalAmount: totalAmount,
              items: newOrderData.items,
              memo: memo,
              spaceName: spaceData.name || 'ë¼ìš´ì§€',
              recipients: {
                to: emailSettings.bartender_order.recipients[0],
                cc: emailSettings.bartender_order.recipients.slice(1)
              }
            })
          });

          const emailResult = await emailResponse.json();
          console.log('âœ… ë°”í…ë” ì£¼ë¬¸ ì´ë©”ì¼ ë°œì†¡ ê²°ê³¼:', emailResult);
        } else {
          console.log('â„¹ï¸ ë°”í…ë” ì£¼ë¬¸ ì´ë©”ì¼ ì•Œë¦¼ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆê±°ë‚˜ ìˆ˜ì‹ ì ì—†ìŒ');
        }
      } catch (emailError) {
        console.error('âš ï¸ ë°”í…ë” ì£¼ë¬¸ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨ (ì£¼ë¬¸ì€ ì™„ë£Œë¨):', emailError);
      }

      return { id: orderId, ...newOrderData, createdAt: now };
    } catch (error) {
      console.error('âŒ ì£¼ë¬¸ ìƒì„± ì‹¤íŒ¨:', error);
      throw error;
    }
  },
};

export default bartenderService;
</file>

<file path="src/services/mealGatheringService.js">
import { doc, setDoc, getDoc, getDocs, collection, query, where, Timestamp, deleteDoc, updateDoc, arrayUnion, arrayRemove } from 'firebase/firestore';
import { db } from '../config/firebase';
import { formatDate } from '../utils/dateUtils';

/**
 * ì‹ì‚¬ ëª¨ì„ ê´€ë¦¬ ì„œë¹„ìŠ¤
 * spaces/{spaceId}/mealGatherings/{gatheringId}
 */
class MealGatheringService {
  /**
   * ëª¨ì„ ìƒì„±
   * @param {string} spaceId - ìŠ¤í˜ì´ìŠ¤ ID
   * @param {object} gatheringData - ëª¨ì„ ë°ì´í„°
   */
  async createGathering(spaceId, gatheringData) {
    if (!spaceId) {
      throw new Error('spaceIdê°€ í•„ìš”í•©ë‹ˆë‹¤');
    }

    try {
      const gatheringsRef = collection(db, 'spaces', spaceId, 'mealGatherings');

      // ë¬¸ì„œ ID ìƒì„±: date_mealType_timestamp
      const timestamp = Date.now();
      const docId = `${gatheringData.date}_${gatheringData.mealType}_${timestamp}`;

      const dataToSave = {
        date: gatheringData.date,
        mealType: gatheringData.mealType, // "lunch" | "dinner"
        title: gatheringData.title || 'ì‹ì‚¬ ëª¨ì„',
        hostId: gatheringData.hostId,
        hostName: gatheringData.hostName,
        departureTime: gatheringData.departureTime || '',
        location: gatheringData.location || '',
        participants: gatheringData.participants || [gatheringData.hostId], // ì£¼ìµœì ìë™ ì°¸ì—¬
        createdAt: Timestamp.now(),
        updatedAt: Timestamp.now()
      };

      await setDoc(doc(gatheringsRef, docId), dataToSave);

      console.log('âœ… ëª¨ì„ ìƒì„± ì„±ê³µ:', docId);
      return { id: docId, ...dataToSave };
    } catch (error) {
      console.error('âŒ ëª¨ì„ ìƒì„± ì‹¤íŒ¨:', error);
      throw error;
    }
  }

  /**
   * íŠ¹ì • ë‚ ì§œì˜ ëª¨ë“  ëª¨ì„ ì¡°íšŒ
   * @param {string} spaceId - ìŠ¤í˜ì´ìŠ¤ ID
   * @param {string} dateStr - ë‚ ì§œ ë¬¸ìì—´ (YYYY-MM-DD)
   */
  async getGatheringsByDate(spaceId, dateStr) {
    try {
      const gatheringsRef = collection(db, 'spaces', spaceId, 'mealGatherings');
      const q = query(gatheringsRef, where('date', '==', dateStr));
      const snapshot = await getDocs(q);

      const gatherings = {
        lunch: [],
        dinner: []
      };

      snapshot.forEach(doc => {
        const data = doc.data();
        const gathering = {
          id: doc.id,
          ...data,
          createdAt: data.createdAt?.toDate?.() || data.createdAt,
          updatedAt: data.updatedAt?.toDate?.() || data.updatedAt
        };

        if (data.mealType === 'lunch') {
          gatherings.lunch.push(gathering);
        } else if (data.mealType === 'dinner') {
          gatherings.dinner.push(gathering);
        }
      });

      return gatherings;
    } catch (error) {
      console.error('âŒ ëª¨ì„ ì¡°íšŒ ì‹¤íŒ¨:', error);
      return { lunch: [], dinner: [] };
    }
  }

  /**
   * ì—¬ëŸ¬ ë‚ ì§œì˜ ëª¨ì„ ì¼ê´„ ì¡°íšŒ
   * @param {string} spaceId - ìŠ¤í˜ì´ìŠ¤ ID
   * @param {string[]} dateStrings - ë‚ ì§œ ë¬¸ìì—´ ë°°ì—´
   */
  async getGatheringsByDateRange(spaceId, dateStrings) {
    try {
      if (!dateStrings || dateStrings.length === 0) return {};

      const gatheringsRef = collection(db, 'spaces', spaceId, 'mealGatherings');

      // Firestore 'in' ì¿¼ë¦¬ëŠ” ìµœëŒ€ 10ê°œê¹Œì§€ë§Œ ê°€ëŠ¥
      const chunks = [];
      for (let i = 0; i < dateStrings.length; i += 10) {
        chunks.push(dateStrings.slice(i, i + 10));
      }

      const allGatherings = {};

      for (const chunk of chunks) {
        const q = query(gatheringsRef, where('date', 'in', chunk));
        const snapshot = await getDocs(q);

        snapshot.forEach(doc => {
          const data = doc.data();
          const dateStr = data.date;

          if (!allGatherings[dateStr]) {
            allGatherings[dateStr] = { lunch: [], dinner: [] };
          }

          const gathering = {
            id: doc.id,
            ...data,
            createdAt: data.createdAt?.toDate?.() || data.createdAt,
            updatedAt: data.updatedAt?.toDate?.() || data.updatedAt
          };

          if (data.mealType === 'lunch') {
            allGatherings[dateStr].lunch.push(gathering);
          } else if (data.mealType === 'dinner') {
            allGatherings[dateStr].dinner.push(gathering);
          }
        });
      }

      return allGatherings;
    } catch (error) {
      console.error('âŒ ëª¨ì„ ë²”ìœ„ ì¡°íšŒ ì‹¤íŒ¨:', error);
      return {};
    }
  }

  /**
   * ëª¨ì„ ì°¸ì—¬
   * @param {string} spaceId - ìŠ¤í˜ì´ìŠ¤ ID
   * @param {string} gatheringId - ëª¨ì„ ID
   * @param {string} userId - ì‚¬ìš©ì ID
   */
  async joinGathering(spaceId, gatheringId, userId) {
    try {
      const gatheringRef = doc(db, 'spaces', spaceId, 'mealGatherings', gatheringId);

      await updateDoc(gatheringRef, {
        participants: arrayUnion(userId),
        updatedAt: Timestamp.now()
      });

      console.log('âœ… ëª¨ì„ ì°¸ì—¬ ì„±ê³µ:', gatheringId, userId);
    } catch (error) {
      console.error('âŒ ëª¨ì„ ì°¸ì—¬ ì‹¤íŒ¨:', error);
      throw error;
    }
  }

  /**
   * ëª¨ì„ ì°¸ì—¬ ì·¨ì†Œ
   * @param {string} spaceId - ìŠ¤í˜ì´ìŠ¤ ID
   * @param {string} gatheringId - ëª¨ì„ ID
   * @param {string} userId - ì‚¬ìš©ì ID
   */
  async leaveGathering(spaceId, gatheringId, userId) {
    try {
      const gatheringRef = doc(db, 'spaces', spaceId, 'mealGatherings', gatheringId);

      await updateDoc(gatheringRef, {
        participants: arrayRemove(userId),
        updatedAt: Timestamp.now()
      });

      console.log('âœ… ëª¨ì„ ì°¸ì—¬ ì·¨ì†Œ ì„±ê³µ:', gatheringId, userId);
    } catch (error) {
      console.error('âŒ ëª¨ì„ ì°¸ì—¬ ì·¨ì†Œ ì‹¤íŒ¨:', error);
      throw error;
    }
  }

  /**
   * ëª¨ì„ ì‚­ì œ
   * @param {string} spaceId - ìŠ¤í˜ì´ìŠ¤ ID
   * @param {string} gatheringId - ëª¨ì„ ID
   */
  async deleteGathering(spaceId, gatheringId) {
    try {
      const gatheringRef = doc(db, 'spaces', spaceId, 'mealGatherings', gatheringId);
      await deleteDoc(gatheringRef);

      console.log('âœ… ëª¨ì„ ì‚­ì œ ì„±ê³µ:', gatheringId);
    } catch (error) {
      console.error('âŒ ëª¨ì„ ì‚­ì œ ì‹¤íŒ¨:', error);
      throw error;
    }
  }

  /**
   * ëª¨ì„ ìˆ˜ì •
   * @param {string} spaceId - ìŠ¤í˜ì´ìŠ¤ ID
   * @param {string} gatheringId - ëª¨ì„ ID
   * @param {object} updates - ìˆ˜ì •í•  ë°ì´í„°
   */
  async updateGathering(spaceId, gatheringId, updates) {
    try {
      const gatheringRef = doc(db, 'spaces', spaceId, 'mealGatherings', gatheringId);

      await updateDoc(gatheringRef, {
        ...updates,
        updatedAt: Timestamp.now()
      });

      console.log('âœ… ëª¨ì„ ìˆ˜ì • ì„±ê³µ:', gatheringId);
    } catch (error) {
      console.error('âŒ ëª¨ì„ ìˆ˜ì • ì‹¤íŒ¨:', error);
      throw error;
    }
  }

  /**
   * ì‚¬ìš©ìê°€ íŠ¹ì • ë‚ ì§œì— ì°¸ì—¬í•œ ëª¨ì„ íƒ€ì… í™•ì¸
   * @param {object} gatheringsByDate - ë‚ ì§œë³„ ëª¨ì„ ë°ì´í„°
   * @param {string} userId - ì‚¬ìš©ì ID
   * @returns {object} { lunch: boolean, dinner: boolean }
   */
  getUserMealStatus(gatheringsByDate, userId) {
    if (!gatheringsByDate) {
      return { lunch: false, dinner: false };
    }

    const lunchGatherings = gatheringsByDate.lunch || [];
    const dinnerGatherings = gatheringsByDate.dinner || [];

    const hasLunch = lunchGatherings.some(g => g.participants?.includes(userId));
    const hasDinner = dinnerGatherings.some(g => g.participants?.includes(userId));

    return {
      lunch: hasLunch,
      dinner: hasDinner
    };
  }
}

export default new MealGatheringService();
</file>

<file path="src/services/migrateExpenses.js">
/**
 * Expense ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸
 * 
 * ëª©ì : í•­ëª©ë³„ ê°œë³„ ë¬¸ì„œ êµ¬ì¡° â†’ ì²­êµ¬ë³„ ë‹¨ì¼ ë¬¸ì„œ êµ¬ì¡°
 * 
 * ì´ì „ êµ¬ì¡°:
 * - 2025-01-20T0549_0001 { itemName: "í™”ì¥ì§€", groupId: "2025-01-20T0549", ... }
 * - 2025-01-20T0549_0002 { itemName: "ì„¸ì œ", groupId: "2025-01-20T0549", ... }
 * 
 * ìƒˆ êµ¬ì¡°:
 * - 2025-01-20T0549 { items: [{...}, {...}], totalAmount: 18000, ... }
 */

import { 
  collection, 
  doc,
  getDocs, 
  query,
  orderBy,
  writeBatch,
  deleteDoc,
  Timestamp
} from 'firebase/firestore';
import { db } from '../config/firebase';

const migrateExpenses = async (spaceId, dryRun = true) => {
  console.log('ğŸ”„ Expense ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘');
  console.log(`ğŸ“ ìŠ¤í˜ì´ìŠ¤: ${spaceId}`);
  console.log(`ğŸ§ª Dry Run: ${dryRun ? 'ON (ì‹¤ì œ ë³€ê²½ ì•ˆí•¨)' : 'OFF (ì‹¤ì œ ë³€ê²½)'}`);
  console.log('---');
  
  try {
    // 1. í˜„ì¬ ëª¨ë“  Expense ë¬¸ì„œ ì¡°íšŒ
    const expenseRef = collection(db, 'spaces', spaceId, 'Expense');
    const q = query(expenseRef, orderBy('createdAt', 'asc'));
    const snapshot = await getDocs(q);
    
    console.log(`ğŸ“Š ì´ ${snapshot.size}ê°œ ë¬¸ì„œ ë°œê²¬`);
    
    // 2. groupIdë³„ë¡œ í•­ëª© ê·¸ë£¹í™”
    const groupMap = new Map();
    
    snapshot.forEach((docSnap) => {
      const data = docSnap.data();
      const groupId = data.groupId;
      
      if (!groupId) {
        console.warn(`âš ï¸  groupId ì—†ëŠ” ë¬¸ì„œ ë°œê²¬: ${docSnap.id}`);
        return;
      }
      
      if (!groupMap.has(groupId)) {
        groupMap.set(groupId, {
          oldDocIds: [],
          items: [],
          metadata: null,
        });
      }
      
      const group = groupMap.get(groupId);
      
      // í•­ëª© ì •ë³´
      group.items.push({
        itemName: data.itemName || '',
        itemPrice: data.itemPrice || 0,
        itemQty: data.itemQty || 1,
        itemSpec: data.itemSpec || '',
        total: data.total || 0,
      });
      
      // ë©”íƒ€ë°ì´í„° (ì²« ë²ˆì§¸ í•­ëª©ì—ì„œ ê°€ì ¸ì˜¤ê¸°)
      if (!group.metadata) {
        group.metadata = {
          UserId: data.UserId,
          userName: data.userName,
          usedAt: data.usedAt,
          createdAt: data.createdAt,
          memo: data.memo || '',
          imageUrl: data.imageUrl || '',
          approved: data.approved || false,
          status: data.status || 'pending',
          approvedAt: data.approvedAt || null,
          approvedBy: data.approvedBy || null,
          approvedByName: data.approvedByName || null,
          rejectedAt: data.rejectedAt || null,
          rejectedBy: data.rejectedBy || null,
          rejectedByName: data.rejectedByName || null,
          rejectionReason: data.rejectionReason || null,
        };
      }
      
      // ì‚­ì œí•  ê¸°ì¡´ ë¬¸ì„œ ID ì¶”ì 
      group.oldDocIds.push(docSnap.id);
    });
    
    console.log(`ğŸ“¦ ${groupMap.size}ê°œ ê·¸ë£¹ìœ¼ë¡œ ì •ë¦¬ë¨`);
    console.log('---');
    
    // 3. ë§ˆì´ê·¸ë ˆì´ì…˜ ë¯¸ë¦¬ë³´ê¸°
    console.log('ğŸ“‹ ë§ˆì´ê·¸ë ˆì´ì…˜ ë¯¸ë¦¬ë³´ê¸°:');
    let totalOldDocs = 0;
    let totalNewDocs = 0;
    
    for (const [groupId, group] of groupMap) {
      console.log(`\nê·¸ë£¹: ${groupId}`);
      console.log(`  - ê¸°ì¡´ ë¬¸ì„œ: ${group.oldDocIds.length}ê°œ`);
      console.log(`  - ìƒˆ ë¬¸ì„œ: 1ê°œ (items ë°°ì—´ ${group.items.length}ê°œ)`);
      console.log(`  - ì²­êµ¬ì: ${group.metadata.userName}`);
      console.log(`  - ì´ì•¡: ${group.items.reduce((sum, item) => sum + item.total, 0).toLocaleString()}ì›`);
      console.log(`  - ìƒíƒœ: ${group.metadata.status}`);
      
      totalOldDocs += group.oldDocIds.length;
      totalNewDocs += 1;
    }
    
    console.log('\n---');
    console.log(`ğŸ“Š ë§ˆì´ê·¸ë ˆì´ì…˜ ìš”ì•½:`);
    console.log(`  - ì‚­ì œë  ë¬¸ì„œ: ${totalOldDocs}ê°œ`);
    console.log(`  - ìƒì„±ë  ë¬¸ì„œ: ${totalNewDocs}ê°œ`);
    console.log(`  - ì ˆê°ë˜ëŠ” ë¬¸ì„œ: ${totalOldDocs - totalNewDocs}ê°œ`);
    console.log('---');
    
    // 4. Dry Runì´ë©´ ì—¬ê¸°ì„œ ì¢…ë£Œ
    if (dryRun) {
      console.log('ğŸ§ª Dry Run ëª¨ë“œ - ì‹¤ì œ ë³€ê²½ ì—†ìŒ');
      console.log('ğŸ’¡ ì‹¤ì œ ë§ˆì´ê·¸ë ˆì´ì…˜: migrateExpenses(spaceId, false)');
      return {
        success: true,
        dryRun: true,
        groups: groupMap.size,
        oldDocs: totalOldDocs,
        newDocs: totalNewDocs,
      };
    }
    
    // 5. ì‹¤ì œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
    console.log('ğŸš€ ì‹¤ì œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘...');
    
    let processedGroups = 0;
    
    for (const [groupId, group] of groupMap) {
      const batch = writeBatch(db);
      
      // ì´ì•¡ ê³„ì‚°
      const totalAmount = group.items.reduce((sum, item) => sum + item.total, 0);
      
      // ìƒˆ ë¬¸ì„œ ìƒì„±
      const newDocRef = doc(expenseRef, groupId);
      const newDocData = {
        ...group.metadata,
        items: group.items,
        totalAmount: totalAmount,
      };
      
      batch.set(newDocRef, newDocData);
      
      // ê¸°ì¡´ ë¬¸ì„œ ì‚­ì œ
      for (const oldDocId of group.oldDocIds) {
        const oldDocRef = doc(expenseRef, oldDocId);
        batch.delete(oldDocRef);
      }
      
      await batch.commit();
      
      processedGroups++;
      console.log(`âœ… [${processedGroups}/${groupMap.size}] ${groupId} ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ`);
    }
    
    console.log('---');
    console.log('ğŸ‰ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ!');
    
    return {
      success: true,
      dryRun: false,
      groups: groupMap.size,
      oldDocs: totalOldDocs,
      newDocs: totalNewDocs,
    };
    
  } catch (error) {
    console.error('âŒ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨:', error);
    throw error;
  }
};

// ì‚¬ìš© ì˜ˆì‹œ
export const runMigration = async (spaceId) => {
  console.log('='.repeat(60));
  console.log('EXPENSE ë§ˆì´ê·¸ë ˆì´ì…˜ ë„êµ¬');
  console.log('='.repeat(60));
  
  // 1ë‹¨ê³„: Dry Run (ë¯¸ë¦¬ë³´ê¸°)
  console.log('\n[1ë‹¨ê³„] Dry Run - ë¯¸ë¦¬ë³´ê¸°\n');
  const previewResult = await migrateExpenses(spaceId, true);
  
  if (!previewResult.success) {
    console.error('ë¯¸ë¦¬ë³´ê¸° ì‹¤íŒ¨');
    return;
  }
  
  console.log('\n' + '='.repeat(60));
  console.log('âš ï¸  ì£¼ì˜: ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
  console.log('='.repeat(60));
  console.log('\nê³„ì†í•˜ë ¤ë©´ ì½˜ì†”ì—ì„œ ë‹¤ìŒì„ ì‹¤í–‰í•˜ì„¸ìš”:');
  console.log(`runMigrationConfirmed("${spaceId}")`);
  
  return previewResult;
};

// í™•ì¸ í›„ ì‹¤í–‰
export const runMigrationConfirmed = async (spaceId) => {
  console.log('\n[2ë‹¨ê³„] ì‹¤ì œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰\n');
  const result = await migrateExpenses(spaceId, false);
  
  if (result.success) {
    console.log('\nâœ… ë§ˆì´ê·¸ë ˆì´ì…˜ ì„±ê³µ!');
    console.log(`ğŸ“Š ${result.oldDocs}ê°œ ë¬¸ì„œ â†’ ${result.newDocs}ê°œ ë¬¸ì„œ`);
    console.log(`ğŸ’¾ ${result.oldDocs - result.newDocs}ê°œ ë¬¸ì„œ ì ˆê°`);
  }
  
  return result;
};

// ë¡¤ë°± í•¨ìˆ˜ (ë¹„ìƒìš©)
export const rollbackMigration = async (spaceId) => {
  console.log('âš ï¸  ë¡¤ë°± ê¸°ëŠ¥ì€ ë°±ì—…ì´ ìˆì–´ì•¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
  console.log('ğŸ’¡ Firebase Consoleì—ì„œ ìˆ˜ë™ìœ¼ë¡œ ë³µêµ¬í•˜ê±°ë‚˜');
  console.log('ğŸ’¡ ë°±ì—…ëœ ë°ì´í„°ë¥¼ ë‹¤ì‹œ import í•˜ì„¸ìš”.');
};

export default {
  runMigration,
  runMigrationConfirmed,
  rollbackMigration,
};
</file>

<file path="src/services/simpleMealService.js">
import { doc, setDoc, getDoc, updateDoc, arrayUnion, arrayRemove, Timestamp } from 'firebase/firestore';
import { db } from '../config/firebase';

/**
 * ê°„ë‹¨í•œ ì‹ì‚¬ ì°¸ì—¬ ì„œë¹„ìŠ¤
 * spaces/{spaceId}/dailyMeals/{date}
 */
class SimpleMealService {
  /**
   * íŠ¹ì • ë‚ ì§œì˜ ì‹ì‚¬ ì°¸ì—¬ì ì¡°íšŒ
   * @param {string} spaceId - ìŠ¤í˜ì´ìŠ¤ ID
   * @param {string} dateStr - ë‚ ì§œ ë¬¸ìì—´ (YYYY-MM-DD)
   * @returns {object} { lunch: [userId...], dinner: [userId...] }
   */
  async getMealParticipants(spaceId, dateStr) {
    try {
      const docRef = doc(db, 'spaces', spaceId, 'dailyMeals', dateStr);
      const docSnap = await getDoc(docRef);

      if (docSnap.exists()) {
        const data = docSnap.data();
        return {
          lunch: data.lunch || [],
          dinner: data.dinner || []
        };
      }

      return { lunch: [], dinner: [] };
    } catch (error) {
      console.error('âŒ ì‹ì‚¬ ì°¸ì—¬ì ì¡°íšŒ ì‹¤íŒ¨:', error);
      return { lunch: [], dinner: [] };
    }
  }

  /**
   * ì ì‹¬ ì°¸ì—¬ í† ê¸€
   * @param {string} spaceId - ìŠ¤í˜ì´ìŠ¤ ID
   * @param {string} dateStr - ë‚ ì§œ ë¬¸ìì—´
   * @param {string} userId - ì‚¬ìš©ì ID
   */
  async toggleLunch(spaceId, dateStr, userId) {
    try {
      const docRef = doc(db, 'spaces', spaceId, 'dailyMeals', dateStr);
      const docSnap = await getDoc(docRef);

      if (!docSnap.exists()) {
        // ë¬¸ì„œê°€ ì—†ìœ¼ë©´ ìƒì„±í•˜ê³  ì¶”ê°€
        await setDoc(docRef, {
          lunch: [userId],
          dinner: [],
          updatedAt: Timestamp.now()
        });
        console.log('âœ… ì ì‹¬ ì°¸ì—¬ (ìƒˆ ë¬¸ì„œ ìƒì„±):', userId);
        return;
      }

      const data = docSnap.data();
      const lunchParticipants = data.lunch || [];

      if (lunchParticipants.includes(userId)) {
        // ì´ë¯¸ ì°¸ì—¬ ì¤‘ì´ë©´ ì œê±°
        await updateDoc(docRef, {
          lunch: arrayRemove(userId),
          updatedAt: Timestamp.now()
        });
        console.log('âœ… ì ì‹¬ ì°¸ì—¬ ì·¨ì†Œ:', userId);
      } else {
        // ì°¸ì—¬ ì¶”ê°€
        await updateDoc(docRef, {
          lunch: arrayUnion(userId),
          updatedAt: Timestamp.now()
        });
        console.log('âœ… ì ì‹¬ ì°¸ì—¬:', userId);
      }
    } catch (error) {
      console.error('âŒ ì ì‹¬ ì°¸ì—¬ í† ê¸€ ì‹¤íŒ¨:', error);
      throw error;
    }
  }

  /**
   * ì €ë… ì°¸ì—¬ í† ê¸€
   * @param {string} spaceId - ìŠ¤í˜ì´ìŠ¤ ID
   * @param {string} dateStr - ë‚ ì§œ ë¬¸ìì—´
   * @param {string} userId - ì‚¬ìš©ì ID
   */
  async toggleDinner(spaceId, dateStr, userId) {
    try {
      const docRef = doc(db, 'spaces', spaceId, 'dailyMeals', dateStr);
      const docSnap = await getDoc(docRef);

      if (!docSnap.exists()) {
        // ë¬¸ì„œê°€ ì—†ìœ¼ë©´ ìƒì„±í•˜ê³  ì¶”ê°€
        await setDoc(docRef, {
          lunch: [],
          dinner: [userId],
          updatedAt: Timestamp.now()
        });
        console.log('âœ… ì €ë… ì°¸ì—¬ (ìƒˆ ë¬¸ì„œ ìƒì„±):', userId);
        return;
      }

      const data = docSnap.data();
      const dinnerParticipants = data.dinner || [];

      if (dinnerParticipants.includes(userId)) {
        // ì´ë¯¸ ì°¸ì—¬ ì¤‘ì´ë©´ ì œê±°
        await updateDoc(docRef, {
          dinner: arrayRemove(userId),
          updatedAt: Timestamp.now()
        });
        console.log('âœ… ì €ë… ì°¸ì—¬ ì·¨ì†Œ:', userId);
      } else {
        // ì°¸ì—¬ ì¶”ê°€
        await updateDoc(docRef, {
          dinner: arrayUnion(userId),
          updatedAt: Timestamp.now()
        });
        console.log('âœ… ì €ë… ì°¸ì—¬:', userId);
      }
    } catch (error) {
      console.error('âŒ ì €ë… ì°¸ì—¬ í† ê¸€ ì‹¤íŒ¨:', error);
      throw error;
    }
  }

  /**
   * ì—¬ëŸ¬ ë‚ ì§œì˜ ì‹ì‚¬ ì°¸ì—¬ì ì¼ê´„ ì¡°íšŒ
   * @param {string} spaceId - ìŠ¤í˜ì´ìŠ¤ ID
   * @param {string[]} dateStrings - ë‚ ì§œ ë¬¸ìì—´ ë°°ì—´
   * @returns {object} { "2024-01-01": { lunch: [], dinner: [] }, ... }
   */
  async getMealsByDateRange(spaceId, dateStrings) {
    try {
      const results = {};

      // ê° ë‚ ì§œë³„ë¡œ ì¡°íšŒ
      await Promise.all(
        dateStrings.map(async (dateStr) => {
          const participants = await this.getMealParticipants(spaceId, dateStr);
          results[dateStr] = participants;
        })
      );

      return results;
    } catch (error) {
      console.error('âŒ ì‹ì‚¬ ë²”ìœ„ ì¡°íšŒ ì‹¤íŒ¨:', error);
      return {};
    }
  }
}

export default new SimpleMealService();
</file>

<file path="src/services/tourService.js">
// src/services/tourService.js
import { doc, getDoc, setDoc, updateDoc, arrayUnion, arrayRemove } from 'firebase/firestore';
import { db } from '../config/firebase';

const tourService = {
  /**
   * ì‚¬ìš©ìê°€ ì™„ë£Œí•œ íˆ¬ì–´ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
   */
  async getCompletedTours(userId) {
    try {
      const userTourRef = doc(db, 'users', userId, 'app', 'tours');
      const userTourSnap = await getDoc(userTourRef);

      if (userTourSnap.exists()) {
        return userTourSnap.data().completedTours || [];
      }
      return [];
    } catch (error) {
      console.error('íˆ¬ì–´ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:', error);
      return [];
    }
  },

  /**
   * íˆ¬ì–´ë¥¼ ì™„ë£Œë¡œ í‘œì‹œ
   */
  async markTourAsCompleted(userId, tourId) {
    try {
      const userTourRef = doc(db, 'users', userId, 'app', 'tours');
      const userTourSnap = await getDoc(userTourRef);

      if (userTourSnap.exists()) {
        // ë¬¸ì„œê°€ ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸
        await updateDoc(userTourRef, {
          completedTours: arrayUnion(tourId),
          lastUpdated: new Date(),
        });
      } else {
        // ë¬¸ì„œê°€ ì—†ìœ¼ë©´ ìƒì„±
        await setDoc(userTourRef, {
          completedTours: [tourId],
          lastUpdated: new Date(),
        });
      }

      console.log('íˆ¬ì–´ ì™„ë£Œ ì €ì¥:', tourId);
    } catch (error) {
      console.error('íˆ¬ì–´ ì™„ë£Œ ì €ì¥ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * íˆ¬ì–´ ë¦¬ì…‹ (ë‹¤ì‹œ ë³´ê¸°)
   */
  async resetTour(userId, tourId) {
    try {
      const userTourRef = doc(db, 'users', userId, 'app', 'tours');
      await updateDoc(userTourRef, {
        completedTours: arrayRemove(tourId),
        lastUpdated: new Date(),
      });

      console.log('íˆ¬ì–´ ë¦¬ì…‹:', tourId);
    } catch (error) {
      console.error('íˆ¬ì–´ ë¦¬ì…‹ ì‹¤íŒ¨:', error);
      throw error;
    }
  },
};

export default tourService;
</file>

<file path="src/utils/constants.js">
// Space ë ˆë²¨ ì‚¬ìš©ì ìœ í˜• (ê° ìŠ¤í˜ì´ìŠ¤ë§ˆë‹¤ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ)
export const USER_TYPES = {
  GUEST: 'guest',
  SHAREHOLDER: 'shareholder',
  VICE_MANAGER: 'vice-manager',
  MANAGER: 'manager'
};

// ì‚¬ìš©ì ìœ í˜• í‘œì‹œëª… (ê¸°ë³¸ê°’, ë‚˜ì¤‘ì— ê° ìŠ¤í˜ì´ìŠ¤ë³„ë¡œ ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ëŠ¥)
export const USER_TYPE_LABELS = {
  'guest': 'ê²ŒìŠ¤íŠ¸',
  'shareholder': 'ì£¼ì£¼',
  'vice-manager': 'ë¶€ë§¤ë‹ˆì €',
  'manager': 'ë§¤ë‹ˆì €'
};

// ê¶Œí•œ ë ˆë²¨ (ìˆ«ìê°€ ë†’ì„ìˆ˜ë¡ ë†’ì€ ê¶Œí•œ)
export const USER_TYPE_LEVEL = {
  'guest': 1,
  'shareholder': 2,
  'vice-manager': 3,
  'manager': 4
};

export const WEEK_DAYS = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
</file>

<file path="src/utils/imageUpload.js">
/**
 * Cloudinary ì´ë¯¸ì§€ ì—…ë¡œë“œ ìœ í‹¸ë¦¬í‹°
 */

const CLOUDINARY_CLOUD_NAME = import.meta.env.VITE_CLOUDINARY_CLOUD_NAME;
const CLOUDINARY_UPLOAD_PRESET = import.meta.env.VITE_CLOUDINARY_UPLOAD_PRESET;

/**
 * ì´ë¯¸ì§€ë¥¼ Cloudinaryì— ì—…ë¡œë“œ
 * @param {File} file - ì—…ë¡œë“œí•  ì´ë¯¸ì§€ íŒŒì¼
 * @param {string} spaceId - ìŠ¤í˜ì´ìŠ¤ ID (í´ë” êµ¬ì¡°ìš©)
 * @returns {Promise<string>} - ì—…ë¡œë“œëœ ì´ë¯¸ì§€ URL
 */
export const uploadImage = async (file, spaceId) => {
  try {
    console.log('ğŸ“¤ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹œì‘:', file.name);
    
    // FormData ìƒì„±
    const formData = new FormData();
    formData.append('file', file);
    formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
    formData.append('folder', `spaces/${spaceId}/expenses`);
    
    // Cloudinary API í˜¸ì¶œ
    const response = await fetch(
      `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`,
      {
        method: 'POST',
        body: formData,
      }
    );
    
    if (!response.ok) {
      throw new Error('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨');
    }
    
    const data = await response.json();
    console.log('âœ… ì´ë¯¸ì§€ ì—…ë¡œë“œ ì„±ê³µ:', data.secure_url);
    
    return data.secure_url;
  } catch (error) {
    console.error('âŒ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨:', error);
    throw error;
  }
};

/**
 * ì—¬ëŸ¬ ì´ë¯¸ì§€ë¥¼ ë™ì‹œì— ì—…ë¡œë“œ
 * @param {File[]} files - ì—…ë¡œë“œí•  ì´ë¯¸ì§€ íŒŒì¼ ë°°ì—´
 * @param {string} spaceId - ìŠ¤í˜ì´ìŠ¤ ID
 * @returns {Promise<string[]>} - ì—…ë¡œë“œëœ ì´ë¯¸ì§€ URL ë°°ì—´
 */
export const uploadMultipleImages = async (files, spaceId) => {
  try {
    console.log('ğŸ“¤ ë‹¤ì¤‘ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹œì‘:', files.length);
    
    const uploadPromises = files.map(file => uploadImage(file, spaceId));
    const urls = await Promise.all(uploadPromises);
    
    console.log('âœ… ë‹¤ì¤‘ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì™„ë£Œ:', urls.length);
    return urls;
  } catch (error) {
    console.error('âŒ ë‹¤ì¤‘ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨:', error);
    throw error;
  }
};

/**
 * ì´ë¯¸ì§€ íŒŒì¼ ìœ íš¨ì„± ê²€ì‚¬
 * @param {File} file - ê²€ì‚¬í•  íŒŒì¼
 * @param {number} maxSizeMB - ìµœëŒ€ íŒŒì¼ í¬ê¸° (MB)
 * @returns {boolean} - ìœ íš¨ì„± ê²€ì‚¬ í†µê³¼ ì—¬ë¶€
 */
export const validateImage = (file, maxSizeMB = 5) => {
  // íŒŒì¼ íƒ€ì… ê²€ì‚¬
  const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
  if (!validTypes.includes(file.type)) {
    throw new Error('JPG, PNG, GIF, WEBP í˜•ì‹ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
  }
  
  // íŒŒì¼ í¬ê¸° ê²€ì‚¬
  const maxSize = maxSizeMB * 1024 * 1024; // MB to bytes
  if (file.size > maxSize) {
    throw new Error(`íŒŒì¼ í¬ê¸°ëŠ” ${maxSizeMB}MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.`);
  }
  
  return true;
};

/**
 * ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° URL ìƒì„±
 * @param {File} file - ë¯¸ë¦¬ë³´ê¸°í•  íŒŒì¼
 * @returns {string} - ë¯¸ë¦¬ë³´ê¸° URL
 */
export const createPreviewUrl = (file) => {
  return URL.createObjectURL(file);
};

/**
 * ë¯¸ë¦¬ë³´ê¸° URL í•´ì œ (ë©”ëª¨ë¦¬ ì •ë¦¬)
 * @param {string} url - í•´ì œí•  URL
 */
export const revokePreviewUrl = (url) => {
  URL.revokeObjectURL(url);
};
</file>

<file path="src/utils/nicknameUtils.js">
// utils/nicknameUtils.js

/**
 * ì£¼ì°¨ë³„ ì¼ê´€ëœ ëœë¤ ë‹‰ë„¤ì„ ìƒì„±
 * ê°™ì€ ì£¼ì—ëŠ” í•­ìƒ ê°™ì€ ë‹‰ë„¤ì„, ë‹¤ìŒ ì£¼ê°€ ë˜ë©´ ìë™ìœ¼ë¡œ ë³€ê²½
 */
export function getWeeklyNickname(userId) {
  if (!userId) return 'ğŸ‘»ìµëª…';

  const animals = [
    'ğŸ°í† ë¼', 'ğŸ¦Šì—¬ìš°', 'ğŸ»ê³°', 'ğŸ¼íŒ¬ë”', 'ğŸ¯í˜¸ë‘ì´',
    'ğŸ¶ê°•ì•„ì§€', 'ğŸ±ê³ ì–‘ì´', 'ğŸ¹í–„ìŠ¤í„°', 'ğŸ¦ì‚¬ì', 'ğŸ¸ê°œêµ¬ë¦¬',
    'ğŸµì›ìˆ­ì´', 'ğŸ¨ì½”ì•Œë¼', 'ğŸ¦ë„ˆêµ¬ë¦¬', 'ğŸºëŠ‘ëŒ€', 'ğŸ¦”ê³ ìŠ´ë„ì¹˜'
  ];

  // í˜„ì¬ ì—°ë„ì™€ ì£¼ì°¨ ê³„ì‚°
  const today = new Date();
  const year = today.getFullYear();
  const weekNumber = getWeekNumber(today);

  // userId + ì—°ë„ + ì£¼ì°¨ë¥¼ ì¡°í•©í•´ì„œ í•´ì‹œ ìƒì„±
  const seed = `${userId}_${year}_${weekNumber}`;
  const hashValue = simpleHash(seed);

  // ë™ë¬¼ê³¼ ë²ˆí˜¸ ì„ íƒ
  const animalIndex = hashValue % animals.length;
  const number = hashValue % 100;

  return `${animals[animalIndex]}${number}`;
}

/**
 * ë™ë¬¼ ì´ëª¨ì§€ë§Œ ë°˜í™˜ (ì¬ë¯¸ ìš”ì†Œìš©)
 */
export function getWeeklyAnimalEmoji(userId) {
  if (!userId) return 'ğŸ‘»';

  const animalEmojis = [
    'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼', 'ğŸ¯',
    'ğŸ¶', 'ğŸ±', 'ğŸ¹', 'ğŸ¦', 'ğŸ¸',
    'ğŸµ', 'ğŸ¨', 'ğŸ¦', 'ğŸº', 'ğŸ¦”'
  ];

  const today = new Date();
  const year = today.getFullYear();
  const weekNumber = getWeekNumber(today);

  const seed = `${userId}_${year}_${weekNumber}`;
  const hashValue = simpleHash(seed);

  const animalIndex = hashValue % animalEmojis.length;

  return animalEmojis[animalIndex];
}

/**
 * ISO 8601 ì£¼ì°¨ ê³„ì‚°
 */
function getWeekNumber(date) {
  const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
  const dayNum = d.getUTCDay() || 7;
  d.setUTCDate(d.getUTCDate() + 4 - dayNum);
  const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
  return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
}

/**
 * ê°„ë‹¨í•œ í•´ì‹œ í•¨ìˆ˜ (SHA-256 ëŒ€ì‹  ì‚¬ìš©)
 */
function simpleHash(str) {
  let hash = 0;
  for (let i = 0; i < str.length; i++) {
    const char = str.charCodeAt(i);
    hash = ((hash << 5) - hash) + char;
    hash = hash & hash; // Convert to 32bit integer
  }
  return Math.abs(hash);
}
</file>

<file path=".gitignore">
node_modules/ 
dist/ 
.env 
.env.local
.env.*.local

# Local Netlify folder
.netlify
".env" 
"loungeap.zip" 
.env.local
.env.*.local
</file>

<file path="DESIGN_UPDATE_GUIDE.md">
# ê²Œí•˜ ì•± ë””ìì¸ ì—…ë°ì´íŠ¸ ê°€ì´ë“œ

## ğŸ“¦ ìˆ˜ì •ëœ íŒŒì¼ (5ê°œ)
1. `index.html` - Pretendard í°íŠ¸ ì¶”ê°€, viewport-fit
2. `src/index.css` - ë‹¤í¬ëª¨ë“œ CSS ë³€ìˆ˜, Pretendard í°íŠ¸
3. `src/services/reservationService.js` - 3ì£¼ ë²”ìœ„ ì¿¼ë¦¬
4. `src/hooks/useReservations.js` - currentWeekStart íŒŒë¼ë¯¸í„°
5. `src/components/reservations/WeeklyList.jsx` - ìƒˆë¡œìš´ ë””ìì¸ ì ìš©

## ğŸ¨ ì£¼ìš” ë””ìì¸ ê°œì„ ì‚¬í•­

### 1. Pretendard í°íŠ¸
- í•œê¸€ ìµœì í™” í°íŠ¸ ì ìš©
- CDNìœ¼ë¡œ ë¹ ë¥¸ ë¡œë”©

### 2. ë‹¤í¬ëª¨ë“œ ì§€ì›1
- CSS ë³€ìˆ˜ë¡œ ë¼ì´íŠ¸/ë‹¤í¬ ìë™ ì „í™˜
- ì‹œìŠ¤í…œ ì„¤ì • ìë™ ê°ì§€

```css
/* ë‹¤í¬ ëª¨ë“œ (ê¸°ë³¸) */
--bg: #0b0f14
--surface: #10151f
--text: #eef2ff

/* ë¼ì´íŠ¸ ëª¨ë“œ */
--bg: #f6f8fb
--surface: #ffffff
--text: #0b1020
```

### 3. details/summary ì¹´ë“œ
- ì ‘ê³  í¼ì¹˜ëŠ” ì¸í„°ë™ì…˜
- ì˜¤ëŠ˜ ë‚ ì§œëŠ” ê¸°ë³¸ìœ¼ë¡œ ì—´ë¦¼
- ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜

### 4. Sticky í—¤ë”
- blur íš¨ê³¼ (backdrop-filter)
- ë°˜íˆ¬ëª… ë°°ê²½
- ìŠ¤í¬ë¡¤í•´ë„ ìƒë‹¨ ê³ ì •

### 5. í”Œë¡œíŒ… ë²„íŠ¼
- ìš°ì¸¡ í•˜ë‹¨ ê³ ì •
- ê·¸ë¦¼ì íš¨ê³¼
- Safe-area ì§€ì› (ì•„ì´í° ë…¸ì¹˜ ëŒ€ì‘)

### 6. ì£¼ê°„ ë„¤ë¹„ê²Œì´ì…˜
- ì¹© ìŠ¤íƒ€ì¼ ë²„íŠ¼
- ë‚ ì§œ ë²”ìœ„ í‘œì‹œ (2025.11.10 ~ 11.16)
- í•œ ì¤„ ë°°ì¹˜, ì‘ì€ í™”ë©´ì—ì„œ wrap

### 7. ì˜ˆì•½ ìƒíƒœ ë°°ì§€
- "ì˜ˆì•½ ì—†ìŒ" (íšŒìƒ‰)
- "ì—¬ìœ " (ì´ˆë¡ìƒ‰, 0-2ëª…)
- "ì˜ˆì•½ ë§ìŒ" (ì£¼í™©ìƒ‰, 3ëª… ì´ìƒ)

### 8. Safe-area ì§€ì›
- iOS ë…¸ì¹˜/ë‹¤ì´ë‚˜ë¯¹ ì•„ì¼ëœë“œ ëŒ€ì‘
- env(safe-area-inset-*) í™œìš©

## ğŸš€ Git ì»¤ë°‹ ë°©ë²•

```bash
# 1. í”„ë¡œì íŠ¸ í´ë”ë¡œ ì´ë™
cd "C:\Users\seoka\OneDrive\web\251106 geha1806"

# 2. ìˆ˜ì •ëœ 5ê°œ íŒŒì¼ ë³µì‚¬
# - index.html
# - src/index.css
# - src/services/reservationService.js
# - src/hooks/useReservations.js
# - src/components/reservations/WeeklyList.jsx

# 3. Git ì»¤ë°‹
git add index.html src/index.css src/services/reservationService.js src/hooks/useReservations.js src/components/reservations/WeeklyList.jsx
git commit -m "ë””ìì¸ ê°œì„ : ë‹¤í¬ëª¨ë“œ, Pretendard í°íŠ¸, details ì¹´ë“œ UI"
git push

# 4. Netlify ìë™ ë°°í¬ í™•ì¸ (1~2ë¶„)
```

## ğŸ¯ í…ŒìŠ¤íŠ¸ í™•ì¸ì‚¬í•­
1. âœ… ë‹¤í¬ëª¨ë“œ / ë¼ì´íŠ¸ëª¨ë“œ ìë™ ì „í™˜
2. âœ… Pretendard í°íŠ¸ ì ìš©
3. âœ… details ì¹´ë“œ ì ‘ê¸°/í¼ì¹˜ê¸°
4. âœ… ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ë³¸ ì—´ë¦¼
5. âœ… Sticky í—¤ë” ìŠ¤í¬ë¡¤ì‹œ ê³ ì •
6. âœ… í”Œë¡œíŒ… ë²„íŠ¼ ìš°ì¸¡ í•˜ë‹¨
7. âœ… 3ì£¼ ë²”ìœ„ë§Œ ë¡œë”© (ì„±ëŠ¥ ê°œì„ )
8. âœ… Safe-area ì ìš© (iOS)

## ğŸ“± ëª¨ë°”ì¼ ìµœì í™”
- max-width: 720px
- í„°ì¹˜ ì¹œí™”ì  ë²„íŠ¼ í¬ê¸°
- ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤
- ì•„ì´í° ë…¸ì¹˜ ëŒ€ì‘

## ğŸ¨ ìƒ‰ìƒ ì‹œìŠ¤í…œ
```
Brand: #2563eb (íŒŒë€ìƒ‰)
Success: #16a34a (ì´ˆë¡ìƒ‰)
Warning: #d97706 (ì£¼í™©ìƒ‰)
Muted: #97a3b6 (íšŒìƒ‰)
Radius: 14px (ë‘¥ê·¼ ëª¨ì„œë¦¬)
```

## ğŸ’¡ ë‹¤ìŒ ê°œì„  ì‚¬í•­
- [ ] ìŠ¤ì¼ˆë ˆí†¤ ë¡œë”©
- [ ] ì—ëŸ¬ ë°”ìš´ë”ë¦¬
- [ ] ì˜¤í”„ë¼ì¸ ì§€ì›
- [ ] PWA ì„¤ì •
</file>

<file path="docs/TMP.HTML">
Sssdfsdf
</file>

<file path="index.html">
<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />

    <!-- Font -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" />
    <link
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css"
      rel="stylesheet"
    />

    <title>ê²Œí•˜ ì•± - ì˜ˆì•½ ê´€ë¦¬</title>

    <!-- =====================================================
         Eruda (mobile debugger)
         - local dev : VITE_ENABLE_ERUDA=true  â†’ ON
         - prod      : VITE_ENABLE_ERUDA=false â†’ OFF
         ===================================================== -->
    <script>
      (function () {
        // âš ï¸ ViteëŠ” build ì‹œ %VITE_ENABLE_ERUDA% ë¥¼ ë¬¸ìì—´ë¡œ ì¹˜í™˜í•¨
        // ì˜ˆ)
        //  - dev  : 'true'
        //  - prod : 'false'
        if ('%VITE_ENABLE_ERUDA%' !== 'true') return;

        const s = document.createElement('script');
        s.src = 'https://cdn.jsdelivr.net/npm/eruda';
        s.onload = function () {
          if (window.eruda) window.eruda.init();
        };
        document.head.appendChild(s);
      })();
    </script>
  </head>

  <body>
    <div id="root"></div>

    <!-- Vite entry -->
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
</file>

<file path="src/components/auth/KakaoLogin.jsx">
// src/components/auth/KakaoLogin.jsx

// âœ… named import ëŒ€ì‘
export const KakaoLogin = () => {
  const handleLogin = () => {
    const REST_API_KEY = import.meta.env.VITE_KAKAO_REST_API_KEY;

    // í˜„ì¬ ì ‘ì† ì¤‘ì¸ í˜¸ìŠ¤íŠ¸ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ URI ë™ì  ìƒì„±
    const currentOrigin = window.location.origin;
    const REDIRECT_URI = `${currentOrigin}/auth/kakao/callback`;

    // í˜„ì¬ ê²½ë¡œë¥¼ stateë¡œ ì „ë‹¬ (ì´ˆëŒ€ ì½”ë“œ ìœ ì§€)
    const currentPath = window.location.pathname;
    const state = encodeURIComponent(JSON.stringify({ from: currentPath }));

    console.log('ğŸ”‘ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ë¦¬ë‹¤ì´ë ‰íŠ¸ URI:', REDIRECT_URI);
    console.log('ğŸ”‘ ì›ë˜ ê²½ë¡œ (state):', currentPath);

    const kakaoURL =
      `https://kauth.kakao.com/oauth/authorize?client_id=${REST_API_KEY}` +
      `&redirect_uri=${encodeURIComponent(REDIRECT_URI)}` +
      `&response_type=code` +
      `&state=${state}`;

    window.location.href = kakaoURL;
  };

  return (
    <button
      onClick={handleLogin}
      className="flex items-center justify-center gap-2 bg-[#FEE500] hover:bg-[#FDD835]
                 text-black font-medium px-6 py-3 rounded-lg transition-colors w-full max-w-xs"
    >
      <span>ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸</span>
    </button>
  );
};

// âœ… default importë„ ê¸°ì¡´ëŒ€ë¡œ ìœ ì§€
export default KakaoLogin;
</file>

<file path="src/components/praise/PraiseCard.jsx">
// components/praise/PraiseCard.jsx
import { useState } from 'react';
import { Calendar, CheckCircle, XCircle, Edit2, Save, ImageIcon } from 'lucide-react';
import { formatDate } from '../../utils/dateUtils';
import { getWeeklyAnimalEmoji, getWeeklyNickname } from '../../utils/nicknameUtils';
import PraiseDetailModal from './PraiseDetailModal';

export default function PraiseCard({ praise, isManager, onApprove, onReject, onUpdate, weeklyCount }) {
  const [isEditing, setIsEditing] = useState(false);
  const [editedText, setEditedText] = useState(praise.refinedText);
  const [editedCategory, setEditedCategory] = useState(praise.category || 'ê¸°íƒ€');
  const [editedItemName, setEditedItemName] = useState(praise.itemName || '');
  const [showDetailModal, setShowDetailModal] = useState(false);

  const isPending = praise.status === 'pending';
  // ì €ì¥ëœ ê°’ ì‚¬ìš© (ì—†ìœ¼ë©´ ë™ì  ìƒì„± - í•˜ìœ„í˜¸í™˜ì„±)
  const animalEmoji = praise.animalEmoji || getWeeklyAnimalEmoji(praise.userId);
  const nickname = praise.nickname || getWeeklyNickname(praise.userId);

  const handleSave = async () => {
    try {
      await onUpdate(praise.id, {
        refinedText: editedText,
        category: editedCategory,
        itemName: editedItemName
      });
      setIsEditing(false);
    } catch (error) {
      console.error('ìˆ˜ì • ì‹¤íŒ¨:', error);
      alert('ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
    }
  };

  const handleCardClick = () => {
    // ê´€ë¦¬ìê°€ í¸ì§‘ ì¤‘ì´ ì•„ë‹ ë•Œë§Œ ìƒì„¸ ëª¨ë‹¬ ì—´ê¸°
    if (!isEditing) {
      setShowDetailModal(true);
    }
  };

  const getCategoryIcon = (category) => {
    switch(category) {
      case 'ë¬¼í’ˆê¸°ë¶€': return 'ğŸ';
      case 'ì²­ì†Œì •ë¦¬': return 'ğŸ§¹';
      case 'ê¸°íƒ€': return 'âœ¨';
      default: return 'âœ¨';
    }
  };

  return (
    <>
      <div 
        className={`bg-white rounded-lg p-4 border shadow-sm cursor-pointer hover:shadow-md transition-shadow ${
          isPending ? 'border-amber-300 bg-amber-50' : 'border-gray-200'
        }`}
        onClick={handleCardClick}
      >
        {/* í—¤ë” */}
        <div className="flex items-start justify-between mb-3">
          <div className="flex items-center gap-2">
            <span className="text-2xl">{animalEmoji}</span>
            {/* ê´€ë¦¬ìì—ê²Œë§Œ ë‹‰ë„¤ì„ + ì£¼ê°„ ì œë³´ íšŸìˆ˜ í‘œì‹œ */}
            {isManager && isPending && (
              <div className="flex flex-col">
                <span className="text-xs font-medium text-gray-700">{nickname}</span>
                {weeklyCount > 0 && (
                  <span className="text-xs text-gray-500">ì´ë²ˆ ì£¼ {weeklyCount}ë²ˆ ì œë³´</span>
                )}
              </div>
            )}
            {isPending && (
              <span className="text-xs bg-amber-100 text-amber-700 px-2 py-0.5 rounded-full font-medium">
                ìŠ¹ì¸ëŒ€ê¸°
              </span>
            )}
          </div>
          {/* ì„ í–‰ ë°œìƒ ë‚ ì§œ */}
          <div className="flex items-center gap-1 text-xs text-gray-500">
            <Calendar size={14} />
            {formatDate(praise.eventDate)}
          </div>
        </div>

        {/* ì¹´í…Œê³ ë¦¬ ì •ë³´ (ê´€ë¦¬ìì—ê²Œë§Œ í‘œì‹œ) */}
        {isManager && isPending && (
          <div className="mb-3 space-y-2">
            {isEditing ? (
              <>
                {/* í¸ì§‘ ëª¨ë“œ: ì„ íƒ ê°€ëŠ¥ */}
                <div onClick={(e) => e.stopPropagation()}>
                  <label className="block text-xs font-medium text-gray-700 mb-1">ì¹´í…Œê³ ë¦¬</label>
                  <select
                    value={editedCategory}
                    onChange={(e) => setEditedCategory(e.target.value)}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                  >
                    <option value="ë¬¼í’ˆê¸°ë¶€">ğŸ ë¬¼í’ˆê¸°ë¶€</option>
                    <option value="ì²­ì†Œì •ë¦¬">ğŸ§¹ ì²­ì†Œì •ë¦¬</option>
                    <option value="ê¸°íƒ€">âœ¨ ê¸°íƒ€</option>
                  </select>
                </div>
                
                {editedCategory === 'ë¬¼í’ˆê¸°ë¶€' && (
                  <div onClick={(e) => e.stopPropagation()}>
                    <label className="block text-xs font-medium text-gray-700 mb-1">ë¬¼í’ˆëª…</label>
                    <input
                      type="text"
                      value={editedItemName}
                      onChange={(e) => setEditedItemName(e.target.value)}
                      placeholder="ì˜ˆ: ë¼ì§€ê³ ê¸°"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                )}
              </>
            ) : (
              <>
                {/* ë³´ê¸° ëª¨ë“œ: í…ìŠ¤íŠ¸ë¡œ í‘œì‹œ */}
                <div className="bg-gray-50 border border-gray-200 rounded-lg p-2 text-sm">
                  <span className="text-gray-600">ì¹´í…Œê³ ë¦¬: </span>
                  <span className="font-medium text-gray-900">
                    {getCategoryIcon(praise.category)} {praise.category || 'ê¸°íƒ€'}
                  </span>
                </div>
                
                {praise.category === 'ë¬¼í’ˆê¸°ë¶€' && praise.itemName && (
                  <div className="bg-blue-50 border border-blue-200 rounded-lg p-2 text-sm">
                    <span className="text-blue-700">ë¬¼í’ˆëª…: </span>
                    <span className="font-medium text-blue-900">{praise.itemName}</span>
                  </div>
                )}
              </>
            )}
          </div>
        )}

        {/* ë‚´ìš© */}
        {isEditing ? (
          <textarea
            value={editedText}
            onChange={(e) => setEditedText(e.target.value)}
            onClick={(e) => e.stopPropagation()}
            className="w-full px-3 py-2 border border-blue-300 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none mb-3"
            rows={3}
          />
        ) : (
          <p className="text-gray-900 leading-relaxed mb-3">
            {praise.refinedText}
          </p>
        )}

        {/* í•˜ë‹¨: ì‚¬ì§„ ì•„ì´ì½˜ + ë¬¼í’ˆ íƒœê·¸ */}
        <div className="flex items-center justify-between text-sm">
          {praise.imageUrl && (
            <div className="flex items-center gap-1 text-gray-600">
              <ImageIcon size={16} />
              <span>ì‚¬ì§„ ìˆìŒ</span>
            </div>
          )}
          
          {praise.category === 'ë¬¼í’ˆê¸°ë¶€' && praise.itemName && (
            <div className="flex items-center gap-1 text-blue-600 font-medium ml-auto">
              {getCategoryIcon(praise.category)}
              <span>{praise.itemName}</span>
            </div>
          )}
        </div>

        {/* ì›ë³¸ í…ìŠ¤íŠ¸ (ê´€ë¦¬ìë§Œ) */}
        {isManager && isPending && !isEditing && (
          <details className="mt-3" onClick={(e) => e.stopPropagation()}>
            <summary className="text-xs text-gray-600 cursor-pointer hover:text-gray-900">
              ì›ë³¸ ë³´ê¸°
            </summary>
            <p className="text-sm text-gray-600 mt-2 pl-3 border-l-2 border-gray-300">
              {praise.originalText}
            </p>
          </details>
        )}

        {/* ê´€ë¦¬ì ì•¡ì…˜ ë²„íŠ¼ */}
        {isManager && isPending && (
          <div className="space-y-2 mt-3" onClick={(e) => e.stopPropagation()}>
            {isEditing ? (
              <div className="flex gap-2 pt-3 border-t border-gray-200">
                <button
                  onClick={handleSave}
                  className="flex-1 py-2 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-1 border border-blue-200"
                >
                  <Save size={16} />
                  ì €ì¥
                </button>
                <button
                  onClick={() => {
                    setEditedText(praise.refinedText);
                    setEditedCategory(praise.category || 'ê¸°íƒ€');
                    setEditedItemName(praise.itemName || '');
                    setIsEditing(false);
                  }}
                  className="flex-1 py-2 bg-gray-50 hover:bg-gray-100 text-gray-700 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-1 border border-gray-200"
                >
                  ì·¨ì†Œ
                </button>
              </div>
            ) : (
              <>
                <button
                  onClick={() => setIsEditing(true)}
                  className="w-full py-2 bg-gray-50 hover:bg-gray-100 text-gray-700 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-1 border border-gray-200"
                >
                  <Edit2 size={16} />
                  ìˆ˜ì •
                </button>
                <div className="flex gap-2">
                  <button
                    onClick={() => onApprove(praise.id)}
                    className="flex-1 py-2 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-1 border border-green-200"
                  >
                    <CheckCircle size={16} />
                    ìŠ¹ì¸
                  </button>
                  <button
                    onClick={() => onReject(praise.id)}
                    className="flex-1 py-2 bg-red-50 hover:bg-red-100 text-red-700 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-1 border border-red-200"
                  >
                    <XCircle size={16} />
                    ê±°ë¶€
                  </button>
                </div>
              </>
            )}
          </div>
        )}
      </div>

      {/* ìƒì„¸ ëª¨ë‹¬ */}
      {showDetailModal && (
        <PraiseDetailModal
          praise={praise}
          onClose={() => setShowDetailModal(false)}
        />
      )}
    </>
  );
}
</file>

<file path="src/components/praise/PraiseDetailModal.jsx">
// components/praise/PraiseDetailModal.jsx
import { X, Calendar } from 'lucide-react';
import { formatDate } from '../../utils/dateUtils';
import { getWeeklyAnimalEmoji } from '../../utils/nicknameUtils';

export default function PraiseDetailModal({ praise, onClose }) {
  // ì €ì¥ëœ ê°’ ì‚¬ìš© (ì—†ìœ¼ë©´ ë™ì  ìƒì„± - í•˜ìœ„í˜¸í™˜ì„±)
  const animalEmoji = praise.animalEmoji || getWeeklyAnimalEmoji(praise.userId);

  const getCategoryIcon = (category) => {
    switch(category) {
      case 'ë¬¼í’ˆê¸°ë¶€': return 'ğŸ';
      case 'ì²­ì†Œì •ë¦¬': return 'ğŸ§¹';
      case 'ê¸°íƒ€': return 'âœ¨';
      default: return 'âœ¨';
    }
  };

  return (
    <>
      {/* ë°±ë“œë¡­ */}
      <div 
        className="fixed inset-0 bg-black/50 z-[100]"
        onClick={onClose}
      />
      
      {/* ëª¨ë‹¬ */}
      <div className="fixed inset-0 z-[101] flex items-end sm:items-center justify-center p-0 sm:p-4">
        <div 
          className="bg-white w-full sm:max-w-md overflow-hidden flex flex-col rounded-t-2xl sm:rounded-2xl"
          style={{
            maxHeight: '85vh',
            height: 'auto'
          }}
          onClick={(e) => e.stopPropagation()}
        >
          {/* í—¤ë” */}
          <div className="flex items-center justify-between p-4 border-b border-gray-200 bg-white">
            <h2 className="text-xl font-bold text-gray-900">ì¹­ì°¬ ìƒì„¸</h2>
            <button
              onClick={onClose}
              className="w-10 h-10 rounded-full flex items-center justify-center hover:bg-gray-100 transition-colors"
            >
              <X className="w-6 h-6 text-gray-500" />
            </button>
          </div>
          
          {/* ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ ì»¨í…ì¸  */}
          <div className="flex-1 overflow-y-auto p-4 space-y-4">
            {/* ê¸°ë³¸ ì •ë³´ */}
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-2">
                <span className="text-3xl">{animalEmoji}</span>
              </div>
              <div className="flex items-center gap-1 text-sm text-gray-500">
                <Calendar size={16} />
                {formatDate(praise.eventDate)}
              </div>
            </div>

            {/* ë‚´ìš© */}
            <div className="bg-gray-50 rounded-lg p-4">
              <p className="text-gray-900 leading-relaxed">
                {praise.refinedText}
              </p>
            </div>

            {/* ì‚¬ì§„ */}
            {praise.imageUrl && (
              <div>
                <h3 className="text-sm font-bold text-gray-900 mb-2">ğŸ“· ì‚¬ì§„</h3>
                <div className="relative">
                  <img 
                    src={praise.imageUrl} 
                    alt="ì¹­ì°¬ ì‚¬ì§„"
                    className="w-full rounded-lg border border-gray-200 cursor-pointer hover:opacity-90 transition-opacity"
                    onClick={() => window.open(praise.imageUrl, '_blank')}
                  />
                  <div className="absolute top-2 right-2 bg-black/50 text-white px-2 py-1 rounded text-xs">
                    í´ë¦­í•˜ì—¬ í¬ê²Œ ë³´ê¸°
                  </div>
                </div>
              </div>
            )}

            {/* ë¬¼í’ˆ ì •ë³´ */}
            {praise.category === 'ë¬¼í’ˆê¸°ë¶€' && praise.itemName && (
              <div className="bg-blue-50 border border-blue-200 rounded-lg p-3">
                <div className="flex items-center gap-2 text-blue-700">
                  <span className="text-xl">{getCategoryIcon(praise.category)}</span>
                  <span className="font-medium">{praise.itemName}</span>
                </div>
              </div>
            )}
          </div>
        </div>
      </div>
    </>
  );
}
</file>

<file path="src/components/praise/PraiseModal.jsx">
// components/praise/PraiseModal.jsx
import { useState } from 'react';
import { X, Loader2, Upload } from 'lucide-react';
import { useAuth } from '../../hooks/useAuth';
import useStore from '../../store/useStore';
import praiseService from '../../services/praiseService';
import { getWeeklyNickname, getWeeklyAnimalEmoji } from '../../utils/nicknameUtils';

export default function PraiseModal({ onClose, onSuccess }) {
  const { user } = useAuth();
  const { selectedSpace } = useStore();
  const [loading, setLoading] = useState(false);
  const [uploading, setUploading] = useState(false);
  const [imageFile, setImageFile] = useState(null);
  const [imagePreview, setImagePreview] = useState(null);
  const [formData, setFormData] = useState({
    rawText: '',
    eventDate: new Date().toISOString().split('T')[0]
  });

  const handleImageSelect = (e) => {
    const file = e.target.files[0];
    if (!file) return;

    if (file.size > 10 * 1024 * 1024) {
      alert('íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤');
      return;
    }

    setImageFile(file);
    const reader = new FileReader();
    reader.onloadend = () => {
      setImagePreview(reader.result);
    };
    reader.readAsDataURL(file);
  };

  const removeImage = () => {
    setImageFile(null);
    setImagePreview(null);
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!formData.rawText.trim()) {
      alert('ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
      return;
    }

    setLoading(true);
    try {
      // 1. ì‚¬ì§„ ì—…ë¡œë“œ (ìˆëŠ” ê²½ìš°)
      let imageUrl = null;
      if (imageFile) {
        setUploading(true);
        const uploadFormData = new FormData();
        uploadFormData.append('file', imageFile);
        uploadFormData.append('upload_preset', import.meta.env.VITE_CLOUDINARY_UPLOAD_PRESET_PRAISE);
        uploadFormData.append('folder', `spaces/${selectedSpace.id}/praises`);

        const uploadResponse = await fetch(
          `https://api.cloudinary.com/v1_1/dhnyr34t1/image/upload`,
          {
            method: 'POST',
            body: uploadFormData
          }
        );

        if (!uploadResponse.ok) {
          const errorData = await uploadResponse.json();
          console.error('Cloudinary ì˜¤ë¥˜:', errorData);
          throw new Error('ì‚¬ì§„ ì—…ë¡œë“œ ì‹¤íŒ¨');
        }

        const uploadResult = await uploadResponse.json();
        imageUrl = uploadResult.secure_url;
        console.log('âœ… ì‚¬ì§„ ì—…ë¡œë“œ ì™„ë£Œ:', imageUrl);
        setUploading(false);
      }

      // 2. AI ì²˜ë¦¬
      console.log('ğŸ¤– AI ì²˜ë¦¬ ì‹œì‘...');
      const aiResponse = await fetch('/.netlify/functions/process-praise', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          rawText: formData.rawText,
          eventDate: formData.eventDate
        })
      });

      if (!aiResponse.ok) {
        throw new Error('AI ì²˜ë¦¬ ì‹¤íŒ¨');
      }

      const aiResult = await aiResponse.json();
      console.log('âœ… AI ì²˜ë¦¬ ì™„ë£Œ:', aiResult);

      // 3. Firebaseì— ì €ì¥
      const weeklyNickname = getWeeklyNickname(user.id);
      const weeklyAnimalEmoji = getWeeklyAnimalEmoji(user.id);

      const praiseData = {
        userId: user.id,
        userName: weeklyNickname,
        animalEmoji: weeklyAnimalEmoji,
        nickname: weeklyNickname,
        userType: selectedSpace.userType,
        originalText: aiResult.originalText,
        refinedText: aiResult.refinedText,
        category: aiResult.category,
        itemName: aiResult.itemName,
        eventDate: formData.eventDate,
        imageUrl: imageUrl,
        status: 'pending'
      };

      await praiseService.create(selectedSpace.id, praiseData);
      console.log('âœ… ì¹­ì°¬ ë“±ë¡ ì™„ë£Œ');

      // 4. ê´€ë¦¬ì ì´ë©”ì¼ ì•Œë¦¼
      try {
        await fetch('/.netlify/functions/send-praise-notification', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            spaceId: selectedSpace.id,
            spaceName: selectedSpace.spaceName,
            userName: weeklyNickname,
            originalText: aiResult.originalText,
            refinedText: aiResult.refinedText,
            eventDate: formData.eventDate
          })
        });
        console.log('ğŸ“§ ê´€ë¦¬ì ì•Œë¦¼ ë°œì†¡ ì™„ë£Œ');
      } catch (emailError) {
        console.warn('ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨ (ë¬´ì‹œ):', emailError);
      }

      alert('ì¹­ì°¬ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!\nê´€ë¦¬ì ìŠ¹ì¸ í›„ ê²Œì‹œë©ë‹ˆë‹¤.');
      onSuccess();

    } catch (error) {
      console.error('âŒ ì¹­ì°¬ ë“±ë¡ ì‹¤íŒ¨:', error);
      alert('ì¹­ì°¬ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\nì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
      setLoading(false);
      setUploading(false);
    }
  };

  return (
    <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center">
      {/* ë°±ë“œë¡­ */}
      <div 
        className="absolute inset-0 bg-black/50"
        onClick={onClose}
      />

      {/* ëª¨ë‹¬ */}
      <div className="relative w-full max-w-[600px] bg-white rounded-t-2xl sm:rounded-2xl shadow-2xl max-h-[90vh] overflow-y-auto">
        {/* í—¤ë” */}
        <div className="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between rounded-t-2xl">
          <h2 className="text-lg font-bold text-gray-900">âœ¨ ì¹­ì°¬í•˜ê¸°</h2>
          <button
            onClick={onClose}
            className="text-gray-500 hover:text-gray-700 transition-colors"
            disabled={loading}
          >
            <X size={24} />
          </button>
        </div>

        {/* í¼ */}
        <form onSubmit={handleSubmit} className="p-6 space-y-6">
          {/* ë‚´ìš© ì…ë ¥ */}
          <div>
            <label className="block text-sm font-medium text-gray-900 mb-2">
              ì¹­ì°¬í•˜ê³  ì‹¶ì€ ì¼ì„ ì ì–´ì£¼ì„¸ìš”
            </label>
            <textarea
              value={formData.rawText}
              onChange={(e) => setFormData({ ...formData, rawText: e.target.value })}
              placeholder="ì˜ˆ: ì˜¤ëŠ˜ ì„¤ê±°ì§€ ë‹¤ í•´ë†¨ì–´ìš”&#10;ì˜ˆ: ì“°ë ˆê¸° ë¶„ë¦¬ìˆ˜ê±° í–ˆìŠµë‹ˆë‹¤"
              className="w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
              rows={5}
              disabled={loading}
            />
            <p className="mt-2 text-xs text-gray-500">
              ğŸ’¡ AIê°€ ìë™ìœ¼ë¡œ ìµëª…í™”í•˜ê³  ì •ë¦¬í•´ë“œë¦½ë‹ˆë‹¤
            </p>
          </div>

          {/* ë‚ ì§œ ì„ íƒ */}
          <div>
            <label className="block text-sm font-medium text-gray-900 mb-2">
              ì–¸ì œ ìˆì—ˆë˜ ì¼ì¸ê°€ìš”?
            </label>
            <input
              type="date"
              value={formData.eventDate}
              onChange={(e) => setFormData({ ...formData, eventDate: e.target.value })}
              className="w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              disabled={loading}
              max={new Date().toISOString().split('T')[0]}
            />
          </div>

          {/* ì‚¬ì§„ ì²¨ë¶€ */}
          <div>
            <label className="block text-sm font-medium text-gray-900 mb-2">
              ğŸ“· ì‚¬ì§„ (ì„ íƒ)
            </label>
            
            {!imagePreview ? (
              <label className="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition-colors">
                <div className="flex flex-col items-center justify-center pt-5 pb-6">
                  <Upload className="w-10 h-10 text-gray-400 mb-2" />
                  <p className="text-sm text-gray-600">í´ë¦­í•˜ì—¬ ì‚¬ì§„ ì„ íƒ</p>
                  <p className="text-xs text-gray-500 mt-1">ìµœëŒ€ 10MB</p>
                </div>
                <input
                  type="file"
                  accept="image/*"
                  onChange={handleImageSelect}
                  className="hidden"
                  disabled={loading}
                />
              </label>
            ) : (
              <div className="relative">
                <img
                  src={imagePreview}
                  alt="ë¯¸ë¦¬ë³´ê¸°"
                  className="w-full h-48 object-cover rounded-lg border border-gray-300"
                />
                <button
                  type="button"
                  onClick={removeImage}
                  className="absolute top-2 right-2 w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors"
                  disabled={loading}
                >
                  <X size={16} />
                </button>
              </div>
            )}
          </div>

          {/* ì œì¶œ ë²„íŠ¼ */}
          <button
            type="submit"
            disabled={loading || uploading}
            className="w-full py-3 bg-blue-500 hover:bg-blue-600 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
          >
            {uploading ? (
              <>
                <Loader2 size={20} className="animate-spin" />
                ì‚¬ì§„ ì—…ë¡œë“œ ì¤‘...
              </>
            ) : loading ? (
              <>
                <Loader2 size={20} className="animate-spin" />
                ì²˜ë¦¬ ì¤‘...
              </>
            ) : (
              'ì œì¶œí•˜ê¸°'
            )}
          </button>
        </form>
      </div>
    </div>
  );
}
</file>

<file path="src/components/reservations/HostSearchInput.jsx">
import { useState, useEffect } from 'react';
import { Search, X, User } from 'lucide-react';
import { collection, getDocs, query, where } from 'firebase/firestore';
import { db } from '../../config/firebase';
import authService from '../../services/authService';

const HostSearchInput = ({ spaceId, onSelect, selectedHost }) => {
  const [searchQuery, setSearchQuery] = useState('');
  const [shareholders, setShareholders] = useState([]);
  const [filteredHosts, setFilteredHosts] = useState([]);
  const [showDropdown, setShowDropdown] = useState(false);
  const [userProfiles, setUserProfiles] = useState({}); // userId -> {displayName, profileImage}

  // ì£¼ì£¼ ëª©ë¡ ë¡œë“œ
  useEffect(() => {
    const loadShareholders = async () => {
      if (!spaceId) return;

      try {
        console.log('ğŸ” ì£¼ì£¼ ëª©ë¡ ë¡œë“œ ì‹œì‘:', spaceId);

        // spaces/{spaceId}/assignedUsersì—ì„œ shareholder ì´ìƒë§Œ ê°€ì ¸ì˜¤ê¸°
        const usersRef = collection(db, `spaces/${spaceId}/assignedUsers`);
        const snapshot = await getDocs(usersRef);

        const hosts = [];
        snapshot.forEach((doc) => {
          const data = doc.data();
          const userType = data.userType || '';

          // shareholder, manager, vice-managerë§Œ ì´ˆëŒ€ì ê°€ëŠ¥
          if (['shareholder', 'manager', 'vice-manager'].includes(userType)) {
            hosts.push({
              id: doc.id,
              displayName: data.displayName || 'ì´ë¦„ì—†ìŒ',
              userType: data.userType
            });
          }
        });

        console.log('âœ… ì£¼ì£¼ ëª©ë¡:', hosts);
        setShareholders(hosts);

        // users ì»¬ë ‰ì…˜ì—ì„œ í”„ë¡œí•„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const userIds = hosts.map(h => h.id);
        if (userIds.length > 0) {
          const profiles = await authService.getUserProfiles(userIds);
          setUserProfiles(profiles);
        }
      } catch (error) {
        console.error('âŒ ì£¼ì£¼ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
      }
    };

    loadShareholders();
  }, [spaceId]);

  // ê²€ìƒ‰ì–´ì— ë”°ë¼ í•„í„°ë§
  useEffect(() => {
    if (!searchQuery.trim()) {
      setFilteredHosts([]);
      setShowDropdown(false);
      return;
    }

    const query = searchQuery.toLowerCase();
    const filtered = shareholders.filter(host =>
      host.displayName.toLowerCase().includes(query)
    );
    
    setFilteredHosts(filtered);
    setShowDropdown(true);
  }, [searchQuery, shareholders]);

  const handleSelect = (host) => {
    onSelect(host);
    setSearchQuery(host.displayName);
    setShowDropdown(false);
  };

  const handleClear = () => {
    setSearchQuery('');
    onSelect(null);
    setShowDropdown(false);
  };

  return (
    <div className="relative">
      <label className="block text-sm font-medium text-gray-700 mb-2">
        ì´ˆëŒ€ì ì„ íƒ <span className="text-red-500">*</span>
      </label>
      
      {/* ì„ íƒëœ ì´ˆëŒ€ì í‘œì‹œ */}
      {selectedHost ? (
        <div className="flex items-center gap-3 p-3 bg-blue-50 border-2 border-blue-500 rounded-lg">
          {(() => {
            const userProfile = userProfiles[selectedHost.id];
            const profileImage = userProfile?.profileImage || '';
            const displayName = userProfile?.displayName || selectedHost.displayName;

            return (
              <>
                {profileImage ? (
                  <img
                    src={profileImage}
                    alt={displayName}
                    className="w-10 h-10 rounded-full object-cover"
                  />
                ) : (
                  <div className="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold">
                    {displayName[0]}
                  </div>
                )}
                <div className="flex-1">
                  <div className="font-semibold text-gray-900">{displayName}</div>
                  <div className="text-xs text-gray-500">ì£¼ì£¼</div>
                </div>
                <button
                  onClick={handleClear}
                  className="p-2 hover:bg-blue-100 rounded-lg"
                >
                  <X className="w-5 h-5 text-gray-500" />
                </button>
              </>
            );
          })()}
        </div>
      ) : (
        <>
          {/* ê²€ìƒ‰ ì…ë ¥ */}
          <div className="relative">
            <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" />
            <input
              type="text"
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              onFocus={() => searchQuery && setShowDropdown(true)}
              placeholder="ì´ˆëŒ€í•´ì£¼ì‹  ì£¼ì£¼ë‹˜ ì´ë¦„ì„ ê²€ìƒ‰í•˜ì„¸ìš”"
              className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            />
          </div>

          {/* ê²€ìƒ‰ ê²°ê³¼ ë“œë¡­ë‹¤ìš´ */}
          {showDropdown && (
            <div className="absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto">
              {filteredHosts.length > 0 ? (
                filteredHosts.map((host) => {
                  const userProfile = userProfiles[host.id];
                  const profileImage = userProfile?.profileImage || '';
                  const displayName = userProfile?.displayName || host.displayName;

                  return (
                    <button
                      key={host.id}
                      onClick={() => handleSelect(host)}
                      className="w-full flex items-center gap-3 p-3 hover:bg-gray-50 transition-colors"
                    >
                      {profileImage ? (
                        <img
                          src={profileImage}
                          alt={displayName}
                          className="w-10 h-10 rounded-full object-cover"
                        />
                      ) : (
                        <div className="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold">
                          {displayName[0]}
                        </div>
                      )}
                      <div className="text-left">
                        <div className="font-semibold text-gray-900">{displayName}</div>
                        <div className="text-xs text-gray-500">ì£¼ì£¼</div>
                      </div>
                    </button>
                  );
                })
              ) : (
                <div className="p-4 text-center text-gray-500 text-sm">
                  ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤
                </div>
              )}
            </div>
          )}

          <p className="text-xs text-gray-500 mt-1">
            ì´ˆëŒ€í•´ì£¼ì‹  ì£¼ì£¼ë‹˜ì˜ ì´ë¦„ì„ ê²€ìƒ‰í•˜ì—¬ ì„ íƒí•´ì£¼ì„¸ìš”
          </p>
        </>
      )}
    </div>
  );
};

export default HostSearchInput;
</file>

<file path="src/components/reservations/MealParticipantListModal.jsx">
import { X, Users } from 'lucide-react';

/**
 * ì‹ì‚¬ ì°¸ì—¬ì ëª¨ë‹¬
 * - ì°¸ì—¬í•œ ì‚¬ëŒë§Œ ì¹´ë“œë¡œ í‘œì‹œ
 * - í•˜ë‹¨ì— ë³¸ì¸ ì°¸ì—¬/ì·¨ì†Œ ë²„íŠ¼
 */
const MealParticipantListModal = ({
  isOpen,
  onClose,
  mealType, // "lunch" | "dinner"
  participants, // [userId...]
  profiles,
  currentUserId,
  onToggle
}) => {
  if (!isOpen) return null;

  const mealTypeLabel = mealType === 'lunch' ? 'ì ì‹¬' : 'ì €ë…';
  const isLunch = mealType === 'lunch';
  const isParticipating = participants.includes(currentUserId);

  return (
    <div className="fixed inset-0 bg-black/50 z-[60] flex items-center justify-center p-4" onClick={onClose}>
      <div
        className="bg-white rounded-2xl max-w-md w-full max-h-[80vh] overflow-y-auto"
        onClick={(e) => e.stopPropagation()}
      >
        {/* í—¤ë” */}
        <div className="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between">
          <div className="flex items-center gap-3">
            <Users className={isLunch ? 'w-6 h-6 text-green-600' : 'w-6 h-6 text-orange-600'} />
            <div>
              <h3 className="text-lg font-bold text-gray-900">{mealTypeLabel} ì°¸ì—¬ì</h3>
              <div className="text-sm text-gray-600">{participants.length}ëª… ì°¸ì—¬ ì¤‘</div>
            </div>
          </div>
          <button
            onClick={onClose}
            className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
          >
            <X className="w-5 h-5" />
          </button>
        </div>

        {/* ì°¸ì—¬ì ë¦¬ìŠ¤íŠ¸ (ì°¸ì—¬í•œ ì‚¬ëŒë§Œ) */}
        <div className="p-6 meal-participants">
          {participants.length > 0 ? (
            <div className="space-y-2 mb-4">
              {participants.map((userId) => {
                const profile = profiles[userId];
                if (!profile) return null;

                const isMine = userId === currentUserId;

                return (
                  <div
                    key={userId}
                    className={`flex items-center gap-3 p-3 rounded-xl ${
                      isMine
                        ? isLunch
                          ? 'bg-green-50 border-2 border-green-300'
                          : 'bg-orange-50 border-2 border-orange-300'
                        : 'bg-gray-50 border border-gray-200'
                    }`}
                  >
                    {/* í”„ë¡œí•„ ì´ë¯¸ì§€ */}
                    <div className="flex-shrink-0">
                      {profile.profileImage ? (
                        <img
                          src={profile.profileImage}
                          alt={profile.displayName}
                          className="w-12 h-12 rounded-full object-cover"
                        />
                      ) : (
                        <div className="w-12 h-12 rounded-full bg-gray-300 flex items-center justify-center text-white font-bold">
                          {profile.displayName?.[0] || '?'}
                        </div>
                      )}
                    </div>

                    {/* ì´ë¦„ */}
                    <div className="flex-1 min-w-0">
                      <div className="font-semibold text-gray-900 flex items-center gap-2">
                        {profile.displayName || 'ì´ë¦„ ì—†ìŒ'}
                        {isMine && (
                          <span className="px-2 py-0.5 bg-blue-500 text-white text-xs rounded-full">
                            ë‚˜
                          </span>
                        )}
                      </div>
                      {profile.phone && (
                        <div className="text-sm text-gray-500">{profile.phone}</div>
                      )}
                    </div>
                  </div>
                );
              })}
            </div>
          ) : (
            <div className="py-8 text-center text-gray-400 mb-4">
              ì•„ì§ ì°¸ì—¬ìê°€ ì—†ìŠµë‹ˆë‹¤
            </div>
          )}

          {/* ë³¸ì¸ ì°¸ì—¬/ì·¨ì†Œ ë²„íŠ¼ */}
          <div className="pt-4 border-t border-gray-200">
            <button
              onClick={onToggle}
              className={`w-full py-4 rounded-xl font-bold text-lg transition-all ${
                isParticipating
                  ? isLunch
                    ? 'bg-green-500 hover:bg-green-600 text-white'
                    : 'bg-orange-500 hover:bg-orange-600 text-white'
                  : 'bg-gray-100 hover:bg-gray-200 text-gray-700'
              }`}
            >
              {isParticipating ? 'ì°¸ì—¬ ì·¨ì†Œ' : 'ì°¸ì—¬í•˜ê¸°'}
            </button>
          </div>
        </div>
      </div>
    </div>
  );
};

export default MealParticipantListModal;
</file>

<file path="src/components/reservations/ReservationEditModal.jsx">
import { useState, useEffect } from 'react';
import { X, Calendar, AlertTriangle } from 'lucide-react';
import Modal from '../common/Modal';
import { formatDate } from '../../utils/dateUtils';

/**
 * ì˜ˆì•½ ìˆ˜ì • ëª¨ë‹¬
 * - ì…ì‹¤ì¼/ì•„ì›ƒì¼ì„ date pickerë¡œ ê°œë³„ ìˆ˜ì •
 * - ê³¼ê±° ë‚ ì§œ ì„ íƒ ì‹œ í™•ì¸ ìš”ì²­
 */
const ReservationEditModal = ({
  isOpen,
  onClose,
  onConfirm,
  reservation,
  existingReservations = {}
}) => {
  const [checkInDate, setCheckInDate] = useState('');
  const [checkOutDate, setCheckOutDate] = useState('');
  const [isDayTrip, setIsDayTrip] = useState(false);
  const [showPastDateConfirm, setShowPastDateConfirm] = useState(false);
  const [pendingCheckInDate, setPendingCheckInDate] = useState('');

  // ê¸°ì¡´ ì˜ˆì•½ ì •ë³´ë¡œ ì´ˆê¸°í™”
  useEffect(() => {
    if (reservation && isOpen) {
      const checkIn = reservation.checkIn?.toDate?.() || reservation.checkIn;
      const checkOut = reservation.checkOut?.toDate?.() || reservation.checkOut;

      // YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ë³€í™˜
      setCheckInDate(formatDate(checkIn));
      setCheckOutDate(formatDate(checkOut));
      setIsDayTrip(reservation.isDayTrip || reservation.nights === 0);
    }
  }, [reservation, isOpen]);

  // ê³¼ê±° ë‚ ì§œì¸ì§€ í™•ì¸
  const isPastDate = (dateStr) => {
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    const selectedDate = new Date(dateStr);
    selectedDate.setHours(0, 0, 0, 0);
    return selectedDate < today;
  };

  // ì…ì‹¤ì¼ ë³€ê²½ í•¸ë“¤ëŸ¬
  const handleCheckInChange = (e) => {
    const newDate = e.target.value;

    if (isPastDate(newDate)) {
      // ê³¼ê±° ë‚ ì§œì¸ ê²½ìš° í™•ì¸ ëª¨ë‹¬ í‘œì‹œ
      setPendingCheckInDate(newDate);
      setShowPastDateConfirm(true);
    } else {
      setCheckInDate(newDate);

      // ë‹¹ì¼ì¹˜ê¸°ê°€ ì•„ë‹ˆê³  ì•„ì›ƒì¼ì´ ì…ì‹¤ì¼ë³´ë‹¤ ì´ë¥´ë©´ ì¡°ì •
      if (!isDayTrip && checkOutDate && newDate >= checkOutDate) {
        const nextDay = new Date(newDate);
        nextDay.setDate(nextDay.getDate() + 1);
        setCheckOutDate(formatDate(nextDay));
      }
    }
  };

  // ê³¼ê±° ë‚ ì§œ í™•ì¸ í›„ ì ìš©
  const confirmPastDate = () => {
    setCheckInDate(pendingCheckInDate);
    setShowPastDateConfirm(false);
    setPendingCheckInDate('');

    // ë‹¹ì¼ì¹˜ê¸°ê°€ ì•„ë‹ˆê³  ì•„ì›ƒì¼ì´ ì…ì‹¤ì¼ë³´ë‹¤ ì´ë¥´ë©´ ì¡°ì •
    if (!isDayTrip && checkOutDate && pendingCheckInDate >= checkOutDate) {
      const nextDay = new Date(pendingCheckInDate);
      nextDay.setDate(nextDay.getDate() + 1);
      setCheckOutDate(formatDate(nextDay));
    }
  };

  // ê³¼ê±° ë‚ ì§œ ì·¨ì†Œ
  const cancelPastDate = () => {
    setShowPastDateConfirm(false);
    setPendingCheckInDate('');
  };

  // ì•„ì›ƒì¼ ë³€ê²½ í•¸ë“¤ëŸ¬
  const handleCheckOutChange = (e) => {
    const newDate = e.target.value;
    setCheckOutDate(newDate);
  };

  // ë‹¹ì¼ì¹˜ê¸° í† ê¸€
  const handleDayTripToggle = (e) => {
    const checked = e.target.checked;
    setIsDayTrip(checked);

    if (checked && checkInDate) {
      // ë‹¹ì¼ì¹˜ê¸° í™œì„±í™” ì‹œ ì•„ì›ƒì¼ì„ ì…ì‹¤ì¼ê³¼ ë™ì¼í•˜ê²Œ
      setCheckOutDate(checkInDate);
    } else if (!checked && checkInDate) {
      // ë‹¹ì¼ì¹˜ê¸° ë¹„í™œì„±í™” ì‹œ ì•„ì›ƒì¼ì„ ì…ì‹¤ì¼ ë‹¤ìŒë‚ ë¡œ
      const nextDay = new Date(checkInDate);
      nextDay.setDate(nextDay.getDate() + 1);
      setCheckOutDate(formatDate(nextDay));
    }
  };

  // ì €ì¥ í•¸ë“¤ëŸ¬
  const handleSave = () => {
    if (!checkInDate || !checkOutDate) {
      alert('ì…ì‹¤ì¼ê³¼ ì•„ì›ƒì¼ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
      return;
    }

    const checkIn = new Date(checkInDate);
    const checkOut = new Date(checkOutDate);

    if (!isDayTrip && checkIn >= checkOut) {
      alert('ì•„ì›ƒì¼ì€ ì…ì‹¤ì¼ë³´ë‹¤ ì´í›„ì—¬ì•¼ í•©ë‹ˆë‹¤.');
      return;
    }

    // ë°•ìˆ˜ ê³„ì‚°
    let nights = 0;
    if (isDayTrip) {
      nights = 0;
    } else {
      const timeDiff = checkOut - checkIn;
      nights = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
    }

    onConfirm({
      checkIn,
      checkOut,
      nights,
      isDayTrip
    });
  };

  if (!isOpen || !reservation) return null;

  // í˜„ì¬ ì˜ˆì•½ ì •ë³´
  const currentCheckIn = reservation.checkIn?.toDate?.() || reservation.checkIn;
  const currentCheckOut = reservation.checkOut?.toDate?.() || reservation.checkOut;

  return (
    <>
      <Modal isOpen={isOpen} onClose={onClose} title="ì˜ˆì•½ ìˆ˜ì •">
        <div className="space-y-6">
          {/* í˜„ì¬ ì˜ˆì•½ ì •ë³´ */}
          <div className="bg-blue-50 border-2 border-blue-200 rounded-xl p-4">
            <div className="text-sm font-semibold text-blue-900 mb-2">í˜„ì¬ ì˜ˆì•½</div>
            <div className="text-lg font-bold text-gray-900 mb-1">{reservation.name}</div>
            <div className="text-sm text-gray-600">
              {currentCheckIn.getMonth() + 1}/{currentCheckIn.getDate()} ~ {currentCheckOut.getMonth() + 1}/{currentCheckOut.getDate()}
              {reservation.isDayTrip || reservation.nights === 0 ? (
                <span className="ml-2 px-2 py-0.5 bg-orange-100 text-orange-700 rounded-md text-xs font-semibold">
                  ë‹¹ì¼ì¹˜ê¸°
                </span>
              ) : (
                <span className="ml-2 text-gray-500">
                  ({reservation.nights}ë°• {reservation.nights + 1}ì¼)
                </span>
              )}
            </div>
          </div>

          {/* ì…ì‹¤ì¼ */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2">
              <Calendar className="w-4 h-4" />
              ì…ì‹¤ì¼
            </label>
            <input
              type="date"
              value={checkInDate}
              onChange={handleCheckInChange}
              className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none text-base"
            />
            {checkInDate && isPastDate(checkInDate) && (
              <div className="mt-2 text-xs text-orange-600 flex items-center gap-1">
                <AlertTriangle className="w-3 h-3" />
                ê³¼ê±° ë‚ ì§œì…ë‹ˆë‹¤
              </div>
            )}
          </div>

          {/* ì•„ì›ƒì¼ */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2">
              <Calendar className="w-4 h-4" />
              ì•„ì›ƒì¼
            </label>
            <input
              type="date"
              value={checkOutDate}
              onChange={handleCheckOutChange}
              disabled={isDayTrip}
              className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none text-base disabled:bg-gray-100 disabled:cursor-not-allowed"
            />
            {isDayTrip && (
              <div className="mt-2 text-xs text-gray-500">
                ë‹¹ì¼ì¹˜ê¸° ì˜ˆì•½ì€ ì•„ì›ƒì¼ì´ ì…ì‹¤ì¼ê³¼ ë™ì¼í•©ë‹ˆë‹¤
              </div>
            )}
          </div>

          {/* ë‹¹ì¼ì¹˜ê¸° ì˜µì…˜ */}
          <div>
            <label className="flex items-center gap-3 p-4 bg-orange-50 rounded-xl cursor-pointer hover:bg-orange-100 transition-colors border-2 border-orange-200">
              <input
                type="checkbox"
                checked={isDayTrip}
                onChange={handleDayTripToggle}
                className="w-5 h-5 text-orange-600 rounded focus:ring-orange-500"
              />
              <div className="flex-1">
                <span className="font-semibold text-gray-900">ë‹¹ì¼ì¹˜ê¸° ì˜ˆì•½</span>
                <div className="text-xs text-gray-600 mt-0.5">
                  ì…ì‹¤ì¼ê³¼ ì•„ì›ƒì¼ì´ ë™ì¼í•œ ì˜ˆì•½ì…ë‹ˆë‹¤
                </div>
              </div>
            </label>
          </div>

          {/* ë²„íŠ¼ */}
          <div className="grid grid-cols-2 gap-3 pt-4">
            <button
              onClick={onClose}
              className="px-4 py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-colors"
            >
              ì·¨ì†Œ
            </button>
            <button
              onClick={handleSave}
              className="px-4 py-3 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-colors"
            >
              ì €ì¥
            </button>
          </div>
        </div>
      </Modal>

      {/* ê³¼ê±° ë‚ ì§œ í™•ì¸ ëª¨ë‹¬ */}
      {showPastDateConfirm && (
        <>
          <div className="fixed inset-0 bg-black/50 z-[70]" onClick={cancelPastDate} />
          <div className="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl shadow-2xl z-[71] p-6 w-[380px] max-w-[90vw]">
            <div className="flex items-center gap-3 mb-4">
              <div className="w-12 h-12 rounded-full bg-orange-100 flex items-center justify-center flex-shrink-0">
                <AlertTriangle className="w-6 h-6 text-orange-600" />
              </div>
              <div>
                <h3 className="text-lg font-bold text-gray-900">ê³¼ê±° ë‚ ì§œ ì„ íƒ</h3>
                <p className="text-sm text-gray-600 mt-0.5">ê³¼ê±° ë‚ ì§œì…ë‹ˆë‹¤</p>
              </div>
            </div>

            <div className="bg-orange-50 border-2 border-orange-200 rounded-xl p-4 mb-6">
              <div className="text-sm text-gray-700 mb-2">ì„ íƒí•œ ì…ì‹¤ì¼:</div>
              <div className="text-lg font-bold text-gray-900">
                {new Date(pendingCheckInDate).toLocaleDateString('ko-KR', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric',
                  weekday: 'short'
                })}
              </div>
            </div>

            <div className="text-sm text-gray-600 mb-6">
              ì´ ë‚ ì§œê°€ ë§ë‚˜ìš”? ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
            </div>

            <div className="grid grid-cols-2 gap-3">
              <button
                onClick={cancelPastDate}
                className="px-4 py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-colors"
              >
                ì·¨ì†Œ
              </button>
              <button
                onClick={confirmPastDate}
                className="px-4 py-3 bg-orange-600 text-white rounded-xl font-semibold hover:bg-orange-700 transition-colors"
              >
                í™•ì¸
              </button>
            </div>
          </div>
        </>
      )}
    </>
  );
};

export default ReservationEditModal;
</file>

<file path="src/components/reservations/ReservationManageModal.jsx">
import { X, Edit, Trash2 } from 'lucide-react';

/**
 * ì˜ˆì•½ ê´€ë¦¬ ëª¨ë‹¬
 * - í”„ë¡œí•„ í´ë¦­ ì‹œ í‘œì‹œ
 * - ì˜ˆì•½ ìˆ˜ì • / ì˜ˆì•½ ì·¨ì†Œ
 */
const ReservationManageModal = ({
  isOpen,
  onClose,
  reservation,
  currentDateStr,
  onEdit,
  onCancel
}) => {
  if (!isOpen || !reservation) return null;

  // dateStrì„ Date ê°ì²´ë¡œ íŒŒì‹± (í‘œì‹œìš©)
  const displayDate = currentDateStr ? new Date(currentDateStr) : new Date();

  const handleEdit = () => {
    onEdit(reservation);
    // onClose()ëŠ” WeeklyListì˜ onEdit í•¸ë“¤ëŸ¬ì—ì„œ ì²˜ë¦¬
  };

  const handleCancel = () => {
    onCancel(reservation);
    onClose();
  };

  // ì˜ˆì•½ ë‚ ì§œ ì •ë³´
  const checkInDate = reservation.checkIn?.toDate?.() || reservation.checkIn;
  const checkOutDate = reservation.checkOut?.toDate?.() || reservation.checkOut;
  const isCheckIn = checkInDate.toDateString() === displayDate.toDateString();
  const isCheckOut = checkOutDate.toDateString() === displayDate.toDateString();
  const isDayTrip = reservation.isDayTrip || reservation.nights === 0;

  return (
    <>
      {/* ë°°ê²½ ì˜¤ë²„ë ˆì´ */}
      <div
        className="fixed inset-0 bg-black/30 z-[60]"
        onClick={onClose}
      />

      {/* ëª¨ë‹¬ */}
      <div
        className="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2
                   bg-white rounded-2xl shadow-2xl z-[61] p-6 w-[440px] max-w-[90vw]"
        onClick={(e) => e.stopPropagation()}
      >
        {/* í—¤ë” */}
        <div className="flex items-center justify-between mb-5">
          <h3 className="text-xl font-bold text-gray-900">ì˜ˆì•½ ê´€ë¦¬</h3>
          <button
            onClick={onClose}
            className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
          >
            <X className="w-5 h-5" />
          </button>
        </div>

        {/* ì˜ˆì•½ ì •ë³´ */}
        <div className="bg-blue-50 border-2 border-blue-200 rounded-xl p-4 mb-5">
          <div className="flex items-start justify-between mb-3">
            <div>
              <div className="text-lg font-bold text-gray-900 mb-1">
                {reservation.name}
              </div>
              <div className="text-sm text-gray-600">
                {isDayTrip ? (
                  <span className="px-2 py-1 bg-orange-100 text-orange-700 rounded-md font-semibold">
                    ë‹¹ì¼ì¹˜ê¸°
                  </span>
                ) : (
                  <span className="font-medium">
                    {reservation.nights}ë°• {reservation.nights + 1}ì¼
                  </span>
                )}
              </div>
            </div>
            <div className="text-right">
              <div className="text-xs text-gray-500 mb-1">ì˜ˆì•½ ê¸°ê°„</div>
              <div className="text-sm font-semibold text-gray-900">
                {checkInDate.getMonth() + 1}/{checkInDate.getDate()} ~ {checkOutDate.getMonth() + 1}/{checkOutDate.getDate()}
              </div>
            </div>
          </div>

          {/* ì²´í¬ì¸/ì²´í¬ì•„ì›ƒ í‘œì‹œ */}
          <div className="flex gap-2">
            {isCheckIn && (
              <span className="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full font-semibold">
                ì²´í¬ì¸ì¼
              </span>
            )}
            {isCheckOut && !isDayTrip && (
              <span className="text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded-full font-semibold">
                ì²´í¬ì•„ì›ƒì¼
              </span>
            )}
          </div>
        </div>

        {/* ì˜ˆì•½ ìˆ˜ì • / ì·¨ì†Œ ë²„íŠ¼ */}
        <div className="grid grid-cols-2 gap-3">
          <button
            onClick={handleEdit}
            className="flex items-center justify-center gap-2 px-4 py-3 bg-blue-50 text-blue-700 rounded-xl font-semibold hover:bg-blue-100 transition-colors border-2 border-blue-200"
          >
            <Edit className="w-5 h-5" />
            ì˜ˆì•½ ìˆ˜ì •
          </button>
          <button
            onClick={handleCancel}
            className="flex items-center justify-center gap-2 px-4 py-3 bg-red-50 text-red-700 rounded-xl font-semibold hover:bg-red-100 transition-colors border-2 border-red-200"
          >
            <Trash2 className="w-5 h-5" />
            ì˜ˆì•½ ì·¨ì†Œ
          </button>
        </div>
      </div>
    </>
  );
};

export default ReservationManageModal;
</file>

<file path="src/components/reservations/WeeklyCalendarView.jsx">
// src/components/reservations/WeeklyCalendarView.jsx
import { useState } from 'react';
import { ChevronLeft, ChevronRight, UserRound, Mars, Venus } from 'lucide-react';
import { formatDate, isToday } from '../../utils/dateUtils';

const WeeklyCalendarView = ({
  currentWeekStart,
  reservationsObj,
  profiles,
  user,
  onDateClick,
  onPrevWeek,
  onNextWeek,
  onThisWeek
}) => {
  // ì´ì „ì£¼, í˜„ì¬ì£¼, ë‹¤ìŒì£¼ ë‚ ì§œ ë°°ì—´ ìƒì„± (ì´ 21ì¼)
  const getAllWeeksDates = () => {
    const allDates = [];

    // ì´ì „ ì£¼
    for (let i = -7; i < 0; i++) {
      const date = new Date(currentWeekStart);
      date.setDate(currentWeekStart.getDate() + i);
      allDates.push({ date, isPrevWeek: true, isNextWeek: false });
    }

    // í˜„ì¬ ì£¼
    for (let i = 0; i < 7; i++) {
      const date = new Date(currentWeekStart);
      date.setDate(currentWeekStart.getDate() + i);
      allDates.push({ date, isPrevWeek: false, isNextWeek: false });
    }

    // ë‹¤ìŒ ì£¼
    for (let i = 7; i < 14; i++) {
      const date = new Date(currentWeekStart);
      date.setDate(currentWeekStart.getDate() + i);
      allDates.push({ date, isPrevWeek: false, isNextWeek: true });
    }

    return allDates;
  };

  const allWeeksDates = getAllWeeksDates();
  const weekDays = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'];

  // ì£¼ì°¨ ë²”ìœ„ í‘œì‹œ
  const weekRange = `${currentWeekStart.getMonth() + 1}/${currentWeekStart.getDate()} - ${new Date(currentWeekStart.getTime() + 6 * 24 * 60 * 60 * 1000).getMonth() + 1}/${new Date(currentWeekStart.getTime() + 6 * 24 * 60 * 60 * 1000).getDate()}`;

  // ì£¼ì°¨ë³„ë¡œ ë‚ ì§œë¥¼ ê·¸ë£¹í™”
  const prevWeekDates = allWeeksDates.slice(0, 7);
  const currentWeekDates = allWeeksDates.slice(7, 14);
  const nextWeekDates = allWeeksDates.slice(14, 21);

  // ì£¼ì°¨ ì •ë³´ ê³„ì‚°
  const getPrevWeekRange = () => {
    const start = new Date(currentWeekStart);
    start.setDate(start.getDate() - 7);
    const end = new Date(start);
    end.setDate(end.getDate() + 6);
    return `${start.getMonth() + 1}/${start.getDate()} - ${end.getMonth() + 1}/${end.getDate()}`;
  };

  const getNextWeekRange = () => {
    const start = new Date(currentWeekStart);
    start.setDate(start.getDate() + 7);
    const end = new Date(start);
    end.setDate(end.getDate() + 6);
    return `${start.getMonth() + 1}/${start.getDate()} - ${end.getMonth() + 1}/${end.getDate()}`;
  };

  // ë‚ ì§œ ì…€ ë Œë”ë§ í•¨ìˆ˜
  const renderDateCell = ({ date, isPrevWeek, isNextWeek }, index) => {
    const dateStr = formatDate(date);
    const isCurrentDay = isToday(date);
    const dateReservations = reservationsObj[dateStr] || [];
    const isCurrentWeek = !isPrevWeek && !isNextWeek;

    // ë‚¨ë…€ í†µê³„
    const maleCount = dateReservations.filter(r => profiles[r.userId]?.gender === 'male').length;
    const femaleCount = dateReservations.filter(r => profiles[r.userId]?.gender === 'female').length;

    // ì£¼ì£¼/ê²ŒìŠ¤íŠ¸ í†µê³„
    const memberTypes = ['shareholder', 'manager', 'vice-manager'];
    const shareholderCount = dateReservations.filter(r => memberTypes.includes(r.type)).length;
    const guestCount = dateReservations.length - shareholderCount;

    // ë‚´ ì˜ˆì•½ ì—¬ë¶€
    const hasMyReservation = dateReservations.some(r => String(r.userId) === String(user.id));

    return (
      <button
        key={dateStr}
        onClick={() => dateReservations.length > 0 && onDateClick(date, dateReservations)}
        className={`
          min-h-[90px] p-2 flex flex-col items-center justify-start
          transition-colors relative
          ${isCurrentDay ? 'bg-blue-50' :
            isCurrentWeek ? 'bg-white hover:bg-gray-50' :
            'bg-gray-50 hover:bg-gray-100'}
          ${dateReservations.length > 0 ? 'cursor-pointer' : 'cursor-default'}
        `}
      >
        {/* ë‚ ì§œ */}
        <div className={`
          text-sm font-semibold mb-1
          ${isCurrentDay ? 'text-blue-600' :
            index % 7 === 5 ? 'text-blue-500' :
            index % 7 === 6 ? 'text-red-500' :
            'text-gray-700'}
        `}>
          {date.getDate()}
        </div>

        {/* ì˜¤ëŠ˜ í‘œì‹œ */}
        {isCurrentDay && (
          <div className="absolute top-1 right-1 w-2 h-2 bg-blue-600 rounded-full"></div>
        )}

        {/* ë‚´ ì˜ˆì•½ í‘œì‹œ */}
        {hasMyReservation && (
          <div className="absolute top-1 left-1 w-2 h-2 bg-green-500 rounded-full"></div>
        )}

        {/* ì˜ˆì•½ ì •ë³´ */}
        {dateReservations.length > 0 ? (
          <div className="flex-1 flex flex-col items-center justify-center gap-1 w-full">
            {/* ì´ ì¸ì› */}
            <div className="flex items-center gap-1">
              <UserRound className="w-3 h-3 text-gray-400" />
              <span className="text-lg font-bold text-gray-900">
                {dateReservations.length}
              </span>
            </div>

            {/* ë‚¨ë…€ êµ¬ë¶„ */}
            <div className="flex items-center gap-1.5 text-xs">
              {maleCount > 0 && (
                <span className="flex items-center gap-0.5 text-blue-600">
                  <Mars className="w-3 h-3" />
                  {maleCount}
                </span>
              )}
              {femaleCount > 0 && (
                <span className="flex items-center gap-0.5 text-pink-600">
                  <Venus className="w-3 h-3" />
                  {femaleCount}
                </span>
              )}
            </div>

            {/* ì£¼ì£¼/ê²ŒìŠ¤íŠ¸ êµ¬ë¶„ */}
            <div className="text-[10px] text-gray-500 leading-tight">
              ì£¼{shareholderCount}/ê²Œ{guestCount}
            </div>
          </div>
        ) : (
          <div className="flex-1"></div>
        )}
      </button>
    );
  };

  return (
    <div className="max-w-2xl mx-auto">
      {/* ì£¼ê°„ ë„¤ë¹„ê²Œì´ì…˜ */}
      <div className="flex items-center justify-center gap-2 px-4 pb-4">
        <button
          onClick={onPrevWeek}
          className="p-2 rounded-full bg-white/20 hover:bg-white/30 transition-colors"
        >
          <ChevronLeft className="w-5 h-5 text-black" />
        </button>
        <div className="px-4 py-2 rounded-full bg-white text-blue-600 font-semibold min-w-[140px] text-center">
          ğŸ“… {weekRange}
        </div>
        <button
          onClick={onNextWeek}
          className="p-2 rounded-full bg-white/20 hover:bg-white/30 transition-colors"
        >
          <ChevronRight className="w-5 h-5 text-black" />
        </button>
        <button
          onClick={onThisWeek}
          className="px-3 py-2 rounded-full bg-white/20 hover:bg-white/30 text-sm font-semibold text-white transition-colors"
        >
          ì˜¤ëŠ˜
        </button>
      </div>

      {/* ë‹¬ë ¥ ê·¸ë¦¬ë“œ - ì£¼ì°¨ë³„ ë¶„ë¦¬ */}
      <div className="space-y-3 mx-4">
        {/* ì§€ë‚œ ì£¼ */}
        <div className="bg-gray-50 rounded-xl shadow overflow-hidden border border-gray-200">
          <div className="flex items-center justify-between bg-gray-100 px-4 py-2 border-b border-gray-200">
            <button
              onClick={onPrevWeek}
              className="p-1 hover:bg-gray-200 rounded transition-colors"
            >
              <ChevronLeft className="w-4 h-4 text-gray-600" />
            </button>
            <span className="text-xs font-semibold text-gray-600">
              ì§€ë‚œ ì£¼ ({getPrevWeekRange()})
            </span>
            <div className="w-6"></div>
          </div>
          <div className="grid grid-cols-7 bg-white border-b border-gray-200">
            {weekDays.map((day, index) => (
              <div
                key={day}
                className={`py-2 text-center text-xs font-semibold ${
                  index === 5 ? 'text-blue-600' :
                  index === 6 ? 'text-red-600' :
                  'text-gray-500'
                }`}
              >
                {day}
              </div>
            ))}
          </div>
          <div className="grid grid-cols-7 divide-x divide-y bg-white">
            {prevWeekDates.map((dateInfo, idx) => renderDateCell(dateInfo, idx))}
          </div>
        </div>

        {/* ì´ë²ˆ ì£¼ */}
        <div className="bg-white rounded-xl shadow-lg overflow-hidden border-2 border-blue-300">
          <div className="flex items-center justify-center bg-gradient-to-r from-blue-500 to-blue-600 px-4 py-2.5">
            <span className="text-sm font-bold text-white">
              ì´ë²ˆ ì£¼ ({weekRange})
            </span>
          </div>
          <div className="grid grid-cols-7 bg-blue-50 border-b border-blue-200">
            {weekDays.map((day, index) => (
              <div
                key={day}
                className={`py-2 text-center text-xs font-bold ${
                  index === 5 ? 'text-blue-600' :
                  index === 6 ? 'text-red-600' :
                  'text-gray-700'
                }`}
              >
                {day}
              </div>
            ))}
          </div>
          <div className="grid grid-cols-7 divide-x divide-y">
            {currentWeekDates.map((dateInfo, idx) => renderDateCell(dateInfo, idx + 7))}
          </div>
        </div>

        {/* ë‹¤ìŒ ì£¼ */}
        <div className="bg-gray-50 rounded-xl shadow overflow-hidden border border-gray-200">
          <div className="flex items-center justify-between bg-gray-100 px-4 py-2 border-b border-gray-200">
            <div className="w-6"></div>
            <span className="text-xs font-semibold text-gray-600">
              ë‹¤ìŒ ì£¼ ({getNextWeekRange()})
            </span>
            <button
              onClick={onNextWeek}
              className="p-1 hover:bg-gray-200 rounded transition-colors"
            >
              <ChevronRight className="w-4 h-4 text-gray-600" />
            </button>
          </div>
          <div className="grid grid-cols-7 bg-white border-b border-gray-200">
            {weekDays.map((day, index) => (
              <div
                key={day}
                className={`py-2 text-center text-xs font-semibold ${
                  index === 5 ? 'text-blue-600' :
                  index === 6 ? 'text-red-600' :
                  'text-gray-500'
                }`}
              >
                {day}
              </div>
            ))}
          </div>
          <div className="grid grid-cols-7 divide-x divide-y bg-white">
            {nextWeekDates.map((dateInfo, idx) => renderDateCell(dateInfo, idx + 14))}
          </div>
        </div>
      </div>
    </div>
  );
};

export default WeeklyCalendarView;
</file>

<file path="src/components/settlement/ReceiptDetailModal.jsx">
// src/components/settlement/ReceiptDetailModal.jsx
import { X, Edit, Users, Trash2 } from 'lucide-react';

const ReceiptDetailModal = ({ receipt, isOpen, onClose, onEdit, onDelete, canEdit, members, userProfiles }) => {
  if (!isOpen || !receipt) return null;

  const formatCurrency = (amount) => {
    return amount?.toLocaleString('ko-KR') + 'ì›' || '0ì›';
  };

  const formatDateTime = (date) => {
    if (!date) return '';
    const d = date instanceof Date ? date : new Date(date);
    return d.toLocaleDateString('ko-KR', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
    });
  };

  return (
    <>
      {/* ë°°ê²½ ì˜¤ë²„ë ˆì´ */}
      <div
        className="fixed inset-0 bg-black/50 z-[100]"
        onClick={onClose}
      />

      {/* ëª¨ë‹¬ */}
      <div className="fixed inset-0 z-[101] flex items-end sm:items-center justify-center p-0 sm:p-4">
        <div
          className="bg-white w-full sm:max-w-2xl rounded-t-2xl sm:rounded-2xl max-h-[90vh] overflow-y-auto"
          onClick={(e) => e.stopPropagation()}
        >
          {/* í—¤ë” */}
          <div className="sticky top-0 bg-white border-b border-gray-200 px-4 py-4 flex items-center justify-between z-10">
            <h2 className="text-xl font-bold text-gray-900">ì˜ìˆ˜ì¦ ìƒì„¸</h2>
            <div className="flex items-center gap-2">
              {canEdit && (
                <>
                  <button
                    onClick={onEdit}
                    className="p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors"
                  >
                    <Edit className="w-5 h-5" />
                  </button>
                  <button
                    onClick={() => {
                      if (window.confirm('ì •ë§ ì´ ì˜ìˆ˜ì¦ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œëœ ì˜ìˆ˜ì¦ì€ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                        onDelete();
                      }
                    }}
                    className="p-2 hover:bg-red-50 rounded-lg text-red-600 transition-colors"
                  >
                    <Trash2 className="w-5 h-5" />
                  </button>
                </>
              )}
              <button
                onClick={onClose}
                className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
              >
                <X className="w-6 h-6 text-gray-600" />
              </button>
            </div>
          </div>

          {/* ë‚´ìš© */}
          <div className="p-4 space-y-4">
            {/* ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ */}
            {receipt.imageUrl && (
              <div className="bg-gray-50 rounded-xl p-4">
                <h3 className="font-bold text-gray-900 mb-3">ì˜ìˆ˜ì¦ ì´ë¯¸ì§€</h3>
                <img
                  src={receipt.imageUrl}
                  alt="ì˜ìˆ˜ì¦"
                  className="w-full rounded-lg border border-gray-200"
                />
              </div>
            )}

            {/* ì œì¶œ ì •ë³´ */}
            <div className="bg-white rounded-xl border border-gray-200 p-4">
              <h3 className="font-bold text-gray-900 mb-3">ì œì¶œ ì •ë³´</h3>
              <div className="space-y-2 text-sm">
                <div className="flex justify-between">
                  <span className="text-gray-600">ì œì¶œì</span>
                  <span className="font-medium text-gray-900">{receipt.submittedByName}</span>
                </div>
                <div className="flex justify-between">
                  <span className="text-gray-600">ì‹¤ì œ ë‚©ë¶€ì</span>
                  <span className="font-medium text-gray-900">{receipt.paidByName}</span>
                </div>
                <div className="flex justify-between">
                  <span className="text-gray-600">ì œì¶œ ì‹œê°„</span>
                  <span className="font-medium text-gray-900">{formatDateTime(receipt.createdAt)}</span>
                </div>
                {receipt.memo && (
                  <div className="pt-2 border-t border-gray-100">
                    <span className="text-gray-600">ë©”ëª¨</span>
                    <p className="mt-1 text-gray-900">{receipt.memo}</p>
                  </div>
                )}
              </div>
            </div>

            {/* í•­ëª©ë³„ ìƒì„¸ */}
            <div className="bg-white rounded-xl border border-gray-200 p-4">
              <h3 className="font-bold text-gray-900 mb-3">í•­ëª© ìƒì„¸</h3>
              <div className="space-y-3">
                {receipt.items?.map((item, index) => (
                  <div key={index} className="bg-gray-50 rounded-lg p-3">
                    <div className="flex justify-between items-start mb-2">
                      <div className="flex-1">
                        <p className="font-medium text-gray-900">{item.itemName}</p>
                        <p className="text-sm text-gray-600 mt-1">
                          {formatCurrency(item.amount)} Ã· {item.splitAmong?.length || 0}ëª…
                          = <span className="font-semibold text-blue-600">{formatCurrency(item.perPerson)}</span>/ì¸
                        </p>
                      </div>
                      <span className="font-bold text-gray-900">{formatCurrency(item.amount)}</span>
                    </div>

                    {/* ë¶„ë‹´ì ëª©ë¡ */}
                    {item.splitAmong && item.splitAmong.length > 0 && (
                      <div className="mt-3 pt-3 border-t border-gray-200">
                        <div className="flex items-center gap-2 mb-2">
                          <Users className="w-4 h-4 text-gray-500" />
                          <span className="text-sm font-medium text-gray-700">ë¶„ë‹´ì ({item.splitAmong.length}ëª…)</span>
                        </div>
                        <div className="flex flex-wrap gap-2">
                          {item.splitAmong.map((userId) => {
                            const member = members?.find(m => m.userId === userId);
                            const userProfile = userProfiles?.[userId];
                            const displayName = userProfile?.displayName || member?.displayName || userId;
                            const profileImage = userProfile?.profileImage || '';

                            return (
                              <div
                                key={userId}
                                className="inline-flex items-center gap-2 bg-white border border-gray-200 px-2 py-1 rounded-full text-sm"
                              >
                                {profileImage ? (
                                  <img
                                    src={profileImage}
                                    alt={displayName}
                                    className="w-5 h-5 rounded-full object-cover"
                                  />
                                ) : (
                                  <div className="w-5 h-5 rounded-full bg-blue-500 flex items-center justify-center text-white text-xs font-bold">
                                    {displayName[0]}
                                  </div>
                                )}
                                <span className="text-gray-700">{displayName}</span>
                              </div>
                            );
                          })}
                        </div>
                      </div>
                    )}
                  </div>
                ))}
              </div>
            </div>

            {/* ì´ì•¡ */}
            <div className="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-4 text-white">
              <div className="flex items-center justify-between">
                <span className="font-medium">ì´ ê¸ˆì•¡</span>
                <span className="text-2xl font-bold">{formatCurrency(receipt.totalAmount)}</span>
              </div>
            </div>
          </div>

          {/* í•˜ë‹¨ ë‹«ê¸° ë²„íŠ¼ */}
          <div className="sticky bottom-0 bg-white border-t border-gray-200 p-4">
            <button
              onClick={onClose}
              className="w-full bg-gray-100 text-gray-700 py-3 rounded-xl font-bold hover:bg-gray-200 transition-colors"
            >
              ë‹«ê¸°
            </button>
          </div>
        </div>
      </div>
    </>
  );
};

export default ReceiptDetailModal;
</file>

<file path="src/components/space/SpaceDropdown.jsx">
// src/components/space/SpaceDropdown.jsx
import { useState, useRef, useEffect } from 'react';
import { GripVertical, ChevronDown, Plus } from 'lucide-react';

const SpaceDropdown = ({ spaces, selectedSpace, onSelect, onReorder, onCreateSpace }) => {
  const [isOpen, setIsOpen] = useState(false);
  const [draggedIndex, setDraggedIndex] = useState(null);
  const [orderedSpaces, setOrderedSpaces] = useState(spaces);
  const [touchStartY, setTouchStartY] = useState(null);
  const [touchCurrentY, setTouchCurrentY] = useState(null);
  const dropdownRef = useRef(null);

  useEffect(() => {
    setOrderedSpaces(spaces);
  }, [spaces]);

  // ì™¸ë¶€ í´ë¦­ ê°ì§€
  useEffect(() => {
    const handleClickOutside = (event) => {
      if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
        setIsOpen(false);
      }
    };

    if (isOpen) {
      document.addEventListener('mousedown', handleClickOutside);
    }
    return () => {
      document.removeEventListener('mousedown', handleClickOutside);
    };
  }, [isOpen]);

  const userTypeMap = {
    'manager': 'ê´€ë¦¬ì',
    'vice-manager': 'ë¶€ê´€ë¦¬ì',
    'shareholder': 'ì£¼ì£¼',
    'guest': 'ê²ŒìŠ¤íŠ¸'
  };

  const handleDragStart = (e, index) => {
    setDraggedIndex(index);
    e.dataTransfer.effectAllowed = 'move';
  };

  const handleDragOver = (e, index) => {
    e.preventDefault();
    if (draggedIndex === null || draggedIndex === index) return;

    const newSpaces = [...orderedSpaces];
    const draggedItem = newSpaces[draggedIndex];
    newSpaces.splice(draggedIndex, 1);
    newSpaces.splice(index, 0, draggedItem);

    setOrderedSpaces(newSpaces);
    setDraggedIndex(index);
  };

  const handleDragEnd = async () => {
    if (draggedIndex !== null) {
      // order ê°’ ì—…ë°ì´íŠ¸
      const updatedSpaces = orderedSpaces.map((space, idx) => ({
        ...space,
        order: idx
      }));
      
      // ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ì— ìˆœì„œ ë³€ê²½ ì•Œë¦¼
      if (onReorder) {
        await onReorder(updatedSpaces);
      }
      
      setOrderedSpaces(updatedSpaces);
    }
    setDraggedIndex(null);
  };

  // í„°ì¹˜ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
  const handleTouchStart = (e, index) => {
    const touch = e.touches[0];
    setTouchStartY(touch.clientY);
    setTouchCurrentY(touch.clientY);
    setDraggedIndex(index);
  };

  const handleTouchMove = (e, currentIndex) => {
    if (draggedIndex === null || touchStartY === null) return;
    
    e.preventDefault();
    const touch = e.touches[0];
    setTouchCurrentY(touch.clientY);
    
    const itemHeight = 60; // ëŒ€ëµì ì¸ í•­ëª© ë†’ì´
    const diff = touch.clientY - touchStartY;
    const steps = Math.round(diff / itemHeight);
    
    if (steps !== 0) {
      const newIndex = Math.max(0, Math.min(orderedSpaces.length - 1, draggedIndex + steps));
      
      if (newIndex !== draggedIndex) {
        const newSpaces = [...orderedSpaces];
        const draggedItem = newSpaces[draggedIndex];
        newSpaces.splice(draggedIndex, 1);
        newSpaces.splice(newIndex, 0, draggedItem);
        
        setOrderedSpaces(newSpaces);
        setDraggedIndex(newIndex);
        setTouchStartY(touch.clientY);
      }
    }
  };

  const handleTouchEnd = async () => {
    if (draggedIndex !== null) {
      const updatedSpaces = orderedSpaces.map((space, idx) => ({
        ...space,
        order: idx
      }));
      
      if (onReorder) {
        await onReorder(updatedSpaces);
      }
      
      setOrderedSpaces(updatedSpaces);
    }
    setDraggedIndex(null);
    setTouchStartY(null);
    setTouchCurrentY(null);
  };

  const handleSelect = (space) => {
    onSelect(space);
    setIsOpen(false);
  };

  const selectedSpaceName = selectedSpace?.spaceName || selectedSpace?.name || 'ë°© ì„ íƒ';
  const selectedUserType = userTypeMap[selectedSpace?.userType] || 'ê²ŒìŠ¤íŠ¸';

  return (
    <div ref={dropdownRef} style={{ position: 'relative' }}>
      {/* ì„ íƒëœ ë°© í‘œì‹œ */}
      <button
        onClick={() => setIsOpen(!isOpen)}
        style={{
          width: '100%',
          padding: '12px 16px',
          background: 'rgba(255,255,255,.08)',
          color: '#fff',
          border: '1px solid rgba(255,255,255,.14)',
          borderRadius: '12px',
          fontWeight: '600',
          fontSize: '15px',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'space-between',
          cursor: 'pointer',
          transition: 'all 0.2s'
        }}
      >
        <span>{selectedSpaceName} ({selectedUserType})</span>
        <ChevronDown 
          className="w-5 h-5" 
          style={{
            transform: isOpen ? 'rotate(180deg)' : 'rotate(0deg)',
            transition: 'transform 0.2s'
          }}
        />
      </button>

      {/* ë“œë¡­ë‹¤ìš´ ëª©ë¡ */}
      {isOpen && (
        <div
          style={{
            position: 'absolute',
            top: 'calc(100% + 8px)',
            left: 0,
            right: 0,
            background: '#fff',
            borderRadius: '12px',
            boxShadow: '0 8px 24px rgba(0,0,0,0.15)',
            overflow: 'hidden',
            zIndex: 50,
            maxHeight: '400px',
            overflowY: 'auto'
          }}
        >
          {orderedSpaces.map((space, index) => {
            const spaceId = space.id || space.spaceId;
            const spaceName = space.spaceName || space.name || spaceId;
            const userTypeText = userTypeMap[space.userType] || 'ê²ŒìŠ¤íŠ¸';
            const isSelected = (selectedSpace?.id || selectedSpace?.spaceId) === spaceId;
            const isDragging = draggedIndex === index;
            
            // ë“œë˜ê·¸ ì¤‘ì¼ ë•Œ ì´ë™ ê±°ë¦¬ ê³„ì‚°
            let translateY = 0;
            let scale = 1;
            let opacity = 1;
            let zIndex = 1;
            let boxShadow = 'none';
            
            if (isDragging && touchStartY && touchCurrentY) {
              translateY = touchCurrentY - touchStartY;
              scale = 1.05;
              opacity = 0.9;
              zIndex = 100;
              boxShadow = '0 8px 16px rgba(0,0,0,0.15)';
            }

            return (
              <div
                key={spaceId}
                draggable
                onDragStart={(e) => handleDragStart(e, index)}
                onDragOver={(e) => handleDragOver(e, index)}
                onDragEnd={handleDragEnd}
                onTouchStart={(e) => {
                  // ë“œë˜ê·¸ í•¸ë“¤ì„ í„°ì¹˜í•œ ê²½ìš°ì—ë§Œ ë“œë˜ê·¸ ì‹œì‘
                  if (e.target.closest('.drag-handle')) {
                    handleTouchStart(e, index);
                  }
                }}
                onTouchMove={(e) => handleTouchMove(e, index)}
                onTouchEnd={handleTouchEnd}
                style={{
                  display: 'flex',
                  alignItems: 'center',
                  gap: '12px',
                  padding: '12px 16px',
                  background: isSelected ? '#f0f9ff' : isDragging ? '#e0f2fe' : '#fff',
                  borderBottom: index < orderedSpaces.length - 1 ? '1px solid #e5e7eb' : 'none',
                  cursor: isDragging ? 'grabbing' : 'pointer',
                  transition: isDragging ? 'none' : 'all 0.2s ease',
                  userSelect: 'none',
                  WebkitUserSelect: 'none',
                  transform: `translateY(${translateY}px) scale(${scale})`,
                  opacity: opacity,
                  zIndex: zIndex,
                  boxShadow: boxShadow,
                  position: 'relative'
                }}
                onMouseEnter={(e) => {
                  if (draggedIndex === null && !isSelected) {
                    e.currentTarget.style.background = '#f9fafb';
                  }
                }}
                onMouseLeave={(e) => {
                  if (draggedIndex === null && !isSelected) {
                    e.currentTarget.style.background = '#fff';
                  }
                }}
              >
                {/* ë“œë˜ê·¸ í•¸ë“¤ */}
                <div
                  className="drag-handle"
                  onMouseDown={(e) => e.stopPropagation()}
                  style={{
                    cursor: isDragging ? 'grabbing' : 'grab',
                    color: isDragging ? '#2563eb' : '#9ca3af',
                    display: 'flex',
                    alignItems: 'center',
                    touchAction: 'none',
                    transition: 'color 0.2s'
                  }}
                >
                  <GripVertical className="w-5 h-5" />
                </div>

                {/* ë°© ì •ë³´ */}
                <div
                  onClick={() => handleSelect(space)}
                  style={{
                    flex: 1,
                    display: 'flex',
                    flexDirection: 'column',
                    gap: '2px'
                  }}
                >
                  <div style={{
                    fontWeight: '600',
                    fontSize: '15px',
                    color: isSelected ? '#2563eb' : '#111827'
                  }}>
                    {spaceName}
                  </div>
                  <div style={{
                    fontSize: '13px',
                    color: '#6b7280'
                  }}>
                    {userTypeText}
                  </div>
                </div>

                {/* ì„ íƒ í‘œì‹œ */}
                {isSelected && (
                  <div style={{
                    width: '8px',
                    height: '8px',
                    borderRadius: '50%',
                    background: '#2563eb'
                  }} />
                )}
              </div>
            );
          })}

          {/* ë°© ìƒì„± ì‹ ì²­ ë²„íŠ¼ */}
          {onCreateSpace && (
            <button
              onClick={() => {
                setIsOpen(false);
                onCreateSpace();
              }}
              style={{
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                gap: '8px',
                padding: '16px',
                background: 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',
                color: '#fff',
                border: 'none',
                borderTop: '1px solid #e5e7eb',
                cursor: 'pointer',
                transition: 'all 0.2s',
                fontWeight: '600',
                fontSize: '15px',
                width: '100%'
              }}
              onMouseEnter={(e) => {
                e.currentTarget.style.background = 'linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%)';
              }}
              onMouseLeave={(e) => {
                e.currentTarget.style.background = 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)';
              }}
            >
              <Plus className="w-5 h-5" />
              <span>ë°© ìƒì„± ì‹ ì²­</span>
            </button>
          )}
        </div>
      )}
    </div>
  );
};

export default SpaceDropdown;
</file>

<file path="src/pages/AlimtalkSettingsPage.jsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import useStore from '../store/useStore';
import spaceSettingsService from '../services/spaceSettingsService';
import { canManageSpace } from '../utils/permissions';
import { ArrowLeft, Bell, BellOff, Info, Clock, CheckCircle, XCircle, AlertCircle } from 'lucide-react';

export default function AlimtalkSettingsPage() {
  const navigate = useNavigate();
  const { user, selectedSpace } = useStore();
  const [settings, setSettings] = useState(null);
  const [loading, setLoading] = useState(true);
  const [processing, setProcessing] = useState(false);

  // ê¶Œí•œ ì²´í¬ ë° ì´ˆê¸° ë°ì´í„° ë¡œë“œ
  useEffect(() => {
    if (!user || !selectedSpace) {
      alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
      navigate('/');
      return;
    }

    const spaceId = selectedSpace.id || selectedSpace.spaceId;
    const userSpaceData = user.spaceAccess?.find(s => s.spaceId === spaceId);
    
    if (!userSpaceData || !canManageSpace(userSpaceData.userType)) {
      alert('ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
      navigate('/');
      return;
    }

    loadSettings();
  }, [user, selectedSpace, navigate]);

  const loadSettings = async () => {
    try {
      setLoading(true);
      const spaceId = selectedSpace.id || selectedSpace.spaceId;
      const data = await spaceSettingsService.getAlimtalkSettings(spaceId);
      setSettings(data);
    } catch (error) {
      console.error('ì•Œë¦¼í†¡ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
      alert('ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setLoading(false);
    }
  };

  // í™œì„±í™” ì‹ ì²­
  const handleRequestActivation = async () => {
    const confirmed = window.confirm(
      'ì•Œë¦¼í†¡ í™œì„±í™”ë¥¼ ì‹ ì²­í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nìŠˆí¼ ê´€ë¦¬ìì˜ ìŠ¹ì¸ í›„ í™œì„±í™”ë©ë‹ˆë‹¤.'
    );
    if (!confirmed) return;

    try {
      setProcessing(true);
      const spaceId = selectedSpace.id || selectedSpace.spaceId;
      const userSpaceData = user.spaceAccess?.find(s => s.spaceId === spaceId);

      await spaceSettingsService.requestAlimtalkActivation(
        spaceId,
        user.id,
        user.displayName || user.name,
        userSpaceData?.userType || 'manager',
        selectedSpace.spaceName || selectedSpace.name
      );

      alert('ì•Œë¦¼í†¡ í™œì„±í™” ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\n\nìŠˆí¼ ê´€ë¦¬ìì˜ ìŠ¹ì¸ì„ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.');
      await loadSettings();
    } catch (error) {
      console.error('ì•Œë¦¼í†¡ í™œì„±í™” ì‹ ì²­ ì‹¤íŒ¨:', error);
      alert('ì‹ ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
      setProcessing(false);
    }
  };

  // ë¹„í™œì„±í™”
  const handleDeactivate = async () => {
    const confirmed = window.confirm(
      'ì•Œë¦¼í†¡ì„ ë¹„í™œì„±í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì˜ˆì•½ ì™„ë£Œ ì‹œ ì•Œë¦¼í†¡ì´ ë°œì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'
    );
    if (!confirmed) return;

    try {
      setProcessing(true);
      const spaceId = selectedSpace.id || selectedSpace.spaceId;
      const userSpaceData = user.spaceAccess?.find(s => s.spaceId === spaceId);

      await spaceSettingsService.deactivateAlimtalk(
        spaceId,
        user.id,
        user.displayName || user.name,
        userSpaceData?.userType || 'manager'
      );

      alert('ì•Œë¦¼í†¡ì´ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
      await loadSettings();
    } catch (error) {
      console.error('ì•Œë¦¼í†¡ ë¹„í™œì„±í™” ì‹¤íŒ¨:', error);
      alert('ë¹„í™œì„±í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
      setProcessing(false);
    }
  };

  // ìƒíƒœë³„ UI ì •ë³´
  const getStatusInfo = () => {
    if (!settings) return null;

    switch (settings.status) {
      case 'approved':
        return {
          icon: CheckCircle,
          iconColor: 'text-green-400',
          bgColor: 'bg-green-500/10 border-green-500/30',
          textColor: 'text-green-300',
          title: 'âœ“ ì•Œë¦¼í†¡ í™œì„±í™”ë¨',
          description: 'ì˜ˆì•½ ì™„ë£Œ ì‹œ ê²ŒìŠ¤íŠ¸ì—ê²Œ ì•Œë¦¼í†¡ì´ ìë™ìœ¼ë¡œ ë°œì†¡ë©ë‹ˆë‹¤.',
          showButton: true,
          buttonText: 'ë¹„í™œì„±í™”',
          buttonAction: handleDeactivate,
          buttonColor: 'from-red-500 to-red-600'
        };
      
      case 'pending':
        return {
          icon: Clock,
          iconColor: 'text-yellow-400',
          bgColor: 'bg-yellow-500/10 border-yellow-500/30',
          textColor: 'text-yellow-300',
          title: 'â³ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘',
          description: 'ìŠˆí¼ ê´€ë¦¬ìì˜ ìŠ¹ì¸ì„ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤. ìŠ¹ì¸ í›„ í™œì„±í™”ë©ë‹ˆë‹¤.',
          showButton: false
        };
      
      case 'rejected':
        return {
          icon: XCircle,
          iconColor: 'text-red-400',
          bgColor: 'bg-red-500/10 border-red-500/30',
          textColor: 'text-red-300',
          title: 'âœ— ì‹ ì²­ ê±°ë¶€ë¨',
          description: settings.rejectionReason || 'ì•Œë¦¼í†¡ í™œì„±í™” ì‹ ì²­ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.',
          showButton: true,
          buttonText: 'ë‹¤ì‹œ ì‹ ì²­í•˜ê¸°',
          buttonAction: handleRequestActivation,
          buttonColor: 'from-blue-500 to-blue-600'
        };
      
      default: // inactive
        return {
          icon: BellOff,
          iconColor: 'text-slate-400',
          bgColor: 'bg-slate-500/10 border-slate-500/30',
          textColor: 'text-slate-300',
          title: 'âœ— ì•Œë¦¼í†¡ ë¹„í™œì„±í™”ë¨',
          description: 'ì˜ˆì•½ ì™„ë£Œ ì‹œ ì•Œë¦¼í†¡ì´ ë°œì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í™œì„±í™”ë¥¼ ì‹ ì²­í•˜ì„¸ìš”.',
          showButton: true,
          buttonText: 'í™œì„±í™” ì‹ ì²­',
          buttonAction: handleRequestActivation,
          buttonColor: 'from-green-500 to-green-600'
        };
    }
  };

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900">
        <div className="text-center">
          <div className="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-slate-300">ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
      </div>
    );
  }

  const statusInfo = getStatusInfo();

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 pb-20">
      {/* í—¤ë” */}
      <div className="bg-gradient-to-r from-slate-800 to-slate-700 border-b border-slate-600/30 sticky top-0 z-10 shadow-lg">
        <div className="max-w-2xl mx-auto px-4 py-4">
          <div className="flex items-center gap-3">
            <button
              onClick={() => navigate('/space/manage')}
              className="p-2 hover:bg-white/10 rounded-lg transition-colors"
            >
              <ArrowLeft className="w-5 h-5 text-white" />
            </button>
            <div>
              <h1 className="text-xl font-bold text-white">ì•Œë¦¼í†¡ ì„¤ì •</h1>
              <p className="text-sm text-slate-300">{selectedSpace?.spaceName || ''}</p>
            </div>
          </div>
        </div>
      </div>

      {/* ì„¤ì • ì¹´ë“œ */}
      <div className="max-w-2xl mx-auto px-4 py-6">
        <div className="bg-gradient-to-br from-slate-800/80 to-slate-700/50 backdrop-blur-sm border border-slate-600/30 rounded-xl p-6 shadow-lg">
          <div className="space-y-6">
            {/* í˜„ì¬ ìƒíƒœ */}
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                {statusInfo && (
                  <statusInfo.icon className={`w-6 h-6 ${statusInfo.iconColor}`} />
                )}
                <div>
                  <h3 className="text-lg font-semibold text-white">
                    ì•Œë¦¼í†¡ ë°œì†¡
                  </h3>
                  <p className="text-sm text-slate-400">
                    ì˜ˆì•½ ì™„ë£Œ ì‹œ ê²ŒìŠ¤íŠ¸ì—ê²Œ ìë™ ë°œì†¡
                  </p>
                </div>
              </div>
            </div>

            {/* ìƒíƒœ í‘œì‹œ */}
            {statusInfo && (
              <div className={`rounded-lg p-4 ${statusInfo.bgColor}`}>
                <p className={`font-medium ${statusInfo.textColor}`}>
                  {statusInfo.title}
                </p>
                <p className={`text-sm mt-1 ${statusInfo.textColor.replace('300', '200/80')}`}>
                  {statusInfo.description}
                </p>
              </div>
            )}

            {/* ì‹ ì²­/ìŠ¹ì¸ ì •ë³´ */}
            {settings?.requestedAt && (
              <div className="text-xs text-slate-400 pt-4 border-t border-slate-600/30 space-y-1">
                <p>
                  ì‹ ì²­ì¼: {settings.requestedAt.toDate?.().toLocaleString('ko-KR') || 'ì•Œ ìˆ˜ ì—†ìŒ'}
                </p>
                {settings.requestedBy && (
                  <p>ì‹ ì²­ì: {settings.requestedBy.displayName}</p>
                )}
                {settings.approvedAt && settings.approvedBy && (
                  <>
                    <p>ìŠ¹ì¸ì¼: {settings.approvedAt.toDate?.().toLocaleString('ko-KR')}</p>
                    <p>ìŠ¹ì¸ì: {settings.approvedBy.displayName}</p>
                  </>
                )}
              </div>
            )}

            {/* ì•¡ì…˜ ë²„íŠ¼ */}
            {statusInfo?.showButton && (
              <button
                onClick={statusInfo.buttonAction}
                disabled={processing}
                className={`w-full px-6 py-4 bg-gradient-to-r ${statusInfo.buttonColor} hover:opacity-90 text-white rounded-xl font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2`}
              >
                {processing ? (
                  <>
                    <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                    <span>ì²˜ë¦¬ ì¤‘...</span>
                  </>
                ) : (
                  <>
                    <Bell className="w-5 h-5" />
                    <span>{statusInfo.buttonText}</span>
                  </>
                )}
              </button>
            )}
          </div>
        </div>

        {/* ì•ˆë‚´ ë©”ì‹œì§€ */}
        <div className="mt-6 bg-blue-500/10 border border-blue-500/30 rounded-xl p-4">
          <div className="flex items-start gap-3">
            <Info className="w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5" />
            <div className="text-sm text-blue-300">
              <p className="font-medium mb-2">ğŸ’¡ ì•Œë¦¼í†¡ ì•ˆë‚´</p>
              <ul className="space-y-1 text-blue-200/80">
                <li>â€¢ ì•Œë¦¼í†¡ í™œì„±í™”ëŠ” ìŠˆí¼ ê´€ë¦¬ìì˜ ìŠ¹ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</li>
                <li>â€¢ ìŠ¹ì¸ í›„ ì˜ˆì•½ ì™„ë£Œ ì‹œ ê²ŒìŠ¤íŠ¸ì—ê²Œ ìë™ìœ¼ë¡œ ë°œì†¡ë©ë‹ˆë‹¤.</li>
                <li>â€¢ ì•Œë¦¼í†¡ì—ëŠ” ì˜ˆì•½ ì •ë³´ì™€ ì…ê¸ˆ ê³„ì¢Œê°€ í¬í•¨ë©ë‹ˆë‹¤.</li>
                <li>â€¢ ë¹„í™œì„±í™”ëŠ” ì¦‰ì‹œ ì²˜ë¦¬ë˜ë©°, ì–¸ì œë“  ë‹¤ì‹œ ì‹ ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
              </ul>
            </div>
          </div>
        </div>

        {/* ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ ì¶”ê°€ ì•ˆë‚´ */}
        {settings?.status === 'pending' && (
          <div className="mt-4 bg-yellow-500/10 border border-yellow-500/30 rounded-xl p-4">
            <div className="flex items-start gap-3">
              <AlertCircle className="w-5 h-5 text-yellow-400 flex-shrink-0 mt-0.5" />
              <div className="text-sm text-yellow-300">
                <p className="font-medium mb-1">â³ ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘</p>
                <p className="text-yellow-200/80">
                  ìŠˆí¼ ê´€ë¦¬ìê°€ ì‹ ì²­ì„ ê²€í† í•˜ê³  ìˆìŠµë‹ˆë‹¤. ìŠ¹ì¸ë˜ë©´ ìë™ìœ¼ë¡œ í™œì„±í™”ë©ë‹ˆë‹¤.
                </p>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}
</file>

<file path="src/pages/ExpenseListPage.jsx">
import { useState, useEffect, useMemo } from 'react';
import { useNavigate } from 'react-router-dom';
import { Plus, Calendar, User, CheckCircle, XCircle, Clock, ChevronDown, ChevronUp, Filter, Settings, X, ArrowLeft } from 'lucide-react';
import { doc, getDoc, setDoc, Timestamp } from 'firebase/firestore';
import { db } from '../config/firebase';
import { useAuth } from '../hooks/useAuth';
import useStore from '../store/useStore';
import expenseService from '../services/expenseService';
import ExpenseDetailModal from '../components/expenses/ExpenseDetailModal';
import { canManageSpace } from '../utils/permissions';

const ExpenseListPage = () => {
  const navigate = useNavigate();
  const { user } = useAuth();
  const { selectedSpace } = useStore();
  
  const [expenses, setExpenses] = useState([]);
  const [filteredExpenses, setFilteredExpenses] = useState([]);
  const [selectedExpense, setSelectedExpense] = useState(null);
  const [isLoading, setIsLoading] = useState(true);
  const [filter, setFilter] = useState('all'); // all, pending, approved, rejected
  const [expandedId, setExpandedId] = useState(null); // í•˜ë‚˜ë§Œ ì—´ë¦¬ë„ë¡
  
  // ë‚ ì§œ í•„í„°
  const [showDateFilter, setShowDateFilter] = useState(false);
  const [startDate, setStartDate] = useState('');
  const [endDate, setEndDate] = useState('');
  
  // ê¸°ë³¸ í•„í„° ì„¤ì • (ë§¤ë‹ˆì € ì´ìƒ)
  const [showDefaultSettings, setShowDefaultSettings] = useState(false);
  const [defaultFilter, setDefaultFilter] = useState('all');
  const [defaultDateRange, setDefaultDateRange] = useState('all'); // all, month, week, custom
  const [defaultStartDate, setDefaultStartDate] = useState('');
  const [defaultEndDate, setDefaultEndDate] = useState('');
  
  const isManager = selectedSpace?.userType && canManageSpace(selectedSpace.userType);
  
  // ìš´ì˜ë¹„ ëª©ë¡ ì¡°íšŒ
  useEffect(() => {
    if (selectedSpace?.id) {
      loadExpenses();
      loadDefaultSettings();
    }
  }, [selectedSpace]);
  
  // í•„í„°ë§
  useEffect(() => {
    applyFilter();
  }, [expenses, filter, startDate, endDate]);
  
  const loadExpenses = async () => {
    setIsLoading(true);
    try {
      const data = await expenseService.getExpenses(selectedSpace.id);
      setExpenses(data);
    } catch (error) {
      console.error('ìš´ì˜ë¹„ ì¡°íšŒ ì‹¤íŒ¨:', error);
      alert('ìš´ì˜ë¹„ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setIsLoading(false);
    }
  };
  
  const loadDefaultSettings = async () => {
    try {
      // Firebaseì—ì„œ ìŠ¤í˜ì´ìŠ¤ë³„ ê¸°ë³¸ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
      const settingsRef = doc(db, 'spaces', selectedSpace.id, 'settings', 'expenseList');
      const settingsSnap = await getDoc(settingsRef);
      
      if (settingsSnap.exists()) {
        const settings = settingsSnap.data();
        setDefaultFilter(settings.defaultFilter || 'all');
        setDefaultDateRange(settings.defaultDateRange || 'all');
        setDefaultStartDate(settings.defaultStartDate || '');
        setDefaultEndDate(settings.defaultEndDate || '');
        
        // ê¸°ë³¸ í•„í„° ì ìš©
        setFilter(settings.defaultFilter || 'all');
        
        // ê¸°ë³¸ ë‚ ì§œ ë²”ìœ„ ì ìš©
        if (settings.defaultDateRange === 'month') {
          const today = new Date();
          const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
          setStartDate(firstDay.toISOString().split('T')[0]);
          setEndDate(new Date().toISOString().split('T')[0]);
        } else if (settings.defaultDateRange === 'week') {
          const today = new Date();
          const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
          setStartDate(weekAgo.toISOString().split('T')[0]);
          setEndDate(today.toISOString().split('T')[0]);
        } else if (settings.defaultDateRange === 'custom') {
          setStartDate(settings.defaultStartDate || '');
          setEndDate(settings.defaultEndDate || '');
        }
      }
    } catch (error) {
      console.log('ê¸°ë³¸ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨ (ì„¤ì • ì—†ìŒ):', error);
    }
  };
  
  const saveDefaultSettings = async () => {
    try {
      // custom ë‚ ì§œ ë²”ìœ„ ì„ íƒ ì‹œ ìœ íš¨ì„± ê²€ì‚¬
      if (defaultDateRange === 'custom') {
        if (!defaultStartDate || !defaultEndDate) {
          alert('ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }
        if (new Date(defaultStartDate) > new Date(defaultEndDate)) {
          alert('ì‹œì‘ì¼ì€ ì¢…ë£Œì¼ë³´ë‹¤ ì´ì „ì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
          return;
        }
      }
      
      const settingsRef = doc(db, 'spaces', selectedSpace.id, 'settings', 'expenseList');
      await setDoc(settingsRef, {
        defaultFilter: defaultFilter,
        defaultDateRange: defaultDateRange,
        defaultStartDate: defaultStartDate,
        defaultEndDate: defaultEndDate,
        updatedBy: user.displayName || user.name,
        updatedAt: Timestamp.fromDate(new Date()),
      });
      
      alert('ê¸°ë³¸ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\nëª¨ë“  ì‚¬ìš©ìì—ê²Œ ì ìš©ë©ë‹ˆë‹¤.');
      setShowDefaultSettings(false);
      
      // ì¦‰ì‹œ ì ìš©
      setFilter(defaultFilter);
      if (defaultDateRange === 'month') {
        const today = new Date();
        const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
        setStartDate(firstDay.toISOString().split('T')[0]);
        setEndDate(new Date().toISOString().split('T')[0]);
      } else if (defaultDateRange === 'week') {
        const today = new Date();
        const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
        setStartDate(weekAgo.toISOString().split('T')[0]);
        setEndDate(today.toISOString().split('T')[0]);
      } else if (defaultDateRange === 'custom') {
        setStartDate(defaultStartDate);
        setEndDate(defaultEndDate);
      } else {
        setStartDate('');
        setEndDate('');
      }
    } catch (error) {
      console.error('ê¸°ë³¸ ì„¤ì • ì €ì¥ ì‹¤íŒ¨:', error);
      alert('ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  };
  
  const applyFilter = () => {
    let filtered = expenses;
    
    // ìƒíƒœ í•„í„°
    if (filter === 'pending') {
      filtered = filtered.filter(e => e.status === 'pending');
    } else if (filter === 'approved') {
      filtered = filtered.filter(e => e.status === 'approved');
    } else if (filter === 'rejected') {
      filtered = filtered.filter(e => e.status === 'rejected');
    }
    
    // ë‚ ì§œ í•„í„°
    if (startDate) {
      const start = new Date(startDate);
      start.setHours(0, 0, 0, 0);
      filtered = filtered.filter(e => {
        const usedDate = new Date(e.usedAt);
        usedDate.setHours(0, 0, 0, 0);
        return usedDate >= start;
      });
    }
    
    if (endDate) {
      const end = new Date(endDate);
      end.setHours(23, 59, 59, 999);
      filtered = filtered.filter(e => {
        const usedDate = new Date(e.usedAt);
        return usedDate <= end;
      });
    }
    
    setFilteredExpenses(filtered);
  };
  
  const clearDateFilter = () => {
    setStartDate('');
    setEndDate('');
  };
  
  const handleApprove = async (expenseId) => {
    try {
      await expenseService.approveExpense(
        selectedSpace.id,
        expenseId,
        {
          approverId: user.id,
          approverName: user.displayName || user.name,
        }
      );
      
      alert('ìŠ¹ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
      await loadExpenses();
      setSelectedExpense(null);
    } catch (error) {
      console.error('ìŠ¹ì¸ ì‹¤íŒ¨:', error);
      throw error;
    }
  };
  
  const handleReject = async (expenseId, reason) => {
    try {
      await expenseService.rejectExpense(
        selectedSpace.id,
        expenseId,
        {
          rejecterId: user.id,
          rejecterName: user.displayName || user.name,
        },
        reason
      );
      
      alert('ê±°ë¶€ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
      await loadExpenses();
      setSelectedExpense(null);
    } catch (error) {
      console.error('ê±°ë¶€ ì‹¤íŒ¨:', error);
      throw error;
    }
  };
  
  const toggleExpand = (id) => {
    // ê°™ì€ ê±° í´ë¦­í•˜ë©´ ë‹«ê¸°, ë‹¤ë¥¸ ê±° í´ë¦­í•˜ë©´ ê·¸ê²ƒë§Œ ì—´ê¸°
    setExpandedId(expandedId === id ? null : id);
  };
  
  const formatCurrency = (amount) => {
    return amount.toLocaleString('ko-KR') + 'ì›';
  };
  
  const formatDate = (date) => {
    if (!date) return '-';
    return new Date(date).toLocaleDateString('ko-KR', {
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
  };
  
  const getItemsSummary = (items) => {
    if (!items || items.length === 0) return 'í•­ëª© ì—†ìŒ';
    if (items.length === 1) return items[0].itemName;
    if (items.length === 2) return `${items[0].itemName}, ${items[1].itemName}`;
    return `${items[0].itemName}, ${items[1].itemName} ì™¸ ${items.length - 2}ê°œ`;
  };
  
  const getStatusBadge = (status) => {
    switch (status) {
      case 'pending':
        return (
          <span className="inline-flex items-center gap-1 px-2 py-1 bg-yellow-100 text-yellow-700 rounded-full text-xs font-semibold">
            <Clock className="w-3 h-3" />
            ëŒ€ê¸°ì¤‘
          </span>
        );
      case 'approved':
        return (
          <span className="inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-semibold">
            <CheckCircle className="w-3 h-3" />
            ìŠ¹ì¸
          </span>
        );
      case 'rejected':
        return (
          <span className="inline-flex items-center gap-1 px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs font-semibold">
            <XCircle className="w-3 h-3" />
            ê±°ë¶€
          </span>
        );
      default:
        return null;
    }
  };
  
  const counts = useMemo(() => {
    // ë‚ ì§œ í•„í„°ê°€ ì ìš©ëœ expensesë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì¹´ìš´íŠ¸
    let dateFiltered = expenses;
    
    // ë‚ ì§œ í•„í„° ì ìš©
    if (startDate) {
      const start = new Date(startDate);
      start.setHours(0, 0, 0, 0);
      dateFiltered = dateFiltered.filter(e => {
        const usedDate = new Date(e.usedAt);
        usedDate.setHours(0, 0, 0, 0);
        return usedDate >= start;
      });
    }
    
    if (endDate) {
      const end = new Date(endDate);
      end.setHours(23, 59, 59, 999);
      dateFiltered = dateFiltered.filter(e => {
        const usedDate = new Date(e.usedAt);
        return usedDate <= end;
      });
    }
    
    return {
      all: dateFiltered.length,
      pending: dateFiltered.filter(e => e.status === 'pending').length,
      approved: dateFiltered.filter(e => e.status === 'approved').length,
      rejected: dateFiltered.filter(e => e.status === 'rejected').length,
    };
  }, [expenses, startDate, endDate]);
  
  return (
    <div className="min-h-screen bg-gray-50 pb-24">
      {/* í—¤ë” */}
      <div className="bg-gradient-to-br from-blue-500 to-indigo-600 text-white">
        <div className="max-w-2xl mx-auto px-4 py-6">
          <div className="flex items-center gap-4 mb-3">
            <button
              onClick={() => navigate('/')}
              className="w-10 h-10 rounded-xl flex items-center justify-center bg-white/20 hover:bg-white/30 transition-colors"
            >
              <ArrowLeft className="w-5 h-5" />
            </button>
            <div className="flex-1">
              <h1 className="text-2xl font-bold">ğŸ’° ê³µìš© ìš´ì˜ë¹„</h1>
              <p className="text-white/80 text-sm mt-1">
                {selectedSpace?.spaceName || 'ìŠ¤í˜ì´ìŠ¤'} ìš´ì˜ë¹„ ê´€ë¦¬
              </p>
            </div>
          </div>
          <div className="flex gap-2">
            <button
              onClick={() => setShowDateFilter(!showDateFilter)}
              className={`p-2 rounded-lg transition-colors ${
                showDateFilter || startDate || endDate
                  ? 'bg-white/30'
                  : 'bg-white/10 hover:bg-white/20'
              }`}
            >
              <Filter className="w-5 h-5" />
            </button>
            {isManager && (
              <button
                onClick={() => setShowDefaultSettings(true)}
                className="p-2 rounded-lg bg-white/10 hover:bg-white/20 transition-colors"
              >
                <Settings className="w-5 h-5" />
              </button>
            )}
          </div>
        </div>
      </div>
      
      {/* ë‚ ì§œ í•„í„° */}
      {showDateFilter && (
        <div className="bg-white border-b border-gray-200 p-4">
          <div className="max-w-2xl mx-auto space-y-3">
            <div className="flex items-center justify-between">
              <h3 className="font-semibold text-gray-900">ğŸ“… ê¸°ê°„ í•„í„°</h3>
              {(startDate || endDate) && (
                <button
                  onClick={clearDateFilter}
                  className="text-sm text-blue-600 hover:text-blue-700 font-semibold"
                >
                  ì´ˆê¸°í™”
                </button>
              )}
            </div>
            <div className="grid grid-cols-2 gap-3">
              <div>
                <label className="block text-sm text-gray-600 mb-1">ì‹œì‘ì¼</label>
                <input
                  type="date"
                  value={startDate}
                  onChange={(e) => setStartDate(e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
              </div>
              <div>
                <label className="block text-sm text-gray-600 mb-1">ì¢…ë£Œì¼</label>
                <input
                  type="date"
                  value={endDate}
                  onChange={(e) => setEndDate(e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
              </div>
            </div>
            {(startDate || endDate) && (
              <div className="text-sm text-gray-600 text-center">
                {startDate && endDate
                  ? `${startDate} ~ ${endDate}`
                  : startDate
                  ? `${startDate} ì´í›„`
                  : `${endDate} ì´ì „`
                }
              </div>
            )}
          </div>
        </div>
      )}
      
      {/* í•„í„° íƒ­ */}
      <div className="bg-white border-b border-gray-200 sticky top-0 z-10 shadow-sm">
        <div className="max-w-2xl mx-auto px-4">
          <div className="flex gap-1 overflow-x-auto">
            <button
              onClick={() => setFilter('all')}
              className={`flex-1 min-w-[80px] px-4 py-3 font-semibold transition-colors ${
                filter === 'all'
                  ? 'text-blue-600 border-b-2 border-blue-600'
                  : 'text-gray-600'
              }`}
            >
              ì „ì²´ ({counts.all})
            </button>
            <button
              onClick={() => setFilter('pending')}
              className={`flex-1 min-w-[80px] px-4 py-3 font-semibold transition-colors ${
                filter === 'pending'
                  ? 'text-yellow-600 border-b-2 border-yellow-600'
                  : 'text-gray-600'
              }`}
            >
              ëŒ€ê¸°ì¤‘ ({counts.pending})
            </button>
            <button
              onClick={() => setFilter('approved')}
              className={`flex-1 min-w-[80px] px-4 py-3 font-semibold transition-colors ${
                filter === 'approved'
                  ? 'text-green-600 border-b-2 border-green-600'
                  : 'text-gray-600'
              }`}
            >
              ìŠ¹ì¸ ({counts.approved})
            </button>
            <button
              onClick={() => setFilter('rejected')}
              className={`flex-1 min-w-[80px] px-4 py-3 font-semibold transition-colors ${
                filter === 'rejected'
                  ? 'text-red-600 border-b-2 border-red-600'
                  : 'text-gray-600'
              }`}
            >
              ê±°ë¶€ ({counts.rejected})
            </button>
          </div>
        </div>
      </div>
      
      {/* ëª©ë¡ */}
      <div className="max-w-2xl mx-auto p-4 space-y-3">
        {isLoading ? (
          <div className="text-center py-12">
            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
            <p className="text-gray-500 mt-4">ë¡œë”© ì¤‘...</p>
          </div>
        ) : filteredExpenses.length === 0 ? (
          <div className="bg-white rounded-xl p-12 text-center">
            <p className="text-gray-500">
              {filter === 'all' 
                ? (startDate || endDate ? 'í•´ë‹¹ ê¸°ê°„ì— ìš´ì˜ë¹„ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.' : 'ìš´ì˜ë¹„ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.')
                : `${filter === 'pending' ? 'ëŒ€ê¸°ì¤‘ì¸' : filter === 'approved' ? 'ìŠ¹ì¸ëœ' : 'ê±°ë¶€ëœ'} ì²­êµ¬ê°€ ì—†ìŠµë‹ˆë‹¤.`
              }
            </p>
          </div>
        ) : (
          filteredExpenses.map((expense) => {
            const isExpanded = expandedId === expense.id;
            
            return (
              <div
                key={expense.id}
                className={`bg-white rounded-xl shadow-sm overflow-hidden transition-all ${
                  isExpanded ? 'ring-2 ring-blue-500 shadow-lg' : ''
                }`}
              >
                {/* í—¤ë” */}
                <div
                  className={`p-4 cursor-pointer transition-colors ${
                    isExpanded ? 'bg-blue-50' : 'hover:bg-gray-50'
                  }`}
                  onClick={() => toggleExpand(expense.id)}
                >
                  <div className="flex items-start justify-between mb-2">
                    <div className="flex items-center gap-2">
                      <User className="w-4 h-4 text-gray-400" />
                      <span className="font-semibold text-gray-900">
                        {expense.userName}
                      </span>
                    </div>
                    {getStatusBadge(expense.status)}
                  </div>
                  
                  <div className="flex items-center gap-2 text-sm text-gray-600 mb-2">
                    <Calendar className="w-4 h-4" />
                    ì‚¬ìš©ì¼: {formatDate(expense.usedAt)}
                  </div>
                  
                  {/* í’ˆëª© ìš”ì•½ */}
                  <div className="text-sm text-gray-700 mb-2 line-clamp-1">
                    {getItemsSummary(expense.items)}
                  </div>
                  
                  <div className="flex items-center justify-between">
                    <span className="text-xs text-gray-500">
                      {expense.items.length}ê°œ í’ˆëª©
                    </span>
                    <div className="flex items-center gap-2">
                      <span className="text-xl font-bold text-blue-600">
                        {formatCurrency(expense.totalAmount)}
                      </span>
                      {isExpanded ? (
                        <ChevronUp className="w-5 h-5 text-blue-600" />
                      ) : (
                        <ChevronDown className="w-5 h-5 text-gray-400" />
                      )}
                    </div>
                  </div>
                </div>
                
                {/* ìƒì„¸ (ì ‘í˜”ë‹¤ í¼ì³ì§) */}
                {isExpanded && (
                  <div className="border-t-2 border-blue-200 p-4 bg-blue-50/50 space-y-3 animate-fadeIn">
                    {/* í’ˆëª© ë‚´ì—­ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2">
                        ğŸ“‹ í’ˆëª© ë‚´ì—­
                      </h4>
                      <div className="space-y-2">
                        {expense.items.map((item, idx) => (
                          <div key={idx} className="bg-white rounded-lg p-3 flex justify-between shadow-sm">
                            <div>
                              <div className="font-medium text-gray-900">
                                {item.itemName}
                                {item.itemSpec && (
                                  <span className="text-gray-500 text-sm ml-1">({item.itemSpec})</span>
                                )}
                              </div>
                              <div className="text-sm text-gray-600 mt-1">
                                {formatCurrency(item.itemPrice)} Ã— {item.itemQty}
                              </div>
                            </div>
                            <div className="font-bold text-gray-900 text-lg">
                              {formatCurrency(item.total)}
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                    
                    {/* ë©”ëª¨ */}
                    {expense.memo && (
                      <div className="bg-white rounded-lg p-3 shadow-sm">
                        <h4 className="text-sm font-semibold text-gray-900 mb-2 flex items-center gap-2">
                          ğŸ“ ë©”ëª¨
                        </h4>
                        <p className="text-sm text-gray-700">{expense.memo}</p>
                      </div>
                    )}
                    
                    {/* ìƒì„¸ë³´ê¸° ë²„íŠ¼ */}
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        setSelectedExpense(expense);
                      }}
                      className="w-full py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors shadow-sm"
                    >
                      ìƒì„¸ë³´ê¸° ë° ìŠ¹ì¸/ê±°ë¶€
                    </button>
                  </div>
                )}
              </div>
            );
          })
        )}
      </div>
      
      {/* í”Œë¡œíŒ… ë²„íŠ¼ */}
      <button
        onClick={() => navigate('/expenses/request')}
        className="fixed right-4 bottom-20 w-14 h-14 bg-gradient-to-br from-blue-600 to-indigo-600 text-white rounded-full shadow-lg hover:shadow-xl transition-all flex items-center justify-center hover:scale-110"
        style={{ bottom: 'calc(70px + env(safe-area-inset-bottom))' }}
      >
        <Plus className="w-6 h-6" />
      </button>
      
      {/* ê¸°ë³¸ ì„¤ì • ëª¨ë‹¬ (ë§¤ë‹ˆì € ì „ìš©) */}
      {showDefaultSettings && (
        <>
          <div 
            className="fixed inset-0 bg-black/50 z-[100]"
            onClick={() => setShowDefaultSettings(false)}
          />
          <div className="fixed inset-x-4 top-1/2 -translate-y-1/2 bg-white rounded-xl shadow-xl z-[101] max-w-md mx-auto p-6">
            <div className="flex items-center justify-between mb-4">
              <h3 className="text-lg font-bold text-gray-900">âš™ï¸ ê¸°ë³¸ ì„¤ì •</h3>
              <button
                onClick={() => setShowDefaultSettings(false)}
                className="w-8 h-8 rounded-full hover:bg-gray-100 flex items-center justify-center"
              >
                <X className="w-5 h-5 text-gray-500" />
              </button>
            </div>
            
            <div className="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
              <p className="text-sm text-blue-900">
                ğŸ’¡ <strong>ë§¤ë‹ˆì € ì „ìš©:</strong> ëª¨ë“  ì‚¬ìš©ìê°€ í˜ì´ì§€ë¥¼ ì—´ ë•Œ í‘œì‹œë  ì´ˆê¸° í•„í„°ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
              </p>
            </div>
            
            <div className="space-y-4">
              {/* ê¸°ë³¸ ìƒíƒœ í•„í„° */}
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  ê¸°ë³¸ ìƒíƒœ í•„í„°
                </label>
                <select
                  value={defaultFilter}
                  onChange={(e) => setDefaultFilter(e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                  <option value="all">ì „ì²´</option>
                  <option value="pending">ëŒ€ê¸°ì¤‘ë§Œ í‘œì‹œ</option>
                  <option value="approved">ìŠ¹ì¸ë§Œ í‘œì‹œ</option>
                  <option value="rejected">ê±°ë¶€ë§Œ í‘œì‹œ</option>
                </select>
              </div>
              
              {/* ê¸°ë³¸ ë‚ ì§œ ë²”ìœ„ */}
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  ê¸°ë³¸ ë‚ ì§œ ë²”ìœ„
                </label>
                <select
                  value={defaultDateRange}
                  onChange={(e) => setDefaultDateRange(e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                  <option value="all">ì „ì²´ ê¸°ê°„</option>
                  <option value="week">ìµœê·¼ 1ì£¼ì¼</option>
                  <option value="month">ì´ë²ˆ ë‹¬</option>
                  <option value="custom">ë‚ ì§œ ì§ì ‘ ì§€ì •</option>
                </select>
              </div>
              
              {/* ë‚ ì§œ ì§ì ‘ ì§€ì • */}
              {defaultDateRange === 'custom' && (
                <div className="bg-gray-50 border border-gray-200 rounded-lg p-3 space-y-3">
                  <div>
                    <label className="block text-xs font-semibold text-gray-600 mb-1">
                      ì‹œì‘ì¼
                    </label>
                    <input
                      type="date"
                      value={defaultStartDate}
                      onChange={(e) => setDefaultStartDate(e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  <div>
                    <label className="block text-xs font-semibold text-gray-600 mb-1">
                      ì¢…ë£Œì¼
                    </label>
                    <input
                      type="date"
                      value={defaultEndDate}
                      onChange={(e) => setDefaultEndDate(e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  {defaultStartDate && defaultEndDate && (
                    <p className="text-xs text-center text-gray-600">
                      ğŸ“… {defaultStartDate} ~ {defaultEndDate}
                    </p>
                  )}
                </div>
              )}
            </div>
            
            <div className="flex gap-3 mt-6">
              <button
                onClick={() => setShowDefaultSettings(false)}
                className="flex-1 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors"
              >
                ì·¨ì†Œ
              </button>
              <button
                onClick={saveDefaultSettings}
                className="flex-1 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors"
              >
                ì €ì¥
              </button>
            </div>
          </div>
        </>
      )}
      
      {/* ìƒì„¸ë³´ê¸° ëª¨ë‹¬ */}
      {selectedExpense && (
        <ExpenseDetailModal
          expense={selectedExpense}
          selectedSpace={selectedSpace}
          onClose={() => setSelectedExpense(null)}
          onApprove={handleApprove}
          onReject={handleReject}
        />
      )}
    </div>
  );
};

export default ExpenseListPage;
</file>

<file path="src/pages/ExpenseRequestPage.jsx">
import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { ArrowLeft, Plus, Trash2, Calendar, ImageIcon, X } from 'lucide-react';
import { useAuth } from '../hooks/useAuth';
import useStore from '../store/useStore';
import expenseService from '../services/expenseService';
import { uploadImage, validateImage, createPreviewUrl, revokePreviewUrl } from '../utils/imageUpload';

const ExpenseRequestPage = () => {
  const navigate = useNavigate();
  const { user } = useAuth();
  const { selectedSpace } = useStore();
  
  const [usedAt, setUsedAt] = useState(new Date().toISOString().split('T')[0]); // YYYY-MM-DD
  const [memo, setMemo] = useState('');
  const [items, setItems] = useState([
    {
      itemName: '',
      itemPrice: '',
      itemQty: 1,
      itemSpec: '',
    }
  ]);
  const [imageFile, setImageFile] = useState(null);
  const [imagePreview, setImagePreview] = useState(null);
  const [isSubmitting, setIsSubmitting] = useState(false);
  
  // í•­ëª© ì¶”ê°€
  const addItem = () => {
    setItems([...items, {
      itemName: '',
      itemPrice: '',
      itemQty: 1,
      itemSpec: '',
    }]);
  };
  
  // í•­ëª© ì‚­ì œ
  const removeItem = (index) => {
    if (items.length === 1) {
      alert('ìµœì†Œ 1ê°œ í•­ëª©ì€ í•„ìš”í•©ë‹ˆë‹¤.');
      return;
    }
    
    const newItems = items.filter((_, i) => i !== index);
    setItems(newItems);
  };
  
  // í•­ëª© í•„ë“œ ë³€ê²½
  const updateItem = (index, field, value) => {
    const newItems = [...items];
    newItems[index][field] = value;
    setItems(newItems);
  };
  
  // ì´ë¯¸ì§€ ì„ íƒ
  const handleImageChange = async (e) => {
    const file = e.target.files[0];
    if (!file) return;
    
    try {
      // ìœ íš¨ì„± ê²€ì‚¬
      validateImage(file, 5); // ìµœëŒ€ 5MB
      
      // ê¸°ì¡´ í”„ë¦¬ë·° í•´ì œ
      if (imagePreview) {
        revokePreviewUrl(imagePreview);
      }
      
      // í”„ë¦¬ë·° ìƒì„±
      const previewUrl = createPreviewUrl(file);
      
      setImageFile(file);
      setImagePreview(previewUrl);
    } catch (error) {
      alert(error.message);
    }
  };
  
  // ì´ë¯¸ì§€ ì‚­ì œ
  const removeImage = () => {
    if (imagePreview) {
      revokePreviewUrl(imagePreview);
    }
    setImageFile(null);
    setImagePreview(null);
  };
  
  // ì´ì•¡ ê³„ì‚°
  const calculateTotal = () => {
    return items.reduce((sum, item) => {
      const price = parseFloat(item.itemPrice) || 0;
      const qty = parseInt(item.itemQty) || 0;
      return sum + (price * qty);
    }, 0);
  };
  
  // ìœ íš¨ì„± ê²€ì‚¬
  const validateForm = () => {
    // ì‚¬ìš©ì¼ì ì²´í¬
    if (!usedAt) {
      alert('ì‚¬ìš©ì¼ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
      return false;
    }
    
    // í•­ëª© ì²´í¬
    for (let i = 0; i < items.length; i++) {
      const item = items[i];
      
      if (!item.itemName.trim()) {
        alert(`${i + 1}ë²ˆ í•­ëª©ì˜ í’ˆëª©ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.`);
        return false;
      }
      
      if (!item.itemPrice || parseFloat(item.itemPrice) <= 0) {
        alert(`${i + 1}ë²ˆ í•­ëª©ì˜ ë‹¨ê°€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.`);
        return false;
      }
      
      if (!item.itemQty || parseInt(item.itemQty) <= 0) {
        alert(`${i + 1}ë²ˆ í•­ëª©ì˜ ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.`);
        return false;
      }
    }
    
    return true;
  };
  
  // ì œì¶œ
  const handleSubmit = async () => {
    if (!validateForm()) return;
    
    if (!window.confirm('ìš´ì˜ë¹„ë¥¼ ì²­êµ¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
    
    setIsSubmitting(true);
    
    try {
      console.log('ğŸ’° ìš´ì˜ë¹„ ì²­êµ¬ ì‹œì‘');
      
      // ì´ë¯¸ì§€ ì—…ë¡œë“œ (ìˆëŠ” ê²½ìš°ë§Œ)
      let imageUrl = '';
      if (imageFile) {
        console.log('ğŸ“¤ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘...');
        imageUrl = await uploadImage(imageFile, selectedSpace.id);
        console.log('âœ… ì´ë¯¸ì§€ ì—…ë¡œë“œ ì™„ë£Œ:', imageUrl);
      }
      
      // í•­ëª© ë°ì´í„° ì •ë¦¬
      const cleanedItems = items.map(item => ({
        itemName: item.itemName.trim(),
        itemPrice: parseFloat(item.itemPrice),
        itemQty: parseInt(item.itemQty),
        itemSpec: item.itemSpec.trim(),
      }));
      
      // Firebaseì— ì €ì¥
      const requestData = {
        userId: user.id,
        userName: user.displayName || user.name,
        usedAt: new Date(usedAt),
        memo: memo.trim(),
        items: cleanedItems,
        imageUrl: imageUrl,
      };
      
      console.log('ğŸ“¤ ì²­êµ¬ ë°ì´í„°:', requestData);
      
      await expenseService.createExpense(selectedSpace.id, requestData);
      
      console.log('âœ… ì²­êµ¬ ì™„ë£Œ');
      alert('ìš´ì˜ë¹„ ì²­êµ¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
      
      // ì´ë¯¸ì§€ í”„ë¦¬ë·° ì •ë¦¬
      if (imagePreview) {
        revokePreviewUrl(imagePreview);
      }
      
      navigate('/expenses');
    } catch (error) {
      console.error('âŒ ì²­êµ¬ ì‹¤íŒ¨:', error);
      alert('ì²­êµ¬ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setIsSubmitting(false);
    }
  };
  
  const formatCurrency = (amount) => {
    return amount.toLocaleString('ko-KR') + 'ì›';
  };
  
  return (
    <div className="min-h-screen bg-gray-50 pb-32">
      {/* í—¤ë” */}
      <div className="bg-gradient-to-br from-blue-500 to-indigo-600 text-white">
        <div className="max-w-2xl mx-auto px-4 py-6">
          <div className="flex items-center gap-4">
            <button
              onClick={() => navigate('/expenses')}
              className="w-10 h-10 rounded-xl flex items-center justify-center bg-white/20 hover:bg-white/30 transition-colors"
            >
              <ArrowLeft className="w-5 h-5" />
            </button>
            <div className="flex-1">
              <h1 className="text-2xl font-bold">ìš´ì˜ë¹„ ì²­êµ¬</h1>
              <p className="text-white/80 text-sm mt-1">
                {selectedSpace?.spaceName || 'ìŠ¤í˜ì´ìŠ¤'} ìš´ì˜ë¹„ ì²­êµ¬í•˜ê¸°
              </p>
            </div>
          </div>
        </div>
      </div>
      
      {/* í¼ */}
      <div className="max-w-2xl mx-auto p-4 space-y-6">
        {/* ì‚¬ìš©ì¼ì */}
        <div className="bg-white rounded-xl shadow-sm p-4">
          <label className="flex items-center gap-2 text-gray-700 font-semibold mb-2">
            <Calendar className="w-5 h-5 text-blue-600" />
            ì‚¬ìš©ì¼ì
          </label>
          <input
            type="date"
            value={usedAt}
            onChange={(e) => setUsedAt(e.target.value)}
            max={new Date().toISOString().split('T')[0]}
            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>
        
        {/* ì¦ë¹™ ì´ë¯¸ì§€ (ì „ì²´ ì²­êµ¬ì— ëŒ€í•œ í•˜ë‚˜ì˜ ì´ë¯¸ì§€) */}
        <div className="bg-white rounded-xl shadow-sm p-4">
          <label className="flex items-center gap-2 text-gray-700 font-semibold mb-3">
            <ImageIcon className="w-5 h-5 text-blue-600" />
            ì¦ë¹™ ì´ë¯¸ì§€ (ì„ íƒ)
          </label>
          
          {imagePreview ? (
            <div className="relative">
              <img 
                src={imagePreview} 
                alt="ì˜ìˆ˜ì¦ ë¯¸ë¦¬ë³´ê¸°"
                className="w-full rounded-lg border border-gray-300"
              />
              <button
                onClick={removeImage}
                className="absolute top-2 right-2 w-8 h-8 bg-red-600 text-white rounded-full flex items-center justify-center hover:bg-red-700 transition-colors shadow-lg"
              >
                <X className="w-4 h-4" />
              </button>
            </div>
          ) : (
            <label className="block cursor-pointer">
              <div className="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-500 transition-colors">
                <ImageIcon className="w-12 h-12 text-gray-400 mx-auto mb-2" />
                <p className="text-sm text-gray-600">
                  í´ë¦­í•˜ì—¬ ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ ì„ íƒ
                </p>
                <p className="text-xs text-gray-400 mt-1">
                  ìµœëŒ€ 5MB (JPG, PNG, GIF, WEBP)
                </p>
              </div>
              <input
                type="file"
                accept="image/*"
                onChange={handleImageChange}
                className="hidden"
              />
            </label>
          )}
        </div>
        
        {/* í’ˆëª© ë¦¬ìŠ¤íŠ¸ */}
        <div className="space-y-4">
          <div className="flex items-center justify-between">
            <h2 className="text-lg font-bold text-gray-900">ğŸ“‹ í’ˆëª© ë‚´ì—­</h2>
            <button
              onClick={addItem}
              className="px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors flex items-center gap-2"
            >
              <Plus className="w-4 h-4" />
              í•­ëª© ì¶”ê°€
            </button>
          </div>
          
          {items.map((item, index) => (
            <div key={index} className="bg-white rounded-xl shadow-sm p-4 space-y-3">
              {/* í—¤ë” */}
              <div className="flex items-center justify-between">
                <span className="font-bold text-gray-900">í•­ëª© {index + 1}</span>
                {items.length > 1 && (
                  <button
                    onClick={() => removeItem(index)}
                    className="w-8 h-8 rounded-full hover:bg-red-50 flex items-center justify-center text-red-600 transition-colors"
                  >
                    <Trash2 className="w-4 h-4" />
                  </button>
                )}
              </div>
              
              {/* í’ˆëª©ëª… */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  í’ˆëª©ëª… *
                </label>
                <input
                  type="text"
                  value={item.itemName}
                  onChange={(e) => updateItem(index, 'itemName', e.target.value)}
                  placeholder="ì˜ˆ: í™”ì¥ì§€, ì„¸ì œ, ì „êµ¬"
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
              </div>
              
              {/* ë‹¨ê°€ & ìˆ˜ëŸ‰ */}
              <div className="grid grid-cols-2 gap-3">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    ë‹¨ê°€ *
                  </label>
                  <input
                    type="number"
                    value={item.itemPrice}
                    onChange={(e) => updateItem(index, 'itemPrice', e.target.value)}
                    placeholder="0"
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  />
                </div>
                
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    ìˆ˜ëŸ‰ *
                  </label>
                  <input
                    type="number"
                    value={item.itemQty}
                    onChange={(e) => updateItem(index, 'itemQty', e.target.value)}
                    min="1"
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  />
                </div>
              </div>
              
              {/* ê·œê²© */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  ê·œê²© (ì„ íƒ)
                </label>
                <input
                  type="text"
                  value={item.itemSpec}
                  onChange={(e) => updateItem(index, 'itemSpec', e.target.value)}
                  placeholder="ì˜ˆ: 2L, 500ml, ëŒ€í˜•"
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
              </div>
              
              {/* ì†Œê³„ */}
              <div className="flex justify-between items-center pt-2 border-t border-gray-200">
                <span className="text-sm text-gray-600">ì†Œê³„</span>
                <span className="text-lg font-bold text-blue-600">
                  {formatCurrency((parseFloat(item.itemPrice) || 0) * (parseInt(item.itemQty) || 0))}
                </span>
              </div>
            </div>
          ))}
        </div>
        
        {/* ë©”ëª¨ */}
        <div className="bg-white rounded-xl shadow-sm p-4">
          <label className="block text-sm font-medium text-gray-700 mb-2">
            ë©”ëª¨ (ì„ íƒ)
          </label>
          <textarea
            value={memo}
            onChange={(e) => setMemo(e.target.value)}
            placeholder="ì²­êµ¬ ì‚¬ìœ ë‚˜ ì°¸ê³ ì‚¬í•­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
            rows={4}
            className="w-full px-4 py-3 border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>
        
        {/* ì´ì•¡ */}
        <div className="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border-2 border-blue-200">
          <div className="flex justify-between items-center">
            <span className="text-xl font-bold text-gray-900">ì´ì•¡</span>
            <span className="text-3xl font-bold text-blue-600">
              {formatCurrency(calculateTotal())}
            </span>
          </div>
        </div>
        
        {/* ì œì¶œ ë²„íŠ¼ */}
        <button
          onClick={handleSubmit}
          disabled={isSubmitting}
          className="w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl font-bold text-lg hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed"
        >
          {isSubmitting 
            ? 'ì²­êµ¬ ì²˜ë¦¬ ì¤‘...'
            : 'ì²­êµ¬í•˜ê¸°'
          }
        </button>
      </div>
    </div>
  );
};

export default ExpenseRequestPage;
</file>

<file path="src/pages/MemberManagePage.jsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { collection, getDocs, doc, deleteDoc, updateDoc } from 'firebase/firestore';
import { db } from '../config/firebase';
import useStore from '../store/useStore';
import { USER_TYPES, USER_TYPE_LABELS, USER_TYPE_LEVEL } from '../utils/constants';
import { canManageSpace } from '../utils/permissions';
import { ArrowLeft, UserMinus, Shield, Users, Search, X } from 'lucide-react';

export default function MemberManagePage() {
  const navigate = useNavigate();
  const { user, selectedSpace } = useStore();
  const [members, setMembers] = useState([]);
  const [loading, setLoading] = useState(true);
  const [processing, setProcessing] = useState(false);
  const [searchQuery, setSearchQuery] = useState('');
  const [filteredMembers, setFilteredMembers] = useState([]);

  // ê¶Œí•œ ì²´í¬
  useEffect(() => {
    console.log('ğŸ” MemberManagePage ê¶Œí•œ ì²´í¬:', { user, selectedSpace });
    
    if (!user || !selectedSpace) {
      console.warn('âš ï¸ user ë˜ëŠ” selectedSpace ì—†ìŒ');
      alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
      navigate('/');
      return;
    }

    const spaceId = selectedSpace.id || selectedSpace.spaceId;
    const userSpaceData = user.spaceAccess?.find(s => s.spaceId === spaceId);
    
    if (!userSpaceData || !canManageSpace(userSpaceData.userType)) {
      console.warn('âš ï¸ ê¶Œí•œ ì—†ìŒ:', userSpaceData?.userType);
      alert('ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ë§¤ë‹ˆì €ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
      navigate('/');
      return;
    }
    
    console.log('âœ… ê¶Œí•œ í™•ì¸ ì™„ë£Œ');
  }, [user, selectedSpace, navigate]);

  // ë©¤ë²„ ëª©ë¡ ë¡œë“œ
  useEffect(() => {
    if (!selectedSpace?.id) return;
    loadMembers();
  }, [selectedSpace]);

  const loadMembers = async () => {
    try {
      setLoading(true);
      const spaceId = selectedSpace.id || selectedSpace.spaceId;
      console.log('ğŸ“‹ ë©¤ë²„ ëª©ë¡ ë¡œë“œ ì‹œì‘:', spaceId);
      
      const assignedUsersRef = collection(db, `spaces/${spaceId}/assignedUsers`);
      const snapshot = await getDocs(assignedUsersRef);
      
      const memberList = [];
      snapshot.forEach(doc => {
        const data = doc.data();
        memberList.push({
          userId: doc.id,
          displayName: data.displayName || 'ì´ë¦„ ì—†ìŒ',
          email: data.email || '',
          userType: data.userType || 'guest',
          profileImage: data.profileImage || '',
          joinedAt: data.joinedAt,
          status: data.status || 'active'
        });
      });

      // ê¶Œí•œ ë ˆë²¨ ìˆœìœ¼ë¡œ ì •ë ¬
      memberList.sort((a, b) => {
        const levelA = USER_TYPE_LEVEL[a.userType] || 0;
        const levelB = USER_TYPE_LEVEL[b.userType] || 0;
        return levelB - levelA;
      });

      setMembers(memberList);
      setFilteredMembers(memberList); // ì´ˆê¸°ì—ëŠ” ì „ì²´ ëª©ë¡
    } catch (error) {
      console.error('ë©¤ë²„ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
      alert('ë©¤ë²„ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setLoading(false);
    }
  };

  // ê²€ìƒ‰ í•„í„°ë§
  useEffect(() => {
    if (!searchQuery.trim()) {
      setFilteredMembers(members);
      return;
    }

    const query = searchQuery.toLowerCase();
    const filtered = members.filter(member => 
      member.displayName.toLowerCase().includes(query) ||
      member.email.toLowerCase().includes(query) ||
      USER_TYPE_LABELS[member.userType].toLowerCase().includes(query)
    );

    setFilteredMembers(filtered);
  }, [searchQuery, members]);

  // ê¶Œí•œ ë³€ê²½
  const handleChangeUserType = async (member, newUserType) => {
    if (member.userId === user.id) {
      alert('ë³¸ì¸ì˜ ê¶Œí•œì€ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      return;
    }

    if (member.userType === USER_TYPES.MANAGER) {
      const confirmed = window.confirm(
        'ë§¤ë‹ˆì € ê¶Œí•œì„ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\në§¤ë‹ˆì €ê°€ ì—†ìœ¼ë©´ ìŠ¤í˜ì´ìŠ¤ ê´€ë¦¬ê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.'
      );
      if (!confirmed) return;
    }

    try {
      setProcessing(true);
      const spaceId = selectedSpace.id || selectedSpace.spaceId;

      // 1. spaces/{spaceId}/assignedUsers/{userId} ì—…ë°ì´íŠ¸
      const spaceUserRef = doc(db, `spaces/${spaceId}/assignedUsers`, member.userId);
      await updateDoc(spaceUserRef, {
        userType: newUserType
      });

      // 2. users/{userId}/spaceAccess/{spaceId} ì—…ë°ì´íŠ¸
      const userSpaceRef = doc(db, `users/${member.userId}/spaceAccess`, spaceId);
      await updateDoc(userSpaceRef, {
        userType: newUserType
      });

      alert('ê¶Œí•œì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
      await loadMembers();
    } catch (error) {
      console.error('ê¶Œí•œ ë³€ê²½ ì‹¤íŒ¨:', error);
      alert('ê¶Œí•œ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setProcessing(false);
    }
  };

  // ë©¤ë²„ ë‚´ë³´ë‚´ê¸°
  const handleRemoveMember = async (member) => {
    if (member.userId === user.id) {
      alert('ë³¸ì¸ì€ ë‚´ë³´ë‚¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      return;
    }

    if (member.userType === USER_TYPES.MANAGER) {
      alert('ë§¤ë‹ˆì €ëŠ” ë‚´ë³´ë‚¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ê¶Œí•œì„ ë³€ê²½í•´ì£¼ì„¸ìš”.');
      return;
    }

    const confirmed = window.confirm(
      `${member.displayName}ë‹˜ì„ ë‚´ë³´ë‚´ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`
    );
    if (!confirmed) return;

    try {
      setProcessing(true);
      const spaceId = selectedSpace.id || selectedSpace.spaceId;

      // 1. spaces/{spaceId}/assignedUsers/{userId} ì‚­ì œ
      const spaceUserRef = doc(db, `spaces/${spaceId}/assignedUsers`, member.userId);
      await deleteDoc(spaceUserRef);

      // 2. users/{userId}/spaceAccess/{spaceId} ì‚­ì œ
      const userSpaceRef = doc(db, `users/${member.userId}/spaceAccess`, spaceId);
      await deleteDoc(userSpaceRef);

      alert('ë©¤ë²„ê°€ ë‚´ë³´ë‚´ì¡ŒìŠµë‹ˆë‹¤.');
      await loadMembers();
    } catch (error) {
      console.error('ë©¤ë²„ ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨:', error);
      alert('ë©¤ë²„ ë‚´ë³´ë‚´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setProcessing(false);
    }
  };

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900">
        <div className="text-center">
          <div className="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-slate-300">ë©¤ë²„ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 pb-20">
      {/* í—¤ë” */}
      <div className="bg-gradient-to-r from-slate-800 to-slate-700 border-b border-slate-600/30 sticky top-0 z-10 shadow-lg">
        <div className="max-w-2xl mx-auto px-4 py-4">
          <div className="flex items-center gap-3">
            <button
              onClick={() => navigate('/space/manage')}
              className="p-2 hover:bg-white/10 rounded-lg transition-colors"
            >
              <ArrowLeft className="w-5 h-5 text-white" />
            </button>
            <div>
              <h1 className="text-xl font-bold text-white">ë©¤ë²„ ê´€ë¦¬</h1>
              <p className="text-sm text-slate-300">{selectedSpace?.spaceName || ''}</p>
            </div>
          </div>
        </div>
      </div>

      {/* ë©¤ë²„ ëª©ë¡ */}
      <div className="max-w-2xl mx-auto px-4 py-6">
        {/* ê²€ìƒ‰ ë°” */}
        <div className="mb-4">
          <div className="relative">
            <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400" />
            <input
              type="text"
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              placeholder="ì´ë¦„, ì´ë©”ì¼, ê¶Œí•œìœ¼ë¡œ ê²€ìƒ‰..."
              className="w-full pl-10 pr-10 py-3 bg-slate-800/50 border border-slate-600/30 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50"
            />
            {searchQuery && (
              <button
                onClick={() => setSearchQuery('')}
                className="absolute right-3 top-1/2 transform -translate-y-1/2 p-1 hover:bg-slate-700/50 rounded transition-colors"
              >
                <X className="w-4 h-4 text-slate-400" />
              </button>
            )}
          </div>
        </div>

        {/* ë©¤ë²„ ì¹´ìš´íŠ¸ */}
        <div className="mb-4 flex items-center justify-between">
          <div className="flex items-center gap-2 text-slate-300">
            <Users className="w-5 h-5" />
            <span className="font-medium">
              {searchQuery 
                ? `ê²€ìƒ‰ ê²°ê³¼ ${filteredMembers.length}ëª… / ì „ì²´ ${members.length}ëª…`
                : `ì „ì²´ ë©¤ë²„ ${members.length}ëª…`
              }
            </span>
          </div>
        </div>

        {/* ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ */}
        {searchQuery && filteredMembers.length === 0 && (
          <div className="bg-slate-800/50 border border-slate-600/30 rounded-xl p-8 text-center">
            <Search className="w-12 h-12 text-slate-400 mx-auto mb-3" />
            <p className="text-slate-300 font-medium">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</p>
            <p className="text-sm text-slate-400 mt-2">
              "{searchQuery}"ì™€(ê³¼) ì¼ì¹˜í•˜ëŠ” ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤
            </p>
            <button
              onClick={() => setSearchQuery('')}
              className="mt-4 px-4 py-2 bg-blue-500/20 hover:bg-blue-500/30 text-blue-300 rounded-lg transition-colors"
            >
              ê²€ìƒ‰ ì´ˆê¸°í™”
            </button>
          </div>
        )}

        {/* ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ */}
        <div className="space-y-3">
          {filteredMembers.map(member => {
            const isCurrentUser = member.userId === user.id;
            const joinedDate = member.joinedAt?.toDate?.() || null;

            return (
              <div
                key={member.userId}
                className="bg-gradient-to-br from-slate-800/80 to-slate-700/50 backdrop-blur-sm border border-slate-600/30 rounded-xl p-4 shadow-lg"
              >
                <div className="flex items-start justify-between gap-3">
                  {/* í”„ë¡œí•„ */}
                  <div className="flex items-center gap-3 flex-1">
                    {member.profileImage ? (
                      <img
                        src={member.profileImage}
                        alt={member.displayName}
                        className="w-12 h-12 rounded-full object-cover"
                      />
                    ) : (
                      <div className="w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-lg">
                        {member.displayName.charAt(0)}
                      </div>
                    )}

                    <div className="flex-1 min-w-0">
                      <div className="flex items-center gap-2">
                        <h3 className="font-semibold text-white truncate">
                          {member.displayName}
                        </h3>
                        {isCurrentUser && (
                          <span className="text-xs bg-blue-500/20 text-blue-300 px-2 py-0.5 rounded">
                            ë‚˜
                          </span>
                        )}
                      </div>
                      {member.email && (
                        <p className="text-sm text-slate-400 truncate">{member.email}</p>
                      )}
                      {joinedDate && (
                        <p className="text-xs text-slate-500 mt-1">
                          ê°€ì…ì¼: {joinedDate.toLocaleDateString('ko-KR')}
                        </p>
                      )}
                    </div>
                  </div>

                  {/* ê¶Œí•œ ë°°ì§€ */}
                  <div className="flex items-center gap-2">
                    <div className={`px-3 py-1.5 rounded-lg text-sm font-medium ${
                      member.userType === USER_TYPES.MANAGER
                        ? 'bg-red-500/20 text-red-300 border border-red-500/30'
                        : member.userType === USER_TYPES.VICE_MANAGER
                        ? 'bg-orange-500/20 text-orange-300 border border-orange-500/30'
                        : member.userType === USER_TYPES.SHAREHOLDER
                        ? 'bg-blue-500/20 text-blue-300 border border-blue-500/30'
                        : 'bg-slate-500/20 text-slate-300 border border-slate-500/30'
                    }`}>
                      {USER_TYPE_LABELS[member.userType]}
                    </div>
                  </div>
                </div>

                {/* ê´€ë¦¬ ë²„íŠ¼ */}
                {!isCurrentUser && (
                  <div className="mt-4 pt-4 border-t border-slate-600/30 flex gap-2">
                    {/* ê¶Œí•œ ë³€ê²½ ë“œë¡­ë‹¤ìš´ */}
                    <select
                      value={member.userType}
                      onChange={(e) => handleChangeUserType(member, e.target.value)}
                      disabled={processing}
                      className="flex-1 px-3 py-2 bg-slate-700/50 border border-slate-600/30 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/50 disabled:opacity-50"
                    >
                      <option value={USER_TYPES.GUEST}>{USER_TYPE_LABELS.guest}</option>
                      <option value={USER_TYPES.SHAREHOLDER}>{USER_TYPE_LABELS.shareholder}</option>
                      <option value={USER_TYPES.VICE_MANAGER}>{USER_TYPE_LABELS['vice-manager']}</option>
                    </select>

                    {/* ë‚´ë³´ë‚´ê¸° ë²„íŠ¼ */}
                    <button
                      onClick={() => handleRemoveMember(member)}
                      disabled={processing || member.userType === USER_TYPES.MANAGER}
                      className="px-4 py-2 bg-red-500/20 hover:bg-red-500/30 text-red-300 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
                    >
                      <UserMinus className="w-4 h-4" />
                      <span className="text-sm">ë‚´ë³´ë‚´ê¸°</span>
                    </button>
                  </div>
                )}
              </div>
            );
          })}
        </div>

        {/* ì•ˆë‚´ ë©”ì‹œì§€ */}
        <div className="mt-6 bg-blue-500/10 border border-blue-500/30 rounded-xl p-4">
          <div className="flex items-start gap-3">
            <Shield className="w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5" />
            <div className="text-sm text-blue-300">
              <p className="font-medium mb-2">ê¶Œí•œ ê´€ë¦¬ ì•ˆë‚´</p>
              <ul className="space-y-1 text-blue-200/80">
                <li>â€¢ ë§¤ë‹ˆì €ë§Œ ë©¤ë²„ì˜ ê¶Œí•œì„ ë³€ê²½í•˜ê±°ë‚˜ ë‚´ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                <li>â€¢ ë§¤ë‹ˆì €ëŠ” ê¶Œí•œ ë³€ê²½ ë“œë¡­ë‹¤ìš´ì— í‘œì‹œë˜ì§€ ì•Šìœ¼ë©°, ë‚´ë³´ë‚¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</li>
                <li>â€¢ ë³¸ì¸ì˜ ê¶Œí•œì€ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</li>
                <li>â€¢ ë©¤ë²„ë¥¼ ë‚´ë³´ë‚´ë©´ ì–‘ë°©í–¥ìœ¼ë¡œ ì‚­ì œë˜ì–´ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      {/* ë¡œë”© ì˜¤ë²„ë ˆì´ */}
      {processing && (
        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
          <div className="bg-slate-800 rounded-xl p-6 shadow-2xl">
            <div className="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <p className="text-white text-center">ì²˜ë¦¬ ì¤‘...</p>
          </div>
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/pages/PrivacyPolicyPage.jsx">
import React from 'react';
import { useNavigate } from 'react-router-dom';
import { ArrowLeft } from 'lucide-react';

const PrivacyPolicyPage = () => {
  const navigate = useNavigate();

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900">
      {/* í—¤ë” */}
      <div className="sticky top-0 z-10 bg-slate-900/80 backdrop-blur-lg border-b border-white/10">
        <div className="max-w-4xl mx-auto px-4 py-4 flex items-center gap-4">
          <button
            onClick={() => navigate(-1)}
            className="p-2 hover:bg-white/10 rounded-lg transition-colors"
          >
            <ArrowLeft className="w-5 h-5 text-white" />
          </button>
          <h1 className="text-xl font-bold text-white">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</h1>
        </div>
      </div>

      {/* ë³¸ë¬¸ */}
      <div className="max-w-4xl mx-auto px-4 py-8">
        <div className="bg-white/10 backdrop-blur-lg rounded-xl border border-white/20 shadow-2xl p-6 md:p-8">
          <div className="space-y-8 text-white">
            {/* ì„œë¬¸ */}
            <section className="space-y-4">
              <p className="text-gray-300 leading-relaxed">
                ì œì´ì—ì´ì¹˜308(ì´í•˜ "íšŒì‚¬"ë¼ í•¨)ëŠ” ã€ê°œì¸ì •ë³´ ë³´í˜¸ë²•ã€ì˜ ê°œì¸ì •ë³´ ë³´í˜¸ ê·œì •ì„ ì¤€ìˆ˜í•˜ê³  ìˆìŠµë‹ˆë‹¤. 
                ë³¸ ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ì„ í†µí•˜ì—¬ íšŒì‚¬ê°€ ì´ìš©ìë¡œë¶€í„° ì œê³µë°›ì€ ê°œì¸ì •ë³´ë¥¼ ì–´ë– í•œ ìš©ë„ì™€ ë°©ì‹ìœ¼ë¡œ ì´ìš©í•˜ê³  ìˆìœ¼ë©°, 
                ê°œì¸ì •ë³´ ë³´í˜¸ë¥¼ ìœ„í•´ ì–´ë– í•œ ì¡°ì¹˜ë¥¼ ì·¨í•˜ê³  ìˆëŠ”ì§€ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤.
              </p>
              <p className="text-gray-300 leading-relaxed">
                ë³¸ ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ì€ íšŒì‚¬ê°€ ìš´ì˜í•˜ëŠ” ê²Œí•˜(ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤) ì˜ˆì•½ ì„œë¹„ìŠ¤ì— ì ìš©ë©ë‹ˆë‹¤.
              </p>
            </section>

            {/* ì œ1ì¡° */}
            <section className="space-y-4">
              <h2 className="text-2xl font-bold text-white border-b border-white/20 pb-3">
                ì œ1ì¡° (ê°œì¸ì •ë³´ì˜ ì²˜ë¦¬ ëª©ì , í•­ëª© ë° ë³´ìœ ã†ì´ìš©ê¸°ê°„)
              </h2>
              <p className="text-gray-300 leading-relaxed">
                íšŒì‚¬ëŠ” ì•„ë˜ì™€ ê°™ì€ ëª©ì ìœ¼ë¡œ ì´ìš©ìê°€ ì§ì ‘ ì œê³µí•˜ëŠ” ìµœì†Œí•œì˜ ê°œì¸ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ê³  ìˆìœ¼ë©°, 
                ì‚¬ì „ì— ì´ë¥¼ ì•Œë¦¬ê³  ë™ì˜ë¥¼ êµ¬í•˜ê³  ìˆìŠµë‹ˆë‹¤.
              </p>
              
              <div className="bg-white/5 rounded-lg p-4 overflow-x-auto">
                <table className="min-w-full text-sm">
                  <thead>
                    <tr className="border-b border-white/20">
                      <th className="text-left py-3 px-2 text-white font-semibold">ìˆ˜ì§‘ ë° ì´ìš© ëª©ì </th>
                      <th className="text-left py-3 px-2 text-white font-semibold">ìˆ˜ì§‘ ë° ì´ìš© í•­ëª©</th>
                      <th className="text-left py-3 px-2 text-white font-semibold">ìˆ˜ì§‘ ì¡°ê±´</th>
                      <th className="text-left py-3 px-2 text-white font-semibold">ë³´ìœ ã†ì´ìš©ê¸°ê°„</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr className="border-b border-white/10">
                      <td className="py-3 px-2 text-gray-300 align-top">
                        íšŒì›ê°€ì… ë° ë³¸ì¸í™•ì¸
                      </td>
                      <td className="py-3 px-2 text-gray-300 align-top">
                        <div className="space-y-1">
                          <div>â€¢ ì´ë¦„ (í•„ìˆ˜)</div>
                          <div>â€¢ ì„±ë³„ (í•„ìˆ˜)</div>
                          <div>â€¢ ì¶œìƒì—°ë„ (í•„ìˆ˜)</div>
                          <div>â€¢ ì¹´ì¹´ì˜¤ê³„ì •(ì „í™”ë²ˆí˜¸) (í•„ìˆ˜)</div>
                        </div>
                      </td>
                      <td className="py-3 px-2 text-gray-300 align-top">
                        í•„ìˆ˜
                      </td>
                      <td className="py-3 px-2 text-gray-300 align-top">
                        íšŒì› íƒˆí‡´ ì‹œê¹Œì§€
                      </td>
                    </tr>
                    <tr className="border-b border-white/10">
                      <td className="py-3 px-2 text-gray-300 align-top">
                        ì„œë¹„ìŠ¤ ì´ìš© ì‹ë³„
                      </td>
                      <td className="py-3 px-2 text-gray-300 align-top">
                        <div className="space-y-1">
                          <div>â€¢ ì¹´ì¹´ì˜¤ ê³„ì • ì •ë³´ (ì´ë©”ì¼, ì´ë¦„) (í•„ìˆ˜)</div>
                          <div>â€¢ í”„ë¡œí•„ ì´ë¯¸ì§€ (ì„ íƒ)</div>
                          <div>â€¢ ì¹´ì¹´ì˜¤ ê³ ìœ  ID (í•„ìˆ˜)</div>
                        </div>
                      </td>
                      <td className="py-3 px-2 text-gray-300 align-top">
                        í•„ìˆ˜/ì„ íƒ
                      </td>
                      <td className="py-3 px-2 text-gray-300 align-top">
                        íšŒì› íƒˆí‡´ ì‹œê¹Œì§€
                      </td>
                    </tr>
                    <tr className="border-b border-white/10">
                      <td className="py-3 px-2 text-gray-300 align-top">
                        ì˜ˆì•½ ê´€ë¦¬ ë° ì„œë¹„ìŠ¤ ì œê³µ
                      </td>
                      <td className="py-3 px-2 text-gray-300 align-top">
                        <div className="space-y-1">
                          <div>â€¢ ì´ë¦„ (í•„ìˆ˜)</div>
                          <div>â€¢ íœ´ëŒ€í° ë²ˆí˜¸ (í•„ìˆ˜)</div>
                          <div>â€¢ ì„±ë³„ (í•„ìˆ˜)</div>
                          <div>â€¢ ì¶œìƒì—°ë„ (í•„ìˆ˜)</div>
                          <div>â€¢ ì²´í¬ì¸/ì²´í¬ì•„ì›ƒ ì¼ì (í•„ìˆ˜)</div>
                          <div>â€¢ ì˜ˆì•½ ë©”ëª¨ (ì„ íƒ)</div>
                        </div>
                      </td>
                      <td className="py-3 px-2 text-gray-300 align-top">
                        í•„ìˆ˜/ì„ íƒ
                      </td>
                      <td className="py-3 px-2 text-gray-300 align-top">
                        ì˜ˆì•½ ì¢…ë£Œ í›„ 3ê°œì›”
                      </td>
                    </tr>
                    <tr>
                      <td className="py-3 px-2 text-gray-300 align-top">
                        ì•Œë¦¼ ì„œë¹„ìŠ¤ ì œê³µ
                      </td>
                      <td className="py-3 px-2 text-gray-300 align-top">
                        <div className="space-y-1">
                          <div>â€¢ íœ´ëŒ€í° ë²ˆí˜¸ (ì•Œë¦¼í†¡/SMS) (í•„ìˆ˜)</div>
                          <div>â€¢ ì´ë©”ì¼ ì£¼ì†Œ (í•„ìˆ˜)</div>
                        </div>
                      </td>
                      <td className="py-3 px-2 text-gray-300 align-top">
                        í•„ìˆ˜
                      </td>
                      <td className="py-3 px-2 text-gray-300 align-top">
                        íšŒì› íƒˆí‡´ ì‹œê¹Œì§€
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div className="space-y-2 text-gray-300">
                <p>íšŒì‚¬ëŠ” ì´ìš©ìì˜ ê¸°ë³¸ì  ì¸ê¶Œ ì¹¨í•´ì˜ ìš°ë ¤ê°€ ìˆëŠ” ë¯¼ê°í•œ ê°œì¸ì •ë³´(ì¸ì¢…, ì‚¬ìƒ, ì •ì¹˜ì  ì„±í–¥, ê±´ê°•, ì„±ìƒí™œ ë“±)ëŠ” ìˆ˜ì§‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                <p>íšŒì‚¬ëŠ” ì›ì¹™ì ìœ¼ë¡œ ë§Œ 14ì„¸ ë¯¸ë§Œ ì•„ë™ì˜ ê°œì¸ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
              </div>
            </section>

            {/* ì œ2ì¡° */}
            <section className="space-y-4">
              <h2 className="text-2xl font-bold text-white border-b border-white/20 pb-3">
                ì œ2ì¡° (ê°œì¸ì •ë³´ì˜ ì œ3ì ì œê³µ)
              </h2>
              <p className="text-gray-300 leading-relaxed">
                íšŒì‚¬ëŠ” ì›ì¹™ì ìœ¼ë¡œ ì´ìš©ìì˜ ê°œì¸ì •ë³´ë¥¼ ì œ3ìì—ê²Œ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ë§Œ, ì•„ë˜ì˜ ê²½ìš°ì—ëŠ” ì˜ˆì™¸ë¡œ í•©ë‹ˆë‹¤.
              </p>
              <ul className="list-disc pl-6 text-gray-300 space-y-2">
                <li>ì´ìš©ìê°€ ì‚¬ì „ì— ë™ì˜í•œ ê²½ìš°</li>
                <li>ë²•ë¥ ì— íŠ¹ë³„í•œ ê·œì •ì´ ìˆê±°ë‚˜ ë²•ë ¹ìƒ ì˜ë¬´ë¥¼ ì¤€ìˆ˜í•˜ê¸° ìœ„í•˜ì—¬ ë¶ˆê°€í”¼í•œ ê²½ìš°</li>
                <li>ì •ë³´ì£¼ì²´ ë˜ëŠ” ê·¸ ë²•ì •ëŒ€ë¦¬ì¸ì´ ì˜ì‚¬í‘œì‹œë¥¼ í•  ìˆ˜ ì—†ëŠ” ìƒíƒœì— ìˆê±°ë‚˜ ì£¼ì†Œë¶ˆëª… ë“±ìœ¼ë¡œ ì‚¬ì „ ë™ì˜ë¥¼ ë°›ì„ ìˆ˜ ì—†ëŠ” ê²½ìš°ë¡œì„œ ëª…ë°±íˆ ì •ë³´ì£¼ì²´ ë˜ëŠ” ì œ3ìì˜ ê¸‰ë°•í•œ ìƒëª…, ì‹ ì²´, ì¬ì‚°ì˜ ì´ìµì„ ìœ„í•˜ì—¬ í•„ìš”í•˜ë‹¤ê³  ì¸ì •ë˜ëŠ” ê²½ìš°</li>
              </ul>

              <div className="bg-white/5 rounded-lg p-4 mt-4">
                <h3 className="text-lg font-semibold text-white mb-3">ì™¸ë¶€ ì„œë¹„ìŠ¤ ì œê³µì</h3>
                <div className="space-y-3 text-sm">
                  <div>
                    <div className="font-semibold text-white">ì¹´ì¹´ì˜¤ (Kakao)</div>
                    <div className="text-gray-400">ì œê³µ ëª©ì : ì†Œì…œ ë¡œê·¸ì¸ ì¸ì¦</div>
                    <div className="text-gray-400">ì œê³µ í•­ëª©: ì¹´ì¹´ì˜¤ ê³„ì • ì •ë³´</div>
                  </div>
                  <div>
                    <div className="font-semibold text-white">ì†”ë¼í”¼ (Solapi)</div>
                    <div className="text-gray-400">ì œê³µ ëª©ì : ì•Œë¦¼í†¡/SMS ë°œì†¡</div>
                    <div className="text-gray-400">ì œê³µ í•­ëª©: íœ´ëŒ€í° ë²ˆí˜¸, ì˜ˆì•½ ì •ë³´</div>
                  </div>
                  <div>
                    <div className="font-semibold text-white">Firebase (Google)</div>
                    <div className="text-gray-400">ì œê³µ ëª©ì : ë°ì´í„° ì €ì¥ ë° ê´€ë¦¬</div>
                    <div className="text-gray-400">ì œê³µ í•­ëª©: íšŒì› ì •ë³´, ì˜ˆì•½ ì •ë³´</div>
                  </div>
                </div>
              </div>
            </section>

            {/* ì œ3ì¡° */}
            <section className="space-y-4">
              <h2 className="text-2xl font-bold text-white border-b border-white/20 pb-3">
                ì œ3ì¡° (ê°œì¸ì •ë³´ì˜ íŒŒê¸°)
              </h2>
              <p className="text-gray-300 leading-relaxed">
                íšŒì‚¬ëŠ” ê°œì¸ì •ë³´ ë³´ìœ ê¸°ê°„ì˜ ê²½ê³¼, ì²˜ë¦¬ëª©ì  ë‹¬ì„± ë“± ê°œì¸ì •ë³´ê°€ ë¶ˆí•„ìš”í•˜ê²Œ ë˜ì—ˆì„ ë•Œì—ëŠ” 
                ì§€ì²´ì—†ì´ í•´ë‹¹ ê°œì¸ì •ë³´ë¥¼ íŒŒê¸°í•©ë‹ˆë‹¤.
              </p>
              
              <div className="space-y-4">
                <div>
                  <h3 className="text-xl font-semibold text-white mb-2">íŒŒê¸° ì ˆì°¨</h3>
                  <p className="text-gray-300">
                    ì´ìš©ìê°€ ì œê³µí•œ ì •ë³´ëŠ” ëª©ì  ë‹¬ì„± í›„ ë³„ë„ì˜ DBì— ì˜®ê²¨ì ¸ ë‚´ë¶€ ë°©ì¹¨ ë° ê¸°íƒ€ ê´€ë ¨ ë²•ë ¹ì— ë”°ë¼ 
                    ì¼ì •ê¸°ê°„ ì €ì¥ëœ í›„ íŒŒê¸°ë©ë‹ˆë‹¤. ë³„ë„ DBë¡œ ì˜®ê²¨ì§„ ê°œì¸ì •ë³´ëŠ” ë²•ë¥ ì— ì˜í•œ ê²½ìš°ê°€ ì•„ë‹ˆê³ ì„œëŠ” 
                    ë‹¤ë¥¸ ëª©ì ìœ¼ë¡œ ì´ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                  </p>
                </div>

                <div>
                  <h3 className="text-xl font-semibold text-white mb-2">íŒŒê¸° ë°©ë²•</h3>
                  <ul className="list-disc pl-6 text-gray-300 space-y-1">
                    <li>ì „ìì  íŒŒì¼ í˜•íƒœ: ë³µêµ¬ ë° ì¬ìƒì´ ë¶ˆê°€ëŠ¥í•œ ê¸°ìˆ ì  ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ ì‚­ì œ</li>
                    <li>ì¢…ì´ ë¬¸ì„œ: ë¶„ì‡„ê¸°ë¡œ ë¶„ì‡„í•˜ê±°ë‚˜ ì†Œê°</li>
                  </ul>
                </div>
              </div>
            </section>

            {/* ì œ4ì¡° */}
            <section className="space-y-4">
              <h2 className="text-2xl font-bold text-white border-b border-white/20 pb-3">
                ì œ4ì¡° (ì •ë³´ì£¼ì²´ì˜ ê¶Œë¦¬Â·ì˜ë¬´ ë° í–‰ì‚¬ë°©ë²•)
              </h2>
              
              <div className="space-y-4">
                <div>
                  <h3 className="text-xl font-semibold text-white mb-2">í–‰ì‚¬ ê°€ëŠ¥í•œ ê¶Œë¦¬</h3>
                  <p className="text-gray-300 mb-2">
                    ì´ìš©ìëŠ” íšŒì‚¬ì— ëŒ€í•´ ì–¸ì œë“ ì§€ ë‹¤ìŒ ê° í˜¸ì˜ ê°œì¸ì •ë³´ ë³´í˜¸ ê´€ë ¨ ê¶Œë¦¬ë¥¼ í–‰ì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
                  </p>
                  <ul className="list-disc pl-6 text-gray-300 space-y-1">
                    <li>ê°œì¸ì •ë³´ ì—´ëŒ ìš”êµ¬</li>
                    <li>ì˜¤ë¥˜ ë“±ì´ ìˆì„ ê²½ìš° ì •ì • ìš”êµ¬</li>
                    <li>ì‚­ì œ ìš”êµ¬</li>
                    <li>ì²˜ë¦¬ì •ì§€ ìš”êµ¬</li>
                  </ul>
                </div>

                <div>
                  <h3 className="text-xl font-semibold text-white mb-2">ê¶Œë¦¬ í–‰ì‚¬ ë°©ë²•</h3>
                  <div className="bg-white/5 rounded-lg p-4">
                    <ul className="text-gray-300 space-y-1 text-sm">
                      <li>â€¢ ì„œë¹„ìŠ¤ ë‚´ ì„¤ì • ë©”ë‰´</li>
                      <li>â€¢ ê°œì¸ì •ë³´ ë³´í˜¸ì±…ì„ìì—ê²Œ ì§ì ‘ ì—°ë½</li>
                    </ul>
                  </div>
                </div>

                <p className="text-gray-300 text-sm">
                  íšŒì‚¬ëŠ” ì´ìš©ìì˜ ìš”êµ¬ì‚¬í•­ì— ëŒ€í•´ ì§€ì²´ ì—†ì´ ì²˜ë¦¬í•˜ë©°, 
                  ì´ìš©ìê°€ ê°œì¸ì •ë³´ì˜ ì˜¤ë¥˜ì— ëŒ€í•œ ì •ì •ì„ ìš”ì²­í•˜ì‹  ê²½ìš° ì •ì •ì„ ì™„ë£Œí•˜ê¸° ì „ê¹Œì§€ 
                  ë‹¹í•´ ê°œì¸ì •ë³´ë¥¼ ì´ìš© ë˜ëŠ” ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                </p>
              </div>
            </section>

            {/* ì œ5ì¡° */}
            <section className="space-y-4">
              <h2 className="text-2xl font-bold text-white border-b border-white/20 pb-3">
                ì œ5ì¡° (ê°œì¸ì •ë³´ ë³´í˜¸ì±…ì„ì)
              </h2>
              <p className="text-gray-300 leading-relaxed mb-4">
                íšŒì‚¬ëŠ” ê°œì¸ì •ë³´ ì²˜ë¦¬ì— ê´€í•œ ì—…ë¬´ë¥¼ ì´ê´„í•´ì„œ ì±…ì„ì§€ê³ , 
                ê°œì¸ì •ë³´ ì²˜ë¦¬ì™€ ê´€ë ¨í•œ ì •ë³´ì£¼ì²´ì˜ ë¶ˆë§Œì²˜ë¦¬ ë° í”¼í•´êµ¬ì œ ë“±ì„ ìœ„í•˜ì—¬ 
                ì•„ë˜ì™€ ê°™ì´ ê°œì¸ì •ë³´ ë³´í˜¸ì±…ì„ìë¥¼ ì§€ì •í•˜ê³  ìˆìŠµë‹ˆë‹¤.
              </p>
              
              <div className="bg-gradient-to-br from-blue-500/20 to-purple-500/20 rounded-lg p-6 border border-white/20">
                <h3 className="font-bold text-xl text-white mb-4">ê°œì¸ì •ë³´ ë³´í˜¸ì±…ì„ì</h3>
                <div className="space-y-2 text-gray-300">
                  <p><span className="font-semibold text-white">ì„±ëª…:</span> ì–‘ì„í™˜</p>
                  <p><span className="font-semibold text-white">ì´ë©”ì¼:</span> reshw@naver.com</p>
                  <p><span className="font-semibold text-white">ì†Œì†:</span> ì œì´ì—ì´ì¹˜308</p>
                </div>
              </div>

              <p className="text-gray-300 text-sm mt-4">
                ì´ìš©ìëŠ” íšŒì‚¬ì˜ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì‹œë©´ì„œ ë°œìƒí•œ ëª¨ë“  ê°œì¸ì •ë³´ ë³´í˜¸ ê´€ë ¨ ë¬¸ì˜, ë¶ˆë§Œì²˜ë¦¬, 
                í”¼í•´êµ¬ì œ ë“±ì— ê´€í•œ ì‚¬í•­ì„ ê°œì¸ì •ë³´ ë³´í˜¸ì±…ì„ìì—ê²Œ ë¬¸ì˜í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
                íšŒì‚¬ëŠ” ì´ìš©ìì˜ ë¬¸ì˜ì— ëŒ€í•´ ì§€ì²´ ì—†ì´ ë‹µë³€ ë° ì²˜ë¦¬í•´ë“œë¦´ ê²ƒì…ë‹ˆë‹¤.
              </p>
            </section>

            {/* ì œ6ì¡° */}
            <section className="space-y-4">
              <h2 className="text-2xl font-bold text-white border-b border-white/20 pb-3">
                ì œ6ì¡° (ê°œì¸ì •ë³´ ìë™ìˆ˜ì§‘ ì¥ì¹˜ì˜ ì„¤ì¹˜âˆ™ìš´ì˜ ë° ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™)
              </h2>
              
              <div className="space-y-4">
                <div>
                  <h3 className="text-xl font-semibold text-white mb-2">ì¿ í‚¤(Cookie) ì‚¬ìš©</h3>
                  <p className="text-gray-300 mb-2">
                    íšŒì‚¬ëŠ” ì´ìš©ìì—ê²Œ ê°œë³„ì ì¸ ë§ì¶¤ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ê¸° ìœ„í•´ ì´ìš©ì •ë³´ë¥¼ ì €ì¥í•˜ê³  
                    ìˆ˜ì‹œë¡œ ë¶ˆëŸ¬ì˜¤ëŠ” 'ì¿ í‚¤(cookie)'ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                  </p>
                  <ul className="list-disc pl-6 text-gray-300 space-y-1 text-sm">
                    <li>ì¿ í‚¤ì˜ ì‚¬ìš© ëª©ì : ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€, ì„œë¹„ìŠ¤ ì´ìš© í¸ì˜ì„± ì œê³µ</li>
                    <li>ì¿ í‚¤ì˜ ì„¤ì¹˜/ìš´ì˜ ë° ê±°ë¶€: ì›¹ë¸Œë¼ìš°ì € ìƒë‹¨ì˜ ë„êµ¬ &gt; ì¸í„°ë„· ì˜µì…˜ &gt; ê°œì¸ì •ë³´ ë©”ë‰´ì—ì„œ ì„¤ì • ê°€ëŠ¥</li>
                    <li>ì¿ í‚¤ ì €ì¥ì„ ê±°ë¶€í•  ê²½ìš° ì¼ë¶€ ì„œë¹„ìŠ¤ ì´ìš©ì— ì–´ë ¤ì›€ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                  </ul>
                </div>

                <div>
                  <h3 className="text-xl font-semibold text-white mb-2">ì†Œì…œ ë¡œê·¸ì¸ ì„œë¹„ìŠ¤</h3>
                  <p className="text-gray-300 mb-2">
                    íšŒì‚¬ëŠ” ì¹´ì¹´ì˜¤ ì†Œì…œ ë¡œê·¸ì¸ ì„œë¹„ìŠ¤ë¥¼ í†µí•´ ì´ìš©ì ì¸ì¦ì„ ì§„í–‰í•©ë‹ˆë‹¤.
                  </p>
                  <div className="bg-white/5 rounded-lg p-4 text-sm">
                    <ul className="space-y-2 text-gray-300">
                      <li>â€¢ ì†Œì…œ ë¡œê·¸ì¸ ì‹œ ìˆ˜ì§‘ë˜ëŠ” ì •ë³´: ì´ë¦„, ì´ë©”ì¼ ì£¼ì†Œ, í”„ë¡œí•„ ì´ë¯¸ì§€, ì¹´ì¹´ì˜¤ ê³„ì • ê³ ìœ  ID</li>
                      <li>â€¢ í•´ë‹¹ ì •ë³´ëŠ” ì´ìš©ì ì‹ë³„ ë° ì„œë¹„ìŠ¤ ì´ìš©ì„ ìœ„í•´ì„œë§Œ í™œìš©ë˜ë©°, ë³„ë„ì˜ ë§ˆì¼€íŒ… ëª©ì ìœ¼ë¡œ ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
                      <li>â€¢ ì†Œì…œ ê³„ì • ì—°ë™ í•´ì œëŠ” ì¹´ì¹´ì˜¤ ê³„ì • ê´€ë¦¬ í˜ì´ì§€ì—ì„œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
                    </ul>
                  </div>
                </div>

                <div>
                  <h3 className="text-xl font-semibold text-white mb-2">Firebase ì„œë¹„ìŠ¤ ì´ìš©</h3>
                  <p className="text-gray-300 text-sm">
                    íšŒì‚¬ëŠ” Googleì˜ Firebase ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤. 
                    FirebaseëŠ” Googleì˜ ê°œì¸ì •ë³´ ë³´í˜¸ì •ì±…ì„ ë”°ë¥´ë©°, ìƒì„¸í•œ ë‚´ìš©ì€ 
                    <a 
                      href="https://policies.google.com/privacy" 
                      target="_blank" 
                      rel="noopener noreferrer"
                      className="text-blue-400 hover:text-blue-300 underline ml-1"
                    >
                      Google ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨
                    </a>
                    ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                  </p>
                </div>
              </div>
            </section>

            {/* ì œ7ì¡° */}
            <section className="space-y-4">
              <h2 className="text-2xl font-bold text-white border-b border-white/20 pb-3">
                ì œ7ì¡° (ê°œì¸ì •ë³´ì˜ ì•ˆì „ì„± í™•ë³´ì¡°ì¹˜)
              </h2>
              <p className="text-gray-300 leading-relaxed mb-3">
                íšŒì‚¬ëŠ” ê°œì¸ì •ë³´ì˜ ì•ˆì „ì„± í™•ë³´ë¥¼ ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ì¡°ì¹˜ë¥¼ ì·¨í•˜ê³  ìˆìŠµë‹ˆë‹¤:
              </p>
              <ul className="list-disc pl-6 text-gray-300 space-y-2">
                <li>ê°œì¸ì •ë³´ ì·¨ê¸‰ ì§ì›ì˜ ìµœì†Œí™” ë° êµìœ¡</li>
                <li>ê°œì¸ì •ë³´ì— ëŒ€í•œ ì ‘ê·¼ ì œí•œ (ë¹„ë°€ë²ˆí˜¸ ì„¤ì • ë° ì•”í˜¸í™”)</li>
                <li>í•´í‚¹ì´ë‚˜ ì»´í“¨í„° ë°”ì´ëŸ¬ìŠ¤ ë“±ì— ì˜í•œ ê°œì¸ì •ë³´ ìœ ì¶œ ë° í›¼ì†ì„ ë§‰ê¸° ìœ„í•œ ë³´ì•ˆ í”„ë¡œê·¸ë¨ ì„¤ì¹˜ ë° ì£¼ê¸°ì  ê°±ì‹ ãƒ»ì ê²€</li>
                <li>ì•”í˜¸í™” í†µì‹  ë“±ì„ í†µí•œ ë„¤íŠ¸ì›Œí¬ìƒì—ì„œ ê°œì¸ì •ë³´ ì•ˆì „ ì „ì†¡</li>
                <li>ê°œì¸ì •ë³´ì— ëŒ€í•œ ì ‘ê·¼ê¸°ë¡ ë³´ê´€ ë° ìœ„ë³€ì¡° ë°©ì§€</li>
                <li>ë°±ì—… ë° ë³µêµ¬ ì‹œìŠ¤í…œ êµ¬ì¶•</li>
              </ul>
            </section>

            {/* ì œ8ì¡° */}
            <section className="space-y-4">
              <h2 className="text-2xl font-bold text-white border-b border-white/20 pb-3">
                ì œ8ì¡° (ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ì˜ ë³€ê²½)
              </h2>
              <p className="text-gray-300 leading-relaxed">
                ë³¸ ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ì€ ì‹œí–‰ì¼ë¡œë¶€í„° ì ìš©ë˜ë©°, ë²•ë ¹ ë° ë°©ì¹¨ì— ë”°ë¥¸ ë³€ê²½ë‚´ìš©ì˜ ì¶”ê°€, 
                ì‚­ì œ ë° ì •ì •ì´ ìˆëŠ” ê²½ìš°ì—ëŠ” ë³€ê²½ì‚¬í•­ì˜ ì‹œí–‰ 7ì¼ ì „ë¶€í„° ê³µì§€ì‚¬í•­ì„ í†µí•˜ì—¬ ê³ ì§€í•  ê²ƒì…ë‹ˆë‹¤. 
                ë‹¤ë§Œ, ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘ ë° í™œìš©, ì œ3ì ì œê³µ ë“±ê³¼ ê°™ì´ ì´ìš©ì ê¶Œë¦¬ì˜ ì¤‘ìš”í•œ ë³€ê²½ì´ ìˆì„ ê²½ìš°ì—ëŠ” 
                ìµœì†Œ 30ì¼ ì „ì— ê³ ì§€í•©ë‹ˆë‹¤.
              </p>
              
              <div className="bg-gradient-to-r from-blue-500/20 to-purple-500/20 rounded-lg p-6 border border-white/20 mt-4">
                <div className="space-y-2 text-gray-300">
                  <p><span className="font-semibold text-white">ê³µê³ ì¼ì:</span> 2024ë…„ 12ì›” 18ì¼</p>
                  <p><span className="font-semibold text-white">ì‹œí–‰ì¼ì:</span> 2024ë…„ 12ì›” 25ì¼</p>
                  <p className="text-sm pt-2 border-t border-white/20 mt-3">
                    ì´ì „ ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ì€ ì„œë¹„ìŠ¤ ë‚´ ê³µì§€ì‚¬í•­ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                  </p>
                </div>
              </div>
            </section>

            {/* ì¶”ê°€ ì •ë³´ */}
            <section className="space-y-4 pt-4 border-t border-white/20">
              <h2 className="text-2xl font-bold text-white">ê°œì¸ì •ë³´ ì¹¨í•´ ê´€ë ¨ ìƒë‹´ ë° ì‹ ê³ </h2>
              <p className="text-gray-300 text-sm leading-relaxed">
                ê°œì¸ì •ë³´ ì¹¨í•´ì— ëŒ€í•œ ì‹ ê³ ë‚˜ ìƒë‹´ì´ í•„ìš”í•˜ì‹  ê²½ìš° ì•„ë˜ ê¸°ê´€ì— ë¬¸ì˜í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤:
              </p>
              <div className="bg-white/5 rounded-lg p-4 space-y-3 text-sm">
                <div>
                  <div className="font-semibold text-white">ê°œì¸ì •ë³´ì¹¨í•´ì‹ ê³ ì„¼í„°</div>
                  <div className="text-gray-400">ì „í™”: (êµ­ë²ˆì—†ì´) 118</div>
                  <div className="text-gray-400">í™ˆí˜ì´ì§€: privacy.kisa.or.kr</div>
                </div>
                <div>
                  <div className="font-semibold text-white">ê°œì¸ì •ë³´ë¶„ìŸì¡°ì •ìœ„ì›íšŒ</div>
                  <div className="text-gray-400">ì „í™”: 1833-6972</div>
                  <div className="text-gray-400">í™ˆí˜ì´ì§€: www.kopico.go.kr</div>
                </div>
                <div>
                  <div className="font-semibold text-white">ëŒ€ê²€ì°°ì²­ ì‚¬ì´ë²„ë²”ì£„ìˆ˜ì‚¬ë‹¨</div>
                  <div className="text-gray-400">ì „í™”: (êµ­ë²ˆì—†ì´) 1301</div>
                  <div className="text-gray-400">í™ˆí˜ì´ì§€: www.spo.go.kr</div>
                </div>
                <div>
                  <div className="font-semibold text-white">ê²½ì°°ì²­ ì‚¬ì´ë²„ì•ˆì „êµ­</div>
                  <div className="text-gray-400">ì „í™”: (êµ­ë²ˆì—†ì´) 182</div>
                  <div className="text-gray-400">í™ˆí˜ì´ì§€: cyberbureau.police.go.kr</div>
                </div>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>
  );
};

export default PrivacyPolicyPage;
</file>

<file path="src/pages/SpaceSettingsPage.jsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import useStore from '../store/useStore';
import spaceSettingsService from '../services/spaceSettingsService';
import { canManageSpace } from '../utils/permissions';
import { ArrowLeft, Save, AlertCircle } from 'lucide-react';
import EmailNotificationSettings from '../components/settings/EmailNotificationSettings';

export default function SpaceSettingsPage() {
  const navigate = useNavigate();
  const { user, selectedSpace, setSelectedSpace } = useStore();
  const [spaceName, setSpaceName] = useState('');
  const [originalName, setOriginalName] = useState('');
  const [emailSettings, setEmailSettings] = useState(null);
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);
  const [hasChanges, setHasChanges] = useState(false);

  // ê¶Œí•œ ì²´í¬ ë° ì´ˆê¸° ë°ì´í„° ë¡œë“œ
  useEffect(() => {
    if (!user || !selectedSpace) {
      alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
      navigate('/');
      return;
    }

    const spaceId = selectedSpace.id || selectedSpace.spaceId;
    const userSpaceData = user.spaceAccess?.find(s => s.spaceId === spaceId);
    
    if (!userSpaceData || !canManageSpace(userSpaceData.userType)) {
      alert('ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
      navigate('/');
      return;
    }

    loadSettings();
  }, [user, selectedSpace, navigate]);

  // ë³€ê²½ì‚¬í•­ ê°ì§€
  useEffect(() => {
    setHasChanges(spaceName !== originalName && spaceName.trim() !== '');
  }, [spaceName, originalName]);

  const loadSettings = async () => {
    try {
      setLoading(true);
      const spaceId = selectedSpace.id || selectedSpace.spaceId;

      // ìŠ¤í˜ì´ìŠ¤ ê¸°ë³¸ ì„¤ì •
      const settings = await spaceSettingsService.getSpaceSettings(spaceId);
      const currentName = settings.name || selectedSpace.spaceName || '';
      setSpaceName(currentName);
      setOriginalName(currentName);

      // ì´ë©”ì¼ ì•Œë¦¼ ì„¤ì •
      const emailSettingsData = await spaceSettingsService.getEmailSettings(spaceId);
      setEmailSettings(emailSettingsData);
    } catch (error) {
      console.error('ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
      alert('ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setLoading(false);
    }
  };

  // ì´ë©”ì¼ ì„¤ì • ì €ì¥ í•¸ë“¤ëŸ¬
  const handleEmailSettingsSave = async (newSettings) => {
    const spaceId = selectedSpace.id || selectedSpace.spaceId;
    await spaceSettingsService.updateEmailSettings(spaceId, newSettings, user.id);
    setEmailSettings(newSettings);
  };

  const handleSave = async () => {
    if (!hasChanges) return;

    const trimmedName = spaceName.trim();
    if (trimmedName.length === 0) {
      alert('ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    if (trimmedName.length > 50) {
      alert('ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ì€ 50ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    const confirmed = window.confirm(
      `ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ì„ "${trimmedName}"(ìœ¼)ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nëª¨ë“  ë©¤ë²„ì—ê²Œ ë³€ê²½ëœ ì´ë¦„ì´ í‘œì‹œë©ë‹ˆë‹¤.`
    );

    if (!confirmed) return;

    try {
      setSaving(true);
      const spaceId = selectedSpace.id || selectedSpace.spaceId;
      
      await spaceSettingsService.updateSpaceName(spaceId, trimmedName, user.id);

      // Zustand ìŠ¤í† ì–´ì˜ selectedSpace ì—…ë°ì´íŠ¸
      setSelectedSpace({
        ...selectedSpace,
        spaceName: trimmedName,
        name: trimmedName
      });

      setOriginalName(trimmedName);
      setSpaceName(trimmedName);
      
      alert('ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
    } catch (error) {
      console.error('ì €ì¥ ì‹¤íŒ¨:', error);
      alert('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
      setSaving(false);
    }
  };

  const handleCancel = () => {
    if (hasChanges) {
      const confirmed = window.confirm('ë³€ê²½ì‚¬í•­ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
      if (!confirmed) return;
    }
    navigate('/space/manage');
  };

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900">
        <div className="text-center">
          <div className="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-slate-300">ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 pb-20">
      {/* í—¤ë” */}
      <div className="bg-gradient-to-r from-slate-800 to-slate-700 border-b border-slate-600/30 sticky top-0 z-10 shadow-lg">
        <div className="max-w-2xl mx-auto px-4 py-4">
          <div className="flex items-center gap-3">
            <button
              onClick={handleCancel}
              className="p-2 hover:bg-white/10 rounded-lg transition-colors"
            >
              <ArrowLeft className="w-5 h-5 text-white" />
            </button>
            <div>
              <h1 className="text-xl font-bold text-white">ìŠ¤í˜ì´ìŠ¤ ì„¤ì •</h1>
              <p className="text-sm text-slate-300">ê¸°ë³¸ ì •ë³´ ê´€ë¦¬</p>
            </div>
          </div>
        </div>
      </div>

      {/* ì„¤ì • í¼ */}
      <div className="max-w-2xl mx-auto px-4 py-6">
        <div className="bg-gradient-to-br from-slate-800/80 to-slate-700/50 backdrop-blur-sm border border-slate-600/30 rounded-xl p-6 shadow-lg">
          <div className="space-y-6">
            {/* ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ */}
            <div>
              <label className="block text-sm font-medium text-slate-300 mb-2">
                ìŠ¤í˜ì´ìŠ¤ ì´ë¦„
              </label>
              <input
                type="text"
                value={spaceName}
                onChange={(e) => setSpaceName(e.target.value)}
                placeholder="ì˜ˆ: ì¡°ê°•308í˜¸"
                maxLength={50}
                disabled={saving}
                className="w-full px-4 py-3 bg-slate-700/50 border border-slate-600/30 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500/50 disabled:opacity-50"
              />
              <p className="mt-2 text-xs text-slate-400">
                {spaceName.length}/50ì â€¢ ëª¨ë“  ë©¤ë²„ì—ê²Œ í‘œì‹œë˜ëŠ” ì´ë¦„ì…ë‹ˆë‹¤
              </p>
            </div>

            {/* ë³€ê²½ì‚¬í•­ ì•ˆë‚´ */}
            {hasChanges && (
              <div className="bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4">
                <div className="flex items-start gap-3">
                  <AlertCircle className="w-5 h-5 text-yellow-400 flex-shrink-0 mt-0.5" />
                  <div className="text-sm text-yellow-300">
                    <p className="font-medium mb-1">ë³€ê²½ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤</p>
                    <p className="text-yellow-200/80">
                      ì €ì¥í•˜ì§€ ì•Šìœ¼ë©´ ë³€ê²½ì‚¬í•­ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤.
                    </p>
                  </div>
                </div>
              </div>
            )}

            {/* ì €ì¥ ë²„íŠ¼ */}
            <div className="flex gap-3">
              <button
                onClick={handleCancel}
                disabled={saving}
                className="flex-1 px-4 py-3 bg-slate-600/50 hover:bg-slate-600/70 text-white rounded-lg font-medium transition-colors disabled:opacity-50"
              >
                ì·¨ì†Œ
              </button>
              <button
                onClick={handleSave}
                disabled={!hasChanges || saving}
                className="flex-1 px-4 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
              >
                {saving ? (
                  <>
                    <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                    <span>ì €ì¥ ì¤‘...</span>
                  </>
                ) : (
                  <>
                    <Save className="w-4 h-4" />
                    <span>ì €ì¥</span>
                  </>
                )}
              </button>
            </div>
          </div>
        </div>

        {/* ì´ë©”ì¼ ì•Œë¦¼ ì„¤ì • */}
        {emailSettings && (
          <div className="mt-6 bg-gradient-to-br from-slate-800/80 to-slate-700/50 backdrop-blur-sm border border-slate-600/30 rounded-xl p-6 shadow-lg">
            <EmailNotificationSettings
              spaceId={selectedSpace.id || selectedSpace.spaceId}
              settings={emailSettings}
              onSave={handleEmailSettingsSave}
            />
          </div>
        )}

        {/* ì•ˆë‚´ ë©”ì‹œì§€ */}
        <div className="mt-6 bg-blue-500/10 border border-blue-500/30 rounded-xl p-4">
          <div className="text-sm text-blue-300">
            <p className="font-medium mb-2">ğŸ’¡ ì„¤ì • ì•ˆë‚´</p>
            <ul className="space-y-1 text-blue-200/80">
              <li>â€¢ ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ì€ ì•± ìƒë‹¨ê³¼ ì˜ˆì•½ ëª©ë¡ì— í‘œì‹œë©ë‹ˆë‹¤.</li>
              <li>â€¢ ë³€ê²½ ì¦‰ì‹œ ëª¨ë“  ë©¤ë²„ì—ê²Œ ë°˜ì˜ë©ë‹ˆë‹¤.</li>
              <li>â€¢ 50ì ì´ë‚´ë¡œ ê°„ê²°í•˜ê²Œ ì‘ì„±í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.</li>
              <li>â€¢ ì´ë©”ì¼ ì•Œë¦¼ ì„¤ì •ì—ì„œ ê° ì•Œë¦¼ ìœ í˜•ë³„ë¡œ ìˆ˜ì‹ ìë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/TestDataPage.jsx">
// src/pages/TestDataPage.jsx
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { doc, setDoc, getDoc, Timestamp } from 'firebase/firestore';
import { db } from '../config/firebase';
import { getWeekId, getWeekRange } from '../services/settlementService';
import bartenderService from '../services/bartenderService';
import { ChevronLeft, TestTube, Coffee } from 'lucide-react';

const TestDataPage = () => {
  const navigate = useNavigate();
  const [loading, setLoading] = useState(false);
  const [message, setMessage] = useState('');

  // í…ŒìŠ¤íŠ¸ ë°ì´í„° ê¸°ë³¸ê°’
  const [spaceCode, setSpaceCode] = useState('37VXcw');
  const [itemName, setItemName] = useState('ì¹˜í‚¨');
  const [amount, setAmount] = useState(10000);
  const [paidBy, setPaidBy] = useState('3828221463');
  const [paidByName, setPaidByName] = useState('ë‚¸ì‚¬ëŒ');
  const [splitAmong, setSplitAmong] = useState('3848191355');
  const [memo, setMemo] = useState('í…ŒìŠ¤íŠ¸ ë°ì´í„°');

  // ì£¼ì°¨ ì„ íƒ
  const [targetDate, setTargetDate] = useState('');
  const [weekInfo, setWeekInfo] = useState(null);

  // ì˜¤ëŠ˜ ë‚ ì§œì˜ ì§€ë‚œ ì£¼ ê³„ì‚°
  useEffect(() => {
    const today = new Date();
    const lastWeek = new Date(today);
    lastWeek.setDate(lastWeek.getDate() - 7);

    const year = lastWeek.getFullYear();
    const month = String(lastWeek.getMonth() + 1).padStart(2, '0');
    const day = String(lastWeek.getDate()).padStart(2, '0');

    setTargetDate(`${year}-${month}-${day}`);
  }, []);

  // ì„ íƒí•œ ë‚ ì§œì˜ ì£¼ì°¨ ì •ë³´ ê³„ì‚°
  useEffect(() => {
    if (targetDate) {
      const date = new Date(targetDate);
      const weekId = getWeekId(date);
      const { weekStart, weekEnd } = getWeekRange(date);

      setWeekInfo({
        weekId,
        weekStart,
        weekEnd,
      });
    }
  }, [targetDate]);

  // ìŠ¤í˜ì´ìŠ¤ ID ì¡°íšŒ (ì½”ë“œë¡œ)
  const getSpaceIdByCode = async (code) => {
    try {
      const spaceRef = doc(db, 'spaces', code);
      const spaceDoc = await getDoc(spaceRef);

      if (!spaceDoc.exists()) {
        throw new Error('ìŠ¤í˜ì´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }

      return code;
    } catch (error) {
      console.error('âŒ ìŠ¤í˜ì´ìŠ¤ ì¡°íšŒ ì‹¤íŒ¨:', error);
      throw error;
    }
  };

  // Receipt ID ìƒì„± (íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜)
  const generateReceiptId = (date = new Date()) => {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    const hours = String(date.getHours()).padStart(2, '0');
    const minutes = String(date.getMinutes()).padStart(2, '0');
    const seconds = String(date.getSeconds()).padStart(2, '0');

    return `${year}-${month}-${day}T${hours}${minutes}${seconds}`;
  };

  // ë°”í…ë” ë©”ë‰´ ë°ì´í„°
  const bartenderMenus = [
    // LOW ì¹´í…Œê³ ë¦¬
    { menuName: 'í•˜ì´ë³¼', price: 0, category: 'LOW', description: 'ì¬ë£Œ: ìœ„ìŠ¤í‚¤, íƒ„ì‚°ìˆ˜\n\nê¹¨ë—í•œ ìœ„ìŠ¤í‚¤ í’ë¯¸ì™€ ì‚°ëœ»í•œ íƒ„ì‚°ì˜ ì¡°í™”\n\nâ— ë§ˆì‹œê³  ì‹¶ìœ¼ë©´ íƒ„ì‚°ìˆ˜ ì‚¬ì˜¤ì„¸ìš”.' },
    { menuName: 'ë²„ë²ˆì½•', price: 0, category: 'LOW', description: 'ì¬ë£Œ: ë²„ë²ˆ ìœ„ìŠ¤í‚¤, ì½œë¼\n\në²„ë²ˆì˜ ë‹¬ì½¤í•¨ì´ ë¶€ë“œëŸ½ê²Œ ì´ì–´ì§€ëŠ” í´ë˜ì‹\n\nâ—' },
    { menuName: 'ì¿ ë°” ë¦¬ë¸Œë ˆ', price: 0, category: 'LOW', description: 'ì¬ë£Œ: ëŸ¼, ì½œë¼, ë¼ì„\n\në¼ì„ì˜ ì‚°ë¯¸ê°€ ê· í˜•ì„ ì¡ì•„ì£¼ëŠ” ìƒì¾Œí•œ ë¡±ë“œë§í¬\n\nâ—' },
    { menuName: 'ë‹¥í„°í˜í¼', price: 0, category: 'LOW', description: 'ì¬ë£Œ: ë””ì‚¬ë¡ ë…¸, ì½œë¼\n\nì•„ëª¬ë“œ í–¥ì´ ì€ì€í•˜ê²Œ í¼ì§€ëŠ” ë‹¬ì½¤í•œ í•œ ì”\n\nâ—' },
    { menuName: 'ì§„ í”¼ì¦ˆ', price: 0, category: 'LOW', description: 'ì¬ë£Œ: ì§„, ë ˆëª¬, ì‹¬í”Œì‹œëŸ½, íƒ„ì‚°ìˆ˜\n\nì‚°ëœ»í•œ ì‹œíŠ¸ëŸ¬ìŠ¤ì™€ ë¶€ë“œëŸ¬ìš´ íƒ„ì‚°ê°\n\nâ—' },

    // MID ì¹´í…Œê³ ë¦¬
    { menuName: 'ì•„ë©”ë¦¬ì¹´ë…¸', price: 0, category: 'MID', description: 'ì¬ë£Œ: ìº„íŒŒë¦¬, ìŠ¤ìœ„íŠ¸ ë² ë¥´ë¬´íŠ¸, íƒ„ì‚°ìˆ˜\n\nìŒ‰ìŒ€í•œ í—ˆë¸Œ í–¥ì´ ì¸ìƒì ì¸ í´ë˜ì‹ ì•„í˜ë¦¬í‹°í”„\n\nâ—â—' },
    { menuName: 'ë°€ë¼ë…¸ í† ë¦¬ë…¸', price: 0, category: 'MID', description: 'ì¬ë£Œ: ìº„íŒŒë¦¬, ìŠ¤ìœ„íŠ¸ ë² ë¥´ë¬´íŠ¸\n\në„¤ê·¸ë¡œë‹ˆì˜ ì›í˜•ì´ ë˜ëŠ” ê¹Šì€ í’ë¯¸\n\nâ—â—' },
    { menuName: 'ê¹€ë ›', price: 0, category: 'MID', description: 'ì¬ë£Œ: ì§„, ë¼ì„, ì‹¬í”Œì‹œëŸ½\n\në¼ì„ì˜ ì‚°ë¯¸ì™€ ì§„ì˜ ë“œë¼ì´í•¨ì´ ë˜ë ·í•œ ì¡°í™”\n\nâ—â—' },
    { menuName: 'ìœ„ìŠ¤í‚¤ ì‚¬ì›Œ', price: 0, category: 'MID', description: 'ì¬ë£Œ: ìœ„ìŠ¤í‚¤, ë ˆëª¬, ì‹¬í”Œì‹œëŸ½\n\në¶€ë“œëŸ¬ìš´ ì‚°ë¯¸ì™€ ìœ„ìŠ¤í‚¤ì˜ ê· í˜•\n\nâ—â—' },
    { menuName: 'ë§ˆê°€ë¦¬íƒ€', price: 0, category: 'MID', description: 'ì¬ë£Œ: í…Œí‚¬ë¼, ì¿ ì•µíŠ¸ë¡œ, ë¼ì„\n\në“œë¼ì´í•˜ê³  ë˜ë ·í•œ í…Œí‚¬ë¼ì˜ ë§¤ë ¥\n\nâ—â—' },
    { menuName: 'ë‹¤ì´í‚¤ë¦¬', price: 0, category: 'MID', description: 'ì¬ë£Œ: ëŸ¼, ë¼ì„, ì‹¬í”Œì‹œëŸ½\n\nëŸ¼ ë³¸ì—°ì˜ í’ë¯¸ê°€ ì‚´ì•„ ìˆëŠ” í´ë˜ì‹\n\nâ—â—' },
    { menuName: 'í™”ì´íŠ¸ ë ˆì´ë””', price: 0, category: 'MID', description: 'ì¬ë£Œ: ì§„, ì¿ ì•µíŠ¸ë¡œ, ë ˆëª¬\n\nì„¬ì„¸í•œ ì‹œíŠ¸ëŸ¬ìŠ¤ í–¥ì´ ì¸ìƒì ì¸ ì¹µí…Œì¼\n\nâ—â—' },
    { menuName: 'ì‚¬ì´ë“œì¹´', price: 0, category: 'MID', description: 'ì¬ë£Œ: ë¸Œëœë””, ì¿ ì•µíŠ¸ë¡œ, ë ˆëª¬\n\në“œë¼ì´í•˜ê³  ìš°ì•„í•œ ì „í†µ í´ë˜ì‹\n\nâ—â—' },

    // HIGH ì¹´í…Œê³ ë¦¬
    { menuName: 'ë„¤ê·¸ë¡œë‹ˆ', price: 0, category: 'HIGH', description: 'ì¬ë£Œ: ì§„, ìº„íŒŒë¦¬, ìŠ¤ìœ„íŠ¸ ë² ë¥´ë¬´íŠ¸\n\nìŒ‰ìŒ€í•¨ê³¼ ë‹¨ë§›ì´ ê· í˜•ì„ ì´ë£¨ëŠ” í´ë˜ì‹í•œ ì•„í˜ë¦¬í‹°í”„\n\nâ—â—â—' },
    { menuName: 'ë¶ˆë°”ë””ì—', price: 0, category: 'HIGH', description: 'ì¬ë£Œ: ë²„ë²ˆ ìœ„ìŠ¤í‚¤, ìº„íŒŒë¦¬, ìŠ¤ìœ„íŠ¸ ë² ë¥´ë¬´íŠ¸\n\në„¤ê·¸ë¡œë‹ˆë³´ë‹¤ ë¬µì§í•œ ìœ„ìŠ¤í‚¤ ì¤‘ì‹¬ì˜ ê¹Šì€ í’ë¯¸\n\nâ—â—â—' },
    { menuName: 'ì˜¬ë“œ íŒ¨ì…˜ë“œ', price: 0, category: 'HIGH', description: 'ì¬ë£Œ: ë²„ë²ˆ ìœ„ìŠ¤í‚¤, ì„¤íƒ•, ì•™ê³ ìŠ¤íˆ¬ë¼ ë¹„í„°\n\nìœ„ìŠ¤í‚¤ ë³¸ì—°ì˜ í–¥ê³¼ ê¹Šì´ë¥¼ ê°€ì¥ ì •ì§í•˜ê²Œ ëŠë‚„ ìˆ˜ ìˆëŠ” ì¹µí…Œì¼\n\nâ—â—â—' },
    { menuName: 'ê°“íŒŒë”', price: 0, category: 'HIGH', description: 'ì¬ë£Œ: ìŠ¤ì¹´ì¹˜ ìœ„ìŠ¤í‚¤, ë””ì‚¬ë¡ ë…¸\n\në‹¬ì½¤í•œ ì•„ëª¬ë“œ í–¥ê³¼ ìœ„ìŠ¤í‚¤ì˜ ë¬µì§í•¨ì´ ì¡°í™”ë¥¼ ì´ë£¨ëŠ” í´ë˜ì‹\n\nâ—â—â—' },
    { menuName: 'ê°“ë§ˆë”', price: 0, category: 'HIGH', description: 'ì¬ë£Œ: ë³´ë“œì¹´, ë””ì‚¬ë¡ ë…¸\n\në¶€ë“œëŸ¬ìš´ ë‹¨ë§› ì†ì— ì€ì€í•œ ì•Œì½”ì˜¬ê°ì´ ëŠê»´ì§€ëŠ” ì¹µí…Œì¼\n\nâ—â—â—' },
    { menuName: 'ë§¨í•˜íƒ„', price: 0, category: 'HIGH', description: 'ì¬ë£Œ: ë²„ë²ˆ ìœ„ìŠ¤í‚¤, ìŠ¤ìœ„íŠ¸ ë² ë¥´ë¬´íŠ¸, ë¹„í„°\n\në‹¨ì •í•˜ê³  ê¹Šì´ ìˆëŠ” êµ¬ì¡°ì˜ ëŒ€í‘œì ì¸ ìœ„ìŠ¤í‚¤ ì¹µí…Œì¼\n\nâ—â—â—' },
    { menuName: 'ë¡­ ë¡œì´', price: 0, category: 'HIGH', description: 'ì¬ë£Œ: ìŠ¤ì¹´ì¹˜ ìœ„ìŠ¤í‚¤, ìŠ¤ìœ„íŠ¸ ë² ë¥´ë¬´íŠ¸, ë¹„í„°\n\në§¨í•˜íƒ„ë³´ë‹¤ ë“œë¼ì´í•˜ê³  ë¬µì§í•œ ìŠ¤ì¹´ì¹˜ ë² ì´ìŠ¤\n\nâ—â—â—' },
    { menuName: 'ë¡± ì•„ì¼ëœë“œ ì•„ì´ìŠ¤í‹°', price: 0, category: 'HIGH', description: 'ì¬ë£Œ: ë³´ë“œì¹´, ì§„, ëŸ¼, í…Œí‚¬ë¼, ì¿ ì•µíŠ¸ë¡œ, ì½œë¼\n\nì—¬ëŸ¬ ìˆ ì´ ì–´ìš°ëŸ¬ì¡Œì§€ë§Œ ë¶€ë“œëŸ½ê²Œ ë„˜ì–´ê°€ëŠ” ê°•í•œ ì¹µí…Œì¼\n\nâ—â—â—' },
    { menuName: 'ì™€í•˜ì¹´ ì˜¬ë“œ íŒ¨ì…˜ë“œ', price: 0, category: 'HIGH', description: 'ì¬ë£Œ: ë©”ì¦ˆì¹¼, í…Œí‚¬ë¼, ì•„ê°€ë²  ì‹œëŸ½, ë¹„í„°\n\nìŠ¤ëª¨í‚¤í•œ í–¥ê³¼ ê¹Šì€ ì—¬ìš´ì´ ì¸ìƒì ì¸ ë©•ì‹œì¹¸ ìŠ¤íƒ€ì¼\n\nâ—â—â—' },
    { menuName: 'ë©”ë””ì‹œë‚˜ ë¼í‹°ë‚˜', price: 0, category: 'HIGH', description: 'ì¬ë£Œ: í…Œí‚¬ë¼, ë©”ì¦ˆì¹¼, ì§„ì € ì‹œëŸ½, ë¼ì„\n\nìŠ¤íŒŒì´ì‹œí•œ ì§„ì €ì™€ ì‹œíŠ¸ëŸ¬ìŠ¤, ìŠ¤ëª¨í‚¤í•¨ì´ ì¡°í™”ë¥¼ ì´ë£¨ëŠ” ì¹µí…Œì¼\n\nâ—â—â—' },
    { menuName: 'í˜ë‹ˆì‹¤ë¦°', price: 0, category: 'HIGH', description: 'ì¬ë£Œ: ë¸”ë Œë””ë“œ ìŠ¤ì¹´ì¹˜, ì•„ì¼ë¼ ìœ„ìŠ¤í‚¤, ë ˆëª¬, í—ˆë‹ˆ, ì§„ì €\n\nê¿€ê³¼ ìƒê°•ì˜ ë¶€ë“œëŸ¬ì›€ ìœ„ì— ìŠ¤ëª¨í‚¤í•œ ì—¬ìš´ì´ ë‚¨ëŠ” ëª¨ë˜ í´ë˜ì‹\n\nâ—â—â—' },
  ];

  // ë°”í…ë” ë©”ë‰´ ì¼ê´„ ìƒì„±
  const createBartenderMenus = async () => {
    setLoading(true);
    setMessage('');

    try {
      const spaceId = await getSpaceIdByCode(spaceCode);
      let successCount = 0;
      let failCount = 0;

      for (const menu of bartenderMenus) {
        try {
          await bartenderService.createMenu(spaceId, {
            ...menu,
            imageUrl: '',
            available: true,
          });
          successCount++;
        } catch (error) {
          console.error(`âŒ ë©”ë‰´ ìƒì„± ì‹¤íŒ¨: ${menu.menuName}`, error);
          failCount++;
        }
      }

      setMessage(`âœ… ë°”í…ë” ë©”ë‰´ ìƒì„± ì™„ë£Œ!\nì„±ê³µ: ${successCount}ê°œ\nì‹¤íŒ¨: ${failCount}ê°œ`);

      if (successCount > 0) {
        setTimeout(() => {
          navigate('/bartender/manage');
        }, 2000);
      }
    } catch (error) {
      console.error('âŒ ë°”í…ë” ë©”ë‰´ ìƒì„± ì‹¤íŒ¨:', error);
      setMessage(`âŒ ì˜¤ë¥˜: ${error.message}`);
    } finally {
      setLoading(false);
    }
  };

  // ë”ë¯¸ ë°ì´í„° ìƒì„±
  const createTestData = async () => {
    if (!weekInfo) {
      setMessage('ì£¼ì°¨ ì •ë³´ë¥¼ ë¡œë“œ ì¤‘ì…ë‹ˆë‹¤...');
      return;
    }

    setLoading(true);
    setMessage('');

    try {
      // ìŠ¤í˜ì´ìŠ¤ ID ì¡°íšŒ
      const spaceId = await getSpaceIdByCode(spaceCode);

      // ë¶„ë‹´ì ëª©ë¡ íŒŒì‹± (ì‰¼í‘œë¡œ êµ¬ë¶„)
      const splitAmongArray = splitAmong.split(',').map(s => s.trim()).filter(s => s);

      if (splitAmongArray.length === 0) {
        throw new Error('ë¶„ë‹´ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      }

      // 1. Settlement ì£¼ì°¨ ë¬¸ì„œ í™•ì¸ ë° ìƒì„±
      const settlementRef = doc(db, 'spaces', spaceId, 'settlement', weekInfo.weekId);
      const settlementSnap = await getDoc(settlementRef);

      if (!settlementSnap.exists()) {
        console.log('ğŸ†• Settlement ì£¼ì°¨ ë¬¸ì„œ ìƒì„±:', weekInfo.weekId);
        await setDoc(settlementRef, {
          weekId: weekInfo.weekId,
          weekStart: Timestamp.fromDate(weekInfo.weekStart),
          weekEnd: Timestamp.fromDate(weekInfo.weekEnd),
          status: 'active',
          createdAt: Timestamp.now(),
          settledAt: null,
          participants: {},
          totalAmount: 0,
        });
      }

      // 2. Receipt ID ìƒì„±
      const now = new Date();
      const receiptId = generateReceiptId(now);

      // 3. í•­ëª©ë³„ 1ì¸ë‹¹ ê¸ˆì•¡ ê³„ì‚° (ì˜¬ë¦¼)
      const perPerson = Math.ceil(amount / splitAmongArray.length);

      // 4. ì˜ìˆ˜ì¦ ë°ì´í„°
      const receipt = {
        id: receiptId,
        submittedBy: 'TEST_USER',
        submittedByName: 'í…ŒìŠ¤íŠ¸ê´€ë¦¬ì',
        paidBy,
        paidByName,
        createdAt: Timestamp.fromDate(now),
        memo: memo || '',
        imageUrl: '',
        items: [
          {
            itemName,
            amount,
            splitAmong: splitAmongArray,
            perPerson,
          }
        ],
        totalAmount: amount,
      };

      // 5. Firestoreì— ì €ì¥
      const receiptRef = doc(
        db,
        'spaces',
        spaceId,
        'settlement',
        weekInfo.weekId,
        'receipts',
        receiptId
      );

      await setDoc(receiptRef, receipt);

      setMessage(`âœ… í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì™„ë£Œ!\nì£¼ì°¨: ${weekInfo.weekId}\nì˜ìˆ˜ì¦ ID: ${receiptId}`);

      console.log('âœ… í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±:', {
        spaceId,
        weekId: weekInfo.weekId,
        receiptId,
        receipt,
      });

      // 3ì´ˆ í›„ ì •ì‚° í˜ì´ì§€ë¡œ ì´ë™
      setTimeout(() => {
        navigate('/settlement');
      }, 3000);
    } catch (error) {
      console.error('âŒ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì‹¤íŒ¨:', error);
      setMessage(`âŒ ì˜¤ë¥˜: ${error.message}`);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen bg-gray-50 pb-20">
      {/* í—¤ë” */}
      <div className="bg-white border-b sticky top-0 z-10">
        <div className="max-w-2xl mx-auto px-4 py-4">
          <div className="flex items-center gap-3">
            <button
              onClick={() => navigate(-1)}
              className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
            >
              <ChevronLeft className="w-5 h-5" />
            </button>
            <div className="flex items-center gap-2">
              <TestTube className="w-5 h-5 text-purple-600" />
              <h1 className="text-xl font-bold">í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±</h1>
            </div>
          </div>
        </div>
      </div>

      {/* í¼ */}
      <div className="max-w-2xl mx-auto px-4 py-6 space-y-6">
        {/* ì•ˆë‚´ ë©”ì‹œì§€ */}
        <div className="bg-purple-50 border border-purple-200 rounded-lg p-4">
          <p className="text-sm text-purple-800">
            âš ï¸ ì´ í˜ì´ì§€ëŠ” í…ŒìŠ¤íŠ¸ ì „ìš©ì…ë‹ˆë‹¤. ì›í•˜ëŠ” ì£¼ì°¨ì— ë”ë¯¸ ì˜ìˆ˜ì¦ ë°ì´í„°ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          </p>
        </div>

        {/* ì£¼ì°¨ ì„ íƒ */}
        <div className="bg-white rounded-lg shadow p-6 space-y-4">
          <h2 className="font-semibold text-lg">ì£¼ì°¨ ì„ íƒ</h2>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              ë‚ ì§œ ì„ íƒ (í•´ë‹¹ ë‚ ì§œê°€ í¬í•¨ëœ ì£¼ì°¨ì— ë°ì´í„° ìƒì„±)
            </label>
            <input
              type="date"
              value={targetDate}
              onChange={(e) => setTargetDate(e.target.value)}
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
            />
          </div>

          {weekInfo && (
            <div className="bg-gray-50 rounded-lg p-4 space-y-1">
              <p className="text-sm">
                <span className="font-medium">ì£¼ì°¨ ID:</span> {weekInfo.weekId}
              </p>
              <p className="text-sm">
                <span className="font-medium">ê¸°ê°„:</span>{' '}
                {weekInfo.weekStart.toLocaleDateString('ko-KR')} ~{' '}
                {weekInfo.weekEnd.toLocaleDateString('ko-KR')}
              </p>
            </div>
          )}
        </div>

        {/* í…ŒìŠ¤íŠ¸ ë°ì´í„° ì…ë ¥ */}
        <div className="bg-white rounded-lg shadow p-6 space-y-4">
          <h2 className="font-semibold text-lg">ì˜ìˆ˜ì¦ ì •ë³´</h2>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              ìŠ¤í˜ì´ìŠ¤ ì½”ë“œ
            </label>
            <input
              type="text"
              value={spaceCode}
              onChange={(e) => setSpaceCode(e.target.value)}
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
              placeholder="37VXcw"
            />
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              í•­ëª©ëª…
            </label>
            <input
              type="text"
              value={itemName}
              onChange={(e) => setItemName(e.target.value)}
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
              placeholder="ì¹˜í‚¨"
            />
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              ê¸ˆì•¡ (ì›)
            </label>
            <input
              type="number"
              value={amount}
              onChange={(e) => setAmount(Number(e.target.value))}
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
              placeholder="10000"
            />
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              ë‚¸ ì‚¬ëŒ (UID)
            </label>
            <input
              type="text"
              value={paidBy}
              onChange={(e) => setPaidBy(e.target.value)}
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
              placeholder="3828221463"
            />
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              ë‚¸ ì‚¬ëŒ ì´ë¦„
            </label>
            <input
              type="text"
              value={paidByName}
              onChange={(e) => setPaidByName(e.target.value)}
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
              placeholder="ë‚¸ì‚¬ëŒ"
            />
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              ë¶„ë‹´ì (UID, ì‰¼í‘œë¡œ êµ¬ë¶„)
            </label>
            <input
              type="text"
              value={splitAmong}
              onChange={(e) => setSplitAmong(e.target.value)}
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
              placeholder="3848191355, 3828221463"
            />
            <p className="text-xs text-gray-500 mt-1">
              ì—¬ëŸ¬ ëª…ì¸ ê²½ìš° ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì„¸ìš”
            </p>
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              ë©”ëª¨ (ì„ íƒ)
            </label>
            <input
              type="text"
              value={memo}
              onChange={(e) => setMemo(e.target.value)}
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
              placeholder="í…ŒìŠ¤íŠ¸ ë°ì´í„°"
            />
          </div>
        </div>

        {/* ìƒì„± ë²„íŠ¼ */}
        <button
          onClick={createTestData}
          disabled={loading || !weekInfo}
          className="w-full bg-purple-600 text-white py-3 rounded-lg font-medium hover:bg-purple-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"
        >
          {loading ? 'ìƒì„± ì¤‘...' : 'í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±'}
        </button>

        {/* ë°”í…ë” ë©”ë‰´ ì¼ê´„ ìƒì„± */}
        <div className="bg-white rounded-lg shadow p-6 space-y-4">
          <div className="flex items-center gap-3">
            <Coffee className="w-6 h-6 text-orange-600" />
            <h2 className="font-semibold text-lg">ë°”í…ë” ë©”ë‰´ ì¼ê´„ ìƒì„±</h2>
          </div>

          <div className="bg-orange-50 border border-orange-200 rounded-lg p-4">
            <p className="text-sm text-orange-800">
              ì¹µí…Œì¼ ë©”ë‰´ {bartenderMenus.length}ê°œë¥¼ í•œë²ˆì— ìƒì„±í•©ë‹ˆë‹¤.
              <br />
              (LOW {bartenderMenus.filter(m => m.category === 'LOW').length}ê°œ,
              MID {bartenderMenus.filter(m => m.category === 'MID').length}ê°œ,
              HIGH {bartenderMenus.filter(m => m.category === 'HIGH').length}ê°œ)
            </p>
          </div>

          <button
            onClick={createBartenderMenus}
            disabled={loading}
            className="w-full bg-gradient-to-r from-orange-500 to-amber-500 text-white py-3 rounded-lg font-medium hover:from-orange-600 hover:to-amber-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
          >
            <Coffee className="w-5 h-5" />
            {loading ? 'ìƒì„± ì¤‘...' : 'ë°”í…ë” ë©”ë‰´ ìƒì„±'}
          </button>
        </div>

        {/* ë©”ì‹œì§€ */}
        {message && (
          <div className={`rounded-lg p-4 ${
            message.includes('âŒ')
              ? 'bg-red-50 text-red-800 border border-red-200'
              : 'bg-green-50 text-green-800 border border-green-200'
          }`}>
            <pre className="text-sm whitespace-pre-wrap font-mono">{message}</pre>
          </div>
        )}
      </div>
    </div>
  );
};

export default TestDataPage;
</file>

<file path="src/utils/permissions.js">
import { USER_TYPES, USER_TYPE_LEVEL } from './constants';
import { isPastDate } from './dateUtils';

export const canReserveOnDate = (userType, date) => {
  if (!userType) return false;
  
  // guest, shareholderëŠ” ê³¼ê±° ë‚ ì§œ ì˜ˆì•½ ë¶ˆê°€
  if (userType === USER_TYPES.GUEST || userType === USER_TYPES.SHAREHOLDER) {
    return !isPastDate(date);
  }
  
  // vice-manager, managerëŠ” ê³¼ê±° í¬í•¨ ëª¨ë‘ ê°€ëŠ¥
  return true;
};

export const canCancelReservation = (userType, userId, reservationUserId) => {
  // ë³¸ì¸ ì˜ˆì•½ì€ í•­ìƒ ì·¨ì†Œ ê°€ëŠ¥
  if (userId === reservationUserId) return true;
  
  // vice-manager, managerëŠ” ëª¨ë“  ì˜ˆì•½ ì·¨ì†Œ ê°€ëŠ¥
  return userType === USER_TYPES.VICE_MANAGER || userType === USER_TYPES.MANAGER;
};

export const canManageSpace = (userType) => {
  // vice-manager, managerëŠ” ìŠ¤í˜ì´ìŠ¤ ê´€ë¦¬ ê°€ëŠ¥ (ë©¤ë²„ ê´€ë¦¬, ê¶Œí•œ ë³€ê²½ ë“±)
  return userType === USER_TYPES.VICE_MANAGER || userType === USER_TYPES.MANAGER;
};

export const canManageReservations = (userType) => {
  // vice-manager ì´ìƒì€ ì˜ˆì•½ ê´€ë¦¬ ê°€ëŠ¥
  return userType === USER_TYPES.VICE_MANAGER || userType === USER_TYPES.MANAGER;
};

// ê¶Œí•œ ë ˆë²¨ ë¹„êµ
export const hasHigherOrEqualLevel = (userType, targetUserType) => {
  const userLevel = USER_TYPE_LEVEL[userType] || 0;
  const targetLevel = USER_TYPE_LEVEL[targetUserType] || 0;
  return userLevel >= targetLevel;
};
</file>

<file path="vite.config.js">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig(({ mode }) => {
  // VITE_DISABLE_CONSOLE í™˜ê²½ë³€ìˆ˜ê°€ 'true'ì¼ ë•Œë§Œ ì½˜ì†” ì œê±° (main ë¸Œëœì¹˜ ì „ìš©)
  const shouldDropConsole = process.env.VITE_DISABLE_CONSOLE === 'true'

  return {
    plugins: [react()],
    server: {
      host: '0.0.0.0', // ëª¨ë“  ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ì—ì„œ ì ‘ì† ê°€ëŠ¥
      port: 5173,
    },
    css: {
      postcss: './postcss.config.js',
    },
    esbuild: shouldDropConsole ? {
      // main ë¸Œëœì¹˜ì—ì„œë§Œ consoleê³¼ debugger ì œê±°
      drop: ['console', 'debugger'],
    } : {}
  }
})
</file>

<file path="MIGRATION_SUMMARY.md">
# ì•Œë¦¼í†¡/ì´ë©”ì¼ í†µí•© - ë³€ê²½ì‚¬í•­ ìš”ì•½

## ğŸ¯ ëª©í‘œ ë‹¬ì„±
âœ… PHP ì™¸ë¶€ í˜¸ìŠ¤íŒ… â†’ Netlify Functions ë‚´ì¬í™” ì™„ë£Œ

## ğŸ“¦ ë³€ê²½ëœ íŒŒì¼ë“¤

### 1. Netlify Functions (3ê°œ)

#### `netlify/functions/send-notification.js` â­ **NEW - ê¶Œì¥**
- **ê¸°ëŠ¥**: ì´ë©”ì¼ + ì•Œë¦¼í†¡ í†µí•© ì²˜ë¦¬
- **ì¥ì **: í•œ ë²ˆì˜ API í˜¸ì¶œë¡œ ëª¨ë“  ì•Œë¦¼ ì²˜ë¦¬
- **PHP ê¸°ëŠ¥ ì™„ë²½ ì¬í˜„**:
  - âœ… HTML ì´ë©”ì¼ í…œí”Œë¦¿ (ë™ì¼í•œ ë””ìì¸)
  - âœ… ì•Œë¦¼í†¡ ë©”ì‹œì§€ + í˜„ê´€ë²ˆí˜¸ ìë™ìƒì„±
  - âœ… ë‚ ì§œ/ë¹„ìš© ìë™ê³„ì‚°
  - âœ… alimtalkEnabled í”Œë˜ê·¸ë¡œ ì•Œë¦¼í†¡ ì œì–´

#### `netlify/functions/send-email.js` (ì—…ë°ì´íŠ¸)
- PHPì˜ ì´ë©”ì¼ HTML í…œí”Œë¦¿ ì™„ì „ ì´ì‹
- reshw@naver.comìœ¼ë¡œ ê´€ë¦¬ì ì•Œë¦¼ ë°œì†¡

#### `netlify/functions/send-alimtalk.js` (ì—…ë°ì´íŠ¸)
- PHPì˜ ì•Œë¦¼í†¡ ë©”ì‹œì§€ í¬ë§· ì™„ì „ ì¬í˜„
- í˜„ê´€ë²ˆí˜¸, ê³„ì¢Œì •ë³´, ë²„íŠ¼ ë§í¬ í¬í•¨

### 2. í™˜ê²½ë³€ìˆ˜ (.env)
```diff
+ # PHP config.phpì—ì„œ ë§ˆì´ê·¸ë ˆì´ì…˜
+ ALIGO_API_KEY=aam0a3v7mfcn6ar5sn4mkhiwcmw0kruh
+ ALIGO_USER_ID=silversh13
+ ALIGO_SENDER_KEY=2a1782c49b7323eb43017cf41a62730f71407278
+ ALIGO_SENDER=01031148626
+ ALIGO_ACCOUNT=ì¹´ì¹´ì˜¤ë±…í¬ 7979-38-83356 ì–‘ì„í™˜
```

### 3. ë¬¸ì„œ
- `ALIMTALK_INTEGRATION.md`: í†µí•© ê°€ì´ë“œ ì „ì²´
- í™˜ê²½ë³€ìˆ˜ ì„¤ì • ë°©ë²•
- ì‚¬ìš© ì˜ˆì œ ì½”ë“œ
- ë§ˆì´ê·¸ë ˆì´ì…˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

## ğŸ”§ í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™ ë°©ë²•

### ê¸°ì¡´ (PHP í˜¸ìŠ¤íŒ…)
```javascript
// ì™¸ë¶€ ì„œë²„ í˜¸ì¶œ
const response = await fetch('https://www.lunagarden.co.kr/send_alimtalk.php', {
  method: 'POST',
  body: JSON.stringify(data)
});
```

### ìƒˆë¡œìš´ (Netlify Functions)
```javascript
// ë‚´ë¶€ í•¨ìˆ˜ í˜¸ì¶œ - ë” ë¹ ë¥´ê³  ì•ˆì „!
const response = await fetch('/.netlify/functions/send-notification', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    name: 'í™ê¸¸ë™',
    phone: '010-1234-5678',
    checkIn: '2025-11-15',
    checkOut: '2025-11-17',
    gender: 'ë‚¨ì„±',
    birthYear: '1990',
    hostDisplayName: 'ê¹€ì£¼ì£¼',
    spaceName: 'ì¡°ê°•308í˜¸',
    memo: 'íŠ¹ë³„ ìš”ì²­ì‚¬í•­',
    alimtalkEnabled: true  // ì¤‘ìš”: falseë©´ ì´ë©”ì¼ë§Œ ë°œì†¡
  })
});

const result = await response.json();
console.log(result);
// {
//   success: true,
//   email: { success: true, message: 'ì´ë©”ì¼ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.' },
//   alimtalk: { success: true, message: 'ì•Œë¦¼í†¡ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.' }
// }
```

## ğŸš€ ë°°í¬ ì ˆì°¨

### 1. Netlify í™˜ê²½ë³€ìˆ˜ ì„¤ì • (í•„ìˆ˜!)
```
Netlify Dashboard 
â†’ Site settings 
â†’ Environment variables 
â†’ Add variable (6ê°œ ì¶”ê°€)
```

í•„ìš”í•œ ë³€ìˆ˜ë“¤:
- ALIGO_API_KEY
- ALIGO_USER_ID
- ALIGO_SENDER_KEY
- ALIGO_SENDER
- ALIGO_ACCOUNT
- RESEND_API_KEY (ê¸°ì¡´ì— ìˆìŒ)

### 2. Git Push
```bash
git add .
git commit -m "feat: PHP ì•Œë¦¼í†¡/ì´ë©”ì¼ì„ Netlify Functionsë¡œ í†µí•©"
git push origin main
```

### 3. ìë™ ë°°í¬ í™•ì¸
- Netlifyê°€ ìë™ìœ¼ë¡œ ë¹Œë“œ & ë°°í¬
- Functions íƒ­ì—ì„œ 3ê°œ í•¨ìˆ˜ í™•ì¸

### 4. í…ŒìŠ¤íŠ¸
- ì‹¤ì œ ì˜ˆì•½ ìƒì„±í•´ë³´ê¸°
- ì´ë©”ì¼ ìˆ˜ì‹  í™•ì¸ (reshw@naver.com)
- ì•Œë¦¼í†¡ ìˆ˜ì‹  í™•ì¸ (ê²ŒìŠ¤íŠ¸ í°)

## âœ¨ ì£¼ìš” ê°œì„ ì‚¬í•­

### ì„±ëŠ¥
- âš¡ **ì‘ë‹µì†ë„ í–¥ìƒ**: ì™¸ë¶€ ì„œë²„ ì™•ë³µ ì œê±°
- ğŸ”’ **ë³´ì•ˆ ê°•í™”**: API í‚¤ í™˜ê²½ë³€ìˆ˜ë¡œ ê´€ë¦¬
- ğŸ“¦ **ì¸í”„ë¼ ë‹¨ìˆœí™”**: PHP ì„œë²„ ì œê±° ê°€ëŠ¥

### ìœ ì§€ë³´ìˆ˜
- ğŸ“ **ì½”ë“œ ì¼ì›í™”**: ëª¨ë“  ë¡œì§ì´ í•œ í”„ë¡œì íŠ¸ì—
- ğŸ”„ **ë²„ì „ ê´€ë¦¬**: Gitìœ¼ë¡œ ë³€ê²½ ì´ë ¥ ì¶”ì 
- ğŸ› **ë””ë²„ê¹… ìš©ì´**: Netlify ë¡œê·¸ë¡œ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§

### ë¹„ìš©
- ğŸ’° **í˜¸ìŠ¤íŒ… ë¹„ìš© ì ˆê°**: PHP ì„œë²„ ë¶ˆí•„ìš”
- ğŸ¯ **ì¢…ëŸ‰ì œ**: FunctionsëŠ” ì‚¬ìš©í•œ ë§Œí¼ë§Œ ê³¼ê¸ˆ

## âš ï¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

ë°°í¬ ì „ í™•ì¸ì‚¬í•­:
- [ ] Netlify í™˜ê²½ë³€ìˆ˜ 6ê°œ ëª¨ë‘ ì„¤ì •
- [ ] ì•Œë¦¬ê³  í…œí”Œë¦¿ TW_5514 ë“±ë¡ í™•ì¸
- [ ] ë°œì‹ ë²ˆí˜¸ 01031148626 ë“±ë¡ í™•ì¸
- [ ] Resend ë„ë©”ì¸ lunagarden.co.kr ì¸ì¦ í™•ì¸
- [ ] í”„ë¡ íŠ¸ì—”ë“œ ì½”ë“œ ë³€ê²½ (API ì—”ë“œí¬ì¸íŠ¸)
- [ ] ì‹¤ì œ í…ŒìŠ¤íŠ¸ (ì†Œì•¡ ì•Œë¦¼í†¡ ë°œì†¡)
- [ ] ê¸°ì¡´ PHP ì„œë²„ ëª¨ë‹ˆí„°ë§ (íŠ¸ë˜í”½ ì—†ìœ¼ë©´ ì œê±°)

## ğŸ“ ë¬¸ì œ ë°œìƒ ì‹œ

### Netlify Functions ë¡œê·¸ í™•ì¸
```
Netlify Dashboard 
â†’ Functions 
â†’ send-notification 
â†’ ìµœê·¼ ì‹¤í–‰ ë¡œê·¸
```

### ì¼ë°˜ì ì¸ ë¬¸ì œë“¤

1. **í™˜ê²½ë³€ìˆ˜ ëˆ„ë½**
   - ì¦ìƒ: 500 ì—ëŸ¬, "undefined" ê´€ë ¨ ì˜¤ë¥˜
   - í•´ê²°: Netlify ëŒ€ì‹œë³´ë“œì—ì„œ ë³€ìˆ˜ ì¬í™•ì¸

2. **ì•Œë¦¼í†¡ ë°œì†¡ ì‹¤íŒ¨**
   - ì¦ìƒ: ì´ë©”ì¼ì€ ì˜¤ì§€ë§Œ ì•Œë¦¼í†¡ ì•ˆì˜´
   - í•´ê²°: ì•Œë¦¬ê³  ëŒ€ì‹œë³´ë“œì—ì„œ ë°œì†¡ ì´ë ¥ í™•ì¸

3. **ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨**
   - ì¦ìƒ: ì•Œë¦¼í†¡ì€ ì˜¤ì§€ë§Œ ì´ë©”ì¼ ì•ˆì˜´
   - í•´ê²°: Resend ëŒ€ì‹œë³´ë“œì—ì„œ ë°œì†¡ ì´ë ¥ í™•ì¸

## ğŸ‰ ì™„ë£Œ!

ì´ì œ PHP ì—†ì´ ì™„ì „íˆ ìì²´ í˜¸ìŠ¤íŒ…ìœ¼ë¡œ ì•Œë¦¼í†¡ê³¼ ì´ë©”ì¼ì„ ë°œì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!
</file>

<file path="netlify/functions/process-praise.js">
// netlify/functions/process-praise.js
import OpenAI from 'openai';

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY
});

export async function handler(event) {
  const headers = {
    'Access-Control-Allow-Origin': '*',
    'Access-Control-Allow-Headers': 'Content-Type',
    'Access-Control-Allow-Methods': 'POST, OPTIONS',
    'Content-Type': 'application/json'
  };

  if (event.httpMethod === 'OPTIONS') {
    return { statusCode: 200, headers, body: '' };
  }

  if (event.httpMethod !== 'POST') {
    return {
      statusCode: 405,
      headers,
      body: JSON.stringify({ error: 'Method not allowed' })
    };
  }

  try {
    const { rawText, eventDate } = JSON.parse(event.body);

    if (!rawText) {
      return {
        statusCode: 400,
        headers,
        body: JSON.stringify({ error: 'ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”' })
      };
    }

    console.log('ğŸ¤– AI ì²˜ë¦¬ ì‹œì‘:', { rawText, eventDate });

    const systemPrompt = `
ë‹¹ì‹ ì€ ë¼ìš´ì§€ ì¹­ì°¬ ê²Œì‹œíŒì˜ ë”°ëœ»í•œ í¸ì§‘ìì…ë‹ˆë‹¤.
ì‚¬ìš©ìì˜ ì„ í–‰ì„ ë¼ìš´ì§€ê°€ ì§ì ‘ ê°ì‚¬í•˜ëŠ” ë©”ì‹œì§€ë¡œ ë³€í™˜í•˜ì„¸ìš”.
ìì—°ìŠ¤ëŸ¬ìš´ ì‹œì œí‘œí˜„ :
1. ê³¼ê±°í˜• ì‚¬ìš© ê¶Œì¥ (ì„ í–‰ì´ ì¼ì–´ë‚œ ê²ƒì€ ê³¼ê±°)
2. í˜„ì¬í˜•ì€ ë˜ë„ë¡ ê¸ˆì§€
3. ì¼íšŒì„±ìœ¼ë¡œ ëë‚˜ëŠ” í–‰ë™ì€ ê³¼ê±°í˜• / ì–‘ì´ ë§ê±°ë‚˜ ì§€ì†ì ìœ¼ë¡œ ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ë‚´ìš©ì€ ë¯¸ë˜í˜•

í•µì‹¬ ê·œì¹™:
1. originalTextëŠ” ì œì¶œìì˜ ì–´ê°ê³¼ í‘œí˜„ì„ ìµœëŒ€í•œ ì‚´ë¦¬ë˜, ì´ë¦„ë§Œ "ëˆ„êµ°ê°€"ë¡œ ì¹˜í™˜
2. **ë¬¼í’ˆëª…(ìŒì‹, ë¬¼ê±´, ì†Œëª¨í’ˆ ë“±)ì´ ì–¸ê¸‰ë˜ë©´ "ë¬¼í’ˆê¸°ë¶€"ë¶€í„° ìš°ì„  ê²€í† **
3. ë¼ìš´ì§€ê°€ ê°ì‚¬ë¥¼ í‘œí˜„í•˜ëŠ” ë”°ëœ»í•œ í†¤
4. 1-2ë¬¸ì¥ìœ¼ë¡œ ê°„ê²°í•˜ê²Œ

[ë°˜í™˜ í˜•ì‹ JSON]
{
  "originalText": "ì œì¶œìì˜ ì›ë¬¸ ì–´ê° ìœ ì§€, ì´ë¦„ë§Œ 'ëˆ„êµ°ê°€'ë¡œ",
  "refinedText": "1-2ë¬¸ì¥ì˜ ê°„ê²°í•œ ê°ì‚¬ ë©”ì‹œì§€",
  "category": "ë¬¼í’ˆê¸°ë¶€" | "ì²­ì†Œì •ë¦¬" | "ê¸°íƒ€",
  "itemName": "ë¬¼í’ˆëª…" (ë¬¼í’ˆê¸°ë¶€ì¸ ê²½ìš°ë§Œ, ë‚˜ë¨¸ì§€ëŠ” null)
}

ì¹´í…Œê³ ë¦¬ ìš°ì„ ìˆœìœ„ (ìœ„ì—ì„œë¶€í„°):
1. **ë¬¼í’ˆê¸°ë¶€** (ìµœìš°ì„ ): ìŒì‹(ë°¥, ë°˜ì°¬, ê³ ê¸°, ê³¼ì¼, ê°„ì‹ ë“±), ìŒë£Œ, ì†Œëª¨í’ˆ(í™”ì¥ì§€, ì„¸ì œ ë“±), ì–´ë©”ë‹ˆí‹°, ê³µêµ¬, ë¬¼ê±´ ë“±ì´ ì–¸ê¸‰ë˜ë©´ ë¬´ì¡°ê±´ "ë¬¼í’ˆê¸°ë¶€"
2. **ì²­ì†Œì •ë¦¬**: ì„¤ê±°ì§€, ì²­ì†Œ, ì“°ë ˆê¸° ì²˜ë¦¬, ì •ë¦¬ì •ëˆ
3. **ê¸°íƒ€**: í™˜ê¸°, ì „ë“± êµì²´, ìˆ˜ë¦¬ ë“±



ì˜ˆì‹œ 1 (ë¬¼í’ˆê¸°ë¶€ - ìŒì‹):
ì…ë ¥: "ë¼ì§€ê³ ê¸° 2kg ëƒ‰ì¥ê³ ì— ë„£ì—ˆì–´ìš”"
ì¶œë ¥: {
  "originalText": "ë¼ì§€ê³ ê¸° 2kg ëƒ‰ì¥ê³ ì— ë„£ì—ˆì–´ìš”",
  "refinedText": "ë¼ì§€ê³ ê¸° ê¸°ë¶€í•´ì£¼ì…”ì„œ ê³ ë§ˆì›Œìš”! ë‹¤ ê°™ì´ ë§›ìˆê²Œ ë¨¹ì„ê²Œìš” ğŸ™",
  "category": "ë¬¼í’ˆê¸°ë¶€",
  "itemName": "ë¼ì§€ê³ ê¸°"
}

ì˜ˆì‹œ 2 (ë¬¼í’ˆê¸°ë¶€ - ë°¥):
ì…ë ¥: "ë°¥ ê¸°ë¶€í•´ì£¼ì…”ì„œ ê°ì‚¬"
ì¶œë ¥: {
  "originalText": "ë°¥ ê¸°ë¶€í•´ì£¼ì…”ì„œ ê°ì‚¬",
  "refinedText": "ë°¥ ì¤€ë¹„í•´ì£¼ì…”ì„œ ì •ë§ ê³ ë§ˆì›Œìš”! ë§›ìˆê²Œ ë¨¹ì„ê²Œìš” ğŸ™",
  "category": "ë¬¼í’ˆê¸°ë¶€",
  "itemName": "ë°¥"
}

ì˜ˆì‹œ 3 (ë¬¼í’ˆê¸°ë¶€ - ì†Œëª¨í’ˆ):
ì…ë ¥: "í™”ì¥ì§€ 3ë¬¶ìŒì´ë‘ íœ´ì§€ ì‚¬ë‹¤ë†¨ìŠµë‹ˆë‹¤"
ì¶œë ¥: {
  "originalText": "í™”ì¥ì§€ 3ë¬¶ìŒì´ë‘ íœ´ì§€ ì‚¬ë‹¤ë†¨ìŠµë‹ˆë‹¤",
  "refinedText": "í™”ì¥ì§€ ì±„ì›Œì£¼ì…”ì„œ ê°ì‚¬í•´ìš”! ë•ë¶„ì— í¸í•˜ê²Œ ì“¸ ìˆ˜ ìˆê² ì–´ìš” ğŸ’š",
  "category": "ë¬¼í’ˆê¸°ë¶€",
  "itemName": "í™”ì¥ì§€"
}

ì˜ˆì‹œ 4 (ì²­ì†Œì •ë¦¬ - ë¬¼í’ˆ ì–¸ê¸‰ ì—†ìŒ):
ì…ë ¥: "ì„¤ê±°ì§€ ë‹¤ í–ˆì–´ìš”"
ì¶œë ¥: {
  "originalText": "ì„¤ê±°ì§€ ë‹¤ í–ˆì–´ìš”",
  "refinedText": "ì„¤ê±°ì§€ í•´ì£¼ì…”ì„œ ê°ì‚¬í•´ìš”! ê¹”ë”í•´ì¡Œë„¤ìš” âœ¨",
  "category": "ì²­ì†Œì •ë¦¬",
  "itemName": null
}

ì˜ˆì‹œ 5 (ë¬¼í’ˆê¸°ë¶€ - ì–´ë©”ë‹ˆí‹°):
ì…ë ¥: "ì˜ë¥˜ ë°©ìˆ˜ ì½”íŒ…ì œ ê³µêµ¬ ì„ ë°˜ì— ë†”ë’€ì–´ìš”"
ì¶œë ¥: {
  "originalText": "ì˜ë¥˜ ë°©ìˆ˜ ì½”íŒ…ì œ ê³µêµ¬ ì„ ë°˜ì— ë†”ë’€ì–´ìš”",
  "refinedText": "ë°©ìˆ˜ ì½”íŒ…ì œ ê°ì‚¬í•©ë‹ˆë‹¤! ìœ ìš©í•˜ê²Œ ì“¸ê²Œìš” ğŸ‘",
  "category": "ë¬¼í’ˆê¸°ë¶€",
  "itemName": "ì˜ë¥˜ë°©ìˆ˜ì²˜ë¦¬ì œ"
}

ì˜ˆì‹œ 6 (ì—¬ëŸ¬ ì‚¬ëŒ + ì´ë¦„ ì¹˜í™˜):
ì…ë ¥: "ìˆ˜í™˜ì´ê°€ ì„¤ê±°ì§€í•˜ê³  ìŠ¹ì€ì´ê°€ ì“°ë ˆê¸° ë²„ë ¸ì–´ìš”"
ì¶œë ¥: {
  "originalText": "ëˆ„êµ°ê°€ê°€ ì„¤ê±°ì§€í•˜ê³  ëˆ„êµ°ê°€ê°€ ì“°ë ˆê¸° ë²„ë ¸ì–´ìš”",
  "refinedText": "ì„¤ê±°ì§€ë‘ ì“°ë ˆê¸°ê¹Œì§€! ì •ë§ ê³ ë§ˆì›Œìš” ğŸ’š",
  "category": "ì²­ì†Œì •ë¦¬",
  "itemName": null
}

ì˜ˆì‹œ 7 (ë¬¼í’ˆê¸°ë¶€ - ë°˜ì°¬):
ì…ë ¥: "ë°˜ì°¬ ì—¬ëŸ¬ ê°€ì§€ ë§Œë“¤ì–´ì„œ ëƒ‰ì¥ê³ ì— ë„£ì–´ë’€ì–´ìš”"
ì¶œë ¥: {
  "originalText": "ë°˜ì°¬ ì—¬ëŸ¬ ê°€ì§€ ë§Œë“¤ì–´ì„œ ëƒ‰ì¥ê³ ì— ë„£ì–´ë’€ì–´ìš”",
  "refinedText": "ë°˜ì°¬ ì¤€ë¹„í•´ì£¼ì…”ì„œ ê°ì‚¬í•´ìš”! ë§›ìˆê²Œ ë¨¹ì„ê²Œìš” ğŸ’š",
  "category": "ë¬¼í’ˆê¸°ë¶€",
  "itemName": "ë°˜ì°¬"
}

ì˜ˆì‹œ 8 (ê¸°íƒ€ - ë¬¼í’ˆ ì•„ë‹˜):
ì…ë ¥: "í™˜ê¸°ì‹œí‚¤ê³  ì „ë“± ê°ˆì•„ë¼ì› ì–´ìš”"
ì¶œë ¥: {
  "originalText": "í™˜ê¸°ì‹œí‚¤ê³  ì „ë“± ê°ˆì•„ë¼ì› ì–´ìš”",
  "refinedText": "í™˜ê¸°ë‘ ì „ë“±ê¹Œì§€! ë¼ìš´ì§€ê°€ ì¾Œì í•´ì¡Œì–´ìš” âœ¨",
  "category": "ê¸°íƒ€",
  "itemName": null
}

ì˜ˆì‹œ 9 (ë¬¼í’ˆê¸°ë¶€ - ê³¼ì¼):
ì…ë ¥: "ì‚¬ê³¼ í•œ ë°•ìŠ¤ ê°€ì ¸ë‹¤ë†¨ì–´ìš”"
ì¶œë ¥: {
  "originalText": "ì‚¬ê³¼ í•œ ë°•ìŠ¤ ê°€ì ¸ë‹¤ë†¨ì–´ìš”",
  "refinedText": "ì‚¬ê³¼ ê¸°ë¶€í•´ì£¼ì…”ì„œ ê³ ë§ˆì›Œìš”! ì‹ ì„ í•˜ê²Œ ë¨¹ì„ê²Œìš” ğŸ",
  "category": "ë¬¼í’ˆê¸°ë¶€",
  "itemName": "ì‚¬ê³¼"
}
`;

    const response = await openai.chat.completions.create({
      model: "gpt-4o-mini",
      messages: [
        { role: "system", content: systemPrompt },
        { role: "user", content: rawText }
      ],
      temperature: 0.7,
      response_format: { type: "json_object" }
    });

    const result = JSON.parse(response.choices[0].message.content);
    console.log('âœ… AI ì²˜ë¦¬ ì™„ë£Œ:', result);

    return {
      statusCode: 200,
      headers,
      body: JSON.stringify({
        success: true,
        originalText: result.originalText || rawText,
        refinedText: result.refinedText || rawText,
        category: result.category || 'ê¸°íƒ€',
        itemName: result.itemName || null
      })
    };

  } catch (error) {
    console.error('âŒ AI ì²˜ë¦¬ ì˜¤ë¥˜:', error);
    
    return {
      statusCode: 500,
      headers,
      body: JSON.stringify({ 
        success: false, 
        error: error.message || 'AI ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤'
      })
    };
  }
}
</file>

<file path="src/components/expenses/ExpenseDetailModal.jsx">
import { useState } from 'react';
import { X, CheckCircle, XCircle, Calendar, User, ImageIcon } from 'lucide-react';
import { canManageReservations } from '../../utils/permissions';

const ExpenseDetailModal = ({ expense, selectedSpace, onClose, onApprove, onReject }) => {
  const [isApproving, setIsApproving] = useState(false);
  const [isRejecting, setIsRejecting] = useState(false);
  const [showRejectInput, setShowRejectInput] = useState(false);
  const [rejectReason, setRejectReason] = useState('');
  
  const isManager = selectedSpace?.userType && canManageReservations(selectedSpace.userType);
  const isPending = expense.status === 'pending';
  const canApproveOrReject = isManager && isPending;
  
  const formatCurrency = (amount) => {
    return amount.toLocaleString('ko-KR') + 'ì›';
  };
  
  const formatDate = (date) => {
    if (!date) return '-';
    return new Date(date).toLocaleDateString('ko-KR', {
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
  };
  
  const formatDateTime = (date) => {
    if (!date) return '-';
    return new Date(date).toLocaleDateString('ko-KR', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });
  };
  
  const getStatusBadge = (status) => {
    switch (status) {
      case 'pending':
        return (
          <span className="inline-flex items-center gap-1 px-3 py-1 bg-yellow-100 text-yellow-700 rounded-full text-sm font-semibold">
            <CheckCircle className="w-4 h-4" />
            ëŒ€ê¸°ì¤‘
          </span>
        );
      case 'approved':
        return (
          <span className="inline-flex items-center gap-1 px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-semibold">
            <CheckCircle className="w-4 h-4" />
            ìŠ¹ì¸ë¨
          </span>
        );
      case 'rejected':
        return (
          <span className="inline-flex items-center gap-1 px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm font-semibold">
            <XCircle className="w-4 h-4" />
            ê±°ë¶€ë¨
          </span>
        );
      default:
        return null;
    }
  };
  
  const handleApprove = async () => {
    if (!window.confirm('ì´ ì²­êµ¬ë¥¼ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
    
    setIsApproving(true);
    try {
      await onApprove(expense.id);
      onClose();
    } catch (error) {
      alert('ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setIsApproving(false);
    }
  };
  
  const handleReject = async () => {
    if (!rejectReason.trim()) {
      alert('ê±°ë¶€ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }
    
    if (!window.confirm('ì´ ì²­êµ¬ë¥¼ ê±°ë¶€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
    
    setIsRejecting(true);
    try {
      await onReject(expense.id, rejectReason);
      onClose();
    } catch (error) {
      alert('ê±°ë¶€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setIsRejecting(false);
    }
  };
  
  return (
    <>
      {/* ë°±ë“œë¡­ */}
      <div 
        className="fixed inset-0 bg-black/50 z-[100]"
        onClick={onClose}
      />
      
      {/* ëª¨ë‹¬ */}
      <div className="fixed inset-0 z-[101] flex items-end sm:items-center justify-center p-0 sm:p-4">
        <div 
          className="bg-white w-full sm:max-w-md overflow-hidden flex flex-col"
          style={{
            maxHeight: '85vh',
            height: 'auto',
            borderRadius: '16px 16px 0 0',
          }}
          onClick={(e) => e.stopPropagation()}
        >
          {/* í—¤ë” (ê³ ì •) */}
          <div className="flex items-center justify-between p-4 border-b border-gray-200 bg-white">
            <h2 className="text-xl font-bold text-gray-900">ìš´ì˜ë¹„ ìƒì„¸</h2>
            <button
              onClick={onClose}
              className="w-10 h-10 rounded-full flex items-center justify-center hover:bg-gray-100 transition-colors"
            >
              <X className="w-6 h-6 text-gray-500" />
            </button>
          </div>
          
          {/* ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ ì»¨í…ì¸  */}
          <div className="flex-1 overflow-y-auto p-4 space-y-6">
            {/* ê¸°ë³¸ ì •ë³´ */}
            <div className="space-y-3">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-2 text-gray-700">
                  <User className="w-5 h-5 text-gray-400" />
                  <span className="font-medium">ì²­êµ¬ì:</span>
                  <span className="font-bold">{expense.userName}</span>
                </div>
                {getStatusBadge(expense.status)}
              </div>
              
              <div className="flex items-center gap-2 text-gray-700">
                <Calendar className="w-5 h-5 text-gray-400" />
                <span className="font-medium">ì‚¬ìš©ì¼:</span>
                <span>{formatDate(expense.usedAt)}</span>
              </div>
              
              <div className="text-sm text-gray-500">
                ì²­êµ¬ì¼: {formatDateTime(expense.createdAt)}
              </div>
            </div>
            
            {/* ìŠ¹ì¸/ê±°ë¶€ ì •ë³´ */}
            {expense.status === 'approved' && expense.approvedByName && (
              <div className="bg-green-50 border border-green-200 rounded-lg p-3">
                <div className="text-sm font-semibold text-green-800 mb-1">
                  âœ… ìŠ¹ì¸ë¨
                </div>
                <div className="text-sm text-green-700">
                  ìŠ¹ì¸ì: {expense.approvedByName}
                </div>
                <div className="text-xs text-green-600 mt-1">
                  {formatDateTime(expense.approvedAt)}
                </div>
              </div>
            )}
            
            {expense.status === 'rejected' && (
              <div className="bg-red-50 border border-red-200 rounded-lg p-3">
                <div className="text-sm font-semibold text-red-800 mb-1">
                  âŒ ê±°ë¶€ë¨
                </div>
                {expense.rejectedByName && (
                  <div className="text-sm text-red-700">
                    ê±°ë¶€ì: {expense.rejectedByName}
                  </div>
                )}
                {expense.rejectionReason && (
                  <div className="text-sm text-red-600 mt-2">
                    ì‚¬ìœ : {expense.rejectionReason}
                  </div>
                )}
                {expense.rejectedAt && (
                  <div className="text-xs text-red-500 mt-1">
                    {formatDateTime(expense.rejectedAt)}
                  </div>
                )}
              </div>
            )}
            
            {/* ì¦ë¹™ ì´ë¯¸ì§€ - í’ˆëª© ë‚´ì—­ë³´ë‹¤ ë¨¼ì € í‘œì‹œ */}
            {expense.imageUrl && (
              <div>
                <h3 className="text-lg font-bold text-gray-900 mb-3">ğŸ“· ì¦ë¹™ ì´ë¯¸ì§€</h3>
                <div className="relative">
                  <img 
                    src={expense.imageUrl} 
                    alt="ì˜ìˆ˜ì¦"
                    className="w-full rounded-lg border border-gray-200 cursor-pointer hover:opacity-90 transition-opacity"
                    onClick={() => window.open(expense.imageUrl, '_blank')}
                  />
                  <div className="absolute top-2 right-2 bg-black/50 text-white px-2 py-1 rounded text-xs">
                    í´ë¦­í•˜ì—¬ í¬ê²Œ ë³´ê¸°
                  </div>
                </div>
              </div>
            )}
            
            {/* í’ˆëª© ë‚´ì—­ */}
            <div>
              <h3 className="text-lg font-bold text-gray-900 mb-3">ğŸ“‹ í’ˆëª© ë‚´ì—­</h3>
              <div className="bg-gray-50 rounded-lg p-4 space-y-3">
                {expense.items.map((item, idx) => (
                  <div key={idx} className="flex justify-between items-start">
                    <div className="flex-1">
                      <div className="font-medium text-gray-900">
                        {item.itemName || 'í•­ëª©ëª… ì—†ìŒ'}
                        {item.itemSpec && (
                          <span className="text-gray-500 text-sm ml-1">({item.itemSpec})</span>
                        )}
                      </div>
                      <div className="text-sm text-gray-600 mt-1">
                        {item.itemPrice > 0 && (
                          <>
                            {formatCurrency(item.itemPrice)} Ã— {item.itemQty || 1}
                          </>
                        )}
                      </div>
                    </div>
                    <div className="font-bold text-gray-900">
                      {formatCurrency(item.total || 0)}
                    </div>
                  </div>
                ))}
                
                <div className="border-t border-gray-300 pt-3 mt-3 flex justify-between items-center">
                  <span className="font-bold text-gray-900">ì´ì•¡</span>
                  <span className="text-2xl font-bold text-blue-600">
                    {formatCurrency(expense.totalAmount)}
                  </span>
                </div>
              </div>
            </div>
            
            {/* ë©”ëª¨ */}
            {expense.memo && (
              <div>
                <h3 className="text-lg font-bold text-gray-900 mb-2">ğŸ“ ë©”ëª¨</h3>
                <div className="bg-gray-50 rounded-lg p-4 text-gray-700">
                  {expense.memo}
                </div>
              </div>
            )}
          </div>
          
          {/* í•˜ë‹¨ ë²„íŠ¼ (ê³ ì •) */}
          {canApproveOrReject && (
            <div className="border-t border-gray-200 p-4 bg-white space-y-3">
              {showRejectInput ? (
                <>
                  <textarea
                    value={rejectReason}
                    onChange={(e) => setRejectReason(e.target.value)}
                    placeholder="ê±°ë¶€ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-red-500"
                    rows={3}
                  />
                  <div className="flex gap-2">
                    <button
                      onClick={() => {
                        setShowRejectInput(false);
                        setRejectReason('');
                      }}
                      className="flex-1 py-3 px-4 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors"
                    >
                      ì·¨ì†Œ
                    </button>
                    <button
                      onClick={handleReject}
                      disabled={isRejecting}
                      className="flex-1 py-3 px-4 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                      {isRejecting ? 'ì²˜ë¦¬ì¤‘...' : 'ê±°ë¶€ í™•ì •'}
                    </button>
                  </div>
                </>
              ) : (
                <div className="flex gap-2">
                  <button
                    onClick={() => setShowRejectInput(true)}
                    className="flex-1 py-3 px-4 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors flex items-center justify-center gap-2"
                  >
                    <XCircle className="w-5 h-5" />
                    ê±°ë¶€í•˜ê¸°
                  </button>
                  <button
                    onClick={handleApprove}
                    disabled={isApproving}
                    className="flex-1 py-3 px-4 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                  >
                    <CheckCircle className="w-5 h-5" />
                    {isApproving ? 'ì²˜ë¦¬ì¤‘...' : 'ìŠ¹ì¸í•˜ê¸°'}
                  </button>
                </div>
              )}
            </div>
          )}
        </div>
      </div>
    </>
  );
};

export default ExpenseDetailModal;
</file>

<file path="src/components/reservations/ReservationDetailModal.jsx">
// src/components/reservations/ReservationDetailModal.jsx
import { X } from 'lucide-react';
import Modal from '../common/Modal';
import { formatDate } from '../../utils/dateUtils';

const ReservationDetailModal = ({
  isOpen,
  onClose,
  date,
  reservations,
  profiles,
  user,
  onProfileClick
}) => {
  if (!date || !reservations) return null;

  // ì˜ˆì•½ ê·¸ë£¹ ë¶„ë¦¬: ì •ê·œ ì˜ˆì•½ vs ë‹¹ì¼ì¹˜ê¸°
  const regularReservations = reservations.filter(r => !r.isDayTrip && r.nights !== 0);
  const dayTripReservations = reservations.filter(r => r.isDayTrip || r.nights === 0);

  // ë‚¨ë…€ í†µê³„
  const maleCount = reservations.filter(r => profiles[r.userId]?.gender === 'male').length;
  const femaleCount = reservations.filter(r => profiles[r.userId]?.gender === 'female').length;

  // ì£¼ì£¼/ê²ŒìŠ¤íŠ¸ í†µê³„
  const memberTypes = ['shareholder', 'manager', 'vice-manager'];
  const shareholderCount = reservations.filter(r => memberTypes.includes(r.type)).length;
  const guestCount = reservations.filter(r => !memberTypes.includes(r.type)).length;

  return (
    <Modal isOpen={isOpen} onClose={onClose} title={null}>
      <div className="max-h-[70vh] overflow-y-auto">
        {/* í—¤ë” */}
        <div className="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between -mx-6 -mt-6 mb-4">
          <div>
            <h3 className="text-lg font-bold text-gray-900">
              {date.getMonth() + 1}ì›” {date.getDate()}ì¼ ì˜ˆì•½ì
            </h3>
            <div className="flex items-center gap-3 mt-1 text-sm text-gray-600">
              <span>ì´ {reservations.length}ëª…</span>
              <span>â€¢</span>
              <span className="flex items-center gap-1">
                <span className="w-2 h-2 rounded-full bg-blue-500"></span>
                ë‚¨ {maleCount}
              </span>
              <span>â€¢</span>
              <span className="flex items-center gap-1">
                <span className="w-2 h-2 rounded-full bg-pink-500"></span>
                ì—¬ {femaleCount}
              </span>
            </div>
            <div className="text-sm text-gray-500 mt-1">
              ì£¼ì£¼ {shareholderCount} Â· ê²ŒìŠ¤íŠ¸ {guestCount}
            </div>
          </div>
          <button
            onClick={onClose}
            className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
          >
            <X className="w-5 h-5" />
          </button>
        </div>

        {/* ì˜ˆì•½ ë‚´ìš© */}
        <div className="space-y-4">
          {/* ì •ê·œ ì˜ˆì•½ ê·¸ë£¹ */}
          {regularReservations.length > 0 && (
            <div>
              <h4 className="text-sm font-semibold text-gray-700 mb-2">ì˜ˆì•½ì ({regularReservations.length}ëª…)</h4>
              <div className="space-y-2">
                {regularReservations.map((reservation, index) => {
                  const profile = profiles[reservation.userId];
                  const isMine = String(reservation.userId) === String(user.id);
                  const isMember = memberTypes.includes(reservation.type);
                  const genderColor = profile?.gender === 'female' ? 'bg-pink-50 border-pink-200' : 'bg-blue-50 border-blue-200';
                  const genderIcon = profile?.gender === 'female' ? 'ğŸ‘©' : 'ğŸ‘¨';

                  return (
                    <div
                      key={reservation.id}
                      className={`p-4 rounded-xl border-2 transition-all ${
                        isMine ? 'bg-green-50 border-green-300 cursor-pointer hover:bg-green-100' : genderColor
                      }`}
                      onClick={() => {
                        if (isMine && onProfileClick) {
                          onProfileClick(reservation, date);
                        }
                      }}
                    >
                <div className="flex items-center gap-3">
                  {/* í”„ë¡œí•„ ì‚¬ì§„ */}
                  <div className="flex-shrink-0">
                    {profile?.profileImage ? (
                      <img
                        src={profile.profileImage}
                        alt={reservation.name}
                        className="w-12 h-12 rounded-full object-cover ring-2 ring-white shadow-sm"
                      />
                    ) : (
                      <div
                        className={`w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-sm ${
                          profile?.gender === 'female' ? 'bg-pink-500' : 'bg-blue-500'
                        }`}
                      >
                        {reservation.name?.[0]}
                      </div>
                    )}
                  </div>

                  {/* ì •ë³´ */}
                  <div className="flex-1 min-w-0">
                    <div className="flex items-center gap-2">
                      <span className="font-bold text-gray-900 text-base">
                        {reservation.name}
                      </span>
                      {isMine && (
                        <span className="px-2 py-0.5 bg-green-500 text-white text-xs font-bold rounded-full">
                          ë‚˜
                        </span>
                      )}
                      <span className="text-lg">{genderIcon}</span>
                    </div>

                    <div className="flex items-center gap-2 mt-1 text-sm text-gray-600">
                      <span className={`px-2 py-0.5 rounded-md ${
                        isMember ? 'bg-blue-100 text-blue-700' : 'bg-gray-100 text-gray-700'
                      } font-medium`}>
                        {isMember ? 'ì£¼ì£¼' : 'ê²ŒìŠ¤íŠ¸'}
                      </span>

                      {!isMember && reservation.hostDisplayName && (
                        <>
                          <span className="text-gray-400">â€¢</span>
                          <span className="text-gray-600">
                            {reservation.hostDisplayName} ì´ˆëŒ€
                          </span>
                        </>
                      )}
                    </div>
                  </div>

                  {/* ìˆœë²ˆ */}
                  <div className="flex-shrink-0 w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center font-bold text-gray-600 text-sm">
                    {index + 1}
                  </div>
                </div>

                {/* ì•ˆë‚´ ë¬¸êµ¬ */}
                {isMine && (
                  <div className="text-xs text-gray-400 mt-2 text-center">
                    ëˆŒëŸ¬ì„œ ìƒì„¸ë³´ê¸° ë° ìˆ˜ì •
                  </div>
                )}
              </div>
            );
          })}
        </div>
      </div>
    )}

          {/* ë‹¹ì¼ì¹˜ê¸° ê·¸ë£¹ */}
          {dayTripReservations.length > 0 && (
            <div>
              <h4 className="text-sm font-semibold text-orange-700 mb-2">ë‹¹ì¼ì¹˜ê¸° ({dayTripReservations.length}ëª…)</h4>
              <div className="space-y-2">
                {dayTripReservations.map((reservation, index) => {
                  const profile = profiles[reservation.userId];
                  const isMine = String(reservation.userId) === String(user.id);
                  const isMember = memberTypes.includes(reservation.type);
                  const genderColor = profile?.gender === 'female' ? 'bg-pink-50 border-pink-200' : 'bg-blue-50 border-blue-200';
                  const genderIcon = profile?.gender === 'female' ? 'ğŸ‘©' : 'ğŸ‘¨';

                  return (
                    <div
                      key={reservation.id}
                      className={`p-4 rounded-xl border-2 transition-all ${
                        isMine ? 'bg-green-50 border-green-300 cursor-pointer hover:bg-green-100' : genderColor
                      }`}
                      onClick={() => {
                        if (isMine && onProfileClick) {
                          onProfileClick(reservation, date);
                        }
                      }}
                    >
                      <div className="flex items-center gap-3">
                        {/* í”„ë¡œí•„ ì‚¬ì§„ */}
                        <div className="flex-shrink-0">
                          {profile?.profileImage ? (
                            <img
                              src={profile.profileImage}
                              alt={reservation.name}
                              className="w-12 h-12 rounded-full object-cover ring-2 ring-white shadow-sm"
                            />
                          ) : (
                            <div
                              className={`w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-sm ${
                                profile?.gender === 'female' ? 'bg-pink-500' : 'bg-blue-500'
                              }`}
                            >
                              {reservation.name?.[0]}
                            </div>
                          )}
                        </div>

                        {/* ì •ë³´ */}
                        <div className="flex-1 min-w-0">
                          <div className="flex items-center gap-2">
                            <span className="font-bold text-gray-900 text-base">
                              {reservation.name}
                            </span>
                            {isMine && (
                              <span className="px-2 py-0.5 bg-green-500 text-white text-xs font-bold rounded-full">
                                ë‚˜
                              </span>
                            )}
                            <span className="text-lg">{genderIcon}</span>
                          </div>

                          <div className="flex items-center gap-2 mt-1 text-sm text-gray-600">
                            <span className={`px-2 py-0.5 rounded-md ${
                              isMember ? 'bg-blue-100 text-blue-700' : 'bg-gray-100 text-gray-700'
                            } font-medium`}>
                              {isMember ? 'ì£¼ì£¼' : 'ê²ŒìŠ¤íŠ¸'}
                            </span>

                            {!isMember && reservation.hostDisplayName && (
                              <>
                                <span className="text-gray-400">â€¢</span>
                                <span className="text-gray-600">
                                  {reservation.hostDisplayName} ì´ˆëŒ€
                                </span>
                              </>
                            )}
                          </div>
                        </div>

                        {/* ìˆœë²ˆ */}
                        <div className="flex-shrink-0 w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center font-bold text-orange-600 text-sm">
                          {index + 1}
                        </div>
                      </div>

                      {/* ì•ˆë‚´ ë¬¸êµ¬ */}
                      {isMine && (
                        <div className="text-xs text-gray-400 mt-2 text-center">
                          ëˆŒëŸ¬ì„œ ìƒì„¸ë³´ê¸° ë° ìˆ˜ì •
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
            </div>
          )}
        </div>
      </div>
    </Modal>
  );
};

export default ReservationDetailModal;
</file>

<file path="src/components/reservations/SimpleMealModal.jsx">
import { useState, useEffect } from 'react';
import { X, Utensils } from 'lucide-react';
import MealParticipantListModal from './MealParticipantListModal';
import simpleMealService from '../../services/simpleMealService';
import { formatDate } from '../../utils/dateUtils';

/**
 * ê°„ë‹¨í•œ ì‹ì‚¬ ëª¨ë‹¬
 * - ì ì‹¬/ì €ë… ì°¸ì—¬ìë§Œ í‘œì‹œ
 * - í´ë¦­í•˜ë©´ ì°¸ì—¬ì ë¦¬ìŠ¤íŠ¸ ëª¨ë‹¬
 */
const SimpleMealModal = ({
  isOpen,
  onClose,
  date,
  spaceId,
  currentUser,
  profiles
}) => {
  const [participants, setParticipants] = useState({ lunch: [], dinner: [] });
  const [loading, setLoading] = useState(false);
  const [showParticipantModal, setShowParticipantModal] = useState(false);
  const [selectedMealType, setSelectedMealType] = useState(null);

  // ì°¸ì—¬ì ë¡œë“œ
  useEffect(() => {
    if (isOpen && date && spaceId) {
      loadParticipants();
    }
  }, [isOpen, date, spaceId]);

  const loadParticipants = async () => {
    setLoading(true);
    try {
      const dateStr = formatDate(date);
      const data = await simpleMealService.getMealParticipants(spaceId, dateStr);
      setParticipants(data);
    } catch (error) {
      console.error('ì°¸ì—¬ì ë¡œë“œ ì‹¤íŒ¨:', error);
    } finally {
      setLoading(false);
    }
  };

  // ì°¸ì—¬ í† ê¸€
  const handleToggle = async (mealType) => {
    try {
      const dateStr = formatDate(date);

      if (mealType === 'lunch') {
        await simpleMealService.toggleLunch(spaceId, dateStr, currentUser.id);
      } else {
        await simpleMealService.toggleDinner(spaceId, dateStr, currentUser.id);
      }

      // ìƒˆë¡œê³ ì¹¨
      await loadParticipants();
    } catch (error) {
      console.error('ì°¸ì—¬ í† ê¸€ ì‹¤íŒ¨:', error);
      alert('ì°¸ì—¬ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  };

  // ì„¹ì…˜ í´ë¦­
  const handleSectionClick = (mealType) => {
    setSelectedMealType(mealType);
    setShowParticipantModal(true);
  };

  if (!isOpen || !date) return null;

  const dateObj = new Date(date);
  const dateLabel = `${dateObj.getMonth() + 1}ì›” ${dateObj.getDate()}ì¼`;

  // í”„ë¡œí•„ ì‚¬ì§„ ë Œë”ë§ (ìµœëŒ€ 5ê°œ)
  const renderProfileImages = (participantIds, color) => {
    const displayCount = 5;
    const displayIds = participantIds.slice(0, displayCount);
    const hasMore = participantIds.length > displayCount;

    return (
      <div className="flex items-center gap-1">
        {displayIds.map((userId) => {
          const profile = profiles[userId];
          if (!profile) return null;

          return (
            <div key={userId} className="relative">
              {profile.profileImage ? (
                <img
                  src={profile.profileImage}
                  alt={profile.displayName || 'ì°¸ì—¬ì'}
                  className="w-8 h-8 rounded-full object-cover ring-2 ring-white"
                />
              ) : (
                <div className="w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center text-white text-xs font-bold ring-2 ring-white">
                  {profile.displayName?.[0] || '?'}
                </div>
              )}
            </div>
          );
        })}

        {hasMore && (
          <div className="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 text-xs font-bold">
            ...
          </div>
        )}

        {participantIds.length === 0 && (
          <div className="text-sm text-gray-400">ì°¸ì—¬ì ì—†ìŒ</div>
        )}
      </div>
    );
  };

  return (
    <>
      <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" onClick={onClose}>
        <div
          className="bg-white rounded-2xl max-w-lg w-full max-h-[80vh] overflow-y-auto meal-section"
          onClick={(e) => e.stopPropagation()}
        >
          {/* í—¤ë” */}
          <div className="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between">
            <div className="flex items-center gap-3">
              <Utensils className="w-6 h-6 text-blue-600" />
              <div>
                <h3 className="text-xl font-bold text-gray-900">ë°¥</h3>
                <div className="text-sm text-gray-600">{dateLabel}</div>
              </div>
            </div>
            <button
              onClick={onClose}
              className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
            >
              <X className="w-5 h-5" />
            </button>
          </div>

          {loading ? (
            <div className="py-12 text-center text-gray-400">
              ë¡œë”© ì¤‘...
            </div>
          ) : (
            <div className="p-6 space-y-4 meal-section-tabs">
              {/* ì ì‹¬ */}
              <div
                onClick={() => handleSectionClick('lunch')}
                className="p-5 bg-green-50 border-2 border-green-200 rounded-xl cursor-pointer hover:bg-green-100 transition-all"
              >
                <div className="flex items-center justify-between mb-3">
                  <h4 className="text-lg font-bold text-green-700 flex items-center gap-2">
                    <span className="w-3 h-3 rounded-full bg-green-500"></span>
                    ì ì‹¬
                  </h4>
                  <div className="px-3 py-1 bg-green-500 text-white text-sm font-semibold rounded-full">
                    {participants.lunch.length}ëª…
                  </div>
                </div>

                {renderProfileImages(participants.lunch, 'green')}

                <div className="mt-3 text-center text-xs text-green-600">
                  í´ë¦­í•˜ì—¬ ì°¸ì—¬ì í™•ì¸ ë° ì°¸ì—¬/ì·¨ì†Œ
                </div>
              </div>

              {/* ì €ë… */}
              <div
                onClick={() => handleSectionClick('dinner')}
                className="p-5 bg-orange-50 border-2 border-orange-200 rounded-xl cursor-pointer hover:bg-orange-100 transition-all"
              >
                <div className="flex items-center justify-between mb-3">
                  <h4 className="text-lg font-bold text-orange-700 flex items-center gap-2">
                    <span className="w-3 h-3 rounded-full bg-orange-500"></span>
                    ì €ë…
                  </h4>
                  <div className="px-3 py-1 bg-orange-500 text-white text-sm font-semibold rounded-full">
                    {participants.dinner.length}ëª…
                  </div>
                </div>

                {renderProfileImages(participants.dinner, 'orange')}

                <div className="mt-3 text-center text-xs text-orange-600">
                  í´ë¦­í•˜ì—¬ ì°¸ì—¬ì í™•ì¸ ë° ì°¸ì—¬/ì·¨ì†Œ
                </div>
              </div>
            </div>
          )}
        </div>
      </div>

      {/* ì°¸ì—¬ì ë¦¬ìŠ¤íŠ¸ ëª¨ë‹¬ */}
      {showParticipantModal && (
        <MealParticipantListModal
          isOpen={showParticipantModal}
          onClose={() => {
            setShowParticipantModal(false);
            setSelectedMealType(null);
          }}
          mealType={selectedMealType}
          participants={selectedMealType === 'lunch' ? participants.lunch : participants.dinner}
          profiles={profiles}
          currentUserId={currentUser.id}
          onToggle={async () => {
            await handleToggle(selectedMealType);
            setShowParticipantModal(false);
            setSelectedMealType(null);
          }}
        />
      )}
    </>
  );
};

export default SimpleMealModal;
</file>

<file path="src/components/settlement/ParticipantDetailModal.jsx">
// src/components/settlement/ParticipantDetailModal.jsx
import { useState } from 'react';
import { X, Receipt, TrendingUp, TrendingDown } from 'lucide-react';
import ReceiptDetailModal from './ReceiptDetailModal';

const ParticipantDetailModal = ({
  participant,
  userId,
  isOpen,
  onClose,
  receipts,
  userProfiles,
  members,
  currentUser
}) => {
  const [selectedReceipt, setSelectedReceipt] = useState(null);
  const [showReceiptModal, setShowReceiptModal] = useState(false);
  if (!isOpen || !participant || !userId) return null;

  const formatCurrency = (amount) => {
    return amount?.toLocaleString('ko-KR') + 'ì›' || '0ì›';
  };

  const formatDateTime = (date) => {
    if (!date) return '';
    const d = date instanceof Date ? date : new Date(date);
    return d.toLocaleDateString('ko-KR', {
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
    });
  };

  // í•´ë‹¹ ì°¸ì—¬ìê°€ í¬í•¨ëœ ì˜ìˆ˜ì¦ í•„í„°ë§
  const participantReceipts = receipts.filter(receipt => {
    // ë‚©ë¶€ìì¸ ê²½ìš°
    if (receipt.paidBy === userId) return true;

    // ë¶„ë‹´ìì¸ ê²½ìš°
    return receipt.items?.some(item => item.splitAmong?.includes(userId));
  }).sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

  // ê° ì˜ìˆ˜ì¦ì—ì„œ í•´ë‹¹ ì°¸ì—¬ì ê´€ë ¨ í•­ëª©ë§Œ ì¶”ì¶œ
  const getParticipantItems = (receipt) => {
    return receipt.items?.filter(item => item.splitAmong?.includes(userId)) || [];
  };

  const userProfile = userProfiles?.[userId];
  const displayName = userProfile?.displayName || participant.name || userId;
  const profileImage = userProfile?.profileImage || '';

  // ì˜ìˆ˜ì¦ í´ë¦­ í•¸ë“¤ëŸ¬
  const handleReceiptClick = (receipt) => {
    setSelectedReceipt(receipt);
    setShowReceiptModal(true);
  };

  // ì˜ìˆ˜ì¦ ìˆ˜ì • í•¸ë“¤ëŸ¬ (ì¤€ë¹„ ì¤‘)
  const handleReceiptEdit = () => {
    setShowReceiptModal(false);
    alert('ì˜ìˆ˜ì¦ ìˆ˜ì • ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
  };

  return (
    <>
      {/* ë°°ê²½ ì˜¤ë²„ë ˆì´ */}
      <div
        className="fixed inset-0 bg-black/50 z-[100]"
        onClick={onClose}
      />

      {/* ëª¨ë‹¬ */}
      <div className="fixed inset-0 z-[101] flex items-end sm:items-center justify-center p-0 sm:p-4">
        <div
          className="bg-white w-full sm:max-w-2xl rounded-t-2xl sm:rounded-2xl max-h-[90vh] overflow-y-auto"
          onClick={(e) => e.stopPropagation()}
        >
          {/* í—¤ë” */}
          <div className="sticky top-0 bg-white border-b border-gray-200 px-4 py-4 flex items-center justify-between z-10">
            <div className="flex items-center gap-3">
              {profileImage ? (
                <img
                  src={profileImage}
                  alt={displayName}
                  className="w-10 h-10 rounded-full object-cover"
                />
              ) : (
                <div className="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold">
                  {displayName[0]}
                </div>
              )}
              <h2 className="text-xl font-bold text-gray-900">{displayName}</h2>
            </div>
            <button
              onClick={onClose}
              className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
            >
              <X className="w-6 h-6 text-gray-600" />
            </button>
          </div>

          {/* ë‚´ìš© */}
          <div className="p-4 space-y-4">
            {/* ì •ì‚° ìš”ì•½ */}
            <div className="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-6 text-white">
              {/* ì •ì‚° ê²°ê³¼ - í¬ê²Œ ê°•ì¡° */}
              <div className="text-center mb-4">
                <p className="text-sm opacity-80 mb-2">ì •ì‚° ê²°ê³¼</p>
                <div className="flex items-center justify-center gap-3">
                  {participant.balance > 0 ? (
                    <>
                      <TrendingUp className="w-8 h-8 text-green-300" />
                      <span className="text-4xl font-bold text-green-300">
                        +{formatCurrency(participant.balance)}
                      </span>
                    </>
                  ) : participant.balance < 0 ? (
                    <>
                      <TrendingDown className="w-8 h-8 text-red-300" />
                      <span className="text-4xl font-bold text-red-300">
                        {formatCurrency(participant.balance)}
                      </span>
                    </>
                  ) : (
                    <span className="text-4xl font-bold">0ì›</span>
                  )}
                </div>
                <p className="text-xs opacity-75 mt-3">
                  {participant.balance > 0
                    ? 'ì •ì‚°ìì—ê²Œ ë°›ì„ ê¸ˆì•¡ì…ë‹ˆë‹¤'
                    : participant.balance < 0
                    ? 'ì •ì‚°ìì—ê²Œ ë‚¼ ê¸ˆì•¡ì…ë‹ˆë‹¤'
                    : 'ì •ì‚°í•  ê¸ˆì•¡ì´ ì—†ìŠµë‹ˆë‹¤'}
                </p>
              </div>

              {/* ìƒì„¸ ì •ë³´ - ì‘ê²Œ í‘œì‹œ */}
              <div className="flex justify-around pt-4 border-t border-white/20 text-xs">
                <div className="text-center">
                  <p className="opacity-70 mb-1">ë‚¸ ê¸ˆì•¡</p>
                  <p className="font-semibold">{formatCurrency(participant.totalPaid || 0)}</p>
                </div>
                <div className="text-center">
                  <p className="opacity-70 mb-1">ë¶€ë‹´ì•¡</p>
                  <p className="font-semibold">{formatCurrency(participant.totalOwed || 0)}</p>
                </div>
              </div>
            </div>

            {/* ê´€ë ¨ ì˜ìˆ˜ì¦ ëª©ë¡ */}
            <div className="bg-white rounded-xl border border-gray-200 p-4">
              <h3 className="font-bold text-gray-900 mb-3 flex items-center gap-2">
                <Receipt className="w-5 h-5 text-blue-600" />
                ê´€ë ¨ ì˜ìˆ˜ì¦ ({participantReceipts.length}ê°œ)
              </h3>

              {participantReceipts.length === 0 ? (
                <div className="text-center py-8">
                  <Receipt className="w-12 h-12 mx-auto mb-2 text-gray-300" />
                  <p className="text-gray-500 text-sm">ê´€ë ¨ ì˜ìˆ˜ì¦ì´ ì—†ìŠµë‹ˆë‹¤</p>
                </div>
              ) : (
                <div className="space-y-3">
                  {participantReceipts.map((receipt) => {
                    const participantItems = getParticipantItems(receipt);
                    const isPayer = receipt.paidBy === userId;
                    const myShare = participantItems.reduce((sum, item) => sum + (item.perPerson || 0), 0);

                    return (
                      <div
                        key={receipt.id}
                        onClick={() => handleReceiptClick(receipt)}
                        className={`border-2 rounded-lg p-4 cursor-pointer hover:shadow-md transition-all ${
                          isPayer ? 'border-green-200 bg-green-50/30' : 'border-gray-200 bg-white'
                        }`}
                      >
                        {/* ìƒí˜¸ëª…/ë©”ëª¨ */}
                        <div className="flex items-start justify-between mb-3">
                          <div className="flex-1">
                            {receipt.memo && (
                              <h4 className="font-bold text-gray-900 text-base mb-1">
                                {receipt.memo}
                              </h4>
                            )}
                            <p className="text-xs text-gray-500">
                              {formatDateTime(receipt.createdAt)}
                            </p>
                          </div>
                        </div>

                        {/* í’ˆëª© ë¦¬ìŠ¤íŠ¸ */}
                        <div className="mb-3 space-y-1.5">
                          {receipt.items.map((item, idx) => {
                            const isParticipantItem = item.splitAmong?.includes(userId);
                            return (
                              <div
                                key={idx}
                                className={`flex justify-between items-start text-sm py-2 px-2 rounded ${
                                  isParticipantItem ? 'bg-blue-50' : 'bg-gray-50'
                                }`}
                              >
                                <span className={`${isParticipantItem ? 'font-semibold text-blue-900' : 'text-gray-700'} flex-1`}>
                                  {item.itemName}
                                </span>
                                <div className="flex flex-col items-end gap-0.5 ml-2">
                                  {isParticipantItem ? (
                                    <>
                                      <div className="flex items-baseline gap-1">
                                        <span className="font-bold text-blue-600">
                                          {formatCurrency(item.perPerson || 0)}
                                        </span>
                                        <span className="text-xs text-gray-500">
                                          / {formatCurrency(item.amount || 0)}
                                        </span>
                                      </div>
                                      <span className="text-xs text-gray-500">
                                        {item.splitAmong?.length || 0}ëª… ë¶„ë‹´
                                      </span>
                                    </>
                                  ) : (
                                    <>
                                      <span className="text-gray-600">
                                        {formatCurrency(item.amount || 0)}
                                      </span>
                                      <span className="text-xs text-gray-500">
                                        {item.splitAmong?.length || 0}ëª… ë¶„ë‹´
                                      </span>
                                    </>
                                  )}
                                </div>
                              </div>
                            );
                          })}
                        </div>

                        {/* í•˜ë‹¨: ë¶„ë‹´ ê¸ˆì•¡ / ë‚¸ ì‚¬ëŒ ì •ë³´ */}
                        <div className="pt-3 border-t border-gray-200">
                          <div className="flex items-center justify-between">
                            <div className="flex items-center gap-2">
                              <span className="text-xs text-gray-600">ë‚¸ ì‚¬ëŒ</span>
                              <span className={`font-bold ${isPayer ? 'text-green-600' : 'text-gray-900'}`}>
                                {receipt.paidByName}
                                {isPayer && (
                                  <span className="ml-1 text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded">
                                    ë³¸ì¸
                                  </span>
                                )}
                              </span>
                              {isPayer && (
                                <span className="text-lg font-bold text-green-600">
                                  {formatCurrency(receipt.totalAmount)}
                                </span>
                              )}
                            </div>
                            {!isPayer && myShare > 0 && (
                              <div className="flex items-center gap-2">
                                <span className="text-xs text-gray-600">ë¶„ë‹´ì•¡</span>
                                <span className="text-lg font-bold text-blue-600">
                                  {formatCurrency(myShare)}
                                </span>
                              </div>
                            )}
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              )}
            </div>
          </div>

          {/* í•˜ë‹¨ ë‹«ê¸° ë²„íŠ¼ */}
          <div className="sticky bottom-0 bg-white border-t border-gray-200 p-4">
            <button
              onClick={onClose}
              className="w-full bg-gray-100 text-gray-700 py-3 rounded-xl font-bold hover:bg-gray-200 transition-colors"
            >
              ë‹«ê¸°
            </button>
          </div>
        </div>
      </div>

      {/* ì˜ìˆ˜ì¦ ìƒì„¸ ëª¨ë‹¬ */}
      <ReceiptDetailModal
        receipt={selectedReceipt}
        isOpen={showReceiptModal}
        onClose={() => {
          setShowReceiptModal(false);
          setSelectedReceipt(null);
        }}
        onEdit={handleReceiptEdit}
        onDelete={() => {}}
        canEdit={false} // ì°¸ì—¬ì ìƒì„¸ ëª¨ë‹¬ì—ì„œëŠ” ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ ìˆ¨ê¹€
        members={members}
        userProfiles={userProfiles}
      />
    </>
  );
};

export default ParticipantDetailModal;
</file>

<file path="src/pages/JoinSpacePage.jsx">
// src/pages/JoinSpacePage.jsx
import { useState, useEffect } from 'react';
import { useNavigate, useParams } from 'react-router-dom';
import { useAuth } from '../hooks/useAuth';
import spaceService from '../services/spaceService';
import LoginOverlay from '../components/auth/LoginOverlay';

const JoinSpacePage = () => {
  const navigate = useNavigate();
  const { code } = useParams(); // URL íŒŒë¼ë¯¸í„°ì—ì„œ ì½”ë“œ ì¶”ì¶œ
  const { user, isLoggedIn } = useAuth();
  
  const [spaceCode, setSpaceCode] = useState(code || '');
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState('');
  const [spaceInfo, setSpaceInfo] = useState(null);
  const [showConfirm, setShowConfirm] = useState(false);

  useEffect(() => {
    // URLì— ì½”ë“œê°€ ìˆê³  ë¡œê·¸ì¸ ë˜ì–´ ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ ìŠ¤í˜ì´ìŠ¤ ì •ë³´ ì¡°íšŒ
    if (code && isLoggedIn) {
      handleCodeSubmit(code);
    }
  }, [isLoggedIn, code]);

  const handleCodeSubmit = async (inputCode = spaceCode) => {
    if (!inputCode || inputCode.trim().length === 0) {
      setError('ë°© ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
      return;
    }

    setIsLoading(true);
    setError('');
    
    try {
      // ìŠ¤í˜ì´ìŠ¤ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
      const space = await spaceService.getSpaceByCode(inputCode.trim());
      
      if (!space) {
        setError('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë°© ì½”ë“œì…ë‹ˆë‹¤');
        setSpaceInfo(null);
        setShowConfirm(false);
        return;
      }

      // ì´ë¯¸ ê°€ì…ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
      const alreadyJoined = await spaceService.checkUserInSpace(user.id, space.id);
      
      if (alreadyJoined) {
        // ì´ë¯¸ ê°€ì…ëœ ë°©ì´ë©´ ë©”ì¸ìœ¼ë¡œ ì´ë™
        
        navigate('/', { replace: true });
        return;
      }

      // ìŠ¤í˜ì´ìŠ¤ ì •ë³´ í‘œì‹œ ë° í™•ì¸ í™”ë©´ í‘œì‹œ
      setSpaceInfo(space);
      setShowConfirm(true);
    } catch (err) {
      console.error('ë°© ì¡°íšŒ ì‹¤íŒ¨:', err);
      setError('ë°© ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
      setSpaceInfo(null);
      setShowConfirm(false);
    } finally {
      setIsLoading(false);
    }
  };

  const handleJoinConfirm = async () => {
    if (!spaceInfo) return;
    
    setIsLoading(true);
    
    try {
      const result = await spaceService.joinSpace(String(user.id), spaceInfo.id, {
        displayName: user.displayName,
        email: user.email,
        profileImage: user.profileImage
      });

      if (result.alreadyJoined) {
        alert('ì´ë¯¸ ê°€ì…ëœ ë°©ì…ë‹ˆë‹¤');
      } else {
        alert(`${spaceInfo.name}ì— ê°€ì…ë˜ì—ˆìŠµë‹ˆë‹¤!`);
      }
      
      // ë©”ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™
      navigate('/', { replace: true });
    } catch (err) {
      console.error('ë°© ê°€ì… ì‹¤íŒ¨:', err);
      alert(`ë°© ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n${err?.message || ''}`);
    } finally {
      setIsLoading(false);
    }
  };

  const handleCancel = () => {
    setShowConfirm(false);
    setSpaceInfo(null);
    setSpaceCode('');
    setError('');
  };

  if (!isLoggedIn) {
    return <LoginOverlay />;
  }

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50 p-4">
      <div className="w-full max-w-md bg-white rounded-lg shadow-md p-6">
        <h1 className="text-2xl font-bold text-gray-900 mb-6 text-center">
          ë°© ê°€ì…í•˜ê¸°
        </h1>

        {!showConfirm ? (
          // ì½”ë“œ ì…ë ¥ í™”ë©´
          <>
            <div className="mb-4">
              <label className="block text-sm font-medium text-gray-700 mb-2">
                ë°© ì½”ë“œ ì…ë ¥
              </label>
              <input
                type="text"
                value={spaceCode}
                onChange={(e) => {
                  setSpaceCode(e.target.value);
                  setError('');
                }}
                onKeyPress={(e) => {
                  if (e.key === 'Enter') {
                    handleCodeSubmit();
                  }
                }}
                placeholder="6ìë¦¬ ì½”ë“œ ì…ë ¥"
                className={`w-full px-4 py-3 border rounded-lg text-center text-lg tracking-wider
                  focus:outline-none focus:ring-2 
                  ${error 
                    ? 'border-red-500 focus:ring-red-200' 
                    : 'border-gray-300 focus:ring-blue-200'}`}
                disabled={isLoading}
              />
              {error && (
                <p className="text-red-500 text-sm mt-2">{error}</p>
              )}
            </div>

            <button
              onClick={() => handleCodeSubmit()}
              disabled={isLoading || !spaceCode.trim()}
              className={`w-full py-3 rounded-lg font-medium transition-colors mb-4
                ${isLoading || !spaceCode.trim()
                  ? 'bg-gray-400 cursor-not-allowed'
                  : 'bg-blue-600 hover:bg-blue-700 text-white'}`}
            >
              {isLoading ? 'í™•ì¸ ì¤‘...' : 'í™•ì¸'}
            </button>

            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
              <p className="text-sm text-blue-800">
                ğŸ’¡ ë°© ì½”ë“œëŠ” ë°©ì¥ì´ë‚˜ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”!
              </p>
            </div>

            <button
              onClick={() => navigate('/')}
              className="w-full mt-4 py-2 text-gray-600 hover:text-gray-800"
            >
              ì·¨ì†Œ
            </button>
          </>
        ) : (
          // ê°€ì… í™•ì¸ í™”ë©´
          <div className="text-center">
            <div className="mb-6">
              <div className="text-4xl mb-4">ğŸ </div>
              <h2 className="text-xl font-bold text-gray-900 mb-2">
                {spaceInfo?.name || 'ë°© ì´ë¦„'}
              </h2>
              <p className="text-gray-600">
                ì´ ë°©ì— ê°€ì…í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
              </p>
            </div>

            <div className="flex gap-3">
              <button
                onClick={handleCancel}
                disabled={isLoading}
                className="flex-1 py-3 border border-gray-300 rounded-lg font-medium
                  text-gray-700 hover:bg-gray-50 transition-colors"
              >
                ì·¨ì†Œ
              </button>
              <button
                onClick={handleJoinConfirm}
                disabled={isLoading}
                className={`flex-1 py-3 rounded-lg font-medium transition-colors
                  ${isLoading
                    ? 'bg-gray-400 cursor-not-allowed'
                    : 'bg-blue-600 hover:bg-blue-700 text-white'}`}
              >
                {isLoading ? 'ê°€ì… ì¤‘...' : 'ê°€ì…í•˜ê¸°'}
              </button>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

export default JoinSpacePage;
</file>

<file path="src/pages/SignupDemoPage.jsx">
import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { ArrowLeft, Check, X, AlertCircle } from 'lucide-react';

const SignInPage = () => {
  const navigate = useNavigate();
  
  const [formData, setFormData] = useState({
    username: '',
    name: '',
    email: '',
    password: '',
    passwordConfirm: '',
    phoneNumber: '',
    birthYear: '',
    gender: ''
  });
  
  const [verificationCode, setVerificationCode] = useState('');
  const [isCodeSent, setIsCodeSent] = useState(false);
  const [isVerified, setIsVerified] = useState(false);
  const [isUsernameChecked, setIsUsernameChecked] = useState(false);
  const [timer, setTimer] = useState(0);
  
  const [agreements, setAgreements] = useState({
    terms: false,
    privacy: false,
    personalInfo: false,
    marketing: false
  });
  
  const [errors, setErrors] = useState({});
  const [isSubmitting, setIsSubmitting] = useState(false);

  // ì…ë ¥ í•¸ë“¤ëŸ¬
  const handleChange = (e) => {
    const { name, value } = e.target;
    
    // ì•„ì´ë”” ë³€ê²½ ì‹œ ì¤‘ë³µí™•ì¸ ì´ˆê¸°í™”
    if (name === 'username') {
      setIsUsernameChecked(false);
    }
    
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
    // ì—ëŸ¬ ì œê±°
    if (errors[name]) {
      setErrors(prev => ({
        ...prev,
        [name]: ''
      }));
    }
  };

  // ë™ì˜ ì²´í¬ë°•ìŠ¤ í•¸ë“¤ëŸ¬
  const handleAgreementChange = (name) => {
    setAgreements(prev => ({
      ...prev,
      [name]: !prev[name]
    }));
  };

  // ì „ì²´ ë™ì˜
  const handleAllAgree = () => {
    const allChecked = agreements.terms && agreements.privacy && agreements.personalInfo && agreements.marketing;
    setAgreements({
      terms: !allChecked,
      privacy: !allChecked,
      personalInfo: !allChecked,
      marketing: !allChecked
    });
  };

  // ì•„ì´ë”” ì¤‘ë³µí™•ì¸ (ëª¨ì–‘ìƒˆë§Œ)
  const handleCheckUsername = () => {
    if (!formData.username) {
      setErrors(prev => ({
        ...prev,
        username: 'ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”'
      }));
      return;
    }
    
    if (formData.username.length < 4) {
      setErrors(prev => ({
        ...prev,
        username: 'ì•„ì´ë””ëŠ” 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤'
      }));
      return;
    }
    
    if (!/^[a-zA-Z0-9_]+$/.test(formData.username)) {
      setErrors(prev => ({
        ...prev,
        username: 'ì•„ì´ë””ëŠ” ì˜ë¬¸, ìˆ«ì, ì–¸ë”ìŠ¤ì½”ì–´(_)ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤'
      }));
      return;
    }
    
    // ì¤‘ë³µí™•ì¸ ì„±ê³µ (í•­ìƒ ì‚¬ìš© ê°€ëŠ¥)
    setIsUsernameChecked(true);
    setErrors(prev => ({
      ...prev,
      username: ''
    }));
    alert('ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤.');
  };

  // íœ´ëŒ€í° ë²ˆí˜¸ í˜•ì‹í™”
  const formatPhoneNumber = (value) => {
    const numbers = value.replace(/[^\d]/g, '');
    if (numbers.length <= 3) return numbers;
    if (numbers.length <= 7) return `${numbers.slice(0, 3)}-${numbers.slice(3)}`;
    return `${numbers.slice(0, 3)}-${numbers.slice(3, 7)}-${numbers.slice(7, 11)}`;
  };

  // íœ´ëŒ€í° ì…ë ¥ í•¸ë“¤ëŸ¬
  const handlePhoneChange = (e) => {
    const formatted = formatPhoneNumber(e.target.value);
    setFormData(prev => ({
      ...prev,
      phoneNumber: formatted
    }));
  };

  // ì¸ì¦ë²ˆí˜¸ ë°œì†¡ (ëª¨ì–‘ìƒˆë§Œ)
  const handleSendCode = () => {
    if (!formData.phoneNumber || formData.phoneNumber.length < 13) {
      setErrors(prev => ({
        ...prev,
        phoneNumber: 'ì˜¬ë°”ë¥¸ íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”'
      }));
      return;
    }
    
    setIsCodeSent(true);
    setTimer(180); // 3ë¶„
    
    // íƒ€ì´ë¨¸ ì‹œì‘ (ì‹¤ì œë¡œëŠ” êµ¬í˜„ ì•ˆí•¨, ëª¨ì–‘ìƒˆë§Œ)
    alert('ì¸ì¦ë²ˆí˜¸ê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. (í…ŒìŠ¤íŠ¸: 123456)');
  };

  // ì¸ì¦ë²ˆí˜¸ í™•ì¸ (ëª¨ì–‘ìƒˆë§Œ)
  const handleVerifyCode = () => {
    if (verificationCode === '123456') {
      setIsVerified(true);
      alert('ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
    } else {
      alert('ì¸ì¦ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
    }
  };

  // í¼ ê²€ì¦
  const validateForm = () => {
    const newErrors = {};

    if (!formData.username) {
      newErrors.username = 'ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”';
    } else if (!isUsernameChecked) {
      newErrors.username = 'ì•„ì´ë”” ì¤‘ë³µí™•ì¸ì„ í•´ì£¼ì„¸ìš”';
    }

    if (!formData.name.trim()) {
      newErrors.name = 'ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”';
    }

    if (!formData.email.trim()) {
      newErrors.email = 'ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”';
    } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(formData.email)) {
      newErrors.email = 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤';
    }

    if (!formData.password) {
      newErrors.password = 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”';
    } else if (formData.password.length < 8) {
      newErrors.password = 'ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤';
    }

    if (formData.password !== formData.passwordConfirm) {
      newErrors.passwordConfirm = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤';
    }

    if (!formData.phoneNumber || formData.phoneNumber.length < 13) {
      newErrors.phoneNumber = 'íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”';
    }

    if (!isVerified) {
      newErrors.verification = 'íœ´ëŒ€í° ì¸ì¦ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”';
    }

    if (!formData.birthYear) {
      newErrors.birthYear = 'ì¶œìƒì—°ë„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”';
    }

    if (!formData.gender) {
      newErrors.gender = 'ì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”';
    }

    if (!agreements.terms || !agreements.privacy || !agreements.personalInfo) {
      newErrors.agreements = 'í•„ìˆ˜ ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”';
    }

    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  // íšŒì›ê°€ì… ì œì¶œ
  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!validateForm()) {
      return;
    }

    setIsSubmitting(true);
    
    try {
      // ì‹¤ì œë¡œëŠ” ì„œë²„ë¡œ ì „ì†¡í•˜ì§€ ì•ŠìŒ (ì¹´ì¹´ì˜¤ ì‹¬ì‚¬ìš©)
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\n(ì¹´ì¹´ì˜¤ ì‹¬ì‚¬ìš© í˜ì´ì§€ì…ë‹ˆë‹¤)');
      navigate('/');
    } catch (error) {
      alert('íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setIsSubmitting(false);
    }
  };

  const currentYear = new Date().getFullYear();
  const years = Array.from({ length: 100 }, (_, i) => currentYear - i);

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900">
      {/* í—¤ë” */}
      <div className="sticky top-0 z-10 bg-slate-900/80 backdrop-blur-lg border-b border-white/10">
        <div className="max-w-2xl mx-auto px-4 py-4 flex items-center gap-4">
          <button
            onClick={() => navigate(-1)}
            className="p-2 hover:bg-white/10 rounded-lg transition-colors"
          >
            <ArrowLeft className="w-5 h-5 text-white" />
          </button>
          <h1 className="text-xl font-bold text-white">íšŒì›ê°€ì…</h1>
        </div>
      </div>

      {/* ë³¸ë¬¸ */}
      <div className="max-w-2xl mx-auto px-4 py-8">
        <div className="bg-white/10 backdrop-blur-lg rounded-xl border border-white/20 shadow-2xl p-6 md:p-8">
          <form onSubmit={handleSubmit} className="space-y-6">
            {/* ì•„ì´ë”” */}
            <div>
              <label className="block text-sm font-semibold text-white mb-2">
                ì•„ì´ë”” <span className="text-red-400">*</span>
              </label>
              <div className="flex gap-2">
                <input
                  type="text"
                  name="username"
                  value={formData.username}
                  onChange={handleChange}
                  className="flex-1 px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="ì˜ë¬¸, ìˆ«ì, _ ì‚¬ìš© (4ì ì´ìƒ)"
                  disabled={isUsernameChecked}
                />
                <button
                  type="button"
                  onClick={handleCheckUsername}
                  disabled={isUsernameChecked}
                  className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed font-semibold whitespace-nowrap"
                >
                  {isUsernameChecked ? 'í™•ì¸ì™„ë£Œ' : 'ì¤‘ë³µí™•ì¸'}
                </button>
              </div>
              {errors.username && (
                <p className="mt-1 text-sm text-red-400 flex items-center gap-1">
                  <AlertCircle className="w-4 h-4" />
                  {errors.username}
                </p>
              )}
              {isUsernameChecked && (
                <p className="mt-1 text-sm text-green-400 flex items-center gap-1">
                  <Check className="w-4 h-4" />
                  ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤
                </p>
              )}
            </div>

            {/* ì´ë¦„ */}
            <div>
              <label className="block text-sm font-semibold text-white mb-2">
                ì´ë¦„ <span className="text-red-400">*</span>
              </label>
              <input
                type="text"
                name="name"
                value={formData.name}
                onChange={handleChange}
                className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                placeholder="í™ê¸¸ë™"
              />
              {errors.name && (
                <p className="mt-1 text-sm text-red-400 flex items-center gap-1">
                  <AlertCircle className="w-4 h-4" />
                  {errors.name}
                </p>
              )}
            </div>

            {/* ì´ë©”ì¼ */}
            <div>
              <label className="block text-sm font-semibold text-white mb-2">
                ì´ë©”ì¼ <span className="text-red-400">*</span>
              </label>
              <input
                type="email"
                name="email"
                value={formData.email}
                onChange={handleChange}
                className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                placeholder="example@email.com"
              />
              {errors.email && (
                <p className="mt-1 text-sm text-red-400 flex items-center gap-1">
                  <AlertCircle className="w-4 h-4" />
                  {errors.email}
                </p>
              )}
            </div>

            {/* ë¹„ë°€ë²ˆí˜¸ */}
            <div>
              <label className="block text-sm font-semibold text-white mb-2">
                ë¹„ë°€ë²ˆí˜¸ <span className="text-red-400">*</span>
              </label>
              <input
                type="password"
                name="password"
                value={formData.password}
                onChange={handleChange}
                className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                placeholder="8ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”"
              />
              {errors.password && (
                <p className="mt-1 text-sm text-red-400 flex items-center gap-1">
                  <AlertCircle className="w-4 h-4" />
                  {errors.password}
                </p>
              )}
            </div>

            {/* ë¹„ë°€ë²ˆí˜¸ í™•ì¸ */}
            <div>
              <label className="block text-sm font-semibold text-white mb-2">
                ë¹„ë°€ë²ˆí˜¸ í™•ì¸ <span className="text-red-400">*</span>
              </label>
              <input
                type="password"
                name="passwordConfirm"
                value={formData.passwordConfirm}
                onChange={handleChange}
                className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”"
              />
              {errors.passwordConfirm && (
                <p className="mt-1 text-sm text-red-400 flex items-center gap-1">
                  <AlertCircle className="w-4 h-4" />
                  {errors.passwordConfirm}
                </p>
              )}
            </div>

            {/* íœ´ëŒ€í° ë²ˆí˜¸ + ì¸ì¦ */}
            <div>
              <label className="block text-sm font-semibold text-white mb-2">
                íœ´ëŒ€í° ë²ˆí˜¸ <span className="text-red-400">*</span>
              </label>
              <div className="flex gap-2">
                <input
                  type="tel"
                  value={formData.phoneNumber}
                  onChange={handlePhoneChange}
                  className="flex-1 px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="010-0000-0000"
                  maxLength="13"
                  disabled={isVerified}
                />
                <button
                  type="button"
                  onClick={handleSendCode}
                  disabled={isVerified}
                  className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed font-semibold whitespace-nowrap"
                >
                  {isVerified ? 'ì¸ì¦ì™„ë£Œ' : isCodeSent ? 'ì¬ë°œì†¡' : 'ì¸ì¦ë²ˆí˜¸'}
                </button>
              </div>
              {errors.phoneNumber && (
                <p className="mt-1 text-sm text-red-400 flex items-center gap-1">
                  <AlertCircle className="w-4 h-4" />
                  {errors.phoneNumber}
                </p>
              )}

              {/* ì¸ì¦ë²ˆí˜¸ ì…ë ¥ */}
              {isCodeSent && !isVerified && (
                <div className="mt-3 flex gap-2">
                  <input
                    type="text"
                    value={verificationCode}
                    onChange={(e) => setVerificationCode(e.target.value)}
                    className="flex-1 px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="ì¸ì¦ë²ˆí˜¸ 6ìë¦¬ ì…ë ¥ (í…ŒìŠ¤íŠ¸: 123456)"
                    maxLength="6"
                  />
                  <button
                    type="button"
                    onClick={handleVerifyCode}
                    className="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold whitespace-nowrap"
                  >
                    í™•ì¸
                  </button>
                </div>
              )}

              {isVerified && (
                <p className="mt-2 text-sm text-green-400 flex items-center gap-1">
                  <Check className="w-4 h-4" />
                  íœ´ëŒ€í° ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤
                </p>
              )}

              {errors.verification && (
                <p className="mt-1 text-sm text-red-400 flex items-center gap-1">
                  <AlertCircle className="w-4 h-4" />
                  {errors.verification}
                </p>
              )}
            </div>

            {/* ì¶œìƒì—°ë„ */}
            <div>
              <label className="block text-sm font-semibold text-white mb-2">
                ì¶œìƒì—°ë„ <span className="text-red-400">*</span>
              </label>
              <select
                name="birthYear"
                value={formData.birthYear}
                onChange={handleChange}
                className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                <option value="" className="bg-slate-800">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                {years.map(year => (
                  <option key={year} value={year} className="bg-slate-800">{year}ë…„</option>
                ))}
              </select>
              {errors.birthYear && (
                <p className="mt-1 text-sm text-red-400 flex items-center gap-1">
                  <AlertCircle className="w-4 h-4" />
                  {errors.birthYear}
                </p>
              )}
            </div>

            {/* ì„±ë³„ */}
            <div>
              <label className="block text-sm font-semibold text-white mb-2">
                ì„±ë³„ <span className="text-red-400">*</span>
              </label>
              <div className="flex gap-4">
                <label className="flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-white/10 border border-white/20 rounded-lg cursor-pointer hover:bg-white/20 transition-colors">
                  <input
                    type="radio"
                    name="gender"
                    value="male"
                    checked={formData.gender === 'male'}
                    onChange={handleChange}
                    className="w-4 h-4"
                  />
                  <span className="text-white font-medium">ë‚¨ì„±</span>
                </label>
                <label className="flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-white/10 border border-white/20 rounded-lg cursor-pointer hover:bg-white/20 transition-colors">
                  <input
                    type="radio"
                    name="gender"
                    value="female"
                    checked={formData.gender === 'female'}
                    onChange={handleChange}
                    className="w-4 h-4"
                  />
                  <span className="text-white font-medium">ì—¬ì„±</span>
                </label>
              </div>
              {errors.gender && (
                <p className="mt-1 text-sm text-red-400 flex items-center gap-1">
                  <AlertCircle className="w-4 h-4" />
                  {errors.gender}
                </p>
              )}
            </div>

            {/* ì•½ê´€ ë™ì˜ */}
            <div className="space-y-3 pt-4 border-t border-white/20">
              <label className="flex items-center gap-3 cursor-pointer">
                <input
                  type="checkbox"
                  checked={agreements.terms && agreements.privacy && agreements.personalInfo && agreements.marketing}
                  onChange={handleAllAgree}
                  className="w-5 h-5 rounded"
                />
                <span className="text-white font-semibold">ì „ì²´ ë™ì˜</span>
              </label>

              <div className="pl-8 space-y-2">
                <label className="flex items-center gap-3 cursor-pointer">
                  <input
                    type="checkbox"
                    checked={agreements.terms}
                    onChange={() => handleAgreementChange('terms')}
                    className="w-4 h-4 rounded"
                  />
                  <span className="text-gray-300 text-sm">
                    <span className="text-red-400">*</span> ì´ìš©ì•½ê´€ ë™ì˜
                  </span>
                </label>

                <div className="flex items-center gap-3">
                  <label className="flex items-center gap-3 cursor-pointer flex-1">
                    <input
                      type="checkbox"
                      checked={agreements.privacy}
                      onChange={() => handleAgreementChange('privacy')}
                      className="w-4 h-4 rounded"
                    />
                    <span className="text-gray-300 text-sm">
                      <span className="text-red-400">*</span> ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ ë™ì˜
                    </span>
                  </label>
                  <button
                    type="button"
                    onClick={() => navigate('/privacy')}
                    className="text-blue-400 hover:text-blue-300 text-xs underline whitespace-nowrap"
                  >
                    ì „ë¬¸ë³´ê¸°
                  </button>
                </div>

                <div className="flex items-center gap-3">
                  <label className="flex items-center gap-3 cursor-pointer flex-1">
                    <input
                      type="checkbox"
                      checked={agreements.personalInfo}
                      onChange={() => handleAgreementChange('personalInfo')}
                      className="w-4 h-4 rounded"
                    />
                    <span className="text-gray-300 text-sm">
                      <span className="text-red-400">*</span> ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜
                    </span>
                  </label>
                  <button
                    type="button"
                    onClick={() => navigate('/privacy')}
                    className="text-blue-400 hover:text-blue-300 text-xs underline whitespace-nowrap"
                  >
                    ë‚´ìš©ë³´ê¸°
                  </button>
                </div>

                <label className="flex items-center gap-3 cursor-pointer">
                  <input
                    type="checkbox"
                    checked={agreements.marketing}
                    onChange={() => handleAgreementChange('marketing')}
                    className="w-4 h-4 rounded"
                  />
                  <span className="text-gray-300 text-sm">
                    (ì„ íƒ) ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹  ë™ì˜
                  </span>
                </label>
              </div>

              {errors.agreements && (
                <p className="mt-2 text-sm text-red-400 flex items-center gap-1">
                  <AlertCircle className="w-4 h-4" />
                  {errors.agreements}
                </p>
              )}
            </div>

            {/* ìˆ˜ì§‘ ì •ë³´ ì•ˆë‚´ */}
            <div className="bg-blue-500/20 border border-blue-400/30 rounded-lg p-4">
              <div className="flex items-center justify-between mb-2">
                <h3 className="text-white font-semibold text-sm">ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ì•ˆë‚´</h3>
                <button
                  type="button"
                  onClick={() => navigate('/privacy')}
                  className="text-blue-400 hover:text-blue-300 text-xs underline"
                >
                  ìì„¸íˆ ë³´ê¸°
                </button>
              </div>
              <ul className="text-gray-300 text-xs space-y-1">
                <li>â€¢ <span className="text-red-300">ìˆ˜ì§‘ ëª©ì :</span> íšŒì›ê°€ì… ë° ë³¸ì¸í™•ì¸</li>
                <li>â€¢ <span className="text-yellow-300">í•„ìˆ˜ í•­ëª©:</span> ì´ë¦„, ì„±ë³„, ì¶œìƒì—°ë„, ì¹´ì¹´ì˜¤ê³„ì •(ì „í™”ë²ˆí˜¸)</li>
                <li>â€¢ <span className="text-green-300">ì„ íƒ í•­ëª©:</span> ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹  ë™ì˜</li>
                <li>â€¢ <span className="text-purple-300">ë³´ìœ  ê¸°ê°„:</span> íšŒì› íƒˆí‡´ ì‹œê¹Œì§€</li>
                <li className="text-xs text-gray-400 pt-1">â€» ê°œì¸ì •ë³´ ì œê³µì— ë™ì˜í•˜ì§€ ì•Šì„ ê¶Œë¦¬ê°€ ìˆìœ¼ë©°, ë™ì˜ ê±°ë¶€ ì‹œ íšŒì›ê°€ì…ì´ ì œí•œë©ë‹ˆë‹¤.</li>
              </ul>
            </div>

            {/* ì œì¶œ ë²„íŠ¼ */}
            <button
              type="submit"
              disabled={isSubmitting}
              className="w-full py-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg font-bold text-lg hover:from-blue-700 hover:to-blue-800 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all shadow-lg"
            >
              {isSubmitting ? 'ì²˜ë¦¬ ì¤‘...' : 'íšŒì›ê°€ì… ì™„ë£Œ'}
            </button>

            {/* ì•ˆë‚´ ë¬¸êµ¬ */}
            <p className="text-center text-gray-400 text-sm">
              ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”?{' '}
              <button
                type="button"
                onClick={() => navigate('/')}
                className="text-blue-400 hover:text-blue-300 font-semibold"
              >
                ë¡œê·¸ì¸
              </button>
            </p>
          </form>
        </div>

       
        
      </div>
    </div>
  );
};

export default SignInPage;
</file>

<file path="src/pages/SuperAdminPage.jsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import useStore from '../store/useStore';
import spaceSettingsService from '../services/spaceSettingsService';
import spaceService from '../services/spaceService';
import adminSettingsService from '../services/adminSettingsService';
import { ArrowLeft, CheckCircle, XCircle, Clock, Shield, AlertTriangle, List, Trash2, Home, Mail, Save } from 'lucide-react';

// ìŠˆí¼ ì–´ë“œë¯¼ ì‚¬ìš©ì ID ëª©ë¡
const SUPER_ADMIN_IDS = [
  '3828221463', // ì–‘ì„í™˜
  // í•„ìš”ì‹œ ì¶”ê°€
];

export default function SuperAdminPage() {
  const navigate = useNavigate();
  const { user } = useStore();
  const [activeTab, setActiveTab] = useState('alimtalk-pending'); // 'alimtalk-pending' | 'alimtalk-active' | 'space-pending'
  const [requests, setRequests] = useState([]);
  const [activeSpaces, setActiveSpaces] = useState([]);
  const [spaceRequests, setSpaceRequests] = useState([]);
  const [loading, setLoading] = useState(true);
  const [processing, setProcessing] = useState(false);
  const [adminEmail, setAdminEmail] = useState('');
  const [spaceCreationNotifications, setSpaceCreationNotifications] = useState(true);
  const [savingSettings, setSavingSettings] = useState(false);

  // ìŠˆí¼ ì–´ë“œë¯¼ ê¶Œí•œ ì²´í¬
  useEffect(() => {
    if (!user) {
      alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
      navigate('/');
      return;
    }

    if (!SUPER_ADMIN_IDS.includes(user.id)) {
      alert('ìŠˆí¼ ê´€ë¦¬ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      navigate('/');
      return;
    }

    loadData();
  }, [user, navigate]);

  const loadData = async () => {
    try {
      setLoading(true);
      await Promise.all([
        loadRequests(),
        loadActiveSpaces(),
        loadSpaceRequests(),
        loadAdminSettings()
      ]);
    } catch (error) {
      console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
      alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setLoading(false);
    }
  };

  const loadAdminSettings = async () => {
    try {
      const settings = await adminSettingsService.getAdminEmailSettings();
      setAdminEmail(settings.adminEmail || '');
      setSpaceCreationNotifications(settings.spaceCreationNotifications !== false);
    } catch (error) {
      console.error('ì–´ë“œë¯¼ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
    }
  };

  const loadRequests = async () => {
    try {
      const data = await spaceSettingsService.getPendingAlimtalkRequests();
      setRequests(data);
    } catch (error) {
      console.error('ì‹ ì²­ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
      throw error;
    }
  };

  const loadActiveSpaces = async () => {
    try {
      const data = await spaceSettingsService.getActiveAlimtalkSpaces();
      setActiveSpaces(data);
    } catch (error) {
      console.error('í™œì„± ìŠ¤í˜ì´ìŠ¤ ë¡œë“œ ì‹¤íŒ¨:', error);
      throw error;
    }
  };

  const loadSpaceRequests = async () => {
    try {
      const data = await spaceService.getPendingSpaceRequests();
      setSpaceRequests(data);
    } catch (error) {
      console.error('ë°© ìƒì„± ì‹ ì²­ ë¡œë“œ ì‹¤íŒ¨:', error);
      throw error;
    }
  };

  // ìŠ¹ì¸
  const handleApprove = async (request) => {
    const confirmed = window.confirm(
      `${request.spaceName}ì˜ ì•Œë¦¼í†¡ í™œì„±í™”ë¥¼ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`
    );
    if (!confirmed) return;

    try {
      setProcessing(true);
      await spaceSettingsService.approveAlimtalkRequest(
        request.id,
        request.spaceId,
        user.id,
        user.displayName || user.name
      );

      alert('ì•Œë¦¼í†¡ í™œì„±í™”ê°€ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
      await loadData();
    } catch (error) {
      console.error('ìŠ¹ì¸ ì‹¤íŒ¨:', error);
      alert('ìŠ¹ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
      setProcessing(false);
    }
  };

  // ë¹„í™œì„±í™”
  const handleDeactivate = async (space) => {
    const reason = window.prompt(
      `${space.spaceName}ì˜ ì•Œë¦¼í†¡ì„ ë¹„í™œì„±í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\në¹„í™œì„±í™” ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”:`
    );

    if (reason === null) return; // ì·¨ì†Œ
    if (!reason.trim()) {
      alert('ë¹„í™œì„±í™” ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    try {
      setProcessing(true);
      await spaceSettingsService.superAdminDeactivateAlimtalk(
        space.spaceId,
        user.id,
        user.displayName || user.name,
        reason.trim()
      );

      alert('ì•Œë¦¼í†¡ì´ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
      await loadData();
    } catch (error) {
      console.error('ë¹„í™œì„±í™” ì‹¤íŒ¨:', error);
      alert('ë¹„í™œì„±í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
      setProcessing(false);
    }
  };

  // ê±°ë¶€
  const handleReject = async (request) => {
    const reason = window.prompt(
      `${request.spaceName}ì˜ ì•Œë¦¼í†¡ í™œì„±í™”ë¥¼ ê±°ë¶€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nê±°ë¶€ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”:`
    );

    if (reason === null) return; // ì·¨ì†Œ
    if (!reason.trim()) {
      alert('ê±°ë¶€ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    try {
      setProcessing(true);
      await spaceSettingsService.rejectAlimtalkRequest(
        request.id,
        request.spaceId,
        user.id,
        user.displayName || user.name,
        reason.trim()
      );

      alert('ì•Œë¦¼í†¡ í™œì„±í™”ê°€ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.');
      await loadData();
    } catch (error) {
      console.error('ê±°ë¶€ ì‹¤íŒ¨:', error);
      alert('ê±°ë¶€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
      setProcessing(false);
    }
  };

  // ë°© ìƒì„± ì‹ ì²­ ìŠ¹ì¸
  const handleApproveSpace = async (request) => {
    const confirmed = window.confirm(
      `${request.spaceName} ë°© ìƒì„±ì„ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\në°© ì½”ë“œ: ${request.spaceCode}`
    );
    if (!confirmed) return;

    try {
      setProcessing(true);
      await spaceService.approveSpaceCreationRequest(
        request.id,
        request.spaceCode,
        request.spaceName,
        user.id,
        user.displayName || user.name
      );

      alert(`ë°© ìƒì„±ì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.\në°© ì½”ë“œ: ${request.spaceCode}`);
      await loadData();
    } catch (error) {
      console.error('ìŠ¹ì¸ ì‹¤íŒ¨:', error);
      alert('ìŠ¹ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
      setProcessing(false);
    }
  };

  // ë°© ìƒì„± ì‹ ì²­ ê±°ë¶€
  const handleRejectSpace = async (request) => {
    const reason = window.prompt(
      `${request.spaceName} ë°© ìƒì„± ì‹ ì²­ì„ ê±°ë¶€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nê±°ë¶€ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”:`
    );

    if (reason === null) return; // ì·¨ì†Œ
    if (!reason.trim()) {
      alert('ê±°ë¶€ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    try {
      setProcessing(true);
      await spaceService.rejectSpaceCreationRequest(
        request.id,
        user.id,
        user.displayName || user.name,
        reason.trim()
      );

      alert('ë°© ìƒì„± ì‹ ì²­ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.');
      await loadData();
    } catch (error) {
      console.error('ê±°ë¶€ ì‹¤íŒ¨:', error);
      alert('ê±°ë¶€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
      setProcessing(false);
    }
  };

  // ì–´ë“œë¯¼ ì´ë©”ì¼ ì„¤ì • ì €ì¥
  const handleSaveAdminSettings = async () => {
    try {
      setSavingSettings(true);
      await adminSettingsService.updateAdminEmailSettings({
        adminEmail: adminEmail.trim(),
        spaceCreationNotifications
      });
      alert('ì–´ë“œë¯¼ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
    } catch (error) {
      console.error('ì„¤ì • ì €ì¥ ì‹¤íŒ¨:', error);
      alert('ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setSavingSettings(false);
    }
  };

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900">
        <div className="text-center">
          <div className="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-slate-300">ì‹ ì²­ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 pb-20">
      {/* í—¤ë” */}
      <div className="bg-gradient-to-r from-slate-800 to-slate-700 border-b border-slate-600/30 sticky top-0 z-10 shadow-lg">
        <div className="max-w-4xl mx-auto px-4 py-4">
          <div className="flex items-center gap-3">
            <button
              onClick={() => navigate('/')}
              className="p-2 hover:bg-white/10 rounded-lg transition-colors"
            >
              <ArrowLeft className="w-5 h-5 text-white" />
            </button>
            <div>
              <h1 className="text-xl font-bold text-white flex items-center gap-2">
                <Shield className="w-5 h-5 text-yellow-400" />
                ìŠˆí¼ ê´€ë¦¬ì í˜ì´ì§€
              </h1>
              <p className="text-sm text-slate-300">ì•Œë¦¼í†¡ í™œì„±í™” ì‹ ì²­ ê´€ë¦¬</p>
            </div>
          </div>
        </div>
      </div>

      {/* íƒ­ ë©”ë‰´ */}
      <div className="max-w-4xl mx-auto px-4 py-6">
        <div className="grid grid-cols-3 gap-2 mb-6">
          <button
            onClick={() => setActiveTab('alimtalk-pending')}
            className={`py-3 px-3 rounded-lg font-medium transition-all ${
              activeTab === 'alimtalk-pending'
                ? 'bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg'
                : 'bg-slate-800/50 text-slate-400 hover:bg-slate-700/50'
            }`}
          >
            <div className="flex flex-col items-center gap-1">
              <Clock className="w-5 h-5" />
              <span className="text-xs">ì•Œë¦¼í†¡ ëŒ€ê¸°</span>
              {requests.length > 0 && (
                <span className="bg-white/20 px-2 py-0.5 rounded-full text-xs">
                  {requests.length}
                </span>
              )}
            </div>
          </button>

          <button
            onClick={() => setActiveTab('alimtalk-active')}
            className={`py-3 px-3 rounded-lg font-medium transition-all ${
              activeTab === 'alimtalk-active'
                ? 'bg-gradient-to-r from-green-500 to-green-600 text-white shadow-lg'
                : 'bg-slate-800/50 text-slate-400 hover:bg-slate-700/50'
            }`}
          >
            <div className="flex flex-col items-center gap-1">
              <List className="w-5 h-5" />
              <span className="text-xs">ì•Œë¦¼í†¡ í™œì„±</span>
              {activeSpaces.length > 0 && (
                <span className="bg-white/20 px-2 py-0.5 rounded-full text-xs">
                  {activeSpaces.length}
                </span>
              )}
            </div>
          </button>

          <button
            onClick={() => setActiveTab('space-pending')}
            className={`py-3 px-3 rounded-lg font-medium transition-all ${
              activeTab === 'space-pending'
                ? 'bg-gradient-to-r from-purple-500 to-purple-600 text-white shadow-lg'
                : 'bg-slate-800/50 text-slate-400 hover:bg-slate-700/50'
            }`}
          >
            <div className="flex flex-col items-center gap-1">
              <Home className="w-5 h-5" />
              <span className="text-xs">ë°© ìƒì„± ëŒ€ê¸°</span>
              {spaceRequests.length > 0 && (
                <span className="bg-white/20 px-2 py-0.5 rounded-full text-xs">
                  {spaceRequests.length}
                </span>
              )}
            </div>
          </button>
        </div>

        {/* ì•Œë¦¼í†¡ ëŒ€ê¸° ì¤‘ì¸ ì‹ ì²­ íƒ­ */}
        {activeTab === 'alimtalk-pending' && (
          <div>
            <div className="mb-4 flex items-center justify-between">
              <div className="flex items-center gap-2 text-slate-300">
                <Clock className="w-5 h-5" />
                <span className="font-medium">ëŒ€ê¸° ì¤‘ì¸ ì‹ ì²­ {requests.length}ê±´</span>
              </div>
            </div>

        {requests.length === 0 ? (
          <div className="bg-slate-800/50 border border-slate-600/30 rounded-xl p-8 text-center">
            <Clock className="w-12 h-12 text-slate-400 mx-auto mb-3" />
            <p className="text-slate-300 font-medium">ëŒ€ê¸° ì¤‘ì¸ ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤</p>
            <p className="text-sm text-slate-400 mt-2">
              ìƒˆë¡œìš´ ì•Œë¦¼í†¡ í™œì„±í™” ì‹ ì²­ì´ ë“¤ì–´ì˜¤ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
            </p>
          </div>
        ) : (
          <div className="space-y-4">
            {requests.map((request) => (
              <div
                key={request.id}
                className="bg-gradient-to-br from-slate-800/80 to-slate-700/50 backdrop-blur-sm border border-slate-600/30 rounded-xl p-5 shadow-lg"
              >
                <div className="flex items-start justify-between gap-4">
                  {/* ì‹ ì²­ ì •ë³´ */}
                  <div className="flex-1">
                    <h3 className="text-lg font-bold text-white mb-2">
                      {request.spaceName}
                    </h3>
                    
                    <div className="space-y-1 text-sm text-slate-300">
                      <p>
                        <span className="text-slate-400">ì‹ ì²­ì:</span>{' '}
                        {request.requestedBy?.displayName || 'ì•Œ ìˆ˜ ì—†ìŒ'}
                      </p>
                      <p>
                        <span className="text-slate-400">ê¶Œí•œ:</span>{' '}
                        {request.requestedBy?.userType === 'manager' ? 'ë§¤ë‹ˆì €' : 
                         request.requestedBy?.userType === 'vice-manager' ? 'ë¶€ë§¤ë‹ˆì €' : 'ì•Œ ìˆ˜ ì—†ìŒ'}
                      </p>
                      <p>
                        <span className="text-slate-400">ì‹ ì²­ì¼:</span>{' '}
                        {request.requestedAt?.toDate?.().toLocaleString('ko-KR') || 'ì•Œ ìˆ˜ ì—†ìŒ'}
                      </p>
                      <p>
                        <span className="text-slate-400">ìŠ¤í˜ì´ìŠ¤ ID:</span>{' '}
                        <code className="bg-slate-900/50 px-2 py-0.5 rounded text-xs">
                          {request.spaceId}
                        </code>
                      </p>
                    </div>
                  </div>

                  {/* ìŠ¹ì¸/ê±°ë¶€ ë²„íŠ¼ */}
                  <div className="flex flex-col gap-2">
                    <button
                      onClick={() => handleApprove(request)}
                      disabled={processing}
                      className="px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 whitespace-nowrap"
                    >
                      <CheckCircle className="w-4 h-4" />
                      <span>ìŠ¹ì¸</span>
                    </button>
                    
                    <button
                      onClick={() => handleReject(request)}
                      disabled={processing}
                      className="px-4 py-2 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-lg font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 whitespace-nowrap"
                    >
                      <XCircle className="w-4 h-4" />
                      <span>ê±°ë¶€</span>
                    </button>
                  </div>
                </div>
              </div>
            ))}
          </div>
        )}
          </div>
        )}

        {/* ì•Œë¦¼í†¡ í™œì„±í™”ëœ ìŠ¤í˜ì´ìŠ¤ íƒ­ */}
        {activeTab === 'alimtalk-active' && (
          <div>
            <div className="mb-4 flex items-center justify-between">
              <div className="flex items-center gap-2 text-slate-300">
                <List className="w-5 h-5" />
                <span className="font-medium">í™œì„±í™”ëœ ìŠ¤í˜ì´ìŠ¤ {activeSpaces.length}ê°œ</span>
              </div>
            </div>

            {activeSpaces.length === 0 ? (
              <div className="bg-slate-800/50 border border-slate-600/30 rounded-xl p-8 text-center">
                <List className="w-12 h-12 text-slate-400 mx-auto mb-3" />
                <p className="text-slate-300 font-medium">í™œì„±í™”ëœ ì•Œë¦¼í†¡ì´ ì—†ìŠµë‹ˆë‹¤</p>
                <p className="text-sm text-slate-400 mt-2">
                  ì•Œë¦¼í†¡ í™œì„±í™” ì‹ ì²­ì´ ìŠ¹ì¸ë˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                </p>
              </div>
            ) : (
              <div className="space-y-4">
                {activeSpaces.map((space) => (
                  <div
                    key={space.spaceId}
                    className="bg-gradient-to-br from-slate-800/80 to-slate-700/50 backdrop-blur-sm border border-slate-600/30 rounded-xl p-5 shadow-lg"
                  >
                    <div className="flex items-start justify-between gap-4">
                      {/* ìŠ¤í˜ì´ìŠ¤ ì •ë³´ */}
                      <div className="flex-1">
                        <h3 className="text-lg font-bold text-white mb-2">
                          {space.spaceName}
                        </h3>

                        <div className="space-y-1 text-sm text-slate-300">
                          <p>
                            <span className="text-slate-400">ìŠ¹ì¸ì:</span>{' '}
                            {space.alimtalkSettings.approvedBy?.displayName || 'ì•Œ ìˆ˜ ì—†ìŒ'}
                          </p>
                          <p>
                            <span className="text-slate-400">ìŠ¹ì¸ì¼:</span>{' '}
                            {space.alimtalkSettings.approvedAt?.toDate?.().toLocaleString('ko-KR') || 'ì•Œ ìˆ˜ ì—†ìŒ'}
                          </p>
                          <p>
                            <span className="text-slate-400">ì‹ ì²­ì:</span>{' '}
                            {space.alimtalkSettings.requestedBy?.displayName || 'ì•Œ ìˆ˜ ì—†ìŒ'}
                          </p>
                          <p>
                            <span className="text-slate-400">ìŠ¤í˜ì´ìŠ¤ ID:</span>{' '}
                            <code className="bg-slate-900/50 px-2 py-0.5 rounded text-xs">
                              {space.spaceId}
                            </code>
                          </p>
                        </div>
                      </div>

                      {/* ë¹„í™œì„±í™” ë²„íŠ¼ */}
                      <div>
                        <button
                          onClick={() => handleDeactivate(space)}
                          disabled={processing}
                          className="px-4 py-2 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-lg font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 whitespace-nowrap"
                        >
                          <Trash2 className="w-4 h-4" />
                          <span>ë¹„í™œì„±í™”</span>
                        </button>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>
        )}

        {/* ë°© ìƒì„± ëŒ€ê¸° íƒ­ */}
        {activeTab === 'space-pending' && (
          <div>
            <div className="mb-4 flex items-center justify-between">
              <div className="flex items-center gap-2 text-slate-300">
                <Home className="w-5 h-5" />
                <span className="font-medium">ëŒ€ê¸° ì¤‘ì¸ ë°© ìƒì„± ì‹ ì²­ {spaceRequests.length}ê±´</span>
              </div>
            </div>

            {spaceRequests.length === 0 ? (
              <div className="bg-slate-800/50 border border-slate-600/30 rounded-xl p-8 text-center">
                <Home className="w-12 h-12 text-slate-400 mx-auto mb-3" />
                <p className="text-slate-300 font-medium">ëŒ€ê¸° ì¤‘ì¸ ë°© ìƒì„± ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤</p>
                <p className="text-sm text-slate-400 mt-2">
                  ìƒˆë¡œìš´ ë°© ìƒì„± ì‹ ì²­ì´ ë“¤ì–´ì˜¤ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                </p>
              </div>
            ) : (
              <div className="space-y-4">
                {spaceRequests.map((request) => (
                  <div
                    key={request.id}
                    className="bg-gradient-to-br from-slate-800/80 to-slate-700/50 backdrop-blur-sm border border-slate-600/30 rounded-xl p-5 shadow-lg"
                  >
                    <div className="flex items-start justify-between gap-4">
                      {/* ì‹ ì²­ ì •ë³´ */}
                      <div className="flex-1">
                        <h3 className="text-lg font-bold text-white mb-2">
                          {request.spaceName}
                        </h3>

                        <div className="space-y-1 text-sm text-slate-300">
                          <p>
                            <span className="text-slate-400">ì‹ ì²­ì:</span>{' '}
                            {request.requestedBy?.displayName || 'ì•Œ ìˆ˜ ì—†ìŒ'}
                          </p>
                          <p>
                            <span className="text-slate-400">ì‹ ì²­ì¼:</span>{' '}
                            {request.requestedAt?.toDate?.().toLocaleString('ko-KR') || 'ì•Œ ìˆ˜ ì—†ìŒ'}
                          </p>
                          <p>
                            <span className="text-slate-400">ìƒì„±ë  ë°© ì½”ë“œ:</span>{' '}
                            <code className="bg-slate-900/50 px-2 py-0.5 rounded text-xs text-purple-300">
                              {request.spaceCode}
                            </code>
                          </p>
                        </div>
                      </div>

                      {/* ìŠ¹ì¸/ê±°ë¶€ ë²„íŠ¼ */}
                      <div className="flex flex-col gap-2">
                        <button
                          onClick={() => handleApproveSpace(request)}
                          disabled={processing}
                          className="px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 whitespace-nowrap"
                        >
                          <CheckCircle className="w-4 h-4" />
                          <span>ìŠ¹ì¸</span>
                        </button>

                        <button
                          onClick={() => handleRejectSpace(request)}
                          disabled={processing}
                          className="px-4 py-2 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-lg font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 whitespace-nowrap"
                        >
                          <XCircle className="w-4 h-4" />
                          <span>ê±°ë¶€</span>
                        </button>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>
        )}

        {/* ì–´ë“œë¯¼ ì´ë©”ì¼ ì„¤ì • */}
        <div className="mt-8 bg-gradient-to-br from-slate-800/80 to-slate-700/50 backdrop-blur-sm border border-slate-600/30 rounded-xl p-6 shadow-lg">
          <div className="flex items-center gap-2 mb-4">
            <Mail className="w-5 h-5 text-blue-400" />
            <h2 className="text-lg font-bold text-white">ì–´ë“œë¯¼ ì•Œë¦¼ ì„¤ì •</h2>
          </div>

          <div className="space-y-4">
            {/* ì´ë©”ì¼ ì£¼ì†Œ ì…ë ¥ */}
            <div>
              <label className="block text-sm font-medium text-slate-300 mb-2">
                ì•Œë¦¼ ìˆ˜ì‹  ì´ë©”ì¼ ì£¼ì†Œ
              </label>
              <input
                type="email"
                value={adminEmail}
                onChange={(e) => setAdminEmail(e.target.value)}
                placeholder="admin@example.com"
                className="w-full px-4 py-2 bg-slate-900/50 border border-slate-600/30 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-blue-500 transition-colors"
              />
              <p className="text-xs text-slate-400 mt-1">
                ë°© ìƒì„± ì‹ ì²­ ë“± ì¤‘ìš”í•œ ì•Œë¦¼ì„ ë°›ì„ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.
              </p>
            </div>

            {/* ë°© ìƒì„± ì‹ ì²­ ì•Œë¦¼ í† ê¸€ */}
            <div className="flex items-center justify-between py-2">
              <div>
                <p className="text-sm font-medium text-slate-300">ë°© ìƒì„± ì‹ ì²­ ì•Œë¦¼</p>
                <p className="text-xs text-slate-400">ìƒˆë¡œìš´ ë°© ìƒì„± ì‹ ì²­ ì‹œ ì´ë©”ì¼ë¡œ ì•Œë¦¼ì„ ë°›ìŠµë‹ˆë‹¤.</p>
              </div>
              <button
                onClick={() => setSpaceCreationNotifications(!spaceCreationNotifications)}
                className={`relative w-12 h-6 rounded-full transition-colors ${
                  spaceCreationNotifications ? 'bg-blue-500' : 'bg-slate-600'
                }`}
              >
                <div
                  className={`absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full transition-transform ${
                    spaceCreationNotifications ? 'translate-x-6' : 'translate-x-0'
                  }`}
                />
              </button>
            </div>

            {/* ì €ì¥ ë²„íŠ¼ */}
            <button
              onClick={handleSaveAdminSettings}
              disabled={savingSettings}
              className="w-full px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
            >
              <Save className="w-4 h-4" />
              <span>{savingSettings ? 'ì €ì¥ ì¤‘...' : 'ì„¤ì • ì €ì¥'}</span>
            </button>
          </div>
        </div>

        {/* ì•ˆë‚´ */}
        <div className="mt-6 bg-yellow-500/10 border border-yellow-500/30 rounded-xl p-4">
          <div className="flex items-start gap-3">
            <AlertTriangle className="w-5 h-5 text-yellow-400 flex-shrink-0 mt-0.5" />
            <div className="text-sm text-yellow-300">
              <p className="font-medium mb-2">âš ï¸ ìŠˆí¼ ê´€ë¦¬ì ì•ˆë‚´</p>
              {activeTab === 'alimtalk-pending' ? (
                <ul className="space-y-1 text-yellow-200/80">
                  <li>â€¢ ìŠ¹ì¸ ì‹œ í•´ë‹¹ ìŠ¤í˜ì´ìŠ¤ì˜ ì•Œë¦¼í†¡ì´ ì¦‰ì‹œ í™œì„±í™”ë©ë‹ˆë‹¤.</li>
                  <li>â€¢ ê±°ë¶€ ì‹œ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì•¼ í•˜ë©°, ì‹ ì²­ìê°€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                  <li>â€¢ ìŠ¹ì¸/ê±°ë¶€ëœ ì‹ ì²­ì€ ëª©ë¡ì—ì„œ ì‚¬ë¼ì§‘ë‹ˆë‹¤.</li>
                  <li>â€¢ ê±°ë¶€ëœ ê²½ìš°ì—ë„ ì¬ì‹ ì²­ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
                </ul>
              ) : activeTab === 'alimtalk-active' ? (
                <ul className="space-y-1 text-yellow-200/80">
                  <li>â€¢ í™œì„±í™”ëœ ìŠ¤í˜ì´ìŠ¤ì˜ ì•Œë¦¼í†¡ ë°œì†¡ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                  <li>â€¢ ë¹„í™œì„±í™” ì‹œ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì•¼ í•˜ë©°, ì¦‰ì‹œ ì•Œë¦¼í†¡ì´ ì¤‘ë‹¨ë©ë‹ˆë‹¤.</li>
                  <li>â€¢ ë¹„í™œì„±í™” í›„ì—ë„ ì¬ì‹ ì²­ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
                  <li>â€¢ ìŠ¹ì¸ì¼ê³¼ ì‹ ì²­ì ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                </ul>
              ) : (
                <ul className="space-y-1 text-yellow-200/80">
                  <li>â€¢ ìŠ¹ì¸ ì‹œ ë°©ì´ ì¦‰ì‹œ ìƒì„±ë˜ë©° ì‹ ì²­ìì—ê²Œ ì•Œë¦¼ì´ ê°‘ë‹ˆë‹¤.</li>
                  <li>â€¢ ì‹ ì²­ìëŠ” ìƒì„±ëœ ë°©ì˜ ìµœì´ˆ ë§¤ë‹ˆì €ë¡œ ìë™ ë°°ì •ë©ë‹ˆë‹¤.</li>
                  <li>â€¢ ê±°ë¶€ ì‹œ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì•¼ í•˜ë©°, ê±°ë¶€ëœ ê²½ìš°ì—ë„ ì¬ì‹ ì²­ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
                  <li>â€¢ ìƒì„±ë  ë°© ì½”ë“œëŠ” ìë™ìœ¼ë¡œ ìƒì„±ë˜ë©° ì¤‘ë³µ ì²´í¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</li>
                </ul>
              )}
            </div>
          </div>
        </div>
      </div>

      {/* ë¡œë”© ì˜¤ë²„ë ˆì´ */}
      {processing && (
        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
          <div className="bg-slate-800 rounded-xl p-6 shadow-2xl">
            <div className="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <p className="text-white text-center">ì²˜ë¦¬ ì¤‘...</p>
          </div>
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/services/praiseService.js">
// services/praiseService.js
import {
  collection,
  doc,
  setDoc,
  getDocs,
  getDoc,
  updateDoc,
  deleteDoc,
  query,
  where,
  orderBy,
  serverTimestamp,
  Timestamp
} from 'firebase/firestore';
import { db } from '../config/firebase';

/**
 * ì¹­ì°¬ ID ìƒì„±
 * í˜•ì‹: YYYYMMDD_HHMMSS_XXXX
 */
function generatePraiseId(eventDate) {
  const date = new Date(eventDate);
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  
  const now = new Date();
  const hours = String(now.getHours()).padStart(2, '0');
  const minutes = String(now.getMinutes()).padStart(2, '0');
  const seconds = String(now.getSeconds()).padStart(2, '0');
  
  const random = String(Math.floor(Math.random() * 10000)).padStart(4, '0');
  
  return `${year}${month}${day}_${hours}${minutes}${seconds}_${random}`;
}

const praiseService = {
  /**
   * ì¹­ì°¬ ë“±ë¡
   */
  async create(spaceId, data) {
    try {
      const id = generatePraiseId(data.eventDate);
      const docRef = doc(db, `spaces/${spaceId}/praises/${id}`);
      
      const praiseData = {
        id,
        userId: data.userId,
        userName: data.userName,
        animalEmoji: data.animalEmoji || '',
        nickname: data.nickname || data.userName,
        userType: data.userType,
        originalText: data.originalText,
        refinedText: data.refinedText,
        category: data.category || 'ê¸°íƒ€',
        itemName: data.itemName || null,
        imageUrl: data.imageUrl || null,
        eventDate: data.eventDate,
        status: 'pending',
        createdAt: serverTimestamp(),
        updatedAt: serverTimestamp()
      };

      await setDoc(docRef, praiseData);
      console.log('âœ… ì¹­ì°¬ ë¬¸ì„œ ìƒì„±:', id);

      // ì´ë©”ì¼ ì•Œë¦¼ ë°œì†¡
      try {
        const emailSettingsRef = doc(db, `spaces/${spaceId}/settings`, 'email');
        const emailSettingsDoc = await getDoc(emailSettingsRef);
        const emailSettings = emailSettingsDoc.exists() ? emailSettingsDoc.data() : null;

        if (emailSettings?.praise?.enabled && emailSettings.praise.recipients.length > 0) {
          console.log('ğŸ“§ ì¹­ì°¬ ì ‘ìˆ˜ ì´ë©”ì¼ ë°œì†¡ ì‹œì‘');

          // ìŠ¤í˜ì´ìŠ¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
          const spaceDocRef = doc(db, 'spaces', spaceId);
          const spaceDoc = await getDoc(spaceDocRef);
          const spaceData = spaceDoc.exists() ? spaceDoc.data() : {};

          const emailResponse = await fetch('/.netlify/functions/send-email', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              type: 'praise',
              userName: data.userName,
              category: data.category,
              itemName: data.itemName,
              originalText: data.originalText,
              refinedText: data.refinedText,
              imageUrl: data.imageUrl,
              eventDate: data.eventDate,
              spaceName: spaceData.name || 'ë¼ìš´ì§€',
              recipients: {
                to: emailSettings.praise.recipients[0],
                cc: emailSettings.praise.recipients.slice(1)
              }
            })
          });

          const emailResult = await emailResponse.json();
          console.log('âœ… ì¹­ì°¬ ì´ë©”ì¼ ë°œì†¡ ê²°ê³¼:', emailResult);
        } else {
          console.log('â„¹ï¸ ì¹­ì°¬ ì´ë©”ì¼ ì•Œë¦¼ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆê±°ë‚˜ ìˆ˜ì‹ ì ì—†ìŒ');
        }
      } catch (emailError) {
        console.error('âš ï¸ ì¹­ì°¬ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨ (ì¹­ì°¬ ë“±ë¡ì€ ì™„ë£Œë¨):', emailError);
      }

      return id;
    } catch (error) {
      console.error('âŒ ì¹­ì°¬ ìƒì„± ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ì¹­ì°¬ ëª©ë¡ ì¡°íšŒ
   */
  async list(spaceId, statusFilter = 'approved') {
    try {
      const praisesRef = collection(db, `spaces/${spaceId}/praises`);
      
      let q;
      if (statusFilter === 'all') {
        q = query(
          praisesRef,
          orderBy('createdAt', 'desc')
        );
      } else {
        q = query(
          praisesRef,
          where('status', '==', statusFilter),
          orderBy('createdAt', 'desc')
        );
      }

      const snapshot = await getDocs(q);
      const praises = snapshot.docs.map(doc => ({
        ...doc.data(),
        id: doc.id
      }));

      console.log(`âœ… ì¹­ì°¬ ëª©ë¡ ì¡°íšŒ: ${praises.length}ê°œ (filter: ${statusFilter})`);
      return praises;
    } catch (error) {
      console.error('âŒ ì¹­ì°¬ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ì¹­ì°¬ ìŠ¹ì¸
   */
  async approve(spaceId, praiseId, approverId) {
    try {
      const docRef = doc(db, `spaces/${spaceId}/praises/${praiseId}`);
      
      await updateDoc(docRef, {
        status: 'approved',
        approvedAt: serverTimestamp(),
        approvedBy: approverId,
        updatedAt: serverTimestamp()
      });

      console.log('âœ… ì¹­ì°¬ ìŠ¹ì¸:', praiseId);
    } catch (error) {
      console.error('âŒ ì¹­ì°¬ ìŠ¹ì¸ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ì¹­ì°¬ ê±°ë¶€
   */
  async reject(spaceId, praiseId) {
    try {
      const docRef = doc(db, `spaces/${spaceId}/praises/${praiseId}`);
      
      await updateDoc(docRef, {
        status: 'rejected',
        rejectedAt: serverTimestamp(),
        updatedAt: serverTimestamp()
      });

      console.log('âœ… ì¹­ì°¬ ê±°ë¶€:', praiseId);
    } catch (error) {
      console.error('âŒ ì¹­ì°¬ ê±°ë¶€ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ì¹­ì°¬ ìˆ˜ì •
   */
  async update(spaceId, praiseId, updates) {
    try {
      const docRef = doc(db, `spaces/${spaceId}/praises/${praiseId}`);
      
      await updateDoc(docRef, {
        ...updates,
        updatedAt: serverTimestamp()
      });

      console.log('âœ… ì¹­ì°¬ ìˆ˜ì •:', praiseId);
    } catch (error) {
      console.error('âŒ ì¹­ì°¬ ìˆ˜ì • ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * íŠ¹ì • ì¹­ì°¬ ì¡°íšŒ
   */
  async get(spaceId, praiseId) {
    try {
      const docRef = doc(db, `spaces/${spaceId}/praises/${praiseId}`);
      const docSnap = await getDoc(docRef);
      
      if (docSnap.exists()) {
        return { ...docSnap.data(), id: docSnap.id };
      }
      return null;
    } catch (error) {
      console.error('âŒ ì¹­ì°¬ ì¡°íšŒ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ì¹­ì°¬ ì‚­ì œ
   */
  async delete(spaceId, praiseId) {
    try {
      const docRef = doc(db, `spaces/${spaceId}/praises/${praiseId}`);
      await deleteDoc(docRef);
      
      console.log('âœ… ì¹­ì°¬ ì‚­ì œ:', praiseId);
    } catch (error) {
      console.error('âŒ ì¹­ì°¬ ì‚­ì œ ì‹¤íŒ¨:', error);
      throw error;
    }
  }
};

export default praiseService;
</file>

<file path="netlify/functions/settlement-auto-close.js">
// netlify/functions/settlement-auto-close.js
// ì •ì‚° ìë™ ë§ˆê° í•¨ìˆ˜
// ë§¤ì£¼ ì›”ìš”ì¼ 18:00ì— ì‹¤í–‰ë˜ì–´ì•¼ í•¨
// GitHub Actions ë˜ëŠ” ì™¸ë¶€ cron ì„œë¹„ìŠ¤ë¡œ í˜¸ì¶œ

const { initializeApp, cert } = require('firebase-admin/app');
const { getFirestore, Timestamp } = require('firebase-admin/firestore');

// Firebase Admin ì´ˆê¸°í™” (ê°œë³„ í™˜ê²½ë³€ìˆ˜ ì‚¬ìš©)
let adminApp;
let db;

try {
  // ê°œë³„ í™˜ê²½ë³€ìˆ˜ë¡œ ì„œë¹„ìŠ¤ ê³„ì • êµ¬ì„±
  const serviceAccount = {
    type: 'service_account',
    project_id: process.env.FIREBASE_PROJECT_ID,
    private_key_id: process.env.FIREBASE_PRIVATE_KEY_ID,
    private_key: process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g, '\n'),
    client_email: process.env.FIREBASE_CLIENT_EMAIL,
    client_id: process.env.FIREBASE_CLIENT_ID,
    auth_uri: 'https://accounts.google.com/o/oauth2/auth',
    token_uri: 'https://oauth2.googleapis.com/token',
    auth_provider_x509_cert_url: 'https://www.googleapis.com/oauth2/v1/certs',
    client_x509_cert_url: `https://www.googleapis.com/robot/v1/metadata/x509/${encodeURIComponent(process.env.FIREBASE_CLIENT_EMAIL)}`,
    universe_domain: 'googleapis.com'
  };

  adminApp = initializeApp({
    credential: cert(serviceAccount)
  });
  db = getFirestore(adminApp);
  console.log('âœ… Firebase Admin ì´ˆê¸°í™” ì„±ê³µ');
} catch (error) {
  console.error('âŒ Firebase Admin ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
}

/**
 * í•œêµ­ì‹œê°„(KST, UTC+9) ë³€í™˜
 */
const getKoreanTime = (date = new Date()) => {
  // UTC ì‹œê°„ì— 9ì‹œê°„ ì¶”ê°€í•˜ì—¬ í•œêµ­ì‹œê°„ìœ¼ë¡œ ë³€í™˜
  const utcTime = date.getTime();
  const kstOffset = 9 * 60 * 60 * 1000; // 9ì‹œê°„ì„ ë°€ë¦¬ì´ˆë¡œ
  return new Date(utcTime + kstOffset);
};

/**
 * ì£¼ì°¨ ID ìƒì„± (ISO Week)
 */
const getWeekId = (date = new Date()) => {
  const year = date.getFullYear();
  const startOfYear = new Date(year, 0, 1);
  const days = Math.floor((date - startOfYear) / (24 * 60 * 60 * 1000));
  const weekNumber = Math.ceil((days + startOfYear.getDay() + 1) / 7);

  return `${year}-W${String(weekNumber).padStart(2, '0')}`;
};

/**
 * ì£¼ì˜ ì‹œì‘ì¼/ì¢…ë£Œì¼ ê³„ì‚° (ì›”ìš”ì¼~ì¼ìš”ì¼)
 */
const getWeekRange = (date = new Date()) => {
  const day = date.getDay();
  const diff = date.getDate() - day + (day === 0 ? -6 : 1);

  const weekStart = new Date(date.setDate(diff));
  weekStart.setHours(0, 0, 0, 0);

  const weekEnd = new Date(weekStart);
  weekEnd.setDate(weekStart.getDate() + 6);
  weekEnd.setHours(23, 59, 59, 999);

  return { weekStart, weekEnd };
};

/**
 * ìŠ¤í˜ì´ìŠ¤ì˜ ì •ì‚° ìŠ¤ì¼€ì¤„ ì„¤ì •ì´ í˜„ì¬ ì‹œê°„ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
 * í•œêµ­ì‹œê°„(KST) ê¸°ì¤€ìœ¼ë¡œ ë¹„êµ
 */
const shouldSettleNow = (scheduleSettings) => {
  if (!scheduleSettings || !scheduleSettings.enabled) {
    return false;
  }

  // í•œêµ­ì‹œê°„ìœ¼ë¡œ ë³€í™˜
  const now = getKoreanTime();
  const [targetHour, targetMinute] = scheduleSettings.time.split(':').map(Number);

  // ì‹œê°„ ì²´í¬ (Â±5ë¶„ í—ˆìš©)
  const currentMinutes = now.getHours() * 60 + now.getMinutes();
  const targetMinutes = targetHour * 60 + targetMinute;
  const minuteDiff = Math.abs(currentMinutes - targetMinutes);

  if (minuteDiff > 5) {
    return false; // ì„¤ì • ì‹œê°„ì´ ì•„ë‹˜
  }

  // ì£¼ê¸°ë³„ ì²´í¬
  if (scheduleSettings.frequency === 'weekly') {
    return now.getDay() === scheduleSettings.weeklyDay;
  } else if (scheduleSettings.frequency === 'monthly') {
    return now.getDate() === scheduleSettings.monthlyDay;
  } else if (scheduleSettings.frequency === 'yearly') {
    return now.getMonth() + 1 === scheduleSettings.yearlyMonth &&
           now.getDate() === scheduleSettings.yearlyDay;
  }

  return false;
};

/**
 * ì •ì‚° ìë™ ë§ˆê°
 * ê° ìŠ¤í˜ì´ìŠ¤ì˜ ì„¤ì •ì„ ì°¸ì¡°í•˜ì—¬ ë§ˆê° ì‹œê°„ì´ ë˜ë©´ ì‹¤í–‰
 */
const autoCloseSettlements = async () => {
  const kstNow = getKoreanTime();
  console.log('ğŸ¤– ì •ì‚° ìë™ ë§ˆê° ì²´í¬ ì‹œì‘ (í•œêµ­ì‹œê°„):', kstNow.toISOString());

  // ëª¨ë“  ìŠ¤í˜ì´ìŠ¤ ì¡°íšŒ
  const spacesSnapshot = await db.collection('spaces').get();
  const results = [];

  for (const spaceDoc of spacesSnapshot.docs) {
    const spaceId = spaceDoc.id;
    const spaceName = spaceDoc.data().name || spaceId;

    try {
      console.log(`\nğŸ  ìŠ¤í˜ì´ìŠ¤: ${spaceName} (${spaceId})`);

      // ìŠ¤í˜ì´ìŠ¤ì˜ ì •ì‚° ì„¤ì • ì¡°íšŒ
      const settingsRef = db.collection('spaces').doc(spaceId).collection('settings').doc('settlement');
      const settingsDoc = await settingsRef.get();

      if (!settingsDoc.exists()) {
        console.log(`  â„¹ï¸ ì •ì‚° ì„¤ì • ì—†ìŒ (ìë™ ë§ˆê° ë¹„í™œì„±í™”)`);
        results.push({
          spaceId,
          spaceName,
          status: 'no_settings',
          message: 'ì •ì‚° ì„¤ì • ì—†ìŒ'
        });
        continue;
      }

      const scheduleSettings = settingsDoc.data();

      // ìë™ ë§ˆê°ì´ ë¹„í™œì„±í™”ëœ ê²½ìš° ìŠ¤í‚µ
      if (!scheduleSettings.enabled) {
        console.log(`  â¸ï¸ ìë™ ë§ˆê° ë¹„í™œì„±í™”`);
        results.push({
          spaceId,
          spaceName,
          status: 'disabled',
          message: 'ìë™ ë§ˆê° ë¹„í™œì„±í™”'
        });
        continue;
      }

      // í˜„ì¬ ì‹œê°„ì´ ì„¤ì •ëœ ë§ˆê° ì‹œê°„ì¸ì§€ í™•ì¸
      if (!shouldSettleNow(scheduleSettings)) {
        console.log(`  â° ë§ˆê° ì‹œê°„ ì•„ë‹˜ (ì„¤ì •: ${scheduleSettings.frequency} ${scheduleSettings.time})`);
        results.push({
          spaceId,
          spaceName,
          status: 'not_time',
          message: 'ë§ˆê° ì‹œê°„ ì•„ë‹˜'
        });
        continue;
      }

      console.log(`  âœ… ë§ˆê° ì‹œê°„ ì¼ì¹˜! ì •ì‚° ë§ˆê° ì‹œì‘...`);

      // ë§ˆê°í•  ì£¼ì°¨ ê³„ì‚° (í˜„ì¬ ì‹œì  ê¸°ì¤€ ì§€ë‚œ ì£¼ì°¨)
      const now = new Date();
      let targetWeek = new Date(now);

      // ì£¼ê¸°ì— ë”°ë¼ ë§ˆê°í•  ê¸°ê°„ ê²°ì •
      if (scheduleSettings.frequency === 'weekly') {
        // ì§€ë‚œ ì£¼ ë§ˆê°
        targetWeek.setDate(targetWeek.getDate() - 7);
      } else if (scheduleSettings.frequency === 'monthly') {
        // ì§€ë‚œ ë‹¬ ë§ˆê°
        targetWeek.setMonth(targetWeek.getMonth() - 1);
      } else if (scheduleSettings.frequency === 'yearly') {
        // ì§€ë‚œ í•´ ë§ˆê°
        targetWeek.setFullYear(targetWeek.getFullYear() - 1);
      }

      const targetWeekId = getWeekId(targetWeek);
      console.log(`  ğŸ“… ë§ˆê° ëŒ€ìƒ ì£¼ì°¨: ${targetWeekId}`);

      // ì •ì‚° ì¡°íšŒ
      const settlementRef = db.collection('spaces').doc(spaceId).collection('settlement').doc(targetWeekId);
      const settlementDoc = await settlementRef.get();

      if (!settlementDoc.exists()) {
        console.log(`  â„¹ï¸ ì •ì‚° ë°ì´í„° ì—†ìŒ`);
        results.push({
          spaceId,
          spaceName,
          status: 'no_data',
          message: 'ì •ì‚° ë°ì´í„° ì—†ìŒ'
        });
        continue;
      }

      const settlementData = settlementDoc.data();

      // ì´ë¯¸ ì •ì‚° ì™„ë£Œëœ ê²½ìš° ìŠ¤í‚µ
      if (settlementData.status === 'settled') {
        console.log(`  âœ“ ì´ë¯¸ ì •ì‚° ì™„ë£Œë¨`);
        results.push({
          spaceId,
          spaceName,
          status: 'already_settled',
          message: 'ì´ë¯¸ ì •ì‚° ì™„ë£Œ'
        });
        continue;
      }

      // ì •ì‚° ì™„ë£Œ ì²˜ë¦¬
      console.log(`  ğŸ”„ ì •ì‚° ë§ˆê° ì²˜ë¦¬ ì¤‘...`);
      await settlementRef.update({
        status: 'settled',
        settledAt: Timestamp.now(),
        autoSettled: true,
        settledBySchedule: scheduleSettings, // ì–´ë–¤ ìŠ¤ì¼€ì¤„ì— ì˜í•´ ë§ˆê°ë˜ì—ˆëŠ”ì§€ ê¸°ë¡
      });

      console.log(`  âœ… ì •ì‚° ë§ˆê° ì™„ë£Œ`);

      results.push({
        spaceId,
        spaceName,
        weekId: targetWeekId,
        status: 'settled',
        message: 'ìë™ ë§ˆê° ì„±ê³µ',
        participants: Object.keys(settlementData.participants || {}).length,
        totalAmount: settlementData.totalAmount || 0,
        schedule: `${scheduleSettings.frequency} ${scheduleSettings.time}`
      });

    } catch (error) {
      console.error(`  âŒ ì˜¤ë¥˜:`, error);
      results.push({
        spaceId,
        spaceName,
        status: 'error',
        message: error.message
      });
    }
  }

  return results;
};

/**
 * Netlify Scheduled Function Handler
 * Netlifyê°€ ìë™ìœ¼ë¡œ ë§¤ì‹œê°„ ì‹¤í–‰í•©ë‹ˆë‹¤ (netlify.toml ì„¤ì •)
 */
exports.handler = async (event) => {
  // Scheduled functionì€ event.bodyê°€ ì—†ìœ¼ë¯€ë¡œ ë”°ë¡œ ì²´í¬í•˜ì§€ ì•ŠìŒ
  const kstNow = getKoreanTime();
  console.log('ğŸ¤– Netlify Scheduled Function ì‹¤í–‰ (í•œêµ­ì‹œê°„):', kstNow.toISOString());

  try {
    const results = await autoCloseSettlements();

    const summary = {
      timestamp: new Date().toISOString(),
      totalSpaces: results.length,
      settled: results.filter(r => r.status === 'settled').length,
      alreadySettled: results.filter(r => r.status === 'already_settled').length,
      noData: results.filter(r => r.status === 'no_data').length,
      noSettings: results.filter(r => r.status === 'no_settings').length,
      disabled: results.filter(r => r.status === 'disabled').length,
      notTime: results.filter(r => r.status === 'not_time').length,
      errors: results.filter(r => r.status === 'error').length,
      results
    };

    console.log('\nğŸ“Š ìë™ ë§ˆê° ì²´í¬ ì™„ë£Œ:', summary);

    return {
      statusCode: 200,
      body: JSON.stringify(summary)
    };

  } catch (error) {
    console.error('âŒ ìë™ ë§ˆê° ì‹¤íŒ¨:', error);
    return {
      statusCode: 500,
      body: JSON.stringify({
        error: error.message,
        stack: error.stack
      })
    };
  }
};
</file>

<file path="src/components/common/BottomNav.jsx">
// components/common/BottomNav.jsx
import { Home, Heart, MountainSnow, Receipt, MoreHorizontal } from 'lucide-react';
import { Link, useLocation } from 'react-router-dom';

export default function BottomNav() {
  const location = useLocation();
  
  const isActive = (path) => {
    if (path === '/') {
      return location.pathname === '/';
    }
    return location.pathname.startsWith(path);
  };
  
  return (
    <nav 
      className="fixed bottom-0 left-0 right-0 z-40 bg-white border-t border-gray-200 shadow-lg"
      style={{ paddingBottom: 'env(safe-area-inset-bottom)' }}
    >
      <div className="max-w-[600px] mx-auto flex">
        <Link 
          to="/" 
          className={`flex-1 flex flex-col items-center justify-center gap-1 py-3 transition-all ${
            isActive('/') 
              ? 'text-blue-600 bg-blue-50' 
              : 'text-gray-500 hover:text-gray-700 hover:bg-gray-50'
          }`}
        >
          <Home size={22} strokeWidth={isActive('/') ? 2.5 : 2} />
          <span className={`text-xs ${isActive('/') ? 'font-bold' : 'font-normal'}`}>
            ì˜ˆì•½
          </span>
        </Link>
        
        <Link 
          to="/settlement" 
          className={`flex-1 flex flex-col items-center justify-center gap-1 py-3 transition-all ${
            isActive('/settlement') 
              ? 'text-blue-600 bg-blue-50' 
              : 'text-gray-500 hover:text-gray-700 hover:bg-gray-50'
          }`}
        >
          <Receipt size={22} strokeWidth={isActive('/settlement') ? 2.5 : 2} />
          <span className={`text-xs ${isActive('/settlement') ? 'font-bold' : 'font-normal'}`}>
            ì •ì‚°
          </span>
        </Link>
        
        <Link 
          to="/praise" 
          className={`flex-1 flex flex-col items-center justify-center gap-1 py-3 transition-all ${
            isActive('/praise') 
              ? 'text-blue-600 bg-blue-50' 
              : 'text-gray-500 hover:text-gray-700 hover:bg-gray-50'
          }`}
        >
          <Heart size={22} strokeWidth={isActive('/praise') ? 2.5 : 2} />
          <span className={`text-xs ${isActive('/praise') ? 'font-bold' : 'font-normal'}`}>
            ì¹­ì°¬
          </span>
        </Link>

        <Link
          to="/slopes"
          className={`flex-1 flex flex-col items-center justify-center gap-1 py-3 transition-all ${
            isActive('/slopes')
              ? 'text-blue-600 bg-blue-50'
              : 'text-gray-500 hover:text-gray-700 hover:bg-gray-50'
          }`}
        >
          <MountainSnow size={22} strokeWidth={isActive('/slopes') ? 2.5 : 2} />
          <span className={`text-xs ${isActive('/slopes') ? 'font-bold' : 'font-normal'}`}>
            ì˜¤í”ˆì •ë³´
          </span>
        </Link>

        <Link
          to="/more"
          className={`flex-1 flex flex-col items-center justify-center gap-1 py-3 transition-all ${
            isActive('/more')
              ? 'text-blue-600 bg-blue-50'
              : 'text-gray-500 hover:text-gray-700 hover:bg-gray-50'
          }`}
        >
          <MoreHorizontal size={22} strokeWidth={isActive('/more') ? 2.5 : 2} />
          <span className={`text-xs ${isActive('/more') ? 'font-bold' : 'font-normal'}`}>
            ë”ë³´ê¸°
          </span>
        </Link>
      </div>
    </nav>
  );
}
</file>

<file path="src/components/settings/EmailNotificationSettings.jsx">
// src/components/settings/EmailNotificationSettings.jsx
import { useState, useEffect } from 'react';
import { Mail, Plus, X, Save } from 'lucide-react';

const EmailNotificationSettings = ({ spaceId, settings, onSave }) => {
  const [emailSettings, setEmailSettings] = useState({
    reservation: {
      enabled: false,
      types: [],
      recipients: []
    },
    settlement: {
      enabled: false,
      recipients: []
    },
    praise: {
      enabled: false,
      recipients: []
    },
    expense: {
      enabled: false,
      recipients: []
    },
    bartender_order: {
      enabled: false,
      recipients: []
    }
  });

  const [newEmail, setNewEmail] = useState({
    reservation: '',
    settlement: '',
    praise: '',
    expense: '',
    bartender_order: ''
  });

  const [saving, setSaving] = useState(false);

  useEffect(() => {
    if (settings) {
      setEmailSettings(prev => ({
        reservation: {
          enabled: false,
          types: [],
          recipients: [],
          ...settings.reservation
        },
        settlement: {
          enabled: false,
          recipients: [],
          ...settings.settlement
        },
        praise: {
          enabled: false,
          recipients: [],
          ...settings.praise
        },
        expense: {
          enabled: false,
          recipients: [],
          ...settings.expense
        },
        bartender_order: {
          enabled: false,
          recipients: [],
          ...settings.bartender_order
        }
      }));
    }
  }, [settings]);

  // ì˜ˆì•½ íƒ€ì… í† ê¸€
  const toggleReservationType = (type) => {
    setEmailSettings(prev => ({
      ...prev,
      reservation: {
        ...prev.reservation,
        types: prev.reservation.types.includes(type)
          ? prev.reservation.types.filter(t => t !== type)
          : [...prev.reservation.types, type]
      }
    }));
  };

  // ì´ë©”ì¼ ì¶”ê°€
  const addEmail = (category) => {
    const email = newEmail[category].trim();
    if (!email) return;

    // ê°„ë‹¨í•œ ì´ë©”ì¼ ê²€ì¦
    if (!email.includes('@')) {
      alert('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    setEmailSettings(prev => ({
      ...prev,
      [category]: {
        ...prev[category],
        recipients: [...prev[category].recipients, email]
      }
    }));

    setNewEmail(prev => ({ ...prev, [category]: '' }));
  };

  // ì´ë©”ì¼ ì œê±°
  const removeEmail = (category, email) => {
    setEmailSettings(prev => ({
      ...prev,
      [category]: {
        ...prev[category],
        recipients: prev[category].recipients.filter(e => e !== email)
      }
    }));
  };

  // ì•Œë¦¼ í™œì„±í™” í† ê¸€
  const toggleEnabled = (category) => {
    setEmailSettings(prev => ({
      ...prev,
      [category]: {
        ...prev[category],
        enabled: !prev[category].enabled
      }
    }));
  };

  // ì €ì¥
  const handleSave = async () => {
    setSaving(true);
    try {
      await onSave(emailSettings);
      alert('ì´ë©”ì¼ ì•Œë¦¼ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
    } catch (error) {
      console.error('ì„¤ì • ì €ì¥ ì‹¤íŒ¨:', error);
      alert('ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setSaving(false);
    }
  };

  const reservationTypeLabels = {
    guest: 'ê²ŒìŠ¤íŠ¸',
    shareholder: 'ì£¼ì£¼',
    manager: 'ë§¤ë‹ˆì €',
    'vice-manager': 'ë¶€ë§¤ë‹ˆì €'
  };

  return (
    <div className="space-y-6">
      {/* í—¤ë” */}
      <div className="flex items-center justify-between">
        <div className="flex items-center gap-2">
          <Mail className="w-6 h-6 text-blue-600" />
          <h2 className="text-xl font-bold text-gray-900">ì´ë©”ì¼ ì•Œë¦¼ ì„¤ì •</h2>
        </div>
        <button
          onClick={handleSave}
          disabled={saving}
          className="flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white rounded-lg font-semibold transition-colors"
        >
          <Save className="w-4 h-4" />
          {saving ? 'ì €ì¥ ì¤‘...' : 'ì €ì¥'}
        </button>
      </div>

      <p className="text-sm text-gray-600">
        ê° ì•Œë¦¼ ìœ í˜•ë³„ë¡œ ì´ë©”ì¼ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„¤ì •ì´ ì—†ìœ¼ë©´ ê¸°ë³¸ì ìœ¼ë¡œ ì•Œë¦¼ì´ ë°œì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
      </p>

      {/* ì˜ˆì•½ ì•Œë¦¼ */}
      <div className="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
        <div className="flex items-center justify-between mb-4">
          <h3 className="text-lg font-bold text-gray-900">ğŸ“… ì˜ˆì•½ ì•Œë¦¼</h3>
          <label className="relative inline-flex items-center cursor-pointer">
            <input
              type="checkbox"
              checked={emailSettings.reservation.enabled}
              onChange={() => toggleEnabled('reservation')}
              className="sr-only peer"
            />
            <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
          </label>
        </div>

        <p className="text-sm text-gray-600 mb-4">
          ì˜ˆì•½ì´ ë“±ë¡ë  ë•Œ ì´ë©”ì¼ ì•Œë¦¼ì„ ë°›ìŠµë‹ˆë‹¤.
        </p>

        {emailSettings.reservation.enabled && (
          <>
            {/* ì˜ˆì•½ íƒ€ì… ì„ íƒ */}
            <div className="mb-4">
              <label className="block text-sm font-semibold text-gray-700 mb-2">
                ì•Œë¦¼ì„ ë°›ì„ ì˜ˆì•½ íƒ€ì…
              </label>
              <div className="flex flex-wrap gap-2">
                {Object.entries(reservationTypeLabels).map(([type, label]) => (
                  <button
                    key={type}
                    onClick={() => toggleReservationType(type)}
                    className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                      emailSettings.reservation.types.includes(type)
                        ? 'bg-blue-600 text-white'
                        : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                    }`}
                  >
                    {label}
                  </button>
                ))}
              </div>
            </div>

            {/* ìˆ˜ì‹ ì ëª©ë¡ */}
            <div>
              <label className="block text-sm font-semibold text-gray-700 mb-2">
                ìˆ˜ì‹ ì ì´ë©”ì¼
              </label>
              <div className="space-y-2 mb-3">
                {emailSettings.reservation.recipients.map((email, index) => (
                  <div
                    key={index}
                    className="flex items-center justify-between bg-gray-50 px-3 py-2 rounded-lg"
                  >
                    <span className="text-sm text-gray-700">{email}</span>
                    <button
                      onClick={() => removeEmail('reservation', email)}
                      className="text-red-600 hover:text-red-700"
                    >
                      <X className="w-4 h-4" />
                    </button>
                  </div>
                ))}
              </div>
              <div className="flex gap-2">
                <input
                  type="email"
                  value={newEmail.reservation}
                  onChange={(e) => setNewEmail(prev => ({ ...prev, reservation: e.target.value }))}
                  placeholder="ì´ë©”ì¼ ì£¼ì†Œ ì…ë ¥"
                  className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  onKeyPress={(e) => {
                    if (e.key === 'Enter') {
                      e.preventDefault();
                      addEmail('reservation');
                    }
                  }}
                />
                <button
                  onClick={() => addEmail('reservation')}
                  className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition-colors flex items-center gap-2"
                >
                  <Plus className="w-4 h-4" />
                  ì¶”ê°€
                </button>
              </div>
            </div>
          </>
        )}
      </div>

      {/* ê³µê¸ˆì •ì‚° ì•Œë¦¼ */}
      <div className="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
        <div className="flex items-center justify-between mb-4">
          <h3 className="text-lg font-bold text-gray-900">ğŸ’° ê³µê¸ˆì •ì‚° ì•Œë¦¼</h3>
          <label className="relative inline-flex items-center cursor-pointer">
            <input
              type="checkbox"
              checked={emailSettings.settlement.enabled}
              onChange={() => toggleEnabled('settlement')}
              className="sr-only peer"
            />
            <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
          </label>
        </div>

        <p className="text-sm text-gray-600 mb-4">
          ì˜ìˆ˜ì¦ì´ ì œì¶œë  ë•Œ ì´ë©”ì¼ ì•Œë¦¼ì„ ë°›ìŠµë‹ˆë‹¤.
        </p>

        {emailSettings.settlement.enabled && (
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-2">
              ìˆ˜ì‹ ì ì´ë©”ì¼
            </label>
            <div className="space-y-2 mb-3">
              {emailSettings.settlement.recipients.map((email, index) => (
                <div
                  key={index}
                  className="flex items-center justify-between bg-gray-50 px-3 py-2 rounded-lg"
                >
                  <span className="text-sm text-gray-700">{email}</span>
                  <button
                    onClick={() => removeEmail('settlement', email)}
                    className="text-red-600 hover:text-red-700"
                  >
                    <X className="w-4 h-4" />
                  </button>
                </div>
              ))}
            </div>
            <div className="flex gap-2">
              <input
                type="email"
                value={newEmail.settlement}
                onChange={(e) => setNewEmail(prev => ({ ...prev, settlement: e.target.value }))}
                placeholder="ì´ë©”ì¼ ì£¼ì†Œ ì…ë ¥"
                className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                onKeyPress={(e) => {
                  if (e.key === 'Enter') {
                    e.preventDefault();
                    addEmail('settlement');
                  }
                }}
              />
              <button
                onClick={() => addEmail('settlement')}
                className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition-colors flex items-center gap-2"
              >
                <Plus className="w-4 h-4" />
                ì¶”ê°€
              </button>
            </div>
          </div>
        )}
      </div>

      {/* ì¹­ì°¬ ì•Œë¦¼ */}
      <div className="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
        <div className="flex items-center justify-between mb-4">
          <h3 className="text-lg font-bold text-gray-900">ğŸŒŸ ì¹­ì°¬ ì•Œë¦¼</h3>
          <label className="relative inline-flex items-center cursor-pointer">
            <input
              type="checkbox"
              checked={emailSettings.praise.enabled}
              onChange={() => toggleEnabled('praise')}
              className="sr-only peer"
            />
            <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
          </label>
        </div>

        <p className="text-sm text-gray-600 mb-4">
          ì¹­ì°¬ì´ ì ‘ìˆ˜ë  ë•Œ ì´ë©”ì¼ ì•Œë¦¼ì„ ë°›ìŠµë‹ˆë‹¤.
        </p>

        {emailSettings.praise.enabled && (
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-2">
              ìˆ˜ì‹ ì ì´ë©”ì¼
            </label>
            <div className="space-y-2 mb-3">
              {emailSettings.praise.recipients.map((email, index) => (
                <div
                  key={index}
                  className="flex items-center justify-between bg-gray-50 px-3 py-2 rounded-lg"
                >
                  <span className="text-sm text-gray-700">{email}</span>
                  <button
                    onClick={() => removeEmail('praise', email)}
                    className="text-red-600 hover:text-red-700"
                  >
                    <X className="w-4 h-4" />
                  </button>
                </div>
              ))}
            </div>
            <div className="flex gap-2">
              <input
                type="email"
                value={newEmail.praise}
                onChange={(e) => setNewEmail(prev => ({ ...prev, praise: e.target.value }))}
                placeholder="ì´ë©”ì¼ ì£¼ì†Œ ì…ë ¥"
                className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                onKeyPress={(e) => {
                  if (e.key === 'Enter') {
                    e.preventDefault();
                    addEmail('praise');
                  }
                }}
              />
              <button
                onClick={() => addEmail('praise')}
                className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition-colors flex items-center gap-2"
              >
                <Plus className="w-4 h-4" />
                ì¶”ê°€
              </button>
            </div>
          </div>
        )}
      </div>

      {/* ìš´ì˜ë¹„ ì²­êµ¬ ì•Œë¦¼ */}
      <div className="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
        <div className="flex items-center justify-between mb-4">
          <h3 className="text-lg font-bold text-gray-900">ğŸ’¸ ìš´ì˜ë¹„ ì²­êµ¬ ì•Œë¦¼</h3>
          <label className="relative inline-flex items-center cursor-pointer">
            <input
              type="checkbox"
              checked={emailSettings.expense.enabled}
              onChange={() => toggleEnabled('expense')}
              className="sr-only peer"
            />
            <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
          </label>
        </div>

        <p className="text-sm text-gray-600 mb-4">
          ìš´ì˜ë¹„ ì²­êµ¬ê°€ ì œì¶œë  ë•Œ ì´ë©”ì¼ ì•Œë¦¼ì„ ë°›ìŠµë‹ˆë‹¤.
        </p>

        {emailSettings.expense.enabled && (
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-2">
              ìˆ˜ì‹ ì ì´ë©”ì¼
            </label>
            <div className="space-y-2 mb-3">
              {emailSettings.expense.recipients.map((email, index) => (
                <div
                  key={index}
                  className="flex items-center justify-between bg-gray-50 px-3 py-2 rounded-lg"
                >
                  <span className="text-sm text-gray-700">{email}</span>
                  <button
                    onClick={() => removeEmail('expense', email)}
                    className="text-red-600 hover:text-red-700"
                  >
                    <X className="w-4 h-4" />
                  </button>
                </div>
              ))}
            </div>
            <div className="flex gap-2">
              <input
                type="email"
                value={newEmail.expense}
                onChange={(e) => setNewEmail(prev => ({ ...prev, expense: e.target.value }))}
                placeholder="ì´ë©”ì¼ ì£¼ì†Œ ì…ë ¥"
                className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                onKeyPress={(e) => {
                  if (e.key === 'Enter') {
                    e.preventDefault();
                    addEmail('expense');
                  }
                }}
              />
              <button
                onClick={() => addEmail('expense')}
                className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition-colors flex items-center gap-2"
              >
                <Plus className="w-4 h-4" />
                ì¶”ê°€
              </button>
            </div>
          </div>
        )}
      </div>

      {/* ë°”í…ë” ì£¼ë¬¸ ì•Œë¦¼ */}
      <div className="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
        <div className="flex items-center justify-between mb-4">
          <h3 className="text-lg font-bold text-gray-900">ğŸ¸ ë°”í…ë” ì£¼ë¬¸ ì•Œë¦¼</h3>
          <label className="relative inline-flex items-center cursor-pointer">
            <input
              type="checkbox"
              checked={emailSettings.bartender_order.enabled}
              onChange={() => toggleEnabled('bartender_order')}
              className="sr-only peer"
            />
            <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
          </label>
        </div>

        <p className="text-sm text-gray-600 mb-4">
          ë°”í…ë” ì£¼ë¬¸ì´ ë“¤ì–´ì˜¬ ë•Œ ì´ë©”ì¼ ì•Œë¦¼ì„ ë°›ìŠµë‹ˆë‹¤.
        </p>

        {emailSettings.bartender_order.enabled && (
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-2">
              ìˆ˜ì‹ ì ì´ë©”ì¼
            </label>
            <div className="space-y-2 mb-3">
              {emailSettings.bartender_order.recipients.map((email, index) => (
                <div
                  key={index}
                  className="flex items-center justify-between bg-gray-50 px-3 py-2 rounded-lg"
                >
                  <span className="text-sm text-gray-700">{email}</span>
                  <button
                    onClick={() => removeEmail('bartender_order', email)}
                    className="text-red-600 hover:text-red-700"
                  >
                    <X className="w-4 h-4" />
                  </button>
                </div>
              ))}
            </div>
            <div className="flex gap-2">
              <input
                type="email"
                value={newEmail.bartender_order}
                onChange={(e) => setNewEmail(prev => ({ ...prev, bartender_order: e.target.value }))}
                placeholder="ì´ë©”ì¼ ì£¼ì†Œ ì…ë ¥"
                className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                onKeyPress={(e) => {
                  if (e.key === 'Enter') {
                    e.preventDefault();
                    addEmail('bartender_order');
                  }
                }}
              />
              <button
                onClick={() => addEmail('bartender_order')}
                className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition-colors flex items-center gap-2"
              >
                <Plus className="w-4 h-4" />
                ì¶”ê°€
              </button>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

export default EmailNotificationSettings;
</file>

<file path="src/pages/MorePage.jsx">
// src/pages/MorePage.jsx
import { useNavigate } from 'react-router-dom';
import {
  Settings2,
  Wallet,
  Share2,
  UserCog,
  FileText,
  Shield,
  ShieldCheck,
  LogOut,
  UserMinus,
  ChevronRight,
  CalendarClock,
  TestTube,
  BookOpen,
  Users,
  Play,
  Coffee
} from 'lucide-react';
import { useAuth } from '../hooks/useAuth';
import useStore from '../store/useStore';
import { canManageSpace } from '../utils/permissions';
import { USER_TYPE_LABELS } from '../utils/constants';
import LoginOverlay from '../components/auth/LoginOverlay';
import { useTour } from '../contexts/TourContext';
import { TOUR_IDS, tours } from '../data/tourData';

const MorePage = () => {
  const navigate = useNavigate();
  const { user, isLoggedIn, logout } = useAuth();
  const { selectedSpace } = useStore();
  const { startTour, isTourCompleted } = useTour();

  if (!isLoggedIn) {
    return <LoginOverlay />;
  }

  const handleShare = async () => {
    const spaceId = selectedSpace?.id || selectedSpace?.spaceId;

    if (!spaceId) {
      alert('ìŠ¤í˜ì´ìŠ¤ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
      return;
    }

    const inviteLink = `${window.location.origin}/join/${spaceId}`;

    // ëª¨ë°”ì¼ ëŒ€ì‘: textareaë¥¼ ì‚¬ìš©í•œ ë³µì‚¬
    try {
      if (navigator.clipboard && window.isSecureContext) {
        // ìµœì‹  ë¸Œë¼ìš°ì €
        await navigator.clipboard.writeText(inviteLink);
        alert('ì´ˆëŒ€ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
      } else {
        // êµ¬í˜• ë¸Œë¼ìš°ì €/ëª¨ë°”ì¼ ëŒ€ì‘
        const textArea = document.createElement('textarea');
        textArea.value = inviteLink;
        textArea.style.position = 'fixed';
        textArea.style.left = '-999999px';
        textArea.style.top = '-999999px';
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        document.execCommand('copy');
        textArea.remove();
        alert('ì´ˆëŒ€ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
      }
    } catch (err) {
      console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
      // ë³µì‚¬ ì‹¤íŒ¨ ì‹œ ë§í¬ ì§ì ‘ í‘œì‹œ
      setTimeout(() => {
        alert(`ì´ ë§í¬ë¥¼ ë³µì‚¬í•˜ì„¸ìš”:\n${inviteLink}`);
      }, 100);
    }
  };

  const handleLogout = () => {
    if (window.confirm('ì •ë§ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      logout();
      navigate('/');
    }
  };

  const handleWithdraw = () => {
    if (window.confirm('ì •ë§ íšŒì› íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ë©° ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
      alert('íšŒì› íƒˆí‡´ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
    }
  };

  // ë©”ë‰´ ì•„ì´í…œ ì»´í¬ë„ŒíŠ¸
  const MenuItem = ({ icon: Icon, label, onClick, variant = 'default' }) => {
    const colorClass = variant === 'danger' ? 'text-red-600 hover:bg-red-50 active:bg-red-100' :
                      variant === 'admin' ? 'text-purple-700 hover:bg-purple-50 active:bg-purple-100' :
                      'text-gray-700 hover:bg-blue-50 active:bg-blue-100';
    const iconBgClass = variant === 'danger' ? 'bg-red-50' :
                       variant === 'admin' ? 'bg-purple-50' :
                       'bg-blue-50';
    const iconColorClass = variant === 'danger' ? 'text-red-600' :
                          variant === 'admin' ? 'text-purple-600' :
                          'text-blue-600';

    return (
      <button
        onClick={onClick}
        className={`w-full flex items-center justify-between p-4 bg-white rounded-2xl border border-gray-100 transition-all hover:shadow-md hover:border-transparent ${colorClass}`}
      >
        <div className="flex items-center gap-4">
          <div className={`w-12 h-12 rounded-xl flex items-center justify-center ${iconBgClass}`}>
            <Icon className={`w-6 h-6 ${iconColorClass}`} />
          </div>
          <span className="font-semibold text-base">{label}</span>
        </div>
        <ChevronRight className="w-5 h-5 text-gray-400" />
      </button>
    );
  };

  return (
    <div className="min-h-screen bg-gradient-to-b from-gray-50 to-gray-100 pb-24">
      {/* í—¤ë” & í”„ë¡œí•„ */}
      <div className="bg-gradient-to-br from-blue-500 via-blue-600 to-blue-700 text-white">
        <div className="px-6 pt-6 pb-8">
          <h1 className="text-2xl font-bold mb-6">ë”ë³´ê¸°</h1>

          {/* í”„ë¡œí•„ ì„¹ì…˜ */}
          <div className="bg-white/10 backdrop-blur-md rounded-2xl p-4 border border-white/20 shadow-xl">
            <div className="flex items-center gap-3">
              {/* í”„ë¡œí•„ ì´ë¯¸ì§€ */}
              {user?.profileImage ? (
                <img
                  src={user.profileImage}
                  alt={user.displayName}
                  className="w-14 h-14 rounded-xl object-cover ring-2 ring-white/30"
                />
              ) : (
                <div className="w-14 h-14 rounded-xl bg-white/20 flex items-center justify-center ring-2 ring-white/30">
                  <span className="text-xl font-bold">{user?.displayName?.[0] || 'U'}</span>
                </div>
              )}

              {/* ì‚¬ìš©ì ì •ë³´ */}
              <div className="flex-1 min-w-0">
                <h2 className="text-lg font-bold mb-1 truncate">{user?.displayName || 'ì‚¬ìš©ì'}</h2>
                <div className="text-xs text-white/85 flex items-center gap-1.5">
                  <span className="truncate">{selectedSpace?.spaceName || 'ìŠ¤í˜ì´ìŠ¤'}</span>
                  <span className="text-white/50">â€¢</span>
                  <span className="font-medium">{selectedSpace?.userType && USER_TYPE_LABELS[selectedSpace.userType] || 'ê²ŒìŠ¤íŠ¸'}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* ë©”ë‰´ ì„¹ì…˜ */}
      <div className="px-4 pt-6 space-y-8 pb-4">
        {/* ìŠ¤í˜ì´ìŠ¤ ê´€ë¦¬ ë©”ë‰´ */}
        <div className="space-y-3">
          <h3 className="text-xs font-bold text-gray-500 uppercase tracking-wider px-3 mb-4">
            ìŠ¤í˜ì´ìŠ¤
          </h3>

          {/* ìŠ¤í˜ì´ìŠ¤ ê´€ë¦¬ (vice-manager, managerë§Œ) */}
          {selectedSpace?.userType && canManageSpace(selectedSpace.userType) && (
            <>
              <MenuItem
                icon={Settings2}
                label="ìŠ¤í˜ì´ìŠ¤ ê´€ë¦¬"
                onClick={() => navigate('/space/manage')}
              />

              <MenuItem
                icon={CalendarClock}
                label="ì •ì‚° ìë™í™” ì„¤ì •"
                onClick={() => navigate('/settlement/schedule')}
              />
            </>
          )}

          <MenuItem
            icon={Wallet}
            label="ê³µìš© ìš´ì˜ë¹„"
            onClick={() => navigate('/expenses')}
          />

          <MenuItem
            icon={Coffee}
            label="ë°”í…ë” ì£¼ë¬¸"
            onClick={() => navigate('/bartender/menu')}
          />

          <MenuItem
            icon={Share2}
            label="ì´ˆëŒ€ ì½”ë“œ ê³µìœ "
            onClick={handleShare}
          />
        </div>

        {/* ê°œì¸ ì„¤ì • ë©”ë‰´ */}
        <div className="space-y-3">
          <h3 className="text-xs font-bold text-gray-500 uppercase tracking-wider px-3 mb-4">
            ê°œì¸ ì„¤ì •
          </h3>

          <MenuItem
            icon={UserCog}
            label="ê°œì¸ì •ë³´ ìˆ˜ì •"
            onClick={() => alert('ê°œì¸ì •ë³´ ìˆ˜ì • ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.')}
          />

          <MenuItem
            icon={FileText}
            label="ì´ìš©ì•½ê´€"
            onClick={() => navigate('/terms')}
          />

          <MenuItem
            icon={Shield}
            label="ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨"
            onClick={() => navigate('/privacy')}
          />
        </div>

        {/* ì•± ì •ë³´ ë©”ë‰´ */}
        <div className="space-y-3">
          <h3 className="text-xs font-bold text-gray-500 uppercase tracking-wider px-3 mb-4">
            ì•± ì •ë³´
          </h3>

          <MenuItem
            icon={Users}
            label="ì‚¬ìš© ê°€ì´ë“œ"
            onClick={() => navigate('/user-guide')}
          />

          <MenuItem
            icon={BookOpen}
            label="ì•± ì†Œê°œ"
            onClick={() => navigate('/introduction')}
          />

          {/* íˆ¬ì–´ ë‹¤ì‹œë³´ê¸° */}
          <div className="bg-white rounded-2xl p-4 border border-gray-100">
            <h4 className="font-semibold text-gray-900 mb-3 flex items-center gap-2">
              <Play className="w-5 h-5 text-blue-600" />
              ê¸°ëŠ¥ ì•ˆë‚´ ë‹¤ì‹œë³´ê¸°
            </h4>
            <div className="space-y-2">
              {Object.values(tours).map((tour) => (
                <button
                  key={tour.id}
                  onClick={() => startTour(tour.id)}
                  className="w-full flex items-center justify-between p-3 bg-gray-50 hover:bg-blue-50 rounded-xl transition-colors group"
                >
                  <div className="flex-1 text-left">
                    <p className="font-medium text-gray-900 group-hover:text-blue-600 mb-1">
                      {tour.title}
                    </p>
                    <p className="text-xs text-gray-500">
                      {tour.description}
                    </p>
                  </div>
                  {isTourCompleted(tour.id) && (
                    <span className="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full font-medium ml-2">
                      ì™„ë£Œ
                    </span>
                  )}
                </button>
              ))}
            </div>
          </div>
        </div>

        {/* ìŠˆí¼ì–´ë“œë¯¼ ë©”ë‰´ */}
        {user?.isSuperAdmin && (
          <div className="space-y-3">
            <h3 className="text-xs font-bold text-gray-500 uppercase tracking-wider px-3 mb-4">
              ê´€ë¦¬ì
            </h3>

            <MenuItem
              icon={ShieldCheck}
              label="ìŠˆí¼ì–´ë“œë¯¼"
              onClick={() => navigate('/super-admin')}
              variant="admin"
            />

            <MenuItem
              icon={TestTube}
              label="í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±"
              onClick={() => navigate('/test-data')}
              variant="admin"
            />
          </div>
        )}

        {/* ê³„ì • ë©”ë‰´ */}
        <div className="space-y-3">
          <h3 className="text-xs font-bold text-gray-500 uppercase tracking-wider px-3 mb-4">
            ê³„ì •
          </h3>

          <MenuItem
            icon={LogOut}
            label="ë¡œê·¸ì•„ì›ƒ"
            onClick={handleLogout}
          />

          <MenuItem
            icon={UserMinus}
            label="íšŒì› íƒˆí‡´"
            onClick={handleWithdraw}
            variant="danger"
          />
        </div>
      </div>
    </div>
  );
};

export default MorePage;
</file>

<file path="src/services/expenseService.js">
import { 
  collection, 
  doc, 
  getDocs, 
  getDoc,
  setDoc,
  updateDoc,
  query, 
  where,
  orderBy,
  Timestamp
} from 'firebase/firestore';
import { db } from '../config/firebase';

/**
 * Expense ID ìƒì„± (íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜)
 * í˜•ì‹: YYYY-MM-DDTHHMM
 * ì˜ˆ: 2025-01-20T0549
 */
const generateExpenseId = (date = new Date()) => {
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  const hours = String(date.getHours()).padStart(2, '0');
  const minutes = String(date.getMinutes()).padStart(2, '0');
  
  return `${year}-${month}-${day}T${hours}${minutes}`;
};

const expenseService = {
  /**
   * ìŠ¤í˜ì´ìŠ¤ì˜ ëª¨ë“  ìš´ì˜ë¹„ ë‚´ì—­ ì¡°íšŒ
   */
  async getExpenses(spaceId) {
    try {
      console.log('ğŸ’° ìš´ì˜ë¹„ ë‚´ì—­ ì¡°íšŒ:', spaceId);
      
      const expenseRef = collection(db, 'spaces', spaceId, 'Expense');
      const q = query(expenseRef, orderBy('createdAt', 'desc'));
      const snapshot = await getDocs(q);
      
      const expenses = [];
      snapshot.forEach((doc) => {
        expenses.push({
          id: doc.id,
          ...doc.data(),
          createdAt: doc.data().createdAt?.toDate(),
          usedAt: doc.data().usedAt?.toDate(),
          approvedAt: doc.data().approvedAt?.toDate(),
          rejectedAt: doc.data().rejectedAt?.toDate(),
        });
      });
      
      console.log('âœ… ìš´ì˜ë¹„ ë‚´ì—­ ì¡°íšŒ ì™„ë£Œ:', expenses.length);
      return expenses;
    } catch (error) {
      console.error('âŒ ìš´ì˜ë¹„ ë‚´ì—­ ì¡°íšŒ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * íŠ¹ì • ìš´ì˜ë¹„ ìƒì„¸ ì¡°íšŒ
   */
  async getExpense(spaceId, expenseId) {
    try {
      console.log('ğŸ’° ìš´ì˜ë¹„ ìƒì„¸ ì¡°íšŒ:', { spaceId, expenseId });
      
      const expenseRef = doc(db, 'spaces', spaceId, 'Expense', expenseId);
      const snapshot = await getDoc(expenseRef);
      
      if (!snapshot.exists()) {
        throw new Error('ìš´ì˜ë¹„ ë‚´ì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }
      
      const data = {
        id: snapshot.id,
        ...snapshot.data(),
        createdAt: snapshot.data().createdAt?.toDate(),
        usedAt: snapshot.data().usedAt?.toDate(),
        approvedAt: snapshot.data().approvedAt?.toDate(),
        rejectedAt: snapshot.data().rejectedAt?.toDate(),
      };
      
      console.log('âœ… ìš´ì˜ë¹„ ìƒì„¸ ì¡°íšŒ ì™„ë£Œ');
      return data;
    } catch (error) {
      console.error('âŒ ìš´ì˜ë¹„ ìƒì„¸ ì¡°íšŒ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ìš´ì˜ë¹„ ì²­êµ¬ ìƒì„±
   * @param {string} spaceId - ìŠ¤í˜ì´ìŠ¤ ID
   * @param {Object} requestData - ì²­êµ¬ ë°ì´í„°
   * @param {string} requestData.userId - ì²­êµ¬ì ID
   * @param {string} requestData.userName - ì²­êµ¬ì ì´ë¦„
   * @param {Date} requestData.usedAt - ì‚¬ìš©ì¼ì
   * @param {string} requestData.memo - ì²­êµ¬ ì‚¬ìœ /ë©”ëª¨
   * @param {string} requestData.imageUrl - ì¦ë¹™ ì´ë¯¸ì§€ URL
   * @param {Array} requestData.items - í•­ëª© ë°°ì—´
   * @param {string} requestData.items[].itemName - í’ˆëª©ëª…
   * @param {number} requestData.items[].itemPrice - ë‹¨ê°€
   * @param {number} requestData.items[].itemQty - ìˆ˜ëŸ‰
   * @param {string} requestData.items[].itemSpec - ê·œê²©
   */
  async createExpense(spaceId, requestData) {
    try {
      console.log('ğŸ’° ìš´ì˜ë¹„ ì²­êµ¬ ìƒì„±:', { spaceId, requestData });
      
      const { userId, userName, usedAt, memo, items, imageUrl } = requestData;
      
      // ID ìƒì„± (í˜„ì¬ ì‹œê° ê¸°ì¤€)
      const now = new Date();
      const expenseId = generateExpenseId(now);
      const createdAt = Timestamp.fromDate(now);
      const usedAtTimestamp = Timestamp.fromDate(usedAt);
      
      // ì´ì•¡ ê³„ì‚°
      const totalAmount = items.reduce((sum, item) => {
        return sum + (item.itemPrice * item.itemQty);
      }, 0);
      
      // ë‹¨ì¼ ë¬¸ì„œë¡œ ìƒì„±
      const expenseRef = doc(db, 'spaces', spaceId, 'Expense', expenseId);
      const expenseData = {
        userId: userId,
        userName: userName,
        usedAt: usedAtTimestamp,
        createdAt: createdAt,
        memo: memo || '',
        imageUrl: imageUrl || '',
        items: items.map(item => ({
          itemName: item.itemName,
          itemPrice: item.itemPrice,
          itemQty: item.itemQty,
          itemSpec: item.itemSpec || '',
          total: item.itemPrice * item.itemQty,
        })),
        totalAmount: totalAmount,
        approved: false,
        status: 'pending',
        approvedAt: null,
        approvedBy: null,
        approvedByName: null,
        rejectedAt: null,
        rejectedBy: null,
        rejectedByName: null,
        rejectionReason: null,
      };
      
      await setDoc(expenseRef, expenseData);

      console.log('âœ… ìš´ì˜ë¹„ ì²­êµ¬ ìƒì„± ì™„ë£Œ:', expenseId);

      // ğŸ”¥ ì´ë©”ì¼ ì•Œë¦¼ ë°œì†¡
      try {
        console.log('ğŸ“§ ìš´ì˜ë¹„ ì²­êµ¬ ì´ë©”ì¼ ë°œì†¡ ì‹œì‘...');

        // ìŠ¤í˜ì´ìŠ¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const spaceDocRef = doc(db, 'spaces', spaceId);
        const spaceDoc = await getDoc(spaceDocRef);
        const spaceData = spaceDoc.exists() ? spaceDoc.data() : {};

        // ì´ë©”ì¼ ì•Œë¦¼ ì„¤ì • ê°€ì ¸ì˜¤ê¸°
        const emailSettingsRef = doc(db, `spaces/${spaceId}/settings`, 'email');
        const emailSettingsDoc = await getDoc(emailSettingsRef);
        const emailSettings = emailSettingsDoc.exists() ? emailSettingsDoc.data() : null;

        console.log('ì´ë©”ì¼ ì•Œë¦¼ ì„¤ì •:', emailSettings);

        if (emailSettings?.expense?.enabled && emailSettings.expense.recipients.length > 0) {
          console.log('ğŸ“§ ìš´ì˜ë¹„ ì²­êµ¬ ì´ë©”ì¼ ë°œì†¡ ì‹œì‘');

          const emailResponse = await fetch('/.netlify/functions/send-email', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              type: 'expense',
              userName: userName,
              usedAt: usedAt,
              createdAt: now,
              totalAmount: totalAmount,
              items: expenseData.items,
              memo: memo,
              imageUrl: imageUrl,
              spaceName: spaceData.name || 'ë¼ìš´ì§€',
              recipients: {
                to: emailSettings.expense.recipients[0],
                cc: emailSettings.expense.recipients.slice(1)
              }
            })
          });

          const emailResult = await emailResponse.json();
          console.log('âœ… ìš´ì˜ë¹„ ì²­êµ¬ ì´ë©”ì¼ ë°œì†¡ ê²°ê³¼:', emailResult);
        } else {
          console.log('â„¹ï¸ ìš´ì˜ë¹„ ì²­êµ¬ ì´ë©”ì¼ ì•Œë¦¼ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆê±°ë‚˜ ìˆ˜ì‹ ì ì—†ìŒ');
        }
      } catch (emailError) {
        console.error('âš ï¸ ìš´ì˜ë¹„ ì²­êµ¬ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨ (ì²­êµ¬ ë“±ë¡ì€ ì™„ë£Œë¨):', emailError);
      }

      return { id: expenseId, ...expenseData };
    } catch (error) {
      console.error('âŒ ìš´ì˜ë¹„ ì²­êµ¬ ìƒì„± ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ìš´ì˜ë¹„ ìŠ¹ì¸
   */
  async approveExpense(spaceId, expenseId, approverData) {
    try {
      console.log('âœ… ìš´ì˜ë¹„ ìŠ¹ì¸:', { spaceId, expenseId, approverData });
      
      const expenseRef = doc(db, 'spaces', spaceId, 'Expense', expenseId);
      
      await updateDoc(expenseRef, {
        approved: true,
        status: 'approved',
        approvedAt: Timestamp.fromDate(new Date()),
        approvedBy: approverData.approverId,
        approvedByName: approverData.approverName,
      });
      
      console.log('âœ… ìš´ì˜ë¹„ ìŠ¹ì¸ ì™„ë£Œ');
      return true;
    } catch (error) {
      console.error('âŒ ìš´ì˜ë¹„ ìŠ¹ì¸ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ìš´ì˜ë¹„ ê±°ë¶€
   */
  async rejectExpense(spaceId, expenseId, rejecterData, reason) {
    try {
      console.log('âŒ ìš´ì˜ë¹„ ê±°ë¶€:', { spaceId, expenseId, reason });
      
      const expenseRef = doc(db, 'spaces', spaceId, 'Expense', expenseId);
      
      await updateDoc(expenseRef, {
        approved: false,
        status: 'rejected',
        rejectedAt: Timestamp.fromDate(new Date()),
        rejectedBy: rejecterData.rejecterId,
        rejectedByName: rejecterData.rejecterName,
        rejectionReason: reason || 'ì‚¬ìœ  ì—†ìŒ',
      });
      
      console.log('âœ… ìš´ì˜ë¹„ ê±°ë¶€ ì™„ë£Œ');
      return true;
    } catch (error) {
      console.error('âŒ ìš´ì˜ë¹„ ê±°ë¶€ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ëŒ€ê¸°ì¤‘ì¸ ì²­êµ¬ ëª©ë¡ ì¡°íšŒ
   */
  async getPendingExpenses(spaceId) {
    try {
      console.log('â³ ëŒ€ê¸°ì¤‘ì¸ ì²­êµ¬ ì¡°íšŒ:', spaceId);
      
      const expenseRef = collection(db, 'spaces', spaceId, 'Expense');
      const q = query(
        expenseRef,
        where('status', '==', 'pending'),
        orderBy('createdAt', 'desc')
      );
      const snapshot = await getDocs(q);
      
      const expenses = [];
      snapshot.forEach((doc) => {
        expenses.push({
          id: doc.id,
          ...doc.data(),
          createdAt: doc.data().createdAt?.toDate(),
          usedAt: doc.data().usedAt?.toDate(),
        });
      });
      
      console.log('âœ… ëŒ€ê¸°ì¤‘ì¸ ì²­êµ¬ ì¡°íšŒ ì™„ë£Œ:', expenses.length);
      return expenses;
    } catch (error) {
      console.error('âŒ ëŒ€ê¸°ì¤‘ì¸ ì²­êµ¬ ì¡°íšŒ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ìŠ¹ì¸ëœ ì²­êµ¬ ëª©ë¡ ì¡°íšŒ
   */
  async getApprovedExpenses(spaceId) {
    try {
      console.log('âœ… ìŠ¹ì¸ëœ ì²­êµ¬ ì¡°íšŒ:', spaceId);
      
      const expenseRef = collection(db, 'spaces', spaceId, 'Expense');
      const q = query(
        expenseRef,
        where('status', '==', 'approved'),
        orderBy('approvedAt', 'desc')
      );
      const snapshot = await getDocs(q);
      
      const expenses = [];
      snapshot.forEach((doc) => {
        expenses.push({
          id: doc.id,
          ...doc.data(),
          createdAt: doc.data().createdAt?.toDate(),
          usedAt: doc.data().usedAt?.toDate(),
          approvedAt: doc.data().approvedAt?.toDate(),
        });
      });
      
      console.log('âœ… ìŠ¹ì¸ëœ ì²­êµ¬ ì¡°íšŒ ì™„ë£Œ:', expenses.length);
      return expenses;
    } catch (error) {
      console.error('âŒ ìŠ¹ì¸ëœ ì²­êµ¬ ì¡°íšŒ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ê±°ë¶€ëœ ì²­êµ¬ ëª©ë¡ ì¡°íšŒ
   */
  async getRejectedExpenses(spaceId) {
    try {
      console.log('âŒ ê±°ë¶€ëœ ì²­êµ¬ ì¡°íšŒ:', spaceId);
      
      const expenseRef = collection(db, 'spaces', spaceId, 'Expense');
      const q = query(
        expenseRef,
        where('status', '==', 'rejected'),
        orderBy('rejectedAt', 'desc')
      );
      const snapshot = await getDocs(q);
      
      const expenses = [];
      snapshot.forEach((doc) => {
        expenses.push({
          id: doc.id,
          ...doc.data(),
          createdAt: doc.data().createdAt?.toDate(),
          usedAt: doc.data().usedAt?.toDate(),
          rejectedAt: doc.data().rejectedAt?.toDate(),
        });
      });
      
      console.log('âœ… ê±°ë¶€ëœ ì²­êµ¬ ì¡°íšŒ ì™„ë£Œ:', expenses.length);
      return expenses;
    } catch (error) {
      console.error('âŒ ê±°ë¶€ëœ ì²­êµ¬ ì¡°íšŒ ì‹¤íŒ¨:', error);
      throw error;
    }
  },
};

export default expenseService;
</file>

<file path="netlify.toml">
[build]
  command = "npm run build"
  publish = "dist"
  functions = "netlify/functions"

[build.environment]
  NODE_VERSION = "18"

# Production í™˜ê²½ (main ë¸Œëœì¹˜) - ì½˜ì†” ë¡œê·¸ ì œê±°
[context.production.environment]
  VITE_DISABLE_CONSOLE = "true"

# Branch Deploy í™˜ê²½ (staging ë“±) - ì½˜ì†” ë¡œê·¸ ìœ ì§€
[context.branch-deploy.environment]
  VITE_DISABLE_CONSOLE = "false"

# Deploy Preview í™˜ê²½ (PR) - ì½˜ì†” ë¡œê·¸ ìœ ì§€
[context.deploy-preview.environment]
  VITE_DISABLE_CONSOLE = "false"

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

[functions]
  node_bundler = "esbuild"

# ì •ì‚° ìë™ ë§ˆê° - ë§¤ì‹œê°„ ì‹¤í–‰
[functions."settlement-auto-close"]
  schedule = "@hourly"
  [functions."settlement-auto-close".environment]
    FIREBASE_PROJECT_ID = "$FIREBASE_PROJECT_ID"
    FIREBASE_PRIVATE_KEY_ID = "$FIREBASE_PRIVATE_KEY_ID"
    FIREBASE_PRIVATE_KEY = "$FIREBASE_PRIVATE_KEY"
    FIREBASE_CLIENT_EMAIL = "$FIREBASE_CLIENT_EMAIL"
    FIREBASE_CLIENT_ID = "$FIREBASE_CLIENT_ID"

# ìš´ì˜ë¹„ ìŠ¹ì¸ ë…ë ¤ ë©”ì¼ - ë§¤ì¼ í•œêµ­ì‹œê°„ ì˜¤ì „ 10ì‹œ (UTC 01:00)
[functions."send-pending-expense-reminder"]
  schedule = "0 1 * * *"
  [functions."send-pending-expense-reminder".environment]
    FIREBASE_PROJECT_ID = "$FIREBASE_PROJECT_ID"
    FIREBASE_PRIVATE_KEY_ID = "$FIREBASE_PRIVATE_KEY_ID"
    FIREBASE_PRIVATE_KEY = "$FIREBASE_PRIVATE_KEY"
    FIREBASE_CLIENT_EMAIL = "$FIREBASE_CLIENT_EMAIL"
    FIREBASE_CLIENT_ID = "$FIREBASE_CLIENT_ID"

# ì´ë©”ì¼ ë°œì†¡
[functions."send-email"]
  [functions."send-email".environment]
    RESEND_API_KEY = "$RESEND_API_KEY"

# ì•Œë¦¼í†¡
[functions."send-alimtalk"]
  [functions."send-alimtalk".environment]
    NHN_API_URL = "$NHN_API_URL"
    NHN_APPKEY = "$NHN_APPKEY"
    NHN_SECRET_KEY = "$NHN_SECRET_KEY"
    NHN_SENDER_KEY = "$NHN_SENDER_KEY"
    NHN_PLUS_FRIEND_ID = "$NHN_PLUS_FRIEND_ID"
    NHN_TEMPLATE_GUEST_CONFIRM = "$NHN_TEMPLATE_GUEST_CONFIRM"

[functions."send-alimtalk-proxy"]
  [functions."send-alimtalk-proxy".environment]
    NHN_API_URL = "$NHN_API_URL"
    NHN_APPKEY = "$NHN_APPKEY"
    NHN_SECRET_KEY = "$NHN_SECRET_KEY"
    NHN_SENDER_KEY = "$NHN_SENDER_KEY"

# ì¹­ì°¬ ì²˜ë¦¬
[functions."process-praise"]
  [functions."process-praise".environment]
    OPENAI_API_KEY = "$OPENAI_API_KEY"

[functions."send-praise-notification"]
  [functions."send-praise-notification".environment]
    RESEND_API_KEY = "$RESEND_API_KEY"

[functions."send-notification"]
  [functions."send-notification".environment]
    RESEND_API_KEY = "$RESEND_API_KEY"
</file>

<file path="netlify/functions/send-pending-expense-reminder.js">
// netlify/functions/send-pending-expense-reminder.js
// ìš´ì˜ë¹„ ìŠ¹ì¸ ë…ë ¤ ë©”ì¼ ë°œì†¡
// ë§¤ì¼ í•œêµ­ì‹œê°„ ì˜¤ì „ 10ì‹œì— ì‹¤í–‰ë˜ì–´ì•¼ í•¨ (netlify.toml ì„¤ì •: UTC 01:00 = KST 10:00)

const { initializeApp, cert } = require('firebase-admin/app');
const { getFirestore } = require('firebase-admin/firestore');

// Firebase Admin ì´ˆê¸°í™” (ê°œë³„ í™˜ê²½ë³€ìˆ˜ ì‚¬ìš©)
let adminApp;
let db;

const initializeFirebase = () => {
  if (!adminApp) {
    try {
      // ê°œë³„ í™˜ê²½ë³€ìˆ˜ë¡œ ì„œë¹„ìŠ¤ ê³„ì • êµ¬ì„±
      const serviceAccount = {
        type: 'service_account',
        project_id: process.env.FIREBASE_PROJECT_ID,
        private_key_id: process.env.FIREBASE_PRIVATE_KEY_ID,
        private_key: process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g, '\n'),
        client_email: process.env.FIREBASE_CLIENT_EMAIL,
        client_id: process.env.FIREBASE_CLIENT_ID,
        auth_uri: 'https://accounts.google.com/o/oauth2/auth',
        token_uri: 'https://oauth2.googleapis.com/token',
        auth_provider_x509_cert_url: 'https://www.googleapis.com/oauth2/v1/certs',
        client_x509_cert_url: `https://www.googleapis.com/robot/v1/metadata/x509/${encodeURIComponent(process.env.FIREBASE_CLIENT_EMAIL)}`,
        universe_domain: 'googleapis.com'
      };

      adminApp = initializeApp({
        credential: cert(serviceAccount)
      });
      db = getFirestore(adminApp);
      console.log('âœ… Firebase Admin ì´ˆê¸°í™” ì„±ê³µ');
    } catch (error) {
      console.error('âŒ Firebase Admin ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
      throw error;
    }
  }
  return db;
};

/**
 * í•œêµ­ì‹œê°„(KST, UTC+9) ë³€í™˜
 */
const getKoreanTime = (date = new Date()) => {
  const utcTime = date.getTime();
  const kstOffset = 9 * 60 * 60 * 1000; // 9ì‹œê°„ì„ ë°€ë¦¬ì´ˆë¡œ
  return new Date(utcTime + kstOffset);
};

/**
 * ê° ìŠ¤í˜ì´ìŠ¤ì˜ pending ìš´ì˜ë¹„ ê±´ìˆ˜ í™•ì¸ ë° ë…ë ¤ ë©”ì¼ ë°œì†¡
 */
const sendPendingExpenseReminders = async () => {
  const kstNow = getKoreanTime();
  console.log('ğŸ“§ ìš´ì˜ë¹„ ë…ë ¤ ë©”ì¼ ë°œì†¡ ì²´í¬ ì‹œì‘ (í•œêµ­ì‹œê°„):', kstNow.toISOString());

  // Firebase ì´ˆê¸°í™”
  const firestore = initializeFirebase();

  // ëª¨ë“  ìŠ¤í˜ì´ìŠ¤ ì¡°íšŒ
  const spacesSnapshot = await firestore.collection('spaces').get();
  const results = [];

  for (const spaceDoc of spacesSnapshot.docs) {
    const spaceId = spaceDoc.id;
    const spaceName = spaceDoc.data().name || spaceId;

    try {
      console.log(`\nğŸ  ìŠ¤í˜ì´ìŠ¤: ${spaceName} (${spaceId})`);

      // ì´ë©”ì¼ ì•Œë¦¼ ì„¤ì • í™•ì¸
      const emailSettingsRef = firestore.collection('spaces').doc(spaceId).collection('settings').doc('email');
      const emailSettingsDoc = await emailSettingsRef.get();

      if (!emailSettingsDoc.exists) {
        console.log(`  â„¹ï¸ ì´ë©”ì¼ ì„¤ì • ì—†ìŒ`);
        results.push({
          spaceId,
          spaceName,
          status: 'no_email_settings',
          message: 'ì´ë©”ì¼ ì„¤ì • ì—†ìŒ'
        });
        continue;
      }

      const emailSettings = emailSettingsDoc.data();

      // expense ì•Œë¦¼ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆê±°ë‚˜ ìˆ˜ì‹ ìê°€ ì—†ìœ¼ë©´ ìŠ¤í‚µ
      if (!emailSettings?.expense?.enabled || !emailSettings.expense.recipients?.length) {
        console.log(`  â¸ï¸ ìš´ì˜ë¹„ ì´ë©”ì¼ ì•Œë¦¼ ë¹„í™œì„±í™” ë˜ëŠ” ìˆ˜ì‹ ì ì—†ìŒ`);
        results.push({
          spaceId,
          spaceName,
          status: 'email_disabled',
          message: 'ì´ë©”ì¼ ì•Œë¦¼ ë¹„í™œì„±í™”'
        });
        continue;
      }

      // pending ìƒíƒœì˜ expense ê±´ìˆ˜ ì¡°íšŒ
      const expenseSnapshot = await firestore.collection('spaces').doc(spaceId).collection('Expense')
        .where('status', '==', 'pending')
        .get();

      const pendingCount = expenseSnapshot.size;

      if (pendingCount === 0) {
        console.log(`  âœ“ ìŠ¹ì¸ ëŒ€ê¸°ì¤‘ì¸ ìš´ì˜ë¹„ ì—†ìŒ`);
        results.push({
          spaceId,
          spaceName,
          status: 'no_pending',
          message: 'ìŠ¹ì¸ ëŒ€ê¸°ì¤‘ì¸ ê±´ ì—†ìŒ'
        });
        continue;
      }

      console.log(`  ğŸ“¬ ìŠ¹ì¸ ëŒ€ê¸°ì¤‘ì¸ ìš´ì˜ë¹„ ${pendingCount}ê±´ ë°œê²¬ - ë…ë ¤ ë©”ì¼ ë°œì†¡ ì‹œì‘`);

      // ë…ë ¤ ë©”ì¼ ë°œì†¡
      try {
        const emailResponse = await fetch('https://loungeap.netlify.app/.netlify/functions/send-email', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            type: 'expense_reminder',
            spaceName: spaceName,
            pendingCount: pendingCount,
            recipients: {
              to: emailSettings.expense.recipients[0],
              cc: emailSettings.expense.recipients.slice(1)
            }
          })
        });

        if (emailResponse.ok) {
          const emailResult = await emailResponse.json();
          console.log(`  âœ… ë…ë ¤ ë©”ì¼ ë°œì†¡ ì„±ê³µ:`, emailResult);

          results.push({
            spaceId,
            spaceName,
            status: 'sent',
            message: 'ë…ë ¤ ë©”ì¼ ë°œì†¡ ì„±ê³µ',
            pendingCount: pendingCount,
            recipients: emailSettings.expense.recipients
          });
        } else {
          throw new Error(`Email API responded with status ${emailResponse.status}`);
        }
      } catch (emailError) {
        console.error(`  âš ï¸ ë…ë ¤ ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨:`, emailError);
        results.push({
          spaceId,
          spaceName,
          status: 'email_failed',
          message: `ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨: ${emailError.message}`,
          pendingCount: pendingCount
        });
      }

    } catch (error) {
      console.error(`  âŒ ì˜¤ë¥˜:`, error);
      results.push({
        spaceId,
        spaceName,
        status: 'error',
        message: error.message
      });
    }
  }

  return results;
};

/**
 * Netlify Scheduled Function Handler
 * ë§¤ì¼ í•œêµ­ì‹œê°„ ì˜¤ì „ 10ì‹œì— ì‹¤í–‰ (UTC 01:00)
 */
exports.handler = async (event) => {
  const kstNow = getKoreanTime();
  console.log('ğŸ“§ Netlify ë…ë ¤ ë©”ì¼ Scheduled Function ì‹¤í–‰ (í•œêµ­ì‹œê°„):', kstNow.toISOString());

  try {
    const results = await sendPendingExpenseReminders();

    const summary = {
      timestamp: kstNow.toISOString(),
      totalSpaces: results.length,
      sent: results.filter(r => r.status === 'sent').length,
      noPending: results.filter(r => r.status === 'no_pending').length,
      emailDisabled: results.filter(r => r.status === 'email_disabled').length,
      noEmailSettings: results.filter(r => r.status === 'no_email_settings').length,
      emailFailed: results.filter(r => r.status === 'email_failed').length,
      errors: results.filter(r => r.status === 'error').length,
      results
    };

    console.log('\nğŸ“Š ë…ë ¤ ë©”ì¼ ë°œì†¡ ì²´í¬ ì™„ë£Œ:', summary);

    return {
      statusCode: 200,
      body: JSON.stringify(summary)
    };

  } catch (error) {
    console.error('âŒ ë…ë ¤ ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨:', error);
    return {
      statusCode: 500,
      body: JSON.stringify({
        error: error.message,
        stack: error.stack
      })
    };
  }
};
</file>

<file path="src/components/auth/KakaoCallback.jsx">
// src/components/auth/KakaoCallback.jsx
import { useEffect, useRef } from 'react';
import { useNavigate } from 'react-router-dom';
import { useAuth } from '../../hooks/useAuth';
import authService from '../../services/authService';
import Loading from '../common/Loading';

const KakaoCallback = () => {
  const navigate = useNavigate();
  const { login } = useAuth();

  // React 18(ê°œë°œëª¨ë“œ) ì¤‘ë³µ ì‹¤í–‰ ë° ìƒˆë¡œê³ ì¹¨/HMR ëŒ€ë¹„ ì´ì¤‘ ê°€ë“œ
  const once = useRef(false);

  useEffect(() => {
    (async () => {
      if (once.current) return;
      once.current = true;

      const url = new URL(window.location.href);
      const code = url.searchParams.get('code');
      const stateStr = url.searchParams.get('state');

      const from = (() => {
        try {
          return JSON.parse(decodeURIComponent(stateStr || ''))?.from || '/';
        } catch {
          return '/';
        }
      })();

      if (code && sessionStorage.getItem(`kakao_code_used_${code}`) === '1') {
        navigate(from, { replace: true });
        return;
      }

      try {
        if (!code) throw new Error('ì¸ê°€ ì½”ë“œ(code)ê°€ ì—†ìŠµë‹ˆë‹¤.');

        const userInfo = await authService.getKakaoUserInfo(code);
        console.log('âœ… ì¹´ì¹´ì˜¤ ìœ ì € ì •ë³´ ë°›ìŒ:', userInfo);

        const exists = await authService.checkUserExists(userInfo.id);
        console.log('ğŸ” ì‚¬ìš©ì ì¡´ì¬ ì—¬ë¶€:', exists);

        if (!exists) {
          console.log('ğŸ†• ë¯¸ë“±ë¡ ì‚¬ìš©ì - íšŒì›ê°€ì… í˜ì´ì§€ë¡œ ì´ë™, from:', from);
          if (code) sessionStorage.setItem(`kakao_code_used_${code}`, '1');

          navigate('/signup', {
            replace: true,
            state: {
              kakaoUserInfo: userInfo,
              from
            }
          });
          return;
        }

        console.log('ğŸ‘¤ ê¸°ì¡´ ì‚¬ìš©ì - ë¡œê·¸ì¸ ì²˜ë¦¬');

        // âœ… ê¸°ì¡´ ìœ ì €ë„ ì¹´ì¹´ì˜¤ ìµœì‹ ê°’(ëª¨ë“  í•„ë“œ í¬í•¨)ìœ¼ë¡œ merge ì—…ë°ì´íŠ¸
        await authService.updateUserProfile(userInfo.id, {
          displayName: userInfo.displayName,     // ì‹¤ëª…
          nickname: userInfo.nickname || '',      // âœ… ì¹´ì¹´ì˜¤ ë‹‰ë„¤ì„
          profileImage: userInfo.profileImage,
          birthyear: userInfo.birthyear || '',
          gender: userInfo.gender || '',
          phoneNumber: userInfo.phoneNumber || '',
          email: userInfo.email || ''
        });

        await login(userInfo);

        if (code) sessionStorage.setItem(`kakao_code_used_${code}`, '1');
        navigate(from, { replace: true });
      } catch (e) {
        console.error('ë¡œê·¸ì¸ ì‹¤íŒ¨:', e);
        alert(`ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n${e?.message ?? ''}`);

        if (code) sessionStorage.setItem(`kakao_code_used_${code}`, '1');
        navigate('/login', { replace: true });
      }
    })();
  }, [navigate, login]);

  return (
    <div className="min-h-screen flex items-center justify-center">
      <Loading />
    </div>
  );
};

export default KakaoCallback;
</file>

<file path="src/store/useStore.js">
import { create } from 'zustand';

const useStore = create((set) => ({
  // ì¸ì¦
  user: null,
  isLoggedIn: false,
  setUser: (user) => set({ user, isLoggedIn: !!user }),
  logout: () => set({ user: null, isLoggedIn: false, selectedSpace: null }),
  
  // ìŠ¤í˜ì´ìŠ¤
  selectedSpace: null,
  setSelectedSpace: (space) => {
    // localStorageì— ë§ˆì§€ë§‰ ì„ íƒ ê³µê°„ ID ì €ì¥
    if (space?.id) {
      localStorage.setItem('lastSelectedSpaceId', space.id);
    } else {
      localStorage.removeItem('lastSelectedSpaceId');
    }
    set({ selectedSpace: space });
  },
  
  // ì˜ˆì•½
  reservations: {},
  setReservations: (reservations) => set({ reservations }),
  
  // í”„ë¡œí•„
  profiles: {},
  addProfiles: (newProfiles) => set((state) => ({
    profiles: { ...state.profiles, ...newProfiles }
  })),
}));

export default useStore;
</file>

<file path="netlify/functions/send-email.js">
const { Resend } = require('resend');

exports.handler = async (event) => {
  // CORS í—¤ë”
  const headers = {
    'Access-Control-Allow-Origin': '*',
    'Access-Control-Allow-Headers': 'Content-Type',
    'Access-Control-Allow-Methods': 'POST, OPTIONS'
  };

  // OPTIONS ìš”ì²­ ì²˜ë¦¬
  if (event.httpMethod === 'OPTIONS') {
    return { statusCode: 200, headers, body: '' };
  }

  try {
    const resend = new Resend(process.env.RESEND_API_KEY);
    const data = JSON.parse(event.body);

    // typeì— ë”°ë¼ ë‹¤ë¥¸ ì´ë©”ì¼ ìƒì„±
    const type = data.type || 'guest_reservation';

    let emailContent;
    if (type === 'guest_reservation') {
      emailContent = generateGuestReservationEmail(data);
    } else if (type === 'praise') {
      emailContent = generatePraiseEmail(data);
    } else if (type === 'settlement') {
      emailContent = generateSettlementEmail(data);
    } else if (type === 'expense') {
      emailContent = generateExpenseEmail(data);
    } else if (type === 'expense_reminder') {
      emailContent = generateExpenseReminderEmail(data);
    } else if (type === 'bartender_order') {
      emailContent = generateBartenderOrderEmail(data);
    } else if (type === 'space_creation_request') {
      emailContent = generateSpaceCreationRequestEmail(data);
    } else {
      throw new Error(`Unknown email type: ${type}`);
    }

    // ìˆ˜ì‹ ì ì„¤ì • (ê¸°ë³¸ ìˆ˜ì‹ ì + CC)
    const to = data.recipients?.to || 'reshw@naver.com';
    const cc = data.recipients?.cc || [];

    // ì´ë©”ì¼ ë°œì†¡
    const result = await resend.emails.send({
      from: 'ê²ŒìŠ¤íŠ¸ë¼ìš´ì§€ <noreply@lunagarden.co.kr>',
      to: to,
      cc: cc.length > 0 ? cc : undefined,
      subject: emailContent.subject,
      html: emailContent.html
    });

    console.log('Email sent:', result);

    return {
      statusCode: 200,
      headers,
      body: JSON.stringify({
        success: true,
        email: {
          success: true,
          message: 'ì´ë©”ì¼ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.',
          id: result.id
        }
      })
    };

  } catch (error) {
    console.error('Email send error:', error);
    return {
      statusCode: 500,
      headers,
      body: JSON.stringify({
        success: false,
        email: {
          success: false,
          message: 'ì´ë©”ì¼ ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'
        },
        error: error.message
      })
    };
  }
};

/**
 * ê²ŒìŠ¤íŠ¸ ì˜ˆì•½ ì´ë©”ì¼ ìƒì„±
 */
function generateGuestReservationEmail(data) {
  const checkinDate = new Date(data.checkIn);
  const checkoutDate = new Date(data.checkOut);
  const nights = Math.floor((checkoutDate - checkinDate) / (1000 * 60 * 60 * 24));
  const days = nights + 1;
  const cost = nights * (data.pricePerNight || 30000);

  // ë‚ ì§œ í¬ë§·íŒ… (YYMMDD)
  const formatDateShort = (date) => {
    const year = String(date.getFullYear()).slice(2);
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}${month}${day}`;
  };

  // ë‚ ì§œ í¬ë§·íŒ… (ì „ì²´)
  const formatDate = (date) => {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}ë…„ ${month}ì›” ${day}ì¼`;
  };

  const accountInfo = data.accountInfo || process.env.ALIGO_ACCOUNT || 'ì¹´ì¹´ì˜¤ë±…í¬ 7979-38-83356 ì–‘ì„í™˜';
  const spaceName = data.spaceName || 'ì¡°ê°•308í˜¸';

  // ì˜ˆì•½ íƒ€ì…ë³„ ë¼ë²¨ (guest, shareholder, manager, vice-manager)
  const reservationType = data.reservationType || 'guest';
  const reservationTypeLabels = {
    'guest': 'ê²ŒìŠ¤íŠ¸',
    'shareholder': 'ì£¼ì£¼',
    'manager': 'ë§¤ë‹ˆì €',
    'vice-manager': 'ë¶€ë§¤ë‹ˆì €'
  };
  const typeLabel = reservationTypeLabels[reservationType] || 'ê²ŒìŠ¤íŠ¸';

  // ì œëª©: [ë¼ìš´ì§€ëª…] ì£¼ì£¼/ë§¤ë‹ˆì €/ë¶€ë§¤ë‹ˆì €/ê²ŒìŠ¤íŠ¸ ã…‡ã…‡ã…‡ ì˜ˆì•½(251224-251225)
  const subject = `[${spaceName}] ${typeLabel} ${data.name} ì˜ˆì•½(${formatDateShort(checkinDate)}-${formatDateShort(checkoutDate)})`;

  // HTML ì´ë©”ì¼ í…œí”Œë¦¿ (Inline CSS)
  const html = `
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif; background-color: #f5f5f5;">
  <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #f5f5f5; padding: 20px 0;">
    <tr>
      <td align="center">
        <table width="600" cellpadding="0" cellspacing="0" border="0" style="background-color: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">

          <!-- í—¤ë” -->
          <tr>
            <td style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px 40px; text-align: center;">
              <h1 style="margin: 0; color: #ffffff; font-size: 28px; font-weight: 700;">ğŸ  ${typeLabel} ì˜ˆì•½ ì•ˆë‚´</h1>
              <p style="margin: 10px 0 0 0; color: #ffffff; font-size: 16px; opacity: 0.95;">${spaceName}</p>
            </td>
          </tr>

          <!-- ì˜ˆì•½ ì •ë³´ -->
          <tr>
            <td style="padding: 40px;">
              <h2 style="margin: 0 0 20px 0; font-size: 20px; color: #333333; font-weight: 600; border-bottom: 2px solid #667eea; padding-bottom: 10px;">ğŸ“… ì˜ˆì•½ ì •ë³´</h2>
              <table width="100%" cellpadding="12" cellspacing="0" border="0" style="border: 1px solid #e0e0e0; border-radius: 6px; overflow: hidden;">
                <tr style="background-color: #f9f9f9;">
                  <td style="width: 35%; font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0;">ì…ì‹¤ì¼</td>
                  <td style="color: #333333; border-bottom: 1px solid #e0e0e0;">${formatDate(checkinDate)}</td>
                </tr>
                <tr style="background-color: #ffffff;">
                  <td style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0;">í‡´ì‹¤ì¼</td>
                  <td style="color: #333333; border-bottom: 1px solid #e0e0e0;">${formatDate(checkoutDate)}</td>
                </tr>
                <tr style="background-color: #e8f4fe;">
                  <td style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0;">ìˆ™ë°• ê¸°ê°„</td>
                  <td style="color: #333333; font-weight: 700;">${nights}ë°• ${days}ì¼</td>
                </tr>
              </table>
            </td>
          </tr>

          <!-- ì˜ˆì•½ì ì •ë³´ -->
          <tr>
            <td style="padding: 0 40px 40px 40px;">
              <h2 style="margin: 0 0 20px 0; font-size: 20px; color: #333333; font-weight: 600; border-bottom: 2px solid #667eea; padding-bottom: 10px;">ğŸ‘¤ ì˜ˆì•½ì ì •ë³´</h2>
              <table width="100%" cellpadding="12" cellspacing="0" border="0" style="border: 1px solid #e0e0e0; border-radius: 6px; overflow: hidden;">
                <tr style="background-color: #f9f9f9;">
                  <td style="width: 35%; font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0;">ì´ë¦„</td>
                  <td style="color: #333333; border-bottom: 1px solid #e0e0e0;">${data.name}</td>
                </tr>
                <tr style="background-color: #ffffff;">
                  <td style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0;">ì—°ë½ì²˜</td>
                  <td style="color: #333333; border-bottom: 1px solid #e0e0e0;">${data.phone}</td>
                </tr>
                <tr style="background-color: #f9f9f9;">
                  <td style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0;">ì„±ë³„</td>
                  <td style="color: #333333; border-bottom: 1px solid #e0e0e0;">${data.gender || '-'}</td>
                </tr>
                <tr style="background-color: #ffffff;">
                  <td style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0;">ìƒë…„</td>
                  <td style="color: #333333; border-bottom: 1px solid #e0e0e0;">${data.birthYear || '-'}</td>
                </tr>
                ${reservationType === 'guest' ? `
                <tr style="background-color: #f9f9f9;">
                  <td style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0;">ì´ˆëŒ€ ì£¼ì£¼</td>
                  <td style="color: #333333;">${data.hostDisplayName || '-'}</td>
                </tr>
                ` : ''}
              </table>
            </td>
          </tr>

          <!-- ì´ìš©ë£Œ ì •ë³´ (ê²ŒìŠ¤íŠ¸ë§Œ í‘œì‹œ) -->
          ${reservationType === 'guest' ? `
          <tr>
            <td style="padding: 0 40px 40px 40px;">
              <h2 style="margin: 0 0 20px 0; font-size: 20px; color: #333333; font-weight: 600; border-bottom: 2px solid #667eea; padding-bottom: 10px;">ğŸ’° ì´ìš©ë£Œ ì •ë³´</h2>
              <table width="100%" cellpadding="12" cellspacing="0" border="0" style="border: 1px solid #e0e0e0; border-radius: 6px; overflow: hidden;">
                <tr style="background-color: #e8f4fe;">
                  <td style="width: 35%; font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0;">ì´ ì´ìš©ë£Œ</td>
                  <td style="color: #333333; font-weight: 700; font-size: 18px; border-bottom: 1px solid #e0e0e0;">${cost.toLocaleString()}ì› (3ë§Œì›/1ë°•)</td>
                </tr>
                <tr style="background-color: #ffffff;">
                  <td style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0;">ê³„ì¢Œ ì •ë³´</td>
                  <td style="color: #333333;">${accountInfo}</td>
                </tr>
              </table>
            </td>
          </tr>
          ` : ''}

          ${data.memo ? `
          <!-- ë©”ëª¨ -->
          <tr>
            <td style="padding: 0 40px 40px 40px;">
              <h2 style="margin: 0 0 20px 0; font-size: 20px; color: #333333; font-weight: 600; border-bottom: 2px solid #667eea; padding-bottom: 10px;">ğŸ“ ë©”ëª¨</h2>
              <div style="background-color: #f9f9f9; padding: 16px; border-radius: 6px; border-left: 4px solid #667eea;">
                <p style="margin: 0; color: #555555; line-height: 1.6;">${data.memo}</p>
              </div>
            </td>
          </tr>
          ` : ''}

          <!-- í‘¸í„° -->
          <tr>
            <td style="background-color: #f9f9f9; padding: 20px 40px; text-align: center; border-top: 1px solid #e0e0e0;">
              <p style="margin: 0; color: #999999; font-size: 13px;">ì´ ì´ë©”ì¼ì€ ìë™ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
              <p style="margin: 8px 0 0 0; color: #999999; font-size: 13px;">ë¬¸ì˜ì‚¬í•­ì€ ${spaceName}ë¡œ ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.</p>
            </td>
          </tr>

        </table>
      </td>
    </tr>
  </table>
</body>
</html>`;

  return { subject, html };
}

/**
 * PRAISE ì ‘ìˆ˜ ì´ë©”ì¼ ìƒì„±
 */
function generatePraiseEmail(data) {
  const spaceName = data.spaceName || 'ë¼ìš´ì§€';
  const eventDate = new Date(data.eventDate);

  // ë‚ ì§œ í¬ë§·íŒ…
  const formatDate = (date) => {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}ë…„ ${month}ì›” ${day}ì¼`;
  };

  const subject = `[${spaceName}] ì¹­ì°¬ ì ‘ìˆ˜: ${data.userName} - ${data.category}`;

  const html = `
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif; background-color: #f5f5f5;">
  <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #f5f5f5; padding: 20px 0;">
    <tr>
      <td align="center">
        <table width="600" cellpadding="0" cellspacing="0" border="0" style="background-color: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">

          <!-- í—¤ë” -->
          <tr>
            <td style="background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%); padding: 30px 40px; text-align: center;">
              <h1 style="margin: 0; color: #ffffff; font-size: 28px; font-weight: 700;">ğŸŒŸ ì¹­ì°¬ ì ‘ìˆ˜</h1>
              <p style="margin: 10px 0 0 0; color: #ffffff; font-size: 16px; opacity: 0.95;">${spaceName}</p>
            </td>
          </tr>

          <!-- ì¹­ì°¬ ì •ë³´ -->
          <tr>
            <td style="padding: 40px;">
              <h2 style="margin: 0 0 20px 0; font-size: 20px; color: #333333; font-weight: 600; border-bottom: 2px solid #ffd89b; padding-bottom: 10px;">ğŸ“‹ ì¹­ì°¬ ì •ë³´</h2>
              <table width="100%" cellpadding="12" cellspacing="0" border="0" style="border: 1px solid #e0e0e0; border-radius: 6px; overflow: hidden;">
                <tr style="background-color: #f9f9f9;">
                  <td style="width: 35%; font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0;">ì‘ì„±ì</td>
                  <td style="color: #333333; border-bottom: 1px solid #e0e0e0;">${data.userName}</td>
                </tr>
                <tr style="background-color: #ffffff;">
                  <td style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0;">ì¹´í…Œê³ ë¦¬</td>
                  <td style="color: #333333; border-bottom: 1px solid #e0e0e0;">${data.category}</td>
                </tr>
                ${data.itemName ? `
                <tr style="background-color: #f9f9f9;">
                  <td style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0;">ë¬¼í’ˆëª…</td>
                  <td style="color: #333333; border-bottom: 1px solid #e0e0e0;">${data.itemName}</td>
                </tr>
                ` : ''}
                <tr style="background-color: ${data.itemName ? '#ffffff' : '#f9f9f9'};">
                  <td style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0;">ë‚ ì§œ</td>
                  <td style="color: #333333;">${formatDate(eventDate)}</td>
                </tr>
              </table>
            </td>
          </tr>

          <!-- ì¹­ì°¬ ë‚´ìš© -->
          <tr>
            <td style="padding: 0 40px 40px 40px;">
              <h2 style="margin: 0 0 20px 0; font-size: 20px; color: #333333; font-weight: 600; border-bottom: 2px solid #ffd89b; padding-bottom: 10px;">ğŸ’¬ ì›ë³¸ ë‚´ìš©</h2>
              <div style="background-color: #fffbf5; padding: 20px; border-radius: 6px; border-left: 4px solid #ffd89b;">
                <p style="margin: 0; color: #555555; line-height: 1.8; white-space: pre-wrap;">${data.originalText}</p>
              </div>
            </td>
          </tr>

          ${data.refinedText ? `
          <!-- ë‹¤ë“¬ì€ ë‚´ìš© -->
          <tr>
            <td style="padding: 0 40px 40px 40px;">
              <h2 style="margin: 0 0 20px 0; font-size: 20px; color: #333333; font-weight: 600; border-bottom: 2px solid #ffd89b; padding-bottom: 10px;">âœ¨ ë‹¤ë“¬ì€ ë‚´ìš©</h2>
              <div style="background-color: #f0f8ff; padding: 20px; border-radius: 6px; border-left: 4px solid #4a90e2;">
                <p style="margin: 0; color: #555555; line-height: 1.8; white-space: pre-wrap;">${data.refinedText}</p>
              </div>
            </td>
          </tr>
          ` : ''}

          ${data.imageUrl ? `
          <!-- ì´ë¯¸ì§€ -->
          <tr>
            <td style="padding: 0 40px 40px 40px;">
              <h2 style="margin: 0 0 20px 0; font-size: 20px; color: #333333; font-weight: 600; border-bottom: 2px solid #ffd89b; padding-bottom: 10px;">ğŸ“· ì²¨ë¶€ ì´ë¯¸ì§€</h2>
              <div style="text-align: center;">
                <img src="${data.imageUrl}" alt="ì¹­ì°¬ ì´ë¯¸ì§€" style="max-width: 100%; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
              </div>
            </td>
          </tr>
          ` : ''}

          <!-- í‘¸í„° -->
          <tr>
            <td style="background-color: #f9f9f9; padding: 20px 40px; text-align: center; border-top: 1px solid #e0e0e0;">
              <p style="margin: 0; color: #999999; font-size: 13px;">ì´ ì´ë©”ì¼ì€ ìë™ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
              <p style="margin: 8px 0 0 0; color: #999999; font-size: 13px;">ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì¹­ì°¬ì„ ìŠ¹ì¸í•˜ê±°ë‚˜ ê±°ë¶€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </td>
          </tr>

        </table>
      </td>
    </tr>
  </table>
</body>
</html>`;

  return { subject, html };
}

/**
 * ê³µê¸ˆì •ì‚° ì ‘ìˆ˜ ì´ë©”ì¼ ìƒì„±
 */
function generateSettlementEmail(data) {
  const spaceName = data.spaceName || 'ë¼ìš´ì§€';
  const submittedAt = new Date(data.submittedAt);

  // ë‚ ì§œ í¬ë§·íŒ…
  const formatDateTime = (date) => {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    const hours = String(date.getHours()).padStart(2, '0');
    const minutes = String(date.getMinutes()).padStart(2, '0');
    return `${year}ë…„ ${month}ì›” ${day}ì¼ ${hours}:${minutes}`;
  };

  const subject = `[${spaceName}] ì •ì‚° ì ‘ìˆ˜: ${data.paidByName} - ${data.totalAmount.toLocaleString()}ì›`;

  const html = `
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif; background-color: #f5f5f5;">
  <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #f5f5f5; padding: 20px 0;">
    <tr>
      <td align="center">
        <table width="600" cellpadding="0" cellspacing="0" border="0" style="background-color: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">

          <!-- í—¤ë” -->
          <tr>
            <td style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); padding: 30px 40px; text-align: center;">
              <h1 style="margin: 0; color: #ffffff; font-size: 28px; font-weight: 700;">ğŸ’° ì˜ìˆ˜ì¦ ì œì¶œ</h1>
              <p style="margin: 10px 0 0 0; color: #ffffff; font-size: 16px; opacity: 0.95;">${spaceName} - ì£¼ì°¨ ì •ì‚°</p>
            </td>
          </tr>

          <!-- ì˜ìˆ˜ì¦ ì •ë³´ -->
          <tr>
            <td style="padding: 40px;">
              <h2 style="margin: 0 0 20px 0; font-size: 20px; color: #333333; font-weight: 600; border-bottom: 2px solid #11998e; padding-bottom: 10px;">ğŸ“‹ ì˜ìˆ˜ì¦ ì •ë³´</h2>
              <table width="100%" cellpadding="12" cellspacing="0" border="0" style="border: 1px solid #e0e0e0; border-radius: 6px; overflow: hidden;">
                <tr style="background-color: #f9f9f9;">
                  <td style="width: 35%; font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0;">ë‚©ë¶€ì</td>
                  <td style="color: #333333; border-bottom: 1px solid #e0e0e0;">${data.paidByName}</td>
                </tr>
                ${data.submittedByName && data.paidByName !== data.submittedByName ? `
                <tr style="background-color: #ffffff;">
                  <td style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0;">ë“±ë¡ì</td>
                  <td style="color: #333333; border-bottom: 1px solid #e0e0e0;">${data.submittedByName}</td>
                </tr>
                ` : ''}
                <tr style="background-color: ${data.submittedByName && data.paidByName !== data.submittedByName ? '#f9f9f9' : '#ffffff'};">
                  <td style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0;">ì œì¶œ ì‹œê°„</td>
                  <td style="color: #333333; border-bottom: 1px solid #e0e0e0;">${formatDateTime(submittedAt)}</td>
                </tr>
                <tr style="background-color: #e8f8f5;">
                  <td style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0;">ì´ ê¸ˆì•¡</td>
                  <td style="color: #11998e; font-weight: 700; font-size: 18px;">${data.totalAmount.toLocaleString()}ì›</td>
                </tr>
              </table>
            </td>
          </tr>

          <!-- í•­ëª© ëª©ë¡ -->
          <tr>
            <td style="padding: 0 40px 40px 40px;">
              <h2 style="margin: 0 0 20px 0; font-size: 20px; color: #333333; font-weight: 600; border-bottom: 2px solid #11998e; padding-bottom: 10px;">ğŸ›’ ì§€ì¶œ í•­ëª©</h2>
              <table width="100%" cellpadding="12" cellspacing="0" border="0" style="border: 1px solid #e0e0e0; border-radius: 6px; overflow: hidden;">
                ${data.items.map((item, index) => `
                <tr style="background-color: ${index % 2 === 0 ? '#f9f9f9' : '#ffffff'};">
                  <td style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; ${index < data.items.length - 1 ? 'border-bottom: 1px solid #e0e0e0;' : ''}">${item.itemName}</td>
                  <td style="color: #333333; text-align: right; ${index < data.items.length - 1 ? 'border-bottom: 1px solid #e0e0e0;' : ''}">${item.amount.toLocaleString()}ì› (${item.splitAmong.length}ëª… ë¶„ë‹´)</td>
                </tr>
                `).join('')}
              </table>
            </td>
          </tr>

          ${data.memo ? `
          <!-- ë©”ëª¨ -->
          <tr>
            <td style="padding: 0 40px 40px 40px;">
              <h2 style="margin: 0 0 20px 0; font-size: 20px; color: #333333; font-weight: 600; border-bottom: 2px solid #11998e; padding-bottom: 10px;">ğŸ“ ë©”ëª¨</h2>
              <div style="background-color: #f0f8ff; padding: 16px; border-radius: 6px; border-left: 4px solid #11998e;">
                <p style="margin: 0; color: #555555; line-height: 1.6;">${data.memo}</p>
              </div>
            </td>
          </tr>
          ` : ''}

          ${data.imageUrl ? `
          <!-- ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ -->
          <tr>
            <td style="padding: 0 40px 40px 40px;">
              <h2 style="margin: 0 0 20px 0; font-size: 20px; color: #333333; font-weight: 600; border-bottom: 2px solid #11998e; padding-bottom: 10px;">ğŸ“· ì˜ìˆ˜ì¦ ì´ë¯¸ì§€</h2>
              <div style="text-align: center;">
                <img src="${data.imageUrl}" alt="ì˜ìˆ˜ì¦" style="max-width: 100%; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
              </div>
            </td>
          </tr>
          ` : ''}

          <!-- í‘¸í„° -->
          <tr>
            <td style="background-color: #f9f9f9; padding: 20px 40px; text-align: center; border-top: 1px solid #e0e0e0;">
              <p style="margin: 0; color: #999999; font-size: 13px;">ì´ ì´ë©”ì¼ì€ ìë™ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
              <p style="margin: 8px 0 0 0; color: #999999; font-size: 13px;">ì •ì‚° í˜ì´ì§€ì—ì„œ ìì„¸í•œ ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </td>
          </tr>

        </table>
      </td>
    </tr>
  </table>
</body>
</html>`;

  return { subject, html };
}

/**
 * ìš´ì˜ë¹„ ì²­êµ¬ ì ‘ìˆ˜ ì´ë©”ì¼ ìƒì„±
 */
function generateExpenseEmail(data) {
  const spaceName = data.spaceName || 'ë¼ìš´ì§€';
  const createdAt = new Date(data.createdAt);

  // ë‚ ì§œ í¬ë§·íŒ…
  const formatDateTime = (date) => {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    const hours = String(date.getHours()).padStart(2, '0');
    const minutes = String(date.getMinutes()).padStart(2, '0');
    return `${year}ë…„ ${month}ì›” ${day}ì¼ ${hours}:${minutes}`;
  };

  const formatDate = (date) => {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}ë…„ ${month}ì›” ${day}ì¼`;
  };

  const subject = `[${spaceName}] ìš´ì˜ë¹„ ì²­êµ¬: ${data.userName} - ${data.totalAmount.toLocaleString()}ì›`;

  const html = `
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif; background-color: #f5f5f5;">
  <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #f5f5f5; padding: 20px 0;">
    <tr>
      <td align="center">
        <table width="600" cellpadding="0" cellspacing="0" border="0" style="background-color: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">

          <!-- í—¤ë” -->
          <tr>
            <td style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 30px 40px; text-align: center;">
              <h1 style="margin: 0; color: #ffffff; font-size: 28px; font-weight: 700;">ğŸ’¸ ìš´ì˜ë¹„ ì²­êµ¬ ì ‘ìˆ˜</h1>
              <p style="margin: 10px 0 0 0; color: #ffffff; font-size: 16px; opacity: 0.95;">${spaceName}</p>
            </td>
          </tr>

          <!-- ì²­êµ¬ ì •ë³´ -->
          <tr>
            <td style="padding: 40px;">
              <h2 style="margin: 0 0 20px 0; font-size: 20px; color: #333333; font-weight: 600; border-bottom: 2px solid #f093fb; padding-bottom: 10px;">ğŸ“‹ ì²­êµ¬ ì •ë³´</h2>
              <table width="100%" cellpadding="12" cellspacing="0" border="0" style="border: 1px solid #e0e0e0; border-radius: 6px; overflow: hidden;">
                <tr style="background-color: #f9f9f9;">
                  <td style="width: 35%; font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0;">ì²­êµ¬ì</td>
                  <td style="color: #333333; border-bottom: 1px solid #e0e0e0;">${data.userName}</td>
                </tr>
                <tr style="background-color: #ffffff;">
                  <td style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0;">ì‚¬ìš©ì¼</td>
                  <td style="color: #333333; border-bottom: 1px solid #e0e0e0;">${formatDate(new Date(data.usedAt))}</td>
                </tr>
                <tr style="background-color: #f9f9f9;">
                  <td style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0;">ì²­êµ¬ ì œì¶œ</td>
                  <td style="color: #333333; border-bottom: 1px solid #e0e0e0;">${formatDateTime(createdAt)}</td>
                </tr>
                <tr style="background-color: #ffe8f5;">
                  <td style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0;">ì´ ì²­êµ¬ì•¡</td>
                  <td style="color: #f5576c; font-weight: 700; font-size: 18px;">${data.totalAmount.toLocaleString()}ì›</td>
                </tr>
              </table>
            </td>
          </tr>

          <!-- í•­ëª© ëª©ë¡ -->
          <tr>
            <td style="padding: 0 40px 40px 40px;">
              <h2 style="margin: 0 0 20px 0; font-size: 20px; color: #333333; font-weight: 600; border-bottom: 2px solid #f093fb; padding-bottom: 10px;">ğŸ›’ ì²­êµ¬ í•­ëª©</h2>
              <table width="100%" cellpadding="12" cellspacing="0" border="0" style="border: 1px solid #e0e0e0; border-radius: 6px; overflow: hidden;">
                <tr style="background-color: #f9f9f9;">
                  <th style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0; text-align: left;">í’ˆëª©</th>
                  <th style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0; text-align: center;">ë‹¨ê°€</th>
                  <th style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0; text-align: center;">ìˆ˜ëŸ‰</th>
                  <th style="font-weight: 600; color: #555555; border-bottom: 1px solid #e0e0e0; text-align: right;">ê¸ˆì•¡</th>
                </tr>
                ${data.items.map((item, index) => `
                <tr style="background-color: ${index % 2 === 0 ? '#ffffff' : '#f9f9f9'};">
                  <td style="color: #333333; border-right: 1px solid #e0e0e0; ${index < data.items.length - 1 ? 'border-bottom: 1px solid #e0e0e0;' : ''}">${item.itemName}${item.itemSpec ? ` (${item.itemSpec})` : ''}</td>
                  <td style="color: #333333; text-align: center; border-right: 1px solid #e0e0e0; ${index < data.items.length - 1 ? 'border-bottom: 1px solid #e0e0e0;' : ''}">${item.itemPrice.toLocaleString()}ì›</td>
                  <td style="color: #333333; text-align: center; border-right: 1px solid #e0e0e0; ${index < data.items.length - 1 ? 'border-bottom: 1px solid #e0e0e0;' : ''}">${item.itemQty}</td>
                  <td style="color: #333333; text-align: right; ${index < data.items.length - 1 ? 'border-bottom: 1px solid #e0e0e0;' : ''}">${item.total.toLocaleString()}ì›</td>
                </tr>
                `).join('')}
              </table>
            </td>
          </tr>

          ${data.memo ? `
          <!-- ë©”ëª¨ -->
          <tr>
            <td style="padding: 0 40px 40px 40px;">
              <h2 style="margin: 0 0 20px 0; font-size: 20px; color: #333333; font-weight: 600; border-bottom: 2px solid #f093fb; padding-bottom: 10px;">ğŸ“ ì²­êµ¬ ì‚¬ìœ </h2>
              <div style="background-color: #fff5f8; padding: 16px; border-radius: 6px; border-left: 4px solid #f5576c;">
                <p style="margin: 0; color: #555555; line-height: 1.6; white-space: pre-wrap;">${data.memo}</p>
              </div>
            </td>
          </tr>
          ` : ''}

          ${data.imageUrl ? `
          <!-- ì¦ë¹™ ì´ë¯¸ì§€ -->
          <tr>
            <td style="padding: 0 40px 40px 40px;">
              <h2 style="margin: 0 0 20px 0; font-size: 20px; color: #333333; font-weight: 600; border-bottom: 2px solid #f093fb; padding-bottom: 10px;">ğŸ“· ì¦ë¹™ ìë£Œ</h2>
              <div style="text-align: center;">
                <img src="${data.imageUrl}" alt="ì¦ë¹™ ìë£Œ" style="max-width: 100%; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
              </div>
            </td>
          </tr>
          ` : ''}

          <!-- í‘¸í„° -->
          <tr>
            <td style="background-color: #f9f9f9; padding: 20px 40px; text-align: center; border-top: 1px solid #e0e0e0;">
              <p style="margin: 0; color: #999999; font-size: 13px;">ì´ ì´ë©”ì¼ì€ ìë™ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
              <p style="margin: 8px 0 0 0; color: #999999; font-size: 13px;">ìš´ì˜ë¹„ í˜ì´ì§€ì—ì„œ ì²­êµ¬ë¥¼ ìŠ¹ì¸í•˜ê±°ë‚˜ ê±°ë¶€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </td>
          </tr>

        </table>
      </td>
    </tr>
  </table>
</body>
</html>`;

  return { subject, html };
}

/**
 * ë°”í…ë” ì£¼ë¬¸ ì ‘ìˆ˜ ì´ë©”ì¼ ìƒì„±
 */
function generateBartenderOrderEmail(data) {
  const spaceName = data.spaceName || 'ë¼ìš´ì§€';
  const orderedAt = new Date(data.orderedAt);

  // ë‚ ì§œ í¬ë§·íŒ…
  const formatDateTime = (date) => {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    const hours = String(date.getHours()).padStart(2, '0');
    const minutes = String(date.getMinutes()).padStart(2, '0');
    return `${year}ë…„ ${month}ì›” ${day}ì¼ ${hours}:${minutes}`;
  };

  const subject = `[${spaceName}] ë°”í…ë” ì£¼ë¬¸: ${data.userName} - ${data.totalAmount.toLocaleString()}ì›`;

  const html = `
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif; background-color: #f5f5f5;">
  <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #f5f5f5; padding: 20px 0;">
    <tr>
      <td align="center">
        <table width="600" cellpadding="0" cellspacing="0" border="0" style="background-color: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">

          <!-- í—¤ë” -->
          <tr>
            <td style="background: linear-gradient(135deg, #ff8a00 0%, #da1b60 100%); padding: 30px 40px; text-align: center;">
              <h1 style="margin: 0; color: #ffffff; font-size: 28px; font-weight: 700;">ğŸ¸ ë°”í…ë” ì£¼ë¬¸ ì ‘ìˆ˜</h1>
              <p style="margin: 10px 0 0 0; color: #ffffff; font-size: 16px; opacity: 0.95;">${spaceName}</p>
            </td>
          </tr>

          <!-- ì£¼ë¬¸ ì •ë³´ -->
          <tr>
            <td style="padding: 40px;">
              <h2 style="margin: 0 0 20px 0; font-size: 20px; color: #333333; font-weight: 600; border-bottom: 2px solid #ff8a00; padding-bottom: 10px;">ğŸ“‹ ì£¼ë¬¸ ì •ë³´</h2>
              <table width="100%" cellpadding="12" cellspacing="0" border="0" style="border: 1px solid #e0e0e0; border-radius: 6px; overflow: hidden;">
                <tr style="background-color: #f9f9f9;">
                  <td style="width: 35%; font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0;">ì£¼ë¬¸ì</td>
                  <td style="color: #333333; border-bottom: 1px solid #e0e0e0;">${data.userName}</td>
                </tr>
                <tr style="background-color: #ffffff;">
                  <td style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0;">ì£¼ë¬¸ì¼ì‹œ</td>
                  <td style="color: #333333; border-bottom: 1px solid #e0e0e0;">${formatDateTime(orderedAt)}</td>
                </tr>
                <tr style="background-color: #fff5e8;">
                  <td style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0;">ì´ ê¸ˆì•¡</td>
                  <td style="color: #ff8a00; font-weight: 700; font-size: 18px;">${data.totalAmount.toLocaleString()}ì›</td>
                </tr>
              </table>
            </td>
          </tr>

          <!-- ì£¼ë¬¸ í•­ëª© -->
          <tr>
            <td style="padding: 0 40px 40px 40px;">
              <h2 style="margin: 0 0 20px 0; font-size: 20px; color: #333333; font-weight: 600; border-bottom: 2px solid #ff8a00; padding-bottom: 10px;">ğŸ›’ ì£¼ë¬¸ í•­ëª©</h2>
              <table width="100%" cellpadding="12" cellspacing="0" border="0" style="border: 1px solid #e0e0e0; border-radius: 6px; overflow: hidden;">
                <tr style="background-color: #f9f9f9;">
                  <th style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0; text-align: left;">ë©”ë‰´</th>
                  <th style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0; text-align: center;">ìˆ˜ëŸ‰</th>
                  <th style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0; text-align: center;">ë‹¨ê°€</th>
                  <th style="font-weight: 600; color: #555555; border-bottom: 1px solid #e0e0e0; text-align: right;">ê¸ˆì•¡</th>
                </tr>
                ${data.items.map((item, index) => `
                <tr style="background-color: ${index % 2 === 0 ? '#ffffff' : '#f9f9f9'};">
                  <td style="color: #333333; border-right: 1px solid #e0e0e0; ${index < data.items.length - 1 ? 'border-bottom: 1px solid #e0e0e0;' : ''}">${item.menuName}</td>
                  <td style="color: #333333; text-align: center; border-right: 1px solid #e0e0e0; ${index < data.items.length - 1 ? 'border-bottom: 1px solid #e0e0e0;' : ''}">${item.quantity}</td>
                  <td style="color: #333333; text-align: center; border-right: 1px solid #e0e0e0; ${index < data.items.length - 1 ? 'border-bottom: 1px solid #e0e0e0;' : ''}">${item.price.toLocaleString()}ì›</td>
                  <td style="color: #333333; text-align: right; ${index < data.items.length - 1 ? 'border-bottom: 1px solid #e0e0e0;' : ''}">${item.total.toLocaleString()}ì›</td>
                </tr>
                `).join('')}
              </table>
            </td>
          </tr>

          ${data.memo ? `
          <!-- ìš”ì²­ì‚¬í•­ -->
          <tr>
            <td style="padding: 0 40px 40px 40px;">
              <h2 style="margin: 0 0 20px 0; font-size: 20px; color: #333333; font-weight: 600; border-bottom: 2px solid #ff8a00; padding-bottom: 10px;">ğŸ“ ìš”ì²­ ì‚¬í•­</h2>
              <div style="background-color: #fff5e8; padding: 16px; border-radius: 6px; border-left: 4px solid #ff8a00;">
                <p style="margin: 0; color: #555555; line-height: 1.6; white-space: pre-wrap;">${data.memo}</p>
              </div>
            </td>
          </tr>
          ` : ''}

          <!-- í‘¸í„° -->
          <tr>
            <td style="background-color: #f9f9f9; padding: 20px 40px; text-align: center; border-top: 1px solid #e0e0e0;">
              <p style="margin: 0; color: #999999; font-size: 13px;">ì´ ì´ë©”ì¼ì€ ìë™ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
              <p style="margin: 8px 0 0 0; color: #999999; font-size: 13px;">ì£¼ë¬¸ ë‚´ì—­ì„ í™•ì¸í•˜ê³  ì¤€ë¹„í•´ì£¼ì„¸ìš”.</p>
            </td>
          </tr>

        </table>
      </td>
    </tr>
  </table>
</body>
</html>`;

  return { subject, html };
}

/**
 * ë°© ìƒì„± ì‹ ì²­ ì´ë©”ì¼ ìƒì„±
 */
function generateSpaceCreationRequestEmail(data) {
  const requestedAt = new Date(data.requestedAt);

  const formatDateTime = (date) => {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    const hours = String(date.getHours()).padStart(2, '0');
    const minutes = String(date.getMinutes()).padStart(2, '0');
    return `${year}ë…„ ${month}ì›” ${day}ì¼ ${hours}:${minutes}`;
  };

  const subject = `[ê´€ë¦¬ì ì•Œë¦¼] ë°© ìƒì„± ì‹ ì²­: ${data.spaceName} (${data.spaceCode})`;

  const html = `
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif; background-color: #f5f5f5;">
  <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #f5f5f5; padding: 20px 0;">
    <tr>
      <td align="center">
        <table width="600" cellpadding="0" cellspacing="0" border="0" style="background-color: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
          <tr>
            <td style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px 40px; text-align: center;">
              <h1 style="margin: 0; color: #ffffff; font-size: 28px; font-weight: 700;">ğŸ  ë°© ìƒì„± ì‹ ì²­ ì•Œë¦¼</h1>
              <p style="margin: 10px 0 0 0; color: #ffffff; font-size: 16px; opacity: 0.95;">ìƒˆë¡œìš´ ë°© ìƒì„± ì‹ ì²­ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤</p>
            </td>
          </tr>
          <tr>
            <td style="padding: 40px;">
              <h2 style="margin: 0 0 20px 0; font-size: 20px; color: #333333; font-weight: 600; border-bottom: 2px solid #667eea; padding-bottom: 10px;">ğŸ“‹ ì‹ ì²­ ì •ë³´</h2>
              <table width="100%" cellpadding="12" cellspacing="0" border="0" style="border: 1px solid #e0e0e0; border-radius: 6px; overflow: hidden;">
                <tr style="background-color: #f9f9f9;">
                  <td style="width: 35%; font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0;">ë°© ì´ë¦„</td>
                  <td style="color: #333333; font-weight: 700; font-size: 18px; border-bottom: 1px solid #e0e0e0;">${data.spaceName}</td>
                </tr>
                <tr style="background-color: #e8f4fe;">
                  <td style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0;">ë°© ì½”ë“œ</td>
                  <td style="color: #667eea; font-weight: 700; font-size: 18px; border-bottom: 1px solid #e0e0e0;">
                    <code style="background-color: #f0f4ff; padding: 4px 12px; border-radius: 4px; font-family: 'Monaco', 'Courier New', monospace;">${data.spaceCode}</code>
                  </td>
                </tr>
                <tr style="background-color: #ffffff;">
                  <td style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0;">ì‹ ì²­ì</td>
                  <td style="color: #333333; border-bottom: 1px solid #e0e0e0;">${data.requestedBy}</td>
                </tr>
                <tr style="background-color: #f9f9f9;">
                  <td style="font-weight: 600; color: #555555; border-right: 1px solid #e0e0e0;">ì‹ ì²­ ì‹œê°</td>
                  <td style="color: #333333;">${formatDateTime(requestedAt)}</td>
                </tr>
              </table>
            </td>
          </tr>
          <tr>
            <td style="padding: 0 40px 40px 40px;">
              <div style="background-color: #fff9e6; padding: 20px; border-radius: 6px; border-left: 4px solid #ffc107;">
                <h3 style="margin: 0 0 12px 0; color: #f57c00; font-size: 16px; font-weight: 600;">âš ï¸ ì²˜ë¦¬ ì•ˆë‚´</h3>
                <ul style="margin: 0; padding-left: 20px; color: #555555; line-height: 1.8;">
                  <li>ìŠˆí¼ì–´ë“œë¯¼ í˜ì´ì§€ì—ì„œ ìŠ¹ì¸/ê±°ë¶€ ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                  <li>ìŠ¹ì¸ ì‹œ ë°©ì´ ì¦‰ì‹œ ìƒì„±ë˜ë©°, ì‹ ì²­ìëŠ” ìë™ìœ¼ë¡œ ë§¤ë‹ˆì €ë¡œ ì§€ì •ë©ë‹ˆë‹¤.</li>
                </ul>
              </div>
            </td>
          </tr>
          <tr>
            <td style="background-color: #f9f9f9; padding: 20px 40px; text-align: center; border-top: 1px solid #e0e0e0;">
              <p style="margin: 0; color: #999999; font-size: 13px;">ì´ ì´ë©”ì¼ì€ ìë™ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
</body>
</html>`;

  return { subject, html };
}

/**
 * ìš´ì˜ë¹„ ìŠ¹ì¸ ë…ë ¤ ì´ë©”ì¼ ìƒì„±
 */
function generateExpenseReminderEmail(data) {
  const spaceName = data.spaceName || 'ë¼ìš´ì§€';
  const pendingCount = data.pendingCount || 0;

  const subject = `[${spaceName}] ìš´ì˜ë¹„ ìŠ¹ì¸ëŒ€ê¸°ì¤‘ì¸ ê±´ìˆ˜ê°€ ${pendingCount}ê±´ ìˆìŠµë‹ˆë‹¤`;

  const html = `
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif; background-color: #f5f5f5;">
  <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #f5f5f5; padding: 20px 0;">
    <tr>
      <td align="center">
        <table width="600" cellpadding="0" cellspacing="0" border="0" style="background-color: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">

          <!-- í—¤ë” -->
          <tr>
            <td style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); padding: 30px 40px; text-align: center;">
              <h1 style="margin: 0; color: #ffffff; font-size: 28px; font-weight: 700;">â° ìš´ì˜ë¹„ ìŠ¹ì¸ ë…ë ¤</h1>
              <p style="margin: 10px 0 0 0; color: #ffffff; font-size: 16px; opacity: 0.95;">${spaceName}</p>
            </td>
          </tr>

          <!-- ë…ë ¤ ë©”ì‹œì§€ -->
          <tr>
            <td style="padding: 40px;">
              <div style="text-align: center; margin-bottom: 30px;">
                <div style="display: inline-block; background: linear-gradient(135deg, #fff5f5 0%, #ffe5e5 100%); border-radius: 16px; padding: 24px 32px; border: 2px solid #ff6b6b;">
                  <p style="margin: 0; font-size: 18px; color: #555555; font-weight: 600;">ìŠ¹ì¸ ëŒ€ê¸°ì¤‘ì¸ ìš´ì˜ë¹„ ì²­êµ¬</p>
                  <p style="margin: 12px 0 0 0; font-size: 48px; color: #ff6b6b; font-weight: 700; line-height: 1;">${pendingCount}ê±´</p>
                </div>
              </div>

              <div style="background-color: #fff9e6; border-left: 4px solid #ffc107; padding: 20px; border-radius: 6px; margin-bottom: 30px;">
                <p style="margin: 0; color: #555555; line-height: 1.8;">
                  <strong>ğŸ’¡ ì•ˆë‚´</strong><br>
                  ìŠ¹ì¸ ëŒ€ê¸°ì¤‘ì¸ ìš´ì˜ë¹„ ì²­êµ¬ê°€ ${pendingCount}ê±´ ìˆìŠµë‹ˆë‹¤.<br>
                  ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ í™•ì¸í•˜ì‹œê³  ìŠ¹ì¸ ë˜ëŠ” ê±°ë¶€ ì²˜ë¦¬ë¥¼ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
                </p>
              </div>

              <div style="text-align: center;">
                <p style="margin: 0; color: #999999; font-size: 14px; line-height: 1.8;">
                  ìš´ì˜ë¹„ í˜ì´ì§€ì—ì„œ ì²­êµ¬ ë‚´ì—­ì„ í™•ì¸í•˜ê³ <br>
                  ìŠ¹ì¸ ë˜ëŠ” ê±°ë¶€ ì²˜ë¦¬ë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”.
                </p>
              </div>
            </td>
          </tr>

          <!-- í‘¸í„° -->
          <tr>
            <td style="background-color: #f9f9f9; padding: 20px 40px; text-align: center; border-top: 1px solid #e0e0e0;">
              <p style="margin: 0; color: #999999; font-size: 13px;">ì´ ì´ë©”ì¼ì€ ë§¤ì¼ ì˜¤ì „ 10ì‹œì— ìë™ìœ¼ë¡œ ë°œì†¡ë©ë‹ˆë‹¤.</p>
              <p style="margin: 8px 0 0 0; color: #999999; font-size: 13px;">ìŠ¹ì¸ ëŒ€ê¸°ì¤‘ì¸ ê±´ì´ ì—†ìœ¼ë©´ ë°œì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
            </td>
          </tr>

        </table>
      </td>
    </tr>
  </table>
</body>
</html>`;

  return { subject, html };
}
</file>

<file path="netlify/functions/send-notification.js">
/**
 * NHN Cloud ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡ ë°œì†¡ Netlify Function
 *
 * í™˜ê²½ë³€ìˆ˜ í•„ìš”:
 * - NHN_APPKEY
 * - NHN_SECRET_KEY
 * - NHN_API_URL
 * - NHN_PLUS_FRIEND_ID
 * - NHN_SENDER_KEY
 * - NHN_TEMPLATE_GUEST_CONFIRM
 * - NHN_TEMPLATE_SETTLEMENT_COMPLETE
 */

const fetch = require('node-fetch');

exports.handler = async (event) => {
  // CORS í—¤ë”
  const headers = {
    'Access-Control-Allow-Origin': '*',
    'Access-Control-Allow-Headers': 'Content-Type',
    'Access-Control-Allow-Methods': 'POST, OPTIONS',
    'Content-Type': 'application/json',
  };

  // OPTIONS ìš”ì²­ ì²˜ë¦¬ (CORS preflight)
  if (event.httpMethod === 'OPTIONS') {
    return {
      statusCode: 200,
      headers,
      body: '',
    };
  }

  // POST ìš”ì²­ë§Œ í—ˆìš©
  if (event.httpMethod !== 'POST') {
    return {
      statusCode: 405,
      headers,
      body: JSON.stringify({ error: 'Method Not Allowed' }),
    };
  }

  try {
    const data = JSON.parse(event.body);
    console.log('ğŸ“¨ ì•Œë¦¼í†¡ ë°œì†¡ ìš”ì²­:', JSON.stringify(data, null, 2));

    // í•„ìˆ˜ í™˜ê²½ë³€ìˆ˜ í™•ì¸
    const {
      NHN_APPKEY,
      NHN_SECRET_KEY,
      NHN_API_URL,
      NHN_SENDER_KEY,
      NHN_TEMPLATE_GUEST_CONFIRM,
    } = process.env;

    // í™˜ê²½ë³€ìˆ˜ ì²´í¬
    console.log('ğŸ” í™˜ê²½ë³€ìˆ˜ í™•ì¸:', {
      NHN_APPKEY: NHN_APPKEY ? 'âœ… ì„¤ì •ë¨' : 'âŒ ì—†ìŒ',
      NHN_SECRET_KEY: NHN_SECRET_KEY ? 'âœ… ì„¤ì •ë¨' : 'âŒ ì—†ìŒ',
      NHN_API_URL: NHN_API_URL || 'âŒ ì—†ìŒ',
      NHN_SENDER_KEY: NHN_SENDER_KEY ? 'âœ… ì„¤ì •ë¨' : 'âŒ ì—†ìŒ',
      NHN_TEMPLATE_GUEST_CONFIRM: NHN_TEMPLATE_GUEST_CONFIRM || 'âŒ ì—†ìŒ',
    });

    if (!NHN_APPKEY || !NHN_SECRET_KEY || !NHN_API_URL || !NHN_SENDER_KEY || !NHN_TEMPLATE_GUEST_CONFIRM) {
      const missing = [];
      if (!NHN_APPKEY) missing.push('NHN_APPKEY');
      if (!NHN_SECRET_KEY) missing.push('NHN_SECRET_KEY');
      if (!NHN_API_URL) missing.push('NHN_API_URL');
      if (!NHN_SENDER_KEY) missing.push('NHN_SENDER_KEY');
      if (!NHN_TEMPLATE_GUEST_CONFIRM) missing.push('NHN_TEMPLATE_GUEST_CONFIRM');
      
      const errorMsg = `í™˜ê²½ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤: ${missing.join(', ')}`;
      console.error('âŒ', errorMsg);
      
      return {
        statusCode: 500,
        headers,
        body: JSON.stringify({
          success: false,
          error: errorMsg,
        }),
      };
    }

    // ì•Œë¦¼í†¡ íƒ€ì…ë³„ ì²˜ë¦¬
    const { type, reservationData, settlementData } = data;

    let templateCode;
    let templateParams = {};
    let recipientNo;

    switch (type) {
      case 'guest_confirmation':
        templateCode = NHN_TEMPLATE_GUEST_CONFIRM;
        templateParams = createGuestConfirmationParams(reservationData);
        recipientNo = reservationData.phone;
        break;

      case 'settlement_receive':
        templateCode = 'JH8637'; // ë°›ì„ ëˆ í…œí”Œë¦¿
        templateParams = createSettlementReceiveParams(settlementData);
        recipientNo = settlementData.phone;
        console.log('ğŸ“ ì •ì‚° ë°›ì„ ëˆ ì•Œë¦¼ ë°œì†¡:', {
          name: settlementData.name,
          phone: recipientNo,
          balance: settlementData.balance
        });
        break;

      case 'settlement_pay':
        templateCode = 'JH8638'; // ë‚¼ ëˆ í…œí”Œë¦¿
        templateParams = createSettlementPayParams(settlementData);
        recipientNo = settlementData.phone;
        console.log('ğŸ“ ì •ì‚° ë‚¼ ëˆ ì•Œë¦¼ ë°œì†¡:', {
          name: settlementData.name,
          phone: recipientNo,
          balance: settlementData.balance
        });
        break;

      // ì¶”ê°€ í…œí”Œë¦¿ íƒ€ì…ë“¤...
      // case 'guest_checkin':
      // case 'reservation_cancelled':

      default:
        throw new Error(`ì•Œ ìˆ˜ ì—†ëŠ” ì•Œë¦¼í†¡ íƒ€ì…: ${type}`);
    }

    // NHN Cloud API í˜¸ì¶œ
    const response = await sendNhnAlimtalk({
      appKey: NHN_APPKEY,
      secretKey: NHN_SECRET_KEY,
      apiUrl: NHN_API_URL,
      senderKey: NHN_SENDER_KEY,
      templateCode,
      recipientNo,
      templateParams,
    });

    console.log('âœ… ì•Œë¦¼í†¡ ë°œì†¡ ì„±ê³µ:', response);

    return {
      statusCode: 200,
      headers,
      body: JSON.stringify({
        success: true,
        message: 'ì•Œë¦¼í†¡ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.',
        response,
      }),
    };

  } catch (error) {
    console.error('âŒ ì•Œë¦¼í†¡ ë°œì†¡ ì‹¤íŒ¨:', error);
    console.error('âŒ ì—ëŸ¬ ìŠ¤íƒ:', error.stack);

    return {
      statusCode: 500,
      headers,
      body: JSON.stringify({
        success: false,
        error: error.message || 'ì•Œë¦¼í†¡ ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
        stack: process.env.NODE_ENV === 'development' ? error.stack : undefined,
      }),
    };
  }
};

/**
 * ê²ŒìŠ¤íŠ¸ ì˜ˆì•½ í™•ì¸ í…œí”Œë¦¿ íŒŒë¼ë¯¸í„° ìƒì„±
 */
function createGuestConfirmationParams(data) {
  const {
    name,
    loungeName,
    checkIn,
    checkOut,
    nights,
    days,
    cost,
    pricePerNightper10000,
    accountBank,      // ë³€ê²½: accountInfo â†’ accountBank
    accountNumber,    // ì¶”ê°€
    accountHolder,    // ì¶”ê°€
    doorNumber  // ì „í™”ë²ˆí˜¸ ë’·ìë¦¬ 4ìë¦¬
  } = data;

  // NHN Cloud í…œí”Œë¦¿ ë³€ìˆ˜ëª…ì— ë§ì¶° ë§¤í•‘
  const params = {
    'ì„±ëª…': name,
    'ë¼ìš´ì§€ëª…': loungeName,
    'ì…ì‹¤ì¼': checkIn,
    'í‡´ì‹¤ì¼': checkOut,
    'ë°•ìˆ˜': String(nights),
    'ë‹¨ê°€': pricePerNightper10000, // 1ë°• ìš”ê¸ˆ (ë§Œì› ë‹¨ìœ„)
    'ì¼ìˆ˜': String(days),
    'ë¹„ìš©': cost.toLocaleString(),
    'ì€í–‰ëª…': accountBank,        // ë³€ê²½
    'ê³„ì¢Œë²ˆí˜¸': accountNumber,    // ì¶”ê°€
    'ì˜ˆê¸ˆì£¼': accountHolder,      // ì¶”ê°€
    'ë„ì–´ë²ˆí˜¸': doorNumber,  // ì˜ˆ: "8626" â†’ í…œí”Œë¦¿ì—ì„œ "862611*" í‘œì‹œ
  };

  console.log('ğŸ·ï¸ í…œí”Œë¦¿ íŒŒë¼ë¯¸í„°:', params);

  return params;
}

/**
 * ì •ì‚° ì™„ë£Œ - ë°›ì„ ëˆ í…œí”Œë¦¿ íŒŒë¼ë¯¸í„° ìƒì„± (JH8637)
 * ë³€ìˆ˜: ì„±ëª…, ë¼ìš´ì§€ëª…, ë°›ì„ê¸ˆì•¡, ë‚©ë¶€ê¸ˆì•¡, ì‚¬ìš©ê¸ˆì•¡, ë§¤ë‹ˆì €ì—°ë½ì²˜
 */
function createSettlementReceiveParams(data) {
  const {
    name,
    loungeName,
    balance,
    totalPaid,
    totalOwed,
    managerPhone
  } = data;

  const params = {
    'ì„±ëª…': name,
    'ë¼ìš´ì§€ëª…': loungeName,
    'ë°›ì„ê¸ˆì•¡': balance.toLocaleString(),
    'ë‚©ë¶€ê¸ˆì•¡': totalPaid.toLocaleString(),
    'ì‚¬ìš©ê¸ˆì•¡': totalOwed.toLocaleString(),
    'ë§¤ë‹ˆì €ì—°ë½ì²˜': managerPhone,
  };

  console.log('ğŸ·ï¸ ì •ì‚° ë°›ì„ ëˆ í…œí”Œë¦¿ íŒŒë¼ë¯¸í„° (JH8637):', params);

  return params;
}

/**
 * ì •ì‚° ì™„ë£Œ - ë‚¼ ëˆ í…œí”Œë¦¿ íŒŒë¼ë¯¸í„° ìƒì„± (JH8638)
 * ë³€ìˆ˜: ì„±ëª…, ë¼ìš´ì§€ëª…, ì •ì‚°ê¸ˆì•¡, ë‚©ë¶€ê¸ˆì•¡, ì‚¬ìš©ê¸ˆì•¡, ë§¤ë‹ˆì €ì—°ë½ì²˜, ì€í–‰ëª…, ê³„ì¢Œë²ˆí˜¸, ì˜ˆê¸ˆì£¼ëª…
 */
function createSettlementPayParams(data) {
  const {
    name,
    loungeName,
    balance,
    totalPaid,
    totalOwed,
    managerPhone,
    accountBank,
    accountNumber,
    accountHolder
  } = data;

  const params = {
    'ì„±ëª…': name,
    'ë¼ìš´ì§€ëª…': loungeName,
    'ì •ì‚°ê¸ˆì•¡': balance.toLocaleString(),
    'ë‚©ë¶€ê¸ˆì•¡': totalPaid.toLocaleString(),
    'ì‚¬ìš©ê¸ˆì•¡': totalOwed.toLocaleString(),
    'ë§¤ë‹ˆì €ì—°ë½ì²˜': managerPhone,
    'ì€í–‰ëª…': accountBank,
    'ê³„ì¢Œë²ˆí˜¸': accountNumber,
    'ì˜ˆê¸ˆì£¼ëª…': accountHolder,
  };

  console.log('ğŸ·ï¸ ì •ì‚° ë‚¼ ëˆ í…œí”Œë¦¿ íŒŒë¼ë¯¸í„° (JH8638):', params);

  return params;
}

/**
 * NHN Cloud ì•Œë¦¼í†¡ API í˜¸ì¶œ
 */
async function sendNhnAlimtalk({
  appKey,
  secretKey,
  apiUrl,
  senderKey,
  templateCode,
  recipientNo,
  templateParams,
}) {
  const url = `${apiUrl}/alimtalk/v2.3/appkeys/${appKey}/messages`;

  // ì „í™”ë²ˆí˜¸ í¬ë§·íŒ… (êµ­ê°€ì½”ë“œ, í•˜ì´í”ˆ, ê³µë°± ì œê±° í›„ ìˆ«ìë§Œ)
  let formattedPhone = recipientNo.replace(/[\s\-+]/g, ''); // ê³µë°±, í•˜ì´í”ˆ, + ì œê±°
  
  // +82ë¡œ ì‹œì‘í•˜ë©´ 0ìœ¼ë¡œ ë³€í™˜
  if (formattedPhone.startsWith('82')) {
    formattedPhone = '0' + formattedPhone.slice(2);
  }
  
  console.log('ğŸ“ ì „í™”ë²ˆí˜¸ í¬ë§·íŒ…:', {
    ì›ë³¸: recipientNo,
    ë³€í™˜: formattedPhone
  });

  const payload = {
    senderKey,
    templateCode,
    requestDate: '', // ì¦‰ì‹œ ë°œì†¡
    senderGroupingKey: `geha_${Date.now()}`,
    recipientList: [
      {
        recipientNo: formattedPhone,
        templateParameter: templateParams,
        // ì¬ë°œì†¡ ê¸°ëŠ¥ ì¼ì‹œ ë¹„í™œì„±í™” (í…ŒìŠ¤íŠ¸ìš©)
        // resendParameter: {
        //   isResend: true,
        //   resendType: 'SMS',
        //   resendTitle: 'ì¡°ê°•308í˜¸',
        //   resendContent: createFallbackSms(templateParams),
        // },
      },
    ],
  };

  console.log('ğŸ“¤ NHN API ìš”ì²­:', {
    url,
    templateCode,
    recipientNo: formattedPhone,
    params: templateParams,
    senderKey,
  });

  try {
    const response = await fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-Secret-Key': secretKey,
      },
      body: JSON.stringify(payload),
    });

    const result = await response.json();

    console.log('ğŸ“¥ NHN API ì‘ë‹µ:', {
      status: response.status,
      statusText: response.statusText,
      result: JSON.stringify(result, null, 2)
    });

    if (!response.ok) {
      console.error('âŒ NHN API ì—ëŸ¬ ìƒì„¸:', {
        status: response.status,
        statusText: response.statusText,
        header: result.header,
        body: result.body
      });
      throw new Error(
        `NHN API ì˜¤ë¥˜ (${response.status}): ${result.header?.resultMessage || result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`
      );
    }

    return result;
  } catch (error) {
    console.error('âŒ NHN API í˜¸ì¶œ ì¤‘ ì—ëŸ¬:', error);
    throw error;
  }
}

/**
 * ì•Œë¦¼í†¡ ì‹¤íŒ¨ ì‹œ ëŒ€ì²´ SMS ë‚´ìš©
 */
function createFallbackSms(params) {
  return `[${params.ë¼ìš´ì§€ëª…} ì˜ˆì•½ í™•ì¸]
${params.ì„±ëª…}ë‹˜
ì…ì‹¤ì¼: ${params.ì…ì‹¤ì¼}
í‡´ì‹¤ì¼: ${params.í‡´ì‹¤ì¼}
ìˆ™ë°•: ${params.ë°•ìˆ˜}ë°•
ìš”ê¸ˆ: ${params.ë¹„ìš©}ì›
ê³„ì¢Œ: ${params.ì–´ì¹´ìš´íŠ¸ë²ˆí˜¸}
ë„ì–´ë²ˆí˜¸: ${params.ë„ì–´ë²ˆí˜¸}11*`;
}
</file>

<file path="src/pages/SettlementSubmitPage.jsx">
// src/pages/SettlementSubmitPage.jsx
import { useState, useEffect } from 'react';
import { useNavigate, useSearchParams } from 'react-router-dom';
import {
  ArrowLeft,
  Camera,
  Plus,
  Trash2,
  Users,
  DollarSign,
  User,
  Check,
  X,
  Search,
  ChevronDown,
  ChevronUp,
  Calendar
} from 'lucide-react';
import { useAuth } from '../hooks/useAuth';
import useStore from '../store/useStore';
import settlementService from '../services/settlementService';
import authService from '../services/authService';
import LoginOverlay from '../components/auth/LoginOverlay';

const SettlementSubmitPage = () => {
  const navigate = useNavigate();
  const { user, isLoggedIn } = useAuth();
  const { selectedSpace } = useStore();
  const [searchParams] = useSearchParams();

  // ìˆ˜ì • ëª¨ë“œ íŒë‹¨
  const receiptId = searchParams.get('receiptId');
  const weekId = searchParams.get('weekId');
  const isEditMode = !!receiptId && !!weekId;

  const [loading, setLoading] = useState(false);
  const [loadingReceipt, setLoadingReceipt] = useState(isEditMode);
  const [imageFile, setImageFile] = useState(null);
  const [imagePreview, setImagePreview] = useState(null);
  const [uploading, setUploading] = useState(false);
  const [existingImageUrl, setExistingImageUrl] = useState(null);
  
  // ë©¤ë²„ ëª©ë¡
  const [members, setMembers] = useState([]);
  const [userProfiles, setUserProfiles] = useState({}); // userId -> {displayName, profileImage}

  // ê·€ì†ì¼ (ê¸°ë³¸: ì˜¤ëŠ˜)
  const [belongsToDate, setBelongsToDate] = useState(() => {
    const today = new Date();
    return today.toISOString().split('T')[0]; // YYYY-MM-DD
  });
  const [targetWeekSettlement, setTargetWeekSettlement] = useState(null);
  const [isTargetWeekSettled, setIsTargetWeekSettled] = useState(false);

  // ë‚©ë¶€ì (ê¸°ë³¸: ë³¸ì¸)
  const [paidBy, setPaidBy] = useState('');
  const [paidByName, setPaidByName] = useState('');
  const [paidBySearchQuery, setPaidBySearchQuery] = useState('');
  const [showPaidByDropdown, setShowPaidByDropdown] = useState(false);
  
  // ë©”ëª¨
  const [memo, setMemo] = useState('');
  
  // í•­ëª© ëª©ë¡
  const [items, setItems] = useState([
    {
      id: Date.now(),
      itemName: '',
      amount: '',
      splitAmong: [], // [userId, ...]
      searchQuery: '',
      showSearchDropdown: false,
      expanded: true, // ì ‘ê¸°/í¼ì¹˜ê¸° ìƒíƒœ
    }
  ]);

  useEffect(() => {
    if (selectedSpace) {
      loadMembers();
    }
  }, [selectedSpace]);

  // ê·€ì†ì¼ ë³€ê²½ ì‹œ í•´ë‹¹ ì£¼ì°¨ ì •ì‚° ìƒíƒœ í™•ì¸
  useEffect(() => {
    if (selectedSpace && belongsToDate && !isEditMode) {
      checkTargetWeekSettlement();
    }
  }, [selectedSpace, belongsToDate, isEditMode]);

  useEffect(() => {
    if (user && !isEditMode) {
      setPaidBy(String(user.id)); // íƒ€ì… í†µì¼: stringìœ¼ë¡œ ë³€í™˜
      setPaidByName(user.displayName);

      // ì´ˆê¸° í•­ëª©ì— ë³¸ì¸ì„ ë¶„ë‹´ìë¡œ ìë™ ì¶”ê°€
      setItems(prevItems => {
        // ì²« ë²ˆì§¸ í•­ëª©ì´ ë¹„ì–´ìˆê³  ë¶„ë‹´ìê°€ ì—†ìœ¼ë©´ ë³¸ì¸ ì¶”ê°€
        if (prevItems.length === 1 && prevItems[0].splitAmong.length === 0) {
          return [{
            ...prevItems[0],
            splitAmong: [String(user.id)] // íƒ€ì… í†µì¼: stringìœ¼ë¡œ ë³€í™˜
          }];
        }
        return prevItems;
      });
    }
  }, [user, isEditMode]);

  // ìˆ˜ì • ëª¨ë“œì¼ ë•Œ ê¸°ì¡´ ì˜ìˆ˜ì¦ ë°ì´í„° ë¡œë“œ
  useEffect(() => {
    if (isEditMode && selectedSpace && receiptId && weekId) {
      loadReceipt();
    }
  }, [isEditMode, selectedSpace, receiptId, weekId]);

  const loadReceipt = async () => {
    try {
      setLoadingReceipt(true);
      const receipt = await settlementService.getReceipt(selectedSpace.id, weekId, receiptId);

      // ê¸°ì¡´ ë°ì´í„° ì„¤ì •
      setPaidBy(String(receipt.paidBy)); // íƒ€ì… í†µì¼: stringìœ¼ë¡œ ë³€í™˜
      setPaidByName(receipt.paidByName);
      setMemo(receipt.memo || '');
      setExistingImageUrl(receipt.imageUrl);
      setImagePreview(receipt.imageUrl);

      // í•­ëª© ë°ì´í„° ë³µì›
      const loadedItems = receipt.items.map((item, index) => ({
        id: Date.now() + index,
        itemName: item.itemName,
        amount: item.amount.toString(),
        splitAmong: item.splitAmong.map(id => String(id)), // íƒ€ì… í†µì¼: stringìœ¼ë¡œ ë³€í™˜
        searchQuery: '',
        showSearchDropdown: false,
        expanded: true,
      }));
      setItems(loadedItems);

    } catch (error) {
      console.error('ì˜ìˆ˜ì¦ ë¡œë“œ ì‹¤íŒ¨:', error);
      alert('ì˜ìˆ˜ì¦ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      navigate('/settlement');
    } finally {
      setLoadingReceipt(false);
    }
  };

  const loadMembers = async () => {
    if (!selectedSpace) return;

    try {
      const spaceMembers = await settlementService.getSpaceMembers(selectedSpace.id);
      setMembers(spaceMembers);

      // users ì»¬ë ‰ì…˜ì—ì„œ í”„ë¡œí•„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      const userIds = spaceMembers.map(m => m.userId);
      if (userIds.length > 0) {
        const profiles = await authService.getUserProfiles(userIds);
        setUserProfiles(profiles);
      }
    } catch (error) {
      console.error('ë©¤ë²„ ë¡œë“œ ì‹¤íŒ¨:', error);
    }
  };

  // ê·€ì†ì¼ì— í•´ë‹¹í•˜ëŠ” ì£¼ì°¨ì˜ ì •ì‚° ìƒíƒœ í™•ì¸
  const checkTargetWeekSettlement = async () => {
    if (!selectedSpace || !belongsToDate) return;

    try {
      const targetDate = new Date(belongsToDate);
      const settlement = await settlementService.getSettlementByDate(selectedSpace.id, targetDate);

      setTargetWeekSettlement(settlement);
      setIsTargetWeekSettled(settlement?.status === 'settled');
    } catch (error) {
      console.error('ì£¼ì°¨ ì •ì‚° ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error);
      setTargetWeekSettlement(null);
      setIsTargetWeekSettled(false);
    }
  };

  // ì´ë¯¸ì§€ ì„ íƒ
  const handleImageChange = (e) => {
    const file = e.target.files[0];
    if (file) {
      setImageFile(file);
      const reader = new FileReader();
      reader.onloadend = () => {
        setImagePreview(reader.result);
      };
      reader.readAsDataURL(file);
    }
  };

  // Cloudinary ì´ë¯¸ì§€ ì—…ë¡œë“œ
  const uploadImageToCloudinary = async (file) => {
    const formData = new FormData();
    formData.append('file', file);
    formData.append('upload_preset', import.meta.env.VITE_CLOUDINARY_UPLOAD_PRESET);

    try {
      const response = await fetch(
        `https://api.cloudinary.com/v1_1/${import.meta.env.VITE_CLOUDINARY_CLOUD_NAME}/image/upload`,
        {
          method: 'POST',
          body: formData,
        }
      );

      if (!response.ok) {
        throw new Error('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨');
      }

      const data = await response.json();
      return data.secure_url;
    } catch (error) {
      console.error('Cloudinary ì—…ë¡œë“œ ì‹¤íŒ¨:', error);
      throw error;
    }
  };

  // í•­ëª© ì¶”ê°€
  const addItem = () => {
    setItems([
      ...items,
      {
        id: Date.now(),
        itemName: '',
        amount: '',
        splitAmong: user?.id ? [String(user.id)] : [], // íƒ€ì… í†µì¼: stringìœ¼ë¡œ ë³€í™˜
        searchQuery: '',
        showSearchDropdown: false,
        expanded: true,
      }
    ]);
  };

  // í•­ëª© ì ‘ê¸°/í¼ì¹˜ê¸° í† ê¸€
  const toggleItemExpanded = (itemId) => {
    setItems(items.map(item =>
      item.id === itemId ? { ...item, expanded: !item.expanded } : item
    ));
  };

  // í•­ëª© ì‚­ì œ
  const removeItem = (itemId) => {
    if (items.length === 1) {
      alert('ìµœì†Œ 1ê°œì˜ í•­ëª©ì´ í•„ìš”í•©ë‹ˆë‹¤.');
      return;
    }
    setItems(items.filter(item => item.id !== itemId));
  };

  // í•­ëª© ì—…ë°ì´íŠ¸
  const updateItem = (itemId, field, value) => {
    setItems(items.map(item => 
      item.id === itemId ? { ...item, [field]: value } : item
    ));
  };

  // ê²€ìƒ‰ì–´ë¡œ ë©¤ë²„ í•„í„°ë§
  const getFilteredMembers = (itemId) => {
    const item = items.find(i => i.id === itemId);
    if (!item || !item.searchQuery.trim()) return [];

    const query = item.searchQuery.toLowerCase();
    return members.filter(member =>
      member.displayName.toLowerCase().includes(query)
    );
  };

  // ë¶„ë‹´ì ì¶”ê°€
  const addMemberToSplit = (itemId, member) => {
    const item = items.find(i => i.id === itemId);

    // íƒ€ì… í†µì¼ì„ ìœ„í•´ stringìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ë¹„êµ
    const memberIdString = String(member.userId);
    const splitAmongStrings = item.splitAmong.map(id => String(id));

    // ì´ë¯¸ ì„ íƒëœ ë©¤ë²„ì¸ì§€ í™•ì¸
    if (splitAmongStrings.includes(memberIdString)) {
      return;
    }

    setItems(items.map(i =>
      i.id === itemId
        ? {
            ...i,
            splitAmong: [...i.splitAmong, memberIdString], // íƒ€ì… í†µì¼: stringìœ¼ë¡œ ë³€í™˜
            searchQuery: '',
            showSearchDropdown: false,
          }
        : i
    ));
  };

  // ë¶„ë‹´ì ì œê±°
  const removeMemberFromSplit = (itemId, userId) => {
    const item = items.find(i => i.id === itemId);
    // íƒ€ì… í†µì¼ì„ ìœ„í•´ stringìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ë¹„êµ
    const userIdString = String(userId);
    updateItem(itemId, 'splitAmong', item.splitAmong.filter(id => String(id) !== userIdString));
  };

  // ê²€ìƒ‰ ì…ë ¥ ì²˜ë¦¬
  const handleSearchChange = (itemId, value) => {
    setItems(items.map(item =>
      item.id === itemId
        ? {
            ...item,
            searchQuery: value,
            showSearchDropdown: value.trim() !== '',
          }
        : item
    ));
  };

  // ë‚©ë¶€ì ê²€ìƒ‰ í•„í„°ë§
  const getFilteredPaidByMembers = () => {
    if (!paidBySearchQuery.trim()) return [];

    const query = paidBySearchQuery.toLowerCase();
    return members.filter(member =>
      member.displayName.toLowerCase().includes(query)
    );
  };

  // ë‚©ë¶€ì ë³€ê²½
  const changePaidBy = (userId, userName) => {
    setPaidBy(String(userId)); // íƒ€ì… í†µì¼: stringìœ¼ë¡œ ë³€í™˜
    setPaidByName(userName);
    setPaidBySearchQuery('');
    setShowPaidByDropdown(false);
  };

  // ì œì¶œ ìœ íš¨ì„± ê²€ì‚¬
  const validateForm = () => {
    if (!imageFile && !existingImageUrl) {
      alert('ì˜ìˆ˜ì¦ ì‚¬ì§„ì„ ì²¨ë¶€í•´ì£¼ì„¸ìš”.');
      return false;
    }

    for (const item of items) {
      if (!item.itemName.trim()) {
        alert('í•­ëª©ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return false;
      }
      if (!item.amount || item.amount <= 0) {
        alert('ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return false;
      }
      if (item.splitAmong.length === 0) {
        alert(`"${item.itemName}" í•­ëª©ì˜ ë¶„ë‹´ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.`);
        return false;
      }
    }

    return true;
  };

  // ì œì¶œ/ìˆ˜ì •
  const handleSubmit = async () => {
    if (!validateForm()) return;

    try {
      setLoading(true);

      // ì´ë¯¸ì§€ ì²˜ë¦¬ (ìƒˆë¡œìš´ ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ ì—…ë¡œë“œ, ì—†ìœ¼ë©´ ê¸°ì¡´ URL ì‚¬ìš©)
      let imageUrl = existingImageUrl;
      if (imageFile) {
        setUploading(true);
        imageUrl = await uploadImageToCloudinary(imageFile);
        setUploading(false);
      }

      // ì˜ìˆ˜ì¦ ë°ì´í„° ì¤€ë¹„
      const receiptData = {
        paidBy,
        paidByName,
        memo,
        imageUrl,
        belongsToDate,  // ê·€ì†ì¼ ì¶”ê°€
        items: items.map(item => ({
          itemName: item.itemName,
          amount: parseInt(item.amount),
          splitAmong: item.splitAmong,
        })),
      };

      if (isEditMode) {
        // ìˆ˜ì • ëª¨ë“œ
        await settlementService.updateReceipt(selectedSpace.id, weekId, receiptId, receiptData);
        alert('ì˜ìˆ˜ì¦ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤! âœï¸');
      } else {
        // ì œì¶œ ëª¨ë“œ
        receiptData.submittedBy = user.id;
        receiptData.submittedByName = user.displayName;
        await settlementService.submitReceipt(selectedSpace.id, receiptData);
        alert('ì˜ìˆ˜ì¦ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰');
      }

      navigate('/settlement');

    } catch (error) {
      console.error(isEditMode ? 'ì˜ìˆ˜ì¦ ìˆ˜ì • ì‹¤íŒ¨:' : 'ì˜ìˆ˜ì¦ ì œì¶œ ì‹¤íŒ¨:', error);
      alert(isEditMode ? 'ì˜ìˆ˜ì¦ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.' : 'ì˜ìˆ˜ì¦ ì œì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
      setLoading(false);
      setUploading(false);
    }
  };

  const formatCurrency = (amount) => {
    return amount.toLocaleString('ko-KR');
  };

  const getTotalAmount = () => {
    return items.reduce((sum, item) => sum + (parseInt(item.amount) || 0), 0);
  };

  if (!isLoggedIn) {
    return <LoginOverlay />;
  }

  if (!selectedSpace) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center px-4">
        <div className="text-center">
          <div className="text-2xl mb-4">ğŸ </div>
          <p className="text-gray-600 mb-2">ìŠ¤í˜ì´ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
          <p className="text-sm text-gray-500">ì˜ˆì•½ í˜ì´ì§€ì—ì„œ ìŠ¤í˜ì´ìŠ¤ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”</p>
        </div>
      </div>
    );
  }

  if (loadingReceipt) {
    return (
      <div className="flex items-center justify-center h-screen bg-gray-50">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
          <p className="text-gray-600">ì˜ìˆ˜ì¦ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 pb-24">
      {/* í—¤ë” */}
      <div className="bg-white border-b border-gray-200 sticky top-0 z-10">
        <div className="px-4 py-4 flex items-center gap-3">
          <button
            onClick={() => navigate('/settlement')}
            className="w-10 h-10 rounded-full flex items-center justify-center hover:bg-gray-100"
          >
            <ArrowLeft className="w-6 h-6 text-gray-700" />
          </button>
          <h1 className="text-xl font-bold text-gray-900">
            {isEditMode ? 'ì˜ìˆ˜ì¦ ìˆ˜ì •' : 'ì˜ìˆ˜ì¦ ì œì¶œ'}
          </h1>
        </div>
      </div>

      <div className="p-4 space-y-4">
        {/* ê·€ì†ì¼ ì„ íƒ */}
        {!isEditMode && (
          <div className="bg-white rounded-xl p-4 shadow-sm" data-tour="belongs-date-section">
            <h3 className="font-bold text-gray-900 mb-3 flex items-center gap-2">
              <Calendar className="w-5 h-5 text-blue-600" />
              ê·€ì†ì¼
            </h3>
            <input
              type="date"
              value={belongsToDate}
              onChange={(e) => setBelongsToDate(e.target.value)}
              max={new Date().toISOString().split('T')[0]}
              className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              data-tour="belongs-date-input"
            />
            {isTargetWeekSettled && (
              <div className="mt-3 p-3 bg-amber-50 border border-amber-200 rounded-lg">
                <p className="text-sm text-amber-800">
                  âš ï¸ í•´ë‹¹ ì£¼ì°¨ ì •ì‚°ì´ ë§ˆê°ë˜ì–´ ì´ë²ˆ ì£¼ ì •ì‚°ì— ì¶”ê°€ë©ë‹ˆë‹¤.
                  <br />
                  <span className="text-xs text-amber-600 mt-1 block">
                    ê·€ì†ì¼ì€ {belongsToDate}ë¡œ ê¸°ë¡ë˜ì§€ë§Œ, ì •ì‚°ì€ ì´ë²ˆ ì£¼ì°¨ì— í¬í•¨ë©ë‹ˆë‹¤.
                  </span>
                </p>
              </div>
            )}
          </div>
        )}

        {/* ì˜ìˆ˜ì¦ ì‚¬ì§„ */}
        <div className="bg-white rounded-xl p-4 shadow-sm receipt-image-upload">
          <h3 className="font-bold text-gray-900 mb-3 flex items-center gap-2">
            <Camera className="w-5 h-5 text-blue-600" />
            ì˜ìˆ˜ì¦ ì‚¬ì§„
          </h3>
          
          {imagePreview ? (
            <div className="relative">
              <img 
                src={imagePreview} 
                alt="ì˜ìˆ˜ì¦ ë¯¸ë¦¬ë³´ê¸°" 
                className="w-full rounded-lg border border-gray-200"
              />
              <button
                onClick={() => {
                  setImageFile(null);
                  setImagePreview(null);
                }}
                className="absolute top-2 right-2 w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600"
              >
                <X className="w-5 h-5" />
              </button>
            </div>
          ) : (
            <label className="block w-full p-8 border-2 border-dashed border-gray-300 rounded-lg text-center cursor-pointer hover:bg-gray-50 transition-colors">
              <Camera className="w-12 h-12 text-gray-400 mx-auto mb-2" />
              <p className="text-sm text-gray-600">í´ë¦­í•˜ì—¬ ì‚¬ì§„ ì„ íƒ</p>
              <input
                type="file"
                accept="image/*"
                onChange={handleImageChange}
                className="hidden"
              />
            </label>
          )}
        </div>

        {/* ë‚©ë¶€ì ì„ íƒ */}
        <div className="bg-white rounded-xl p-4 shadow-sm paid-by-section">
          <h3 className="font-bold text-gray-900 mb-3 flex items-center gap-2">
            <User className="w-5 h-5 text-blue-600" />
            ëˆ ë‚¸ ì‚¬ëŒ
          </h3>

          {/* ì„ íƒëœ ë‚©ë¶€ì í‘œì‹œ */}
          {paidBy && paidByName && (
            <div className="mb-2">
              <div className="inline-flex items-center gap-2 bg-blue-100 text-blue-700 px-3 py-2 rounded-lg font-medium">
                {userProfiles[paidBy]?.profileImage ? (
                  <img
                    src={userProfiles[paidBy].profileImage}
                    alt={paidByName}
                    className="w-6 h-6 rounded-full object-cover"
                  />
                ) : (
                  <div className="w-6 h-6 rounded-full bg-blue-500 flex items-center justify-center text-white text-xs font-bold">
                    {paidByName[0]}
                  </div>
                )}
                <span>{paidByName}</span>
              </div>
            </div>
          )}

          {/* ê²€ìƒ‰ ì…ë ¥ */}
          <div className="relative">
            <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" />
            <input
              type="text"
              value={paidBySearchQuery}
              onChange={(e) => {
                setPaidBySearchQuery(e.target.value);
                setShowPaidByDropdown(e.target.value.trim() !== '');
              }}
              onFocus={() => paidBySearchQuery && setShowPaidByDropdown(true)}
              placeholder="ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰í•˜ì—¬ ì„ íƒ"
              className="w-full pl-9 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            />

            {/* ê²€ìƒ‰ ê²°ê³¼ ë“œë¡­ë‹¤ìš´ */}
            {showPaidByDropdown && paidBySearchQuery && (
              <div className="absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-48 overflow-y-auto">
                {(() => {
                  const filteredMembers = getFilteredPaidByMembers();
                  return filteredMembers.length > 0 ? (
                    filteredMembers.map((member) => {
                      const userProfile = userProfiles[member.userId];
                      const displayName = userProfile?.displayName || member.displayName;
                      const profileImage = userProfile?.profileImage || '';
                      const isSelected = paidBy === member.userId;

                      return (
                        <button
                          key={member.userId}
                          onClick={() => changePaidBy(member.userId, displayName)}
                          className={`w-full flex items-center gap-3 p-3 text-left transition-colors ${
                            isSelected
                              ? 'bg-blue-50 text-blue-700'
                              : 'hover:bg-gray-50'
                          }`}
                        >
                          {profileImage ? (
                            <img
                              src={profileImage}
                              alt={displayName}
                              className="w-8 h-8 rounded-full object-cover flex-shrink-0"
                            />
                          ) : (
                            <div className="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white text-sm font-bold flex-shrink-0">
                              {displayName[0]}
                            </div>
                          )}
                          <span className="font-medium flex-1">{displayName}</span>
                          {isSelected && (
                            <Check className="w-4 h-4 text-blue-600 flex-shrink-0" />
                          )}
                        </button>
                      );
                    })
                  ) : (
                    <div className="p-4 text-center text-gray-500 text-sm">
                      ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤
                    </div>
                  );
                })()}
              </div>
            )}
          </div>
        </div>

        {/* ë©”ëª¨ */}
        <div className="bg-white rounded-xl p-4 shadow-sm">
          
          <h3 className="font-bold text-gray-900 mb-3">ì‚¬ìš©ì²˜</h3>
          <input
            type="text"
            value={memo}
            onChange={(e) => setMemo(e.target.value)}
            placeholder="ì˜ˆ: ì‚°ë°‘ì—ì§‘, ë…¸ë‘í†µë‹­, íƒœì–‘ë°˜ì  ..."
            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>

        {/* í•­ëª© ëª©ë¡ */}
        <div className="space-y-3">
          {items.map((item, index) => (
            <div key={item.id} className="bg-white rounded-xl p-4 shadow-sm">
              {/* í—¤ë” (í•­ìƒ í‘œì‹œ) */}
              <div className="flex items-center justify-between mb-3">
                <button
                  onClick={() => toggleItemExpanded(item.id)}
                  className="flex-1 flex items-center gap-2 text-left"
                >
                  <h3 className="font-bold text-gray-900">í•­ëª© {index + 1}</h3>
                  {!item.expanded && item.itemName && (
                    <span className="text-sm text-gray-600">
                      â€¢ {item.itemName}
                      {item.amount && ` â€¢ ${formatCurrency(parseInt(item.amount))}ì›`}
                    </span>
                  )}
                  {item.expanded ? (
                    <ChevronUp className="w-5 h-5 text-gray-400 ml-auto" />
                  ) : (
                    <ChevronDown className="w-5 h-5 text-gray-400 ml-auto" />
                  )}
                </button>
                {items.length > 1 && (
                  <button
                    onClick={() => removeItem(item.id)}
                    className="w-8 h-8 rounded-full flex items-center justify-center hover:bg-red-50 text-red-600 transition-colors ml-2"
                  >
                    <Trash2 className="w-5 h-5" />
                  </button>
                )}
              </div>

              {/* í¼ì³ì§„ ë‚´ìš© */}
              {item.expanded && (
                <div className="space-y-3">

                  {/* í•­ëª©ëª… */}
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      í•­ëª©ëª…
                    </label>
                    <input
                      type="text"
                      value={item.itemName}
                      onChange={(e) => updateItem(item.id, 'itemName', e.target.value)}
                      placeholder="ì˜ˆ: ì–‘ë…ì¹˜í‚¨ 2ë§ˆë¦¬"
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                  </div>

                  {/* ê¸ˆì•¡ */}
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      ê¸ˆì•¡
                    </label>
                    <div className="relative">
                      <input
                        type="number"
                        value={item.amount}
                        onChange={(e) => updateItem(item.id, 'amount', e.target.value)}
                        placeholder="0"
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                      />
                      <span className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500">ì›</span>
                    </div>
                  </div>

                  {/* ë¶„ë‹´ì ì„ íƒ */}
                  <div className="item-split-section">
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      ë¶„ë‹´ì ì„ íƒ
                    </label>

                    {/* ì„ íƒëœ ë©¤ë²„ë“¤ í‘œì‹œ */}
                    {item.splitAmong.length > 0 && (
                      <div className="flex flex-wrap gap-2 mb-2">
                        {item.splitAmong.map((userId) => {
                          // íƒ€ì… í†µì¼ì„ ìœ„í•´ stringìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ë¹„êµ
                          const userIdString = String(userId);
                          const member = members.find(m => String(m.userId) === userIdString);
                          const userProfile = userProfiles[userId];
                          if (!member) return null;

                          const displayName = userProfile?.displayName || member.displayName;
                          const profileImage = userProfile?.profileImage || '';

                          return (
                            <div
                              key={userId}
                              className="inline-flex items-center gap-2 bg-blue-100 text-blue-700 px-2 py-1 rounded-full text-sm font-medium"
                            >
                              {profileImage ? (
                                <img
                                  src={profileImage}
                                  alt={displayName}
                                  className="w-6 h-6 rounded-full object-cover"
                                />
                              ) : (
                                <div className="w-6 h-6 rounded-full bg-blue-500 flex items-center justify-center text-white text-xs font-bold">
                                  {displayName[0]}
                                </div>
                              )}
                              <span>{displayName}</span>
                              <button
                                onClick={() => removeMemberFromSplit(item.id, userId)}
                                className="hover:bg-blue-200 rounded-full p-0.5"
                              >
                                <X className="w-4 h-4" />
                              </button>
                            </div>
                          );
                        })}
                      </div>
                    )}

                    {/* ê²€ìƒ‰ ì…ë ¥ */}
                    <div className="relative">
                      <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" />
                      <input
                        type="text"
                        value={item.searchQuery}
                        onChange={(e) => handleSearchChange(item.id, e.target.value)}
                        onFocus={() => item.searchQuery && updateItem(item.id, 'showSearchDropdown', true)}
                        placeholder="ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰í•˜ì—¬ ì¶”ê°€"
                        className="w-full pl-9 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                      />

                      {/* ê²€ìƒ‰ ê²°ê³¼ ë“œë¡­ë‹¤ìš´ */}
                      {item.showSearchDropdown && item.searchQuery && (
                        <div className="absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-48 overflow-y-auto">
                          {(() => {
                            const filteredMembers = getFilteredMembers(item.id);
                            return filteredMembers.length > 0 ? (
                              filteredMembers.map((member) => {
                                // íƒ€ì… í†µì¼ì„ ìœ„í•´ stringìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ë¹„êµ
                                const memberIdString = String(member.userId);
                                const splitAmongStrings = item.splitAmong.map(id => String(id));
                                const isAlreadySelected = splitAmongStrings.includes(memberIdString);
                                const userProfile = userProfiles[member.userId];
                                const displayName = userProfile?.displayName || member.displayName;
                                const profileImage = userProfile?.profileImage || '';

                                return (
                                  <button
                                    key={member.userId}
                                    onClick={() => addMemberToSplit(item.id, member)}
                                    disabled={isAlreadySelected}
                                    className={`w-full flex items-center gap-3 p-3 text-left transition-colors ${
                                      isAlreadySelected
                                        ? 'bg-gray-50 text-gray-400 cursor-not-allowed'
                                        : 'hover:bg-blue-50'
                                    }`}
                                  >
                                    {profileImage ? (
                                      <img
                                        src={profileImage}
                                        alt={displayName}
                                        className="w-8 h-8 rounded-full object-cover flex-shrink-0"
                                      />
                                    ) : (
                                      <div className="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white text-sm font-bold flex-shrink-0">
                                        {displayName[0]}
                                      </div>
                                    )}
                                    <span className="font-medium flex-1">{displayName}</span>
                                    {isAlreadySelected && (
                                      <Check className="w-4 h-4 text-gray-400 flex-shrink-0" />
                                    )}
                                  </button>
                                );
                              })
                            ) : (
                              <div className="p-4 text-center text-gray-500 text-sm">
                                ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤
                              </div>
                            );
                          })()}
                        </div>
                      )}
                    </div>

                    {/* 1/n ê³„ì‚° í‘œì‹œ */}
                    {item.amount && item.splitAmong.length > 0 && (
                      <div className="mt-2 p-2 bg-blue-50 rounded-lg text-center">
                        <p className="text-sm text-blue-800">
                          <span className="font-bold">1ì¸ë‹¹ {formatCurrency(Math.floor(parseInt(item.amount) / item.splitAmong.length))}ì›</span>
                          <span className="text-xs ml-1">({item.splitAmong.length}ëª… ë¶„ë‹´)</span>
                        </p>
                      </div>
                    )}
                  </div>
                </div>
              )}
            </div>
          ))}

          {/* í•­ëª© ì¶”ê°€ ë²„íŠ¼ */}
          <button
            onClick={addItem}
            className="w-full p-4 border-2 border-dashed border-gray-300 rounded-xl text-gray-600 hover:border-blue-400 hover:text-blue-600 hover:bg-blue-50 transition-colors flex items-center justify-center gap-2"
          >
            <Plus className="w-5 h-5" />
            <span className="font-medium">í•­ëª© ì¶”ê°€</span>
          </button>
        </div>

        {/* ì´ì•¡ í‘œì‹œ */}
        <div className="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-4 text-white shadow-lg">
          <div className="flex items-center justify-between">
            <span className="font-medium">ì´ ê¸ˆì•¡</span>
            <span className="text-2xl font-bold">{formatCurrency(getTotalAmount())}ì›</span>
          </div>
        </div>
      </div>

      {/* í•˜ë‹¨ ì œì¶œ ë²„íŠ¼ */}
      <div className="fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-200">
        <button
          onClick={handleSubmit}
          disabled={loading || uploading}
          className="w-full bg-blue-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-700 transition-colors"
        >
          {loading || uploading ? (
            <>
              <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
              <span>{uploading ? 'ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘...' : (isEditMode ? 'ìˆ˜ì • ì¤‘...' : 'ì œì¶œ ì¤‘...')}</span>
            </>
          ) : (
            <>
              <Check className="w-5 h-5" />
              <span>{isEditMode ? 'ìˆ˜ì •í•˜ê¸°' : 'ì œì¶œí•˜ê¸°'}</span>
            </>
          )}
        </button>
      </div>

    </div>
  );
};

export default SettlementSubmitPage;
</file>

<file path="src/pages/SignupPage.jsx">
// src/pages/SignupPage.jsx
import { useState, useEffect } from 'react';
import { useNavigate, useLocation } from 'react-router-dom';
import { useAuth } from '../hooks/useAuth';
import authService from '../services/authService';

const SignupPage = () => {
  const navigate = useNavigate();
  const location = useLocation();
  const { login } = useAuth();

  // ì¹´ì¹´ì˜¤ì—ì„œ ë°›ì•„ì˜¨ ê¸°ë³¸ ì •ë³´
  const kakaoUserInfo = location.state?.kakaoUserInfo;
  const from = location.state?.from || '/';

  console.log('ğŸ“ SignupPage - location.state:', location.state);
  console.log('ğŸ“ SignupPage - kakaoUserInfo:', kakaoUserInfo);

  const [formData, setFormData] = useState({
    birthyear: '',
    gender: '',
    phoneNumber: ''
  });
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [errors, setErrors] = useState({});
  const [agreements, setAgreements] = useState({
    terms: false,
    privacy: false,
    personalInfo: false
  });

  useEffect(() => {
    // ì¹´ì¹´ì˜¤ ì •ë³´ ì—†ì´ ì§ì ‘ ì ‘ê·¼í•˜ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ
    if (!kakaoUserInfo) {
      console.log('âŒ kakaoUserInfo ì—†ìŒ - ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸');
      navigate('/', { replace: true });
    }
  }, [kakaoUserInfo, navigate]);

  const formatPhoneNumber = (value) => {
    const numbers = value.replace(/[^0-9]/g, '');
    if (numbers.length <= 3) return numbers;
    if (numbers.length <= 7) return `${numbers.slice(0, 3)}-${numbers.slice(3)}`;
    return `${numbers.slice(0, 3)}-${numbers.slice(3, 7)}-${numbers.slice(7, 11)}`;
  };

  // âœ… ì¹´ì¹´ì˜¤ ê°’ì´ ìˆìœ¼ë©´ ì´ˆê¸° ì„¸íŒ…(ìˆì„ ë•Œë§Œ)
  useEffect(() => {
    if (!kakaoUserInfo) return;

    // phone normalize: "+82 10-1234-5678" -> "01012345678"
    const normalizePhone = (raw) => {
      if (!raw) return '';
      const digits = raw.replace(/[^0-9]/g, '');
      if (digits.startsWith('82')) return '0' + digits.slice(2);
      return digits;
    };

    setFormData(prev => ({
      ...prev,
      birthyear: kakaoUserInfo.birthyear || prev.birthyear,
      gender: kakaoUserInfo.gender || prev.gender,
      phoneNumber: kakaoUserInfo.phoneNumber
        ? formatPhoneNumber(normalizePhone(kakaoUserInfo.phoneNumber))
        : prev.phoneNumber
    }));
  }, [kakaoUserInfo]);

  const validateForm = () => {
    const newErrors = {};

    // ì¶œìƒë…„ë„ ê²€ì¦ (ì—†ìœ¼ë©´ ì§ì ‘ ì…ë ¥ í•„ìˆ˜)
    if (!formData.birthyear) {
      newErrors.birthyear = 'ì¶œìƒë…„ë„ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”';
    } else if (!/^\d{4}$/.test(formData.birthyear)) {
      newErrors.birthyear = '4ìë¦¬ ìˆ«ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”';
    } else {
      const year = parseInt(formData.birthyear);
      const currentYear = new Date().getFullYear();
      if (year < 1900 || year > currentYear) {
        newErrors.birthyear = 'ì˜¬ë°”ë¥¸ ì¶œìƒë…„ë„ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”';
      }
    }

    // ì„±ë³„ ê²€ì¦ (ì—†ìœ¼ë©´ ì§ì ‘ ì…ë ¥ í•„ìˆ˜)
    if (!formData.gender) {
      newErrors.gender = 'ì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”';
    }

    // ì „í™”ë²ˆí˜¸ ê²€ì¦ (ì—†ìœ¼ë©´ ì§ì ‘ ì…ë ¥ í•„ìˆ˜)
    if (!formData.phoneNumber) {
      newErrors.phoneNumber = 'ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”';
    } else {
      const phoneClean = formData.phoneNumber.replace(/[^0-9]/g, '');
      if (!/^01[0-9]{8,9}$/.test(phoneClean)) {
        newErrors.phoneNumber = 'ì˜¬ë°”ë¥¸ íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”';
      }
    }

    // ì•½ê´€ ë™ì˜ ê²€ì¦
    if (!agreements.terms) {
      newErrors.agreements = 'ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”';
    }
    if (!agreements.privacy) {
      newErrors.agreements = 'ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ì— ë™ì˜í•´ì£¼ì„¸ìš”';
    }
    if (!agreements.personalInfo) {
      newErrors.agreements = 'ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•´ì£¼ì„¸ìš”';
    }

    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({ ...prev, [name]: value }));
    if (errors[name]) {
      setErrors(prev => ({ ...prev, [name]: '' }));
    }
  };

  const handlePhoneChange = (e) => {
    const formatted = formatPhoneNumber(e.target.value);
    setFormData(prev => ({ ...prev, phoneNumber: formatted }));
    if (errors.phoneNumber) {
      setErrors(prev => ({ ...prev, phoneNumber: '' }));
    }
  };

  const handleAgreementChange = (key) => {
    setAgreements(prev => ({ ...prev, [key]: !prev[key] }));
    if (errors.agreements) {
      setErrors(prev => ({ ...prev, agreements: '' }));
    }
  };

  const handleAllAgreements = (checked) => {
    setAgreements({
      terms: checked,
      privacy: checked,
      personalInfo: checked
    });
    if (checked && errors.agreements) {
      setErrors(prev => ({ ...prev, agreements: '' }));
    }
  };

  const handleSubmit = async (e) => {
    e.preventDefault();

    if (!validateForm()) return;

    setIsSubmitting(true);

    try {
      const phoneClean = formData.phoneNumber.replace(/[^0-9]/g, '');

      const fullUserData = {
        id: kakaoUserInfo.id,
        displayName: kakaoUserInfo.displayName,
        email: kakaoUserInfo.email,
        profileImage: kakaoUserInfo.profileImage,
        provider: 'kakao',
        birthyear: formData.birthyear,
        gender: formData.gender,
        phoneNumber: phoneClean
      };

      await authService.registerUser(fullUserData);
      await login(kakaoUserInfo);

      console.log('âœ… íšŒì›ê°€ì… ì™„ë£Œ, ì´ë™í•  ê²½ë¡œ:', from);
      navigate(from, { replace: true });
    } catch (error) {
      console.error('íšŒì›ê°€ì… ì‹¤íŒ¨:', error);
      alert(`íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n${error?.message ?? ''}`);
    } finally {
      setIsSubmitting(false);
    }
  };

  if (!kakaoUserInfo) {
    return null;
  }

  const allAgreed = agreements.terms && agreements.privacy && agreements.personalInfo;

  // âœ… ì¹´ì¹´ì˜¤ì—ì„œ ê°’ì´ ìˆëŠ”ì§€ ì—¬ë¶€
  const hasKakaoBirthyear = !!kakaoUserInfo.birthyear;
  const hasKakaoGender = !!kakaoUserInfo.gender;
  const hasKakaoPhone = !!kakaoUserInfo.phoneNumber;

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-blue-100 p-4">
      <div className="w-full max-w-md bg-white rounded-2xl shadow-xl p-8">
        {/* í—¤ë” */}
        <div className="text-center mb-8">
          {kakaoUserInfo.profileImage && (
            <img
              src={kakaoUserInfo.profileImage}
              alt="í”„ë¡œí•„"
              className="w-24 h-24 rounded-full mx-auto mb-4 ring-4 ring-blue-100"
            />
          )}
          <h1 className="text-2xl font-bold text-gray-900 mb-2">íšŒì›ê°€ì…</h1>
          <p className="text-gray-600">
            {kakaoUserInfo.displayName}ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!
          </p>
        </div>

        <form onSubmit={handleSubmit} className="space-y-6">
          {/* ì¹´ì¹´ì˜¤ ê³„ì • ì •ë³´ (ìë™ ì…ë ¥) */}
          <div className="bg-blue-50 rounded-xl p-4 border border-blue-100">
            <h3 className="text-sm font-semibold text-gray-700 mb-3">ì¹´ì¹´ì˜¤ ê³„ì • ì •ë³´</h3>
            <div className="space-y-2 text-sm">
              <div className="flex justify-between items-center">
                <span className="text-gray-600">ì´ë¦„</span>
                <span className="font-medium text-gray-900">{kakaoUserInfo.displayName}</span>
              </div>

              <div className="flex justify-between items-center">
                <span className="text-gray-600">ì¹´ì¹´ì˜¤ ì´ë©”ì¼</span>
                <span className="font-medium text-gray-900">{kakaoUserInfo.email || 'ë¯¸ì œê³µ'}</span>
              </div>

              {/* âœ… ì „í™”ë²ˆí˜¸ë¥¼ ê°™ì€ ìœ„ê³„ë¡œ ì´ë™ */}
              <div className="flex justify-between items-center gap-3">
                <span className="text-gray-600">ì „í™”ë²ˆí˜¸</span>
                {hasKakaoPhone ? (
                  <span className="font-medium text-gray-900">{formData.phoneNumber || 'ë¯¸ì œê³µ'}</span>
                ) : (
                  <input
                    type="tel"
                    name="phoneNumber"
                    value={formData.phoneNumber}
                    onChange={handlePhoneChange}
                    placeholder="010-1234-5678"
                    maxLength={13}
                    className={`w-40 px-2 py-1 border rounded-md text-right bg-white focus:outline-none focus:ring-2
                      ${errors.phoneNumber
                        ? 'border-red-300 focus:ring-red-200'
                        : 'border-gray-300 focus:ring-blue-200'}`}
                  />
                )}
              </div>

              {errors.phoneNumber && !hasKakaoPhone && (
                <p className="text-red-500 text-sm mt-1">{errors.phoneNumber}</p>
              )}
            </div>
          </div>

          {/* ì¶”ê°€ ì •ë³´ ì…ë ¥ */}
          <div>
            <h3 className="text-sm font-semibold text-gray-700 mb-4">
              ì¶”ê°€ ì •ë³´ ì…ë ¥ <span className="text-red-500">*</span>
            </h3>

            {/* ì¶œìƒë…„ë„ */}
            <div className="mb-4">
              <label className="block text-sm font-medium text-gray-700 mb-2">
                ì¶œìƒë…„ë„ <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                name="birthyear"
                value={formData.birthyear}
                onChange={handleChange}
                placeholder="ì˜ˆ: 1990"
                maxLength={4}
                readOnly={hasKakaoBirthyear}
                disabled={hasKakaoBirthyear}
                className={`w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 
                  ${errors.birthyear
                    ? 'border-red-300 focus:ring-red-200'
                    : 'border-gray-300 focus:ring-blue-200'}
                  ${hasKakaoBirthyear ? 'bg-gray-100' : ''}`}
              />
              {errors.birthyear && (
                <p className="text-red-500 text-sm mt-1">{errors.birthyear}</p>
              )}
            </div>

            {/* ì„±ë³„ */}
            <div className="mb-4">
              <label className="block text-sm font-medium text-gray-700 mb-2">
                ì„±ë³„ <span className="text-red-500">*</span>
              </label>

              {/* âœ… ì¹´ì¹´ì˜¤ì— ê°’ ìˆìœ¼ë©´ ì ê¸ˆ(ì„ íƒ ë¶ˆê°€) */}
              <div className={`flex gap-3 ${hasKakaoGender ? 'pointer-events-none' : ''}`}>
                <label className={`flex-1 flex items-center justify-center py-3 px-4 border-2 rounded-xl transition-all ${
                  formData.gender === 'male'
                    ? 'border-blue-500 bg-blue-50 text-blue-700'
                    : 'border-gray-300 hover:border-gray-400'
                } ${hasKakaoGender ? 'cursor-default' : 'cursor-pointer'}`}>
                  <input
                    type="radio"
                    name="gender"
                    value="male"
                    checked={formData.gender === 'male'}
                    onChange={handleChange}
                    className="sr-only"
                    disabled={hasKakaoGender}
                  />
                  <span className="font-medium">ë‚¨ì„±</span>
                </label>

                <label className={`flex-1 flex items-center justify-center py-3 px-4 border-2 rounded-xl transition-all ${
                  formData.gender === 'female'
                    ? 'border-blue-500 bg-blue-50 text-blue-700'
                    : 'border-gray-300 hover:border-gray-400'
                } ${hasKakaoGender ? 'cursor-default' : 'cursor-pointer'}`}>
                  <input
                    type="radio"
                    name="gender"
                    value="female"
                    checked={formData.gender === 'female'}
                    onChange={handleChange}
                    className="sr-only"
                    disabled={hasKakaoGender}
                  />
                  <span className="font-medium">ì—¬ì„±</span>
                </label>
              </div>

              {errors.gender && (
                <p className="text-red-500 text-sm mt-1">{errors.gender}</p>
              )}
            </div>
          </div>

          {/* ì•½ê´€ ë™ì˜ */}
          <div className="border-t pt-6">
            <h3 className="text-sm font-semibold text-gray-700 mb-4">
              ì•½ê´€ ë™ì˜ <span className="text-red-500">*</span>
            </h3>

            {/* ì „ì²´ ë™ì˜ */}
            <label className="flex items-center p-4 bg-gray-50 rounded-xl mb-3 cursor-pointer hover:bg-gray-100 transition-colors">
              <input
                type="checkbox"
                checked={allAgreed}
                onChange={(e) => handleAllAgreements(e.target.checked)}
                className="w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"
              />
              <span className="ml-3 font-semibold text-gray-900">ì „ì²´ ë™ì˜</span>
            </label>

            {/* ê°œë³„ ë™ì˜ */}
            <div className="space-y-3 pl-2">
              <label className="flex items-start cursor-pointer group">
                <div className="flex items-center h-5">
                  <input
                    type="checkbox"
                    checked={agreements.terms}
                    onChange={() => handleAgreementChange('terms')}
                    className="w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"
                  />
                </div>
                <div className="ml-3 flex-1">
                  <span className="text-sm text-gray-700">[í•„ìˆ˜] ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€</span>
                  <a
                    href="/terms"
                    target="_blank"
                    rel="noopener noreferrer"
                    className="text-xs text-blue-600 hover:underline ml-2"
                  >
                    ë³´ê¸°
                  </a>
                </div>
              </label>

              <label className="flex items-start cursor-pointer group">
                <div className="flex items-center h-5">
                  <input
                    type="checkbox"
                    checked={agreements.privacy}
                    onChange={() => handleAgreementChange('privacy')}
                    className="w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"
                  />
                </div>
                <div className="ml-3 flex-1">
                  <span className="text-sm text-gray-700">[í•„ìˆ˜] ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</span>
                  <a
                    href="/privacy"
                    target="_blank"
                    rel="noopener noreferrer"
                    className="text-xs text-blue-600 hover:underline ml-2"
                  >
                    ë³´ê¸°
                  </a>
                </div>
              </label>

              <label className="flex items-start cursor-pointer group">
                <div className="flex items-center h-5">
                  <input
                    type="checkbox"
                    checked={agreements.personalInfo}
                    onChange={() => handleAgreementChange('personalInfo')}
                    className="w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"
                  />
                </div>
                <div className="ml-3 flex-1">
                  <span className="text-sm text-gray-700">[í•„ìˆ˜] ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë™ì˜</span>
                  <div className="text-xs text-gray-500 mt-1">
                    â€¢ ìˆ˜ì§‘í•­ëª©: ì´ë¦„, ì„±ë³„, ì¶œìƒë…„ë„, ì¹´ì¹´ì˜¤ê³„ì •(ì „í™”ë²ˆí˜¸)<br/>
                    â€¢ ì´ìš©ëª©ì : íšŒì› ì‹ë³„, ì„œë¹„ìŠ¤ ì œê³µ<br/>
                    â€¢ ë³´ìœ ê¸°ê°„: íšŒì› íƒˆí‡´ ì‹œê¹Œì§€
                  </div>
                </div>
              </label>
            </div>

            {errors.agreements && (
              <p className="text-red-500 text-sm mt-2">{errors.agreements}</p>
            )}
          </div>

          {/* ì œì¶œ ë²„íŠ¼ */}
          <button
            type="submit"
            disabled={isSubmitting}
            className={`w-full py-4 rounded-xl font-semibold text-lg transition-all
              ${isSubmitting
                ? 'bg-gray-400 cursor-not-allowed'
                : 'bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white shadow-lg hover:shadow-xl'}`}
          >
            {isSubmitting ? (
              <span className="flex items-center justify-center gap-2">
                <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin" />
                ê°€ì… ì²˜ë¦¬ ì¤‘...
              </span>
            ) : (
              'ê°€ì… ì™„ë£Œ'
            )}
          </button>
        </form>

        {/* ì•ˆë‚´ ë¬¸êµ¬ */}
        <p className="text-xs text-gray-500 text-center mt-6">
          ê°€ì…í•˜ì‹œë©´ ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ ë° ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ì— ë™ì˜í•˜ê²Œ ë©ë‹ˆë‹¤.
        </p>
      </div>
    </div>
  );
};

export default SignupPage;
</file>

<file path="src/pages/SlopesPage.jsx">
// pages/SlopesPage.jsx
import { useState } from 'react';
import { MountainSnow } from 'lucide-react';
import { useAuth } from '../hooks/useAuth';
import LoginOverlay from '../components/auth/LoginOverlay';

export default function SlopesPage() {
  const { isLoggedIn } = useAuth();
  const [activeTab, setActiveTab] = useState('slopes'); // 'slopes' or 'video'

  const tabs = {
    slopes: {
      label: 'ì˜¤í”ˆìŠ¬ë¡œí”„',
      url: 'https://phoenixhnr.co.kr/m/static/pyeongchang/snowpark/slope-lift?tabId=3'
    },
    video: {
      label: 'í˜„ì¥ì˜ìƒ',
      url: 'https://phoenixhnr.co.kr/page/pyeongchang/guide/operation/sketchMovie'
    }
  };

  if (!isLoggedIn) {
    return <LoginOverlay />;
  }

  return (
    <div className="min-h-screen bg-gray-50">
      {/* í—¤ë” */}
      <header className="sticky top-0 z-10 bg-white border-b border-gray-200 shadow-sm">
        <div className="max-w-[720px] mx-auto px-4 py-4">
          <div className="flex items-center gap-2 mb-3">
            <MountainSnow className="text-blue-600" size={24} />
            <div>
              <h1 className="text-xl font-bold text-gray-900">ìŠ¬ë¡œí”„ í˜„í™©</h1>
              <p className="text-sm text-gray-600">íœ˜ë‹‰ìŠ¤ í‰ì°½ ìŠ¤ë…¸ìš°íŒŒí¬</p>
            </div>
          </div>
          
          {/* íƒ­ ë²„íŠ¼ */}
          <div className="flex gap-2">
            <button
              onClick={() => setActiveTab('slopes')}
              className={`flex-1 py-2 rounded-lg text-sm font-semibold transition-all ${
                activeTab === 'slopes'
                  ? 'bg-blue-500 text-white shadow-md'
                  : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
              }`}
            >
              ì˜¤í”ˆìŠ¬ë¡œí”„
            </button>
            <button
              onClick={() => setActiveTab('video')}
              className={`flex-1 py-2 rounded-lg text-sm font-semibold transition-all ${
                activeTab === 'video'
                  ? 'bg-blue-500 text-white shadow-md'
                  : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
              }`}
            >
              í˜„ì¥ì˜ìƒ
            </button>
            <button
              onClick={() => window.open('https://www.snow-forecast.com/resorts/Phoenix-Park-Ski-World/6day/mid', '_blank')}
              className="flex-1 py-2 rounded-lg text-sm font-semibold transition-all bg-gray-100 text-gray-600 hover:bg-gray-200"
            >
              snow-forecast
            </button>
          </div>
          
          {/* ì•ˆë‚´ ë¬¸êµ¬ */}
          <div className="mt-2">
            <p className="text-xs text-center text-gray-500">
              ğŸ’¡ ì •ë³´ëŠ” íœ˜ë‹‰ìŠ¤ íŒŒí¬ ê³µì‹ í™ˆí˜ì´ì§€ì—ì„œ ì œê³µë©ë‹ˆë‹¤
            </p>
          </div>
        </div>
      </header>

      {/* iframe - ì˜ì—­ ìµœëŒ€í™” */}
      <div className="max-w-[720px] mx-auto">
        <iframe
          key={activeTab}
          src={tabs[activeTab].url}
          className="w-full border-0"
          style={{ height: 'calc(100vh - 180px - 64px)' }} // ì „ì²´ - í—¤ë” - BottomNav
          title={`íœ˜ë‹‰ìŠ¤ íŒŒí¬ ${tabs[activeTab].label}`}
          loading="lazy"
        />
      </div>

      {/* BottomNavë¥¼ ìœ„í•œ ì—¬ë°± */}
      <div style={{ height: 'calc(64px + env(safe-area-inset-bottom))' }} />
    </div>
  );
}
</file>

<file path="src/pages/SpaceManagePage.jsx">
import { useNavigate } from 'react-router-dom';
import useStore from '../store/useStore';
import { ArrowLeft, Settings, Users, Bell, Info, Crown, DollarSign, CreditCard } from 'lucide-react';
import { canManageSpace } from '../utils/permissions';
import { USER_TYPES } from '../utils/constants';
import { useEffect } from 'react';

export default function SpaceManagePage() {
  const navigate = useNavigate();
  const { user, selectedSpace } = useStore();

  // ê¶Œí•œ ì²´í¬
  useEffect(() => {
    console.log('ğŸ” SpaceManagePage ê¶Œí•œ ì²´í¬:', { user, selectedSpace });
    
    if (!user || !selectedSpace) {
      console.warn('âš ï¸ user ë˜ëŠ” selectedSpace ì—†ìŒ');
      alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
      navigate('/');
      return;
    }

    const spaceId = selectedSpace.id || selectedSpace.spaceId;
    const userSpaceData = user.spaceAccess?.find(s => s.spaceId === spaceId);
    
    if (!userSpaceData || !canManageSpace(userSpaceData.userType)) {
      console.warn('âš ï¸ ê¶Œí•œ ì—†ìŒ:', userSpaceData?.userType);
      alert('ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ë§¤ë‹ˆì €ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
      navigate('/');
      return;
    }
    
    console.log('âœ… ê¶Œí•œ í™•ì¸ ì™„ë£Œ');
  }, [user, selectedSpace, navigate]);

  const menuItems = [
    {
      id: 'space-settings',
      title: 'ìŠ¤í˜ì´ìŠ¤ ì„¤ì •',
      description: 'ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ ë“± ê¸°ë³¸ ì„¤ì •',
      icon: Settings,
      color: 'from-blue-500 to-blue-600',
      path: '/space/settings'
    },
    {
      id: 'member-manage',
      title: 'ë©¤ë²„ ê´€ë¦¬',
      description: 'ë©¤ë²„ ê¶Œí•œ ë³€ê²½ ë° ê´€ë¦¬',
      icon: Users,
      color: 'from-purple-500 to-purple-600',
      path: '/space/members'
    },
    {
      id: 'alimtalk-settings',
      title: 'ì•Œë¦¼í†¡ ì„¤ì •',
      description: 'ì•Œë¦¼í†¡ ë°œì†¡ on/off',
      icon: Bell,
      color: 'from-green-500 to-green-600',
      path: '/space/alimtalk'
    },
    {
      id: 'guest-policy',
      title: 'ê²ŒìŠ¤íŠ¸ ì •ì±… ê´€ë¦¬',
      description: 'ê²ŒìŠ¤íŠ¸ ìš”ê¸ˆ ë° ê³„ì¢Œ ì •ë³´ ì„¤ì •',
      icon: DollarSign,
      color: 'from-yellow-500 to-orange-600',
      path: '/space/guestpolicy'
    },
    {
      id: 'settlement-account',
      title: 'ì •ì‚° ê³„ì¢Œ ê´€ë¦¬',
      description: 'ì •ì‚° ì•Œë¦¼í†¡ìš© ê³„ì¢Œ ì •ë³´ ì„¤ì •',
      icon: CreditCard,
      color: 'from-emerald-500 to-teal-600',
      path: '/space/settlement'
    },
    {
      id: 'transfer-manager',
      title: 'ë§¤ë‹ˆì € ê¶Œí•œ ì–‘ë„',
      description: 'ë‹¤ë¥¸ ë©¤ë²„ì—ê²Œ ë§¤ë‹ˆì € ê¶Œí•œ ì´ì „',
      icon: Crown,
      color: 'from-red-500 to-red-600',
      path: '/space/transfer-manager',
      managerOnly: true // ë§¤ë‹ˆì €ë§Œ í‘œì‹œ
    }
  ];

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 pb-20">
      {/* í—¤ë” */}
      <div className="bg-gradient-to-r from-slate-800 to-slate-700 border-b border-slate-600/30 sticky top-0 z-10 shadow-lg">
        <div className="max-w-2xl mx-auto px-4 py-4">
          <div className="flex items-center gap-3">
            <button
              onClick={() => navigate('/')}
              className="p-2 hover:bg-white/10 rounded-lg transition-colors"
            >
              <ArrowLeft className="w-5 h-5 text-white" />
            </button>
            <div>
              <h1 className="text-xl font-bold text-white">ìŠ¤í˜ì´ìŠ¤ ê´€ë¦¬</h1>
              <p className="text-sm text-slate-300">{selectedSpace?.spaceName || ''}</p>
            </div>
          </div>
        </div>
      </div>

      {/* ë©”ë‰´ ì¹´ë“œ */}
      <div className="max-w-2xl mx-auto px-4 py-6">
        <div className="space-y-4">
          {menuItems
            .filter(item => {
              // managerOnly í”Œë˜ê·¸ê°€ ìˆìœ¼ë©´ ë§¤ë‹ˆì €ë§Œ í‘œì‹œ
              if (item.managerOnly) {
                const spaceId = selectedSpace.id || selectedSpace.spaceId;
                const userSpaceData = user.spaceAccess?.find(s => s.spaceId === spaceId);
                return userSpaceData?.userType === USER_TYPES.MANAGER;
              }
              return true;
            })
            .map((item) => {
            const Icon = item.icon;
            return (
              <button
                key={item.id}
                onClick={() => navigate(item.path)}
                className="w-full bg-gradient-to-br from-slate-800/80 to-slate-700/50 backdrop-blur-sm border border-slate-600/30 rounded-xl p-5 shadow-lg hover:shadow-xl transition-all hover:scale-[1.02] active:scale-[0.98]"
              >
                <div className="flex items-center gap-4">
                  <div className={`w-14 h-14 rounded-xl bg-gradient-to-br ${item.color} flex items-center justify-center shadow-lg`}>
                    <Icon className="w-7 h-7 text-white" />
                  </div>
                  <div className="flex-1 text-left">
                    <h3 className="text-lg font-bold text-white mb-1">
                      {item.title}
                    </h3>
                    <p className="text-sm text-slate-400">
                      {item.description}
                    </p>
                  </div>
                  <ArrowLeft className="w-5 h-5 text-slate-400 rotate-180" />
                </div>
              </button>
            );
          })}
        </div>

        {/* ì•ˆë‚´ ë©”ì‹œì§€ */}
        <div className="mt-6 bg-blue-500/10 border border-blue-500/30 rounded-xl p-4">
          <div className="flex items-start gap-3">
            <Info className="w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5" />
            <div className="text-sm text-blue-300">
              <p className="font-medium mb-2">ê´€ë¦¬ì ì•ˆë‚´</p>
              <ul className="space-y-1 text-blue-200/80">
                <li>â€¢ ë§¤ë‹ˆì €ë§Œ ìŠ¤í˜ì´ìŠ¤ ì„¤ì •ì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                <li>â€¢ ë³€ê²½ ì‚¬í•­ì€ ì¦‰ì‹œ ë°˜ì˜ë˜ë©°, ëª¨ë“  ë©¤ë²„ì—ê²Œ ì ìš©ë©ë‹ˆë‹¤.</li>
                <li>â€¢ ì¤‘ìš”í•œ ì„¤ì • ë³€ê²½ ì‹œ ì‹ ì¤‘íˆ ê²°ì •í•´ì£¼ì„¸ìš”.</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/services/spaceService.js">
// src/services/spaceService.js
import { doc, getDoc, setDoc, collection, query, where, getDocs, Timestamp, addDoc, updateDoc } from 'firebase/firestore';
import { db } from '../config/firebase';
import adminSettingsService from './adminSettingsService';

class SpaceService {
  // ----- 1) ìŠ¤í˜ì´ìŠ¤ ì½”ë“œë¡œ ìŠ¤í˜ì´ìŠ¤ ì¡´ì¬ ì—¬ë¶€ í™•ì¸ -----
  async getSpaceByCode(spaceCode) {
    try {
      const spaceRef = doc(db, 'spaces', spaceCode);
      const spaceSnap = await getDoc(spaceRef);
      
      if (!spaceSnap.exists()) {
        return null;
      }
      
      return {
        id: spaceSnap.id,
        ...spaceSnap.data()
      };
    } catch (error) {
      console.error('[SpaceService] getSpaceByCode ì‹¤íŒ¨:', error);
      throw error;
    }
  }

  // ----- 2) ì‚¬ìš©ìê°€ ì´ë¯¸ í•´ë‹¹ ìŠ¤í˜ì´ìŠ¤ì— ê°€ì…ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ -----
  async checkUserInSpace(userId, spaceId) {
    try {
      const userSpaceRef = doc(db, `users/${userId}/spaceAccess`, spaceId);
      const userSpaceSnap = await getDoc(userSpaceRef);
      return userSpaceSnap.exists();
    } catch (error) {
      console.error('[SpaceService] checkUserInSpace ì‹¤íŒ¨:', error);
      return false;
    }
  }

  // ----- 3) ìŠ¤í˜ì´ìŠ¤ì— ì‚¬ìš©ì ì¶”ê°€ (ì–‘ë°©í–¥) -----
  async joinSpace(userId, spaceId, userData) {
    try {
      // userIdë¥¼ ë¬¸ìì—´ë¡œ ë³€í™˜
      const userIdStr = String(userId);
      const spaceIdStr = String(spaceId);
      const now = Timestamp.now();  // Firebase Timestamp ì‚¬ìš©
      
      console.log('ğŸ”µ [joinSpace] ì‹œì‘:', { userIdStr, spaceIdStr, userData });
      
      // ìŠ¤í˜ì´ìŠ¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      const space = await this.getSpaceByCode(spaceIdStr);
      if (!space) {
        throw new Error('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë°©ì…ë‹ˆë‹¤.');
      }

      // ì´ë¯¸ ê°€ì…ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
      const alreadyJoined = await this.checkUserInSpace(userIdStr, spaceIdStr);
      if (alreadyJoined) {
        console.log('âš ï¸ [joinSpace] ì´ë¯¸ ê°€ì…ë¨:', userIdStr);
        return { alreadyJoined: true };
      }

      // 1) users/{userId}/spaceAccess/{spaceId} ìƒì„±
      const userSpaceRef = doc(db, `users/${userIdStr}/spaceAccess`, spaceIdStr);
      const userSpaceData = {
        joinedAt: now,
        order: 0, // ê¸°ë³¸ê°’, ë‚˜ì¤‘ì— ì‚¬ìš©ìê°€ ë³€ê²½ ê°€ëŠ¥
        spaceName: space.name || spaceIdStr,
        status: 'active',
        updatedAt: now,
        userType: 'guest' // ê¸°ë³¸ guestë¡œ ê°€ì…
      };
      
      await setDoc(userSpaceRef, userSpaceData);
      console.log('âœ… [joinSpace] users/{userId}/spaceAccess ìƒì„±:', userSpaceData);

      // 2) spaces/{spaceId}/assignedUsers/{userId} ìƒì„±
      const spaceUserRef = doc(db, `spaces/${spaceIdStr}/assignedUsers`, userIdStr);
      const spaceUserData = {
        displayName: userData.displayName || '',
        email: userData.email || '',
        joinedAt: now,
        profileImage: userData.profileImage || '',
        status: 'active',
        userType: 'guest'
      };
      
      await setDoc(spaceUserRef, spaceUserData);
      console.log('âœ… [joinSpace] spaces/{spaceId}/assignedUsers ìƒì„±:', spaceUserData);

      console.log(`âœ… [joinSpace] ì™„ë£Œ: ì‚¬ìš©ì ${userIdStr}ê°€ ìŠ¤í˜ì´ìŠ¤ ${spaceIdStr}ì— ê°€ì…`);
      return { success: true };
    } catch (error) {
      console.error('âŒ [SpaceService] joinSpace ì‹¤íŒ¨:', error);
      throw error;
    }
  }

  // ----- 4) ì‚¬ìš©ìì˜ ëª¨ë“  ìŠ¤í˜ì´ìŠ¤ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° (ê³„ì¢Œ ì •ë³´ í¬í•¨) -----
  async getUserSpaces(userId) {
    try {
      const spaceAccessRef = collection(db, `users/${userId}/spaceAccess`);
      const snapshot = await getDocs(spaceAccessRef);
      
      // ê° ìŠ¤í˜ì´ìŠ¤ì˜ ìƒì„¸ ì •ë³´ë¥¼ ë³‘ë ¬ë¡œ ê°€ì ¸ì˜¤ê¸°
      const spacePromises = [];
      
      snapshot.forEach((docSnap) => {
        const data = docSnap.data();
        const spaceId = docSnap.id;
        
        // ìŠ¤í˜ì´ìŠ¤ ë¬¸ì„œì—ì„œ ê³„ì¢Œ ì •ë³´ í¬í•¨í•œ ìƒì„¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const spacePromise = getDoc(doc(db, 'spaces', spaceId)).then(spaceDoc => {
          const spaceData = spaceDoc.exists() ? spaceDoc.data() : {};
          
          console.log('ğŸ“¦ [getUserSpaces] ìŠ¤í˜ì´ìŠ¤ ìƒì„¸ ì •ë³´:', spaceId, spaceData);
          
          // Timestampë¥¼ Dateë¡œ ë³€í™˜
          const joinedAt = data.joinedAt && typeof data.joinedAt.toDate === 'function' 
            ? data.joinedAt.toDate() 
            : null;
          const updatedAt = data.updatedAt && typeof data.updatedAt.toDate === 'function'
            ? data.updatedAt.toDate()
            : null;
          
          return {
            id: spaceId,
            spaceId: spaceId, // í˜¸í™˜ì„±ì„ ìœ„í•´ ë‘˜ ë‹¤ ì¶”ê°€
            spaceName: data.spaceName || spaceData.name || '',
            name: spaceData.name || data.spaceName || '', // ìŠ¤í˜ì´ìŠ¤ ì´ë¦„
            userType: data.userType || 'guest',
            order: data.order || 0,
            status: data.status || 'active',
            joinedAt: joinedAt,
            updatedAt: updatedAt,
            // ê³„ì¢Œ ì •ë³´ ì¶”ê°€ (spaces/{spaceId} ë¬¸ì„œì˜ í•„ë“œ)
            accountBank: spaceData.accountBank,
            accountNumber: spaceData.accountNumber,
            accountHolder: spaceData.accountHolder,
          };
        });
        
        spacePromises.push(spacePromise);
      });
      
      const spaces = await Promise.all(spacePromises);
      
      // order ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬
      spaces.sort((a, b) => (a.order || 0) - (b.order || 0));
      
      console.log('âœ… [getUserSpaces] ê²°ê³¼ (ê³„ì¢Œ ì •ë³´ í¬í•¨):', spaces);
      return spaces;
    } catch (error) {
      console.error('[SpaceService] getUserSpaces ì‹¤íŒ¨:', error);
      return [];
    }
  }

  // ----- 5) ìŠ¤í˜ì´ìŠ¤ ìˆœì„œ ì—…ë°ì´íŠ¸ -----
  async updateSpaceOrder(userId, spaces) {
    try {
      const updates = spaces.map(async (space, index) => {
        const spaceId = space.id || space.spaceId;
        const userSpaceRef = doc(db, `users/${userId}/spaceAccess`, spaceId);
        await setDoc(userSpaceRef, { order: index }, { merge: true });
      });

      await Promise.all(updates);
      console.log('âœ… ìŠ¤í˜ì´ìŠ¤ ìˆœì„œ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
    } catch (error) {
      console.error('[SpaceService] updateSpaceOrder ì‹¤íŒ¨:', error);
      throw error;
    }
  }

  // ----- 6) 6ìë¦¬ ìŠ¤í˜ì´ìŠ¤ ì½”ë“œ ìƒì„± (ì˜ëŒ€ì†Œë¬¸ì + ìˆ«ì) -----
  generateSpaceCode() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    let code = '';
    for (let i = 0; i < 6; i++) {
      code += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return code;
  }

  // ----- 7) ìŠ¤í˜ì´ìŠ¤ ì½”ë“œ ì¤‘ë³µ ì²´í¬ (spaces ì»¬ë ‰ì…˜ê³¼ admin_requests ë‘˜ ë‹¤ í™•ì¸) -----
  async isSpaceCodeAvailable(code) {
    try {
      // 1. spaces ì»¬ë ‰ì…˜ì—ì„œ í™•ì¸
      const spaceRef = doc(db, 'spaces', code);
      const spaceSnap = await getDoc(spaceRef);
      if (spaceSnap.exists()) {
        return false; // ì´ë¯¸ ì‚¬ìš© ì¤‘
      }

      // 2. admin_requestsì—ì„œ ëŒ€ê¸° ì¤‘ì¸ ì‹ ì²­ í™•ì¸
      const requestsRef = collection(db, 'admin_requests');
      const q = query(
        requestsRef,
        where('type', '==', 'space_creation'),
        where('spaceCode', '==', code),
        where('status', '==', 'pending')
      );
      const snapshot = await getDocs(q);

      if (!snapshot.empty) {
        return false; // ëŒ€ê¸° ì¤‘ì¸ ì‹ ì²­ì—ì„œ ì‚¬ìš© ì¤‘
      }

      return true; // ì‚¬ìš© ê°€ëŠ¥
    } catch (error) {
      console.error('[SpaceService] isSpaceCodeAvailable ì‹¤íŒ¨:', error);
      throw error;
    }
  }

  // ----- 8) ì¤‘ë³µë˜ì§€ ì•ŠëŠ” ìŠ¤í˜ì´ìŠ¤ ì½”ë“œ ìƒì„± -----
  async generateUniqueSpaceCode(maxAttempts = 10) {
    for (let i = 0; i < maxAttempts; i++) {
      const code = this.generateSpaceCode();
      const available = await this.isSpaceCodeAvailable(code);
      if (available) {
        console.log(`âœ… ìœ íš¨í•œ ìŠ¤í˜ì´ìŠ¤ ì½”ë“œ ìƒì„±: ${code}`);
        return code;
      }
      console.log(`âš ï¸ ì½”ë“œ ${code} ì´ë¯¸ ì‚¬ìš© ì¤‘, ì¬ì‹œë„...`);
    }
    throw new Error('ìœ íš¨í•œ ìŠ¤í˜ì´ìŠ¤ ì½”ë“œë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
  }

  // ----- 9) ìŠ¤í˜ì´ìŠ¤ ìƒì„± ì‹ ì²­ -----
  async requestSpaceCreation(userId, userName, spaceName) {
    try {
      console.log('ğŸ“ ìŠ¤í˜ì´ìŠ¤ ìƒì„± ì‹ ì²­ ì‹œì‘:', { userId, userName, spaceName });

      // 1. ìœ ë‹ˆí¬í•œ ìŠ¤í˜ì´ìŠ¤ ì½”ë“œ ìƒì„±
      const spaceCode = await this.generateUniqueSpaceCode();

      // 2. admin_requests ì»¬ë ‰ì…˜ì— ì‹ ì²­ ê¸°ë¡ ì¶”ê°€
      const requestsRef = collection(db, 'admin_requests');
      const now = Timestamp.now();

      const requestData = {
        type: 'space_creation',
        spaceCode: spaceCode,
        spaceName: spaceName,
        status: 'pending',
        requestedBy: {
          id: userId,
          displayName: userName
        },
        requestedAt: now,
        processedAt: null,
        processedBy: null,
        rejectionReason: null
      };

      const requestDoc = await addDoc(requestsRef, requestData);

      console.log('âœ… ìŠ¤í˜ì´ìŠ¤ ìƒì„± ì‹ ì²­ ì™„ë£Œ:', requestDoc.id);

      // 3. ìŠˆí¼ì–´ë“œë¯¼ì—ê²Œ ì´ë©”ì¼ ì•Œë¦¼ ë°œì†¡ (ë¹„ë™ê¸°, ì‹¤íŒ¨í•´ë„ ì „ì²´ í”„ë¡œì„¸ìŠ¤ ì¤‘ë‹¨ ì•ˆí•¨)
      adminSettingsService.sendAdminNotification('space_creation_request', {
        spaceName: spaceName,
        spaceCode: spaceCode,
        requestedBy: userName,
        requestedAt: now.toDate().toISOString()
      }).catch(err => {
        console.error('âš ï¸ ì–´ë“œë¯¼ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨ (ë¬´ì‹œ):', err);
      });

      return {
        success: true,
        requestId: requestDoc.id,
        spaceCode: spaceCode
      };
    } catch (error) {
      console.error('âŒ ìŠ¤í˜ì´ìŠ¤ ìƒì„± ì‹ ì²­ ì‹¤íŒ¨:', error);
      throw error;
    }
  }

  // ----- 10) ëŒ€ê¸° ì¤‘ì¸ ìŠ¤í˜ì´ìŠ¤ ìƒì„± ì‹ ì²­ ëª©ë¡ ì¡°íšŒ (ìŠˆí¼ ì–´ë“œë¯¼ìš©) -----
  async getPendingSpaceRequests() {
    try {
      const requestsRef = collection(db, 'admin_requests');
      const q = query(
        requestsRef,
        where('type', '==', 'space_creation'),
        where('status', '==', 'pending')
      );

      const snapshot = await getDocs(q);
      const requests = [];

      snapshot.forEach(doc => {
        const data = doc.data();
        requests.push({
          id: doc.id,
          ...data
        });
      });

      // ì‹ ì²­ì¼ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
      requests.sort((a, b) => {
        const aDate = a.requestedAt?.toDate?.() || new Date(0);
        const bDate = b.requestedAt?.toDate?.() || new Date(0);
        return bDate - aDate;
      });

      console.log(`âœ… ëŒ€ê¸° ì¤‘ì¸ ìŠ¤í˜ì´ìŠ¤ ìƒì„± ì‹ ì²­ ${requests.length}ê±´ ì¡°íšŒ`);
      return requests;
    } catch (error) {
      console.error('âŒ ëŒ€ê¸° ì¤‘ì¸ ìŠ¤í˜ì´ìŠ¤ ìƒì„± ì‹ ì²­ ì¡°íšŒ ì‹¤íŒ¨:', error);
      throw error;
    }
  }

  // ----- 11) ìŠ¤í˜ì´ìŠ¤ ìƒì„± ì‹ ì²­ ìŠ¹ì¸ (ìŠˆí¼ ì–´ë“œë¯¼ìš©) -----
  async approveSpaceCreationRequest(requestId, spaceCode, spaceName, adminId, adminName) {
    try {
      console.log('âœ… ìŠ¤í˜ì´ìŠ¤ ìƒì„± ì‹ ì²­ ìŠ¹ì¸ ì‹œì‘:', { requestId, spaceCode });

      const now = Timestamp.now();

      // 1. ì‹ ì²­ ë¬¸ì„œ ì½ê¸° (requestedBy ì •ë³´ ê°€ì ¸ì˜¤ê¸°)
      const requestRef = doc(db, 'admin_requests', requestId);
      const requestSnap = await getDoc(requestRef);

      if (!requestSnap.exists()) {
        throw new Error('ì‹ ì²­ ë¬¸ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }

      const requestData = requestSnap.data();
      const requestedById = requestData.requestedBy?.id;
      const requestedByName = requestData.requestedBy?.displayName || 'ì•Œ ìˆ˜ ì—†ìŒ';

      if (!requestedById) {
        throw new Error('ì‹ ì²­ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
      }

      // 2. spaces ì»¬ë ‰ì…˜ì— ìƒˆ ìŠ¤í˜ì´ìŠ¤ ìƒì„±
      const spaceRef = doc(db, 'spaces', spaceCode);
      const spaceData = {
        name: spaceName,
        createdAt: now,
        createdBy: adminId,
        updatedAt: now,
        // ê¸°ë³¸ ì„¤ì •
        accountBank: '',
        accountNumber: '',
        accountHolder: '',
        guestPricePerNight: 30000,
        accountBank_settle: '',
        accountNumber_settle: '',
        accountHolder_settle: ''
      };

      await setDoc(spaceRef, spaceData);
      console.log('âœ… ìŠ¤í˜ì´ìŠ¤ ìƒì„± ì™„ë£Œ:', spaceCode);

      // 3. ì‹ ì²­ìë¥¼ ë§¤ë‹ˆì €ë¡œ ë“±ë¡ - users/{userId}/spaceAccess/{spaceCode}
      const userSpaceRef = doc(db, `users/${requestedById}/spaceAccess`, spaceCode);
      const userSpaceData = {
        joinedAt: now,
        order: 0,
        spaceName: spaceName,
        status: 'active',
        updatedAt: now,
        userType: 'manager' // ì‹ ì²­ìëŠ” ë§¤ë‹ˆì €ë¡œ ë“±ë¡
      };

      await setDoc(userSpaceRef, userSpaceData);
      console.log('âœ… ì‚¬ìš©ì spaceAccess ìƒì„± ì™„ë£Œ:', { userId: requestedById, spaceCode });

      // 4. ì‹ ì²­ìë¥¼ ë§¤ë‹ˆì €ë¡œ ë“±ë¡ - spaces/{spaceCode}/assignedUsers/{userId}
      const spaceUserRef = doc(db, `spaces/${spaceCode}/assignedUsers`, requestedById);
      const spaceUserData = {
        displayName: requestedByName,
        email: '', // ì´ë©”ì¼ ì •ë³´ê°€ ì—†ì„ ìˆ˜ ìˆìŒ
        joinedAt: now,
        profileImage: '',
        status: 'active',
        userType: 'manager' // ì‹ ì²­ìëŠ” ë§¤ë‹ˆì €ë¡œ ë“±ë¡
      };

      await setDoc(spaceUserRef, spaceUserData);
      console.log('âœ… ìŠ¤í˜ì´ìŠ¤ assignedUsers ìƒì„± ì™„ë£Œ:', { spaceCode, userId: requestedById });

      // 5. ì‹ ì²­ ë¬¸ì„œ ì—…ë°ì´íŠ¸
      await updateDoc(requestRef, {
        status: 'approved',
        processedAt: now,
        processedBy: {
          id: adminId,
          displayName: adminName
        }
      });

      console.log('âœ… ìŠ¤í˜ì´ìŠ¤ ìƒì„± ë° ë§¤ë‹ˆì € ë“±ë¡ ì™„ë£Œ:', { spaceCode, managerId: requestedById });

      return { success: true, spaceCode };
    } catch (error) {
      console.error('âŒ ìŠ¤í˜ì´ìŠ¤ ìƒì„± ì‹ ì²­ ìŠ¹ì¸ ì‹¤íŒ¨:', error);
      throw error;
    }
  }

  // ----- 12) ìŠ¤í˜ì´ìŠ¤ ìƒì„± ì‹ ì²­ ê±°ë¶€ (ìŠˆí¼ ì–´ë“œë¯¼ìš©) -----
  async rejectSpaceCreationRequest(requestId, adminId, adminName, reason) {
    try {
      console.log('âŒ ìŠ¤í˜ì´ìŠ¤ ìƒì„± ì‹ ì²­ ê±°ë¶€ ì‹œì‘:', { requestId });

      const requestRef = doc(db, 'admin_requests', requestId);
      await updateDoc(requestRef, {
        status: 'rejected',
        processedAt: Timestamp.now(),
        processedBy: {
          id: adminId,
          displayName: adminName
        },
        rejectionReason: reason
      });

      console.log('âœ… ìŠ¤í˜ì´ìŠ¤ ìƒì„± ì‹ ì²­ ê±°ë¶€ ì™„ë£Œ');
      return { success: true };
    } catch (error) {
      console.error('âŒ ìŠ¤í˜ì´ìŠ¤ ìƒì„± ì‹ ì²­ ê±°ë¶€ ì‹¤íŒ¨:', error);
      throw error;
    }
  }
}

export default new SpaceService();
</file>

<file path=".claude/settings.local.json">
{
  "permissions": {
    "allow": [
      "Bash(npm install:*)",
      "Bash(ls:*)",
      "Bash(npm run build:*)",
      "Bash(npx netlify status)",
      "Bash(npx netlify:*)",
      "Bash(cat:*)",
      "Bash(if [ -f .netlify/state.json ])",
      "Bash(then cat .netlify/state.json)",
      "Bash(else echo \"state.json not found\")",
      "Bash(fi)",
      "Bash(if [ -f netlify.toml ])",
      "Bash(then cat netlify.toml)",
      "Bash(else echo \"netlify.toml not found\")",
      "WebFetch(domain:undongs.netlify.app)",
      "Bash(netlify login:*)",
      "Bash(netlify switch:*)",
      "Bash(netlify logout:*)",
      "Bash(netlify sites:create:*)",
      "Bash(netlify init:*)",
      "Bash(node test-week-calc.js:*)",
      "Bash(del test-week-calc.js)",
      "Bash(grep:*)",
      "Bash(git log:*)",
      "Bash(git add:*)",
      "Bash(git commit -m \"$\\(cat <<''EOF''\ní•œêµ­ì‹œê°„ ê¸°ì¤€ ìë™í™” ë° ìš´ì˜ë¹„ ë…ë ¤ ë©”ì¼ ì¶”ê°€\n\n- ìë™ì •ì‚° ì‹œìŠ¤í…œì„ í•œêµ­ì‹œê°„\\(KST\\) ê¸°ì¤€ìœ¼ë¡œ ìˆ˜ì •\n- ë§¤ì¼ ì˜¤ì „ 10ì‹œ ìš´ì˜ë¹„ ìŠ¹ì¸ ë…ë ¤ ë©”ì¼ ë°œì†¡ ê¸°ëŠ¥ ì¶”ê°€\n- send-pending-expense-reminder.js ì‹ ê·œ ìƒì„±\n- send-email.jsì— expense_reminder íƒ€ì… ì¶”ê°€\n\nCo-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git push:*)",
      "Bash(git checkout:*)",
      "Bash(git merge:*)",
      "Bash(netlify status:*)",
      "Bash(netlify deploy:*)",
      "Bash(curl:*)",
      "Bash(netlify functions:list:*)",
      "Bash(netlify functions:invoke:*)",
      "Bash(git commit:*)",
      "Bash(netlify env:list:*)"
    ]
  }
}
</file>

<file path="src/components/reservations/ReservationModal.jsx">
import { useState, useEffect } from 'react';
import { ChevronLeft, ChevronRight, X } from 'lucide-react';
import Modal from '../common/Modal';
import { formatDate, formatWeekDay, getWeekDates } from '../../utils/dateUtils';
import HostSearchInput from './HostSearchInput';

const ReservationModal = ({ isOpen, onClose, onConfirm, spaceId, existingReservations = {}, user, selectedSpace }) => {
  const [currentWeekStart, setCurrentWeekStart] = useState(() => {
    const today = new Date();
    const day = today.getDay();
    const diff = day === 0 ? -6 : 1 - day;
    const monday = new Date(today);
    monday.setDate(today.getDate() + diff);
    monday.setHours(0, 0, 0, 0);
    return monday;
  });
  
  const [checkIn, setCheckIn] = useState(null);
  const [checkOut, setCheckOut] = useState(null);
  const [selectedHost, setSelectedHost] = useState(null);
  const [isDayTrip, setIsDayTrip] = useState(false);

  // ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì •ë³´
  const userName = user?.displayName || user?.name || 'ì‚¬ìš©ì';
  
  // ë””ë²„ê¹…: selectedSpace í™•ì¸
  useEffect(() => {
    console.log('ğŸ” [ReservationModal] selectedSpace:', selectedSpace);
    console.log('ğŸ” [ReservationModal] selectedSpace?.userType:', selectedSpace?.userType);
  }, [selectedSpace]);
  
  const memberType = selectedSpace?.userType || 'guest';
  
  // ë©¤ë²„ íƒ€ì…ë³„ ë¼ë²¨ (ì£¼ì£¼, ë§¤ë‹ˆì €, ë¶€ë§¤ë‹ˆì €ëŠ” "ì£¼ì£¼"ë¡œ í‘œì‹œ)
  const getMemberTypeLabel = (type) => {
    const memberTypes = ['shareholder', 'manager', 'vice-manager'];
    return memberTypes.includes(type) ? 'ì£¼ì£¼' : 'ê²ŒìŠ¤íŠ¸';
  };
  
  const memberTypeLabel = getMemberTypeLabel(memberType);
  const isGuest = memberType === 'guest';
  
  useEffect(() => {
    console.log('ğŸ” [ReservationModal] memberType:', memberType);
    console.log('ğŸ” [ReservationModal] memberTypeLabel:', memberTypeLabel);
    console.log('ğŸ” [ReservationModal] isGuest:', isGuest);
  }, [memberType, memberTypeLabel, isGuest]);

  const weekDates = getWeekDates(currentWeekStart);

  const prevWeek = () => {
    const newDate = new Date(currentWeekStart);
    newDate.setDate(newDate.getDate() - 7);
    setCurrentWeekStart(newDate);
  };

  const nextWeek = () => {
    const newDate = new Date(currentWeekStart);
    newDate.setDate(newDate.getDate() + 7);
    setCurrentWeekStart(newDate);
  };

  const isDateDisabled = (date) => {
    // ê³¼ê±° ë‚ ì§œ ë¹„í™œì„±í™”
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    if (date < today) return true;

    // ì´ë¯¸ ì˜ˆì•½ëœ ë‚ ì§œ í™•ì¸
    const dateStr = formatDate(date);
    const dayReservations = existingReservations[dateStr] || [];
    
    // ì˜ˆì•½ì´ 10ê°œ ì´ìƒì´ë©´ ë¹„í™œì„±í™”
    return dayReservations.length >= 10;
  };

  const isDateInRange = (date) => {
    if (!checkIn || !checkOut) return false;
    return date > checkIn && date < checkOut;
  };

  const isDateSelected = (date) => {
    if (!checkIn) return false;
    if (checkIn && date.getTime() === checkIn.getTime()) return true;
    if (checkOut && date.getTime() === checkOut.getTime()) return true;
    return false;
  };

  const handleDateClick = (date) => {
    if (isDateDisabled(date)) return;

    if (!checkIn || (checkIn && checkOut)) {
      // ì²« ì„ íƒ or ì¬ì„ íƒ
      setCheckIn(date);
      setCheckOut(null);
      setIsDayTrip(false); // ìƒˆë¡œ ì„ íƒ ì‹œ ë‹¹ì¼ì¹˜ê¸° ì²´í¬ í•´ì œ
    } else if (isDayTrip) {
      // ë‹¹ì¼ì¹˜ê¸° ëª¨ë“œì—ì„œëŠ” ë‚ ì§œ ë³€ê²½ë§Œ ê°€ëŠ¥
      setCheckIn(date);
      setCheckOut(null);
    } else {
      // ë‘ ë²ˆì§¸ ì„ íƒ (ì¼ë°˜ ìˆ™ë°•)
      if (date.getTime() === checkIn.getTime()) {
        // ê°™ì€ ë‚ ì§œ ì„ íƒ ì‹œ ì²´í¬ì•„ì›ƒ ì„¤ì • (ë‹¹ì¼ì¹˜ê¸°ë¡œ ê°„ì£¼)
        setCheckOut(date);
        setIsDayTrip(true);
        return;
      }
      if (date > checkIn) {
        // ì²´í¬ì¸ê³¼ ì²´í¬ì•„ì›ƒ ì‚¬ì´ì— ì˜ˆì•½ ë¶ˆê°€ ë‚ ì§œê°€ ìˆëŠ”ì§€ í™•ì¸
        const hasDisabledInRange = checkDateRangeValid(checkIn, date);
        if (!hasDisabledInRange) {
          alert('ì„ íƒí•œ ê¸°ê°„ ë‚´ì— ì˜ˆì•½ ë¶ˆê°€ëŠ¥í•œ ë‚ ì§œê°€ ìˆìŠµë‹ˆë‹¤.');
          return;
        }
        setCheckOut(date);
      } else {
        // ë” ì´ë¥¸ ë‚ ì§œ ì„ íƒ â†’ ì²´í¬ì•„ì›ƒì„ ì²´í¬ì¸ìœ¼ë¡œ, ìƒˆ ë‚ ì§œë¥¼ ì²´í¬ì¸ìœ¼ë¡œ
        setCheckOut(checkIn);
        setCheckIn(date);
      }
    }
  };

  const checkDateRangeValid = (start, end) => {
    let current = new Date(start);
    current.setDate(current.getDate() + 1);
    
    while (current < end) {
      if (isDateDisabled(current)) {
        return false;
      }
      current.setDate(current.getDate() + 1);
    }
    return true;
  };

  const getNights = () => {
    if (!checkIn || !checkOut) return 0;
    const diff = checkOut.getTime() - checkIn.getTime();
    return Math.ceil(diff / (1000 * 60 * 60 * 24));
  };

  // ReservationModal.jsxì˜ handleConfirm í•¨ìˆ˜
  const handleConfirm = () => {
  // ë‹¹ì¼ì¹˜ê¸° ì²´í¬ ì‹œ ìë™ìœ¼ë¡œ checkOut ì„¤ì •
  const finalCheckOut = isDayTrip ? checkIn : checkOut;

  if (!checkIn) {
    alert('ì²´í¬ì¸ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
    return;
  }

  if (!isDayTrip && !checkOut) {
    alert('ì²´í¬ì•„ì›ƒ ë‚ ì§œë¥¼ ì„ íƒí•˜ê±°ë‚˜ ë‹¹ì¼ì¹˜ê¸°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
    return;
  }

  if (isGuest && !selectedHost) {
    alert('ì´ˆëŒ€í•´ì£¼ì‹  ì£¼ì£¼ë‹˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
    return;
  }

  const nights = isDayTrip ? 0 : getNights();

  console.log('âœ… [ReservationModal] ì˜ˆì•½ í™•ì • - type:', memberType);
  console.log('âœ… [ReservationModal] isDayTrip:', isDayTrip);
  console.log('âœ… [ReservationModal] nights:', nights);
  console.log('âœ… [ReservationModal] selectedHost:', selectedHost);
  console.log('âœ… [ReservationModal] ê³„ì¢Œì •ë³´:', {
    accountBank: selectedSpace?.accountBank,
    accountNumber: selectedSpace?.accountNumber,
    accountHolder: selectedSpace?.accountHolder,
  });

  onConfirm({
    userId: user?.id,
    checkIn,
    checkOut: finalCheckOut,
    name: userName,
    type: memberType,
    nights: nights,
    phone: user?.phoneNumber || '',
    hostId: selectedHost?.id || null,
    hostDisplayName: selectedHost?.displayName || null,
    spaceName: selectedSpace?.name,
    // ê³„ì¢Œ ì •ë³´ ì¶”ê°€
    accountBank: selectedSpace?.accountBank,
    accountNumber: selectedSpace?.accountNumber,
    accountHolder: selectedSpace?.accountHolder,
  });

  // ì´ˆê¸°í™”
  setCheckIn(null);
  setCheckOut(null);
  setSelectedHost(null);
  setIsDayTrip(false);
};

  const handleClose = () => {
    setCheckIn(null);
    setCheckOut(null);
    setSelectedHost(null);
    setIsDayTrip(false);
    onClose();
  };

  return (
    <Modal isOpen={isOpen} onClose={handleClose} title="ì˜ˆì•½í•˜ê¸°">
      <div className="space-y-4">
        <p className="text-sm text-gray-600">ì²´í¬ì¸/ì²´í¬ì•„ì›ƒ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”</p>

        {/* ì£¼ ë„¤ë¹„ê²Œì´ì…˜ */}
        <div className="flex items-center justify-between bg-gray-50 rounded-lg p-3">
          <button onClick={prevWeek} className="p-2 hover:bg-gray-200 rounded-lg">
            <ChevronLeft className="w-5 h-5 text-blue-600" />
          </button>
          <span className="font-semibold text-gray-700">
            {currentWeekStart.getFullYear()}ë…„ {currentWeekStart.getMonth() + 1}ì›” {Math.ceil(currentWeekStart.getDate() / 7)}ì£¼
          </span>
          <button onClick={nextWeek} className="p-2 hover:bg-gray-200 rounded-lg">
            <ChevronRight className="w-5 h-5 text-blue-600" />
          </button>
        </div>

        {/* ìš”ì¼ ë ˆì´ë¸” */}
        <div className="grid grid-cols-7 gap-2 text-center text-xs font-medium text-gray-500">
          <div>ì›”</div>
          <div>í™”</div>
          <div>ìˆ˜</div>
          <div>ëª©</div>
          <div>ê¸ˆ</div>
          <div className="text-blue-500">í† </div>
          <div className="text-red-500">ì¼</div>
        </div>

        {/* ë‚ ì§œ ê·¸ë¦¬ë“œ */}
        <div className="grid grid-cols-7 gap-2">
          {weekDates.map((date, index) => {
            const disabled = isDateDisabled(date);
            const selected = isDateSelected(date);
            const inRange = isDateInRange(date);
            const isToday = new Date().toDateString() === date.toDateString();

            return (
              <button
                key={index}
                onClick={() => handleDateClick(date)}
                disabled={disabled}
                className={`
                  aspect-square rounded-xl text-base font-medium transition-all
                  ${disabled ? 'bg-red-50 text-red-300 cursor-not-allowed' : 'bg-gray-50 text-gray-700 hover:bg-gray-200 hover:scale-105'}
                  ${selected ? 'bg-blue-600 text-white scale-110 shadow-lg' : ''}
                  ${inRange ? 'bg-blue-100 text-blue-700' : ''}
                  ${isToday && !selected ? 'ring-2 ring-blue-600' : ''}
                `}
              >
                {date.getDate()}
              </button>
            );
          })}
        </div>

        {/* ì„ íƒ ì •ë³´ */}
        {checkIn && (
          <div className="space-y-3">
            <div className="bg-blue-50 border-2 border-blue-600 rounded-xl p-4 text-center">
              <div className="text-xs text-blue-600 mb-1">ì„ íƒí•œ ë‚ ì§œ</div>
              <div className="text-lg font-bold text-blue-900">
                {checkIn.getMonth() + 1}/{checkIn.getDate()}
                {!isDayTrip && checkOut && ` ~ ${checkOut.getMonth() + 1}/${checkOut.getDate()}`}
                {!isDayTrip && !checkOut && ' (ì²´í¬ì•„ì›ƒ ì„ íƒ)'}
              </div>
              {!isDayTrip && checkOut && (
                <div className="text-sm text-blue-600 mt-1">
                  {getNights()}ë°• {getNights() + 1}ì¼
                </div>
              )}
              {isDayTrip && (
                <div className="text-sm text-blue-600 mt-1">
                  ë‹¹ì¼ì¹˜ê¸°
                </div>
              )}
            </div>

            {/* ë‹¹ì¼ì¹˜ê¸° ì²´í¬ë°•ìŠ¤ */}
            <label className="flex items-center justify-center gap-2 p-3 bg-orange-50 rounded-xl cursor-pointer border-2 border-orange-200 hover:bg-orange-100 transition-colors">
              <input
                type="checkbox"
                checked={isDayTrip}
                onChange={(e) => {
                  setIsDayTrip(e.target.checked);
                  if (e.target.checked) {
                    setCheckOut(null); // ë‹¹ì¼ì¹˜ê¸° ì²´í¬ ì‹œ checkOut ì´ˆê¸°í™”
                  }
                }}
                className="w-5 h-5 text-orange-600 rounded focus:ring-orange-500"
              />
              <span className="font-semibold text-gray-900">ë‹¹ì¼ì¹˜ê¸°ë¡œ ì˜ˆì•½</span>
            </label>
          </div>
        )}

        {/* ì˜ˆì•½ ì •ë³´ í‘œì‹œ */}
        {checkIn && (checkOut || isDayTrip) && (
          <div className="space-y-3 pt-2 border-t">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                ì´ë¦„ (ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸)
              </label>
              <input
                type="text"
                value={userName}
                readOnly
                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-700 cursor-not-allowed font-semibold"
                title="ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì •ë³´ë¡œ ìë™ ì…ë ¥ë©ë‹ˆë‹¤"
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                ì˜ˆì•½ ìœ í˜•
              </label>
              <input
                type="text"
                value={memberTypeLabel}
                readOnly
                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-700 cursor-not-allowed font-semibold"
                title="ì‚¬ìš©ì ê¶Œí•œì— ë”°ë¼ ìë™ìœ¼ë¡œ ê²°ì •ë©ë‹ˆë‹¤"
              />
              <p className="text-xs text-gray-500 mt-1">
                {getMemberTypeLabel(memberType) === 'ì£¼ì£¼' ? 'ì£¼ì£¼ë¡œ ì˜ˆì•½ë©ë‹ˆë‹¤ (ë¬´ë£Œ)' : 'ê²ŒìŠ¤íŠ¸ë¡œ ì˜ˆì•½ë©ë‹ˆë‹¤ (ìœ ë£Œ)'}
              </p>
            </div>

            {/* ê²ŒìŠ¤íŠ¸ì¸ ê²½ìš° ì´ˆëŒ€ì ì„ íƒ í•„ìˆ˜ */}
            {isGuest && (
              <HostSearchInput
                spaceId={spaceId}
                onSelect={setSelectedHost}
                selectedHost={selectedHost}
              />
            )}
          </div>
        )}

        {/* ë²„íŠ¼ */}
        <div className="grid grid-cols-2 gap-3 pt-4">
          <button
            onClick={handleClose}
            className="px-4 py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200"
          >
            ì·¨ì†Œ
          </button>
          <button
            onClick={handleConfirm}
            disabled={!checkIn || (!isDayTrip && !checkOut) || (isGuest && !selectedHost)}
            className="px-4 py-3 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed"
          >
            ì˜ˆì•½í•˜ê¸°
          </button>
        </div>
      </div>
    </Modal>
  );
};

export default ReservationModal;
</file>

<file path="src/components/settlement/SettlementTableView.jsx">
// src/components/settlement/SettlementTableView.jsx
import { useMemo, useRef, useState } from 'react';
import { Download, Image as ImageIcon } from 'lucide-react';
import html2canvas from 'html2canvas';

const SettlementTableView = ({
  receipts,
  participants,
  userProfiles,
  formatCurrency,
  formatDate,
  weekId,
  settlement
}) => {
  const tableRef = useRef(null);
  const [isCapturing, setIsCapturing] = useState(false);

  // ë‚ ì§œë³„ë¡œ ì˜ìˆ˜ì¦ ê·¸ë£¹í•‘ (ê·€ì†ì¼ ê¸°ì¤€)
  const groupedByDate = useMemo(() => {
    const groups = {};

    receipts.forEach(receipt => {
      // belongsToDateëŠ” YYYY-MM-DD í˜•ì‹ ë¬¸ìì—´
      const belongsDate = receipt.belongsToDate ? new Date(receipt.belongsToDate) : receipt.createdAt;
      const dateKey = formatDate(belongsDate);
      if (!groups[dateKey]) {
        groups[dateKey] = [];
      }
      groups[dateKey].push(receipt);
    });

    return groups;
  }, [receipts, formatDate]);

  // ì°¸ì—¬ì ëª©ë¡ (balance ìˆœìœ¼ë¡œ ì •ë ¬)
  const participantList = useMemo(() => {
    return Object.entries(participants || {})
      .sort(([, a], [, b]) => b.balance - a.balance)
      .map(([userId, data]) => ({
        userId,
        ...data,
        displayName: userProfiles[userId]?.displayName || data.name
      }));
  }, [participants, userProfiles]);

  // ê° ì°¸ì—¬ìë³„ ë‚¸ ê¸ˆì•¡ ê³„ì‚°
  const participantPaidAmounts = useMemo(() => {
    const amounts = {};
    participantList.forEach(p => {
      amounts[p.userId] = 0;
    });

    receipts.forEach(receipt => {
      if (amounts[receipt.paidBy] !== undefined) {
        amounts[receipt.paidBy] += receipt.totalAmount;
      }
    });

    return amounts;
  }, [receipts, participantList]);

  // ê° ì°¸ì—¬ìë³„ ë‚¼ ê¸ˆì•¡ ê³„ì‚°
  const participantOwedAmounts = useMemo(() => {
    const amounts = {};
    participantList.forEach(p => {
      amounts[p.userId] = 0;
    });

    receipts.forEach(receipt => {
      receipt.items.forEach(item => {
        item.splitAmong.forEach(userId => {
          if (amounts[userId] !== undefined) {
            amounts[userId] += item.perPerson;
          }
        });
      });
    });

    return amounts;
  }, [receipts, participantList]);

  // CSV ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
  const downloadCSV = () => {
    let csvContent = '';

    // BOM ì¶”ê°€ (í•œê¸€ ê¹¨ì§ ë°©ì§€)
    csvContent = '\uFEFF';

    // í—¤ë” í–‰
    const headers = ['ë‚ ì§œ', 'ë‚´ìš©', 'ì§€ì¶œ', 'ê¸ˆì•¡', 'ë¶„ë‹´ì', 'ì¸ì›'];
    participantList.forEach(p => headers.push(p.displayName));
    csvContent += headers.join(',') + '\n';

    // ë°ì´í„° í–‰
    Object.entries(groupedByDate).forEach(([date, dateReceipts]) => {
      dateReceipts.forEach(receipt => {
        receipt.items.forEach(item => {
          const row = [
            date,
            `"${(receipt.memo || '-').replace(/"/g, '""')}"`,
            `"${item.itemName.replace(/"/g, '""')}"`,
            item.amount,
            userProfiles[receipt.paidBy]?.displayName || receipt.paidByName,
            item.splitAmong.length
          ];

          participantList.forEach(p => {
            // íƒ€ì… ë¶ˆì¼ì¹˜ ë¬¸ì œ í•´ê²°: ë‘˜ ë‹¤ stringìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ë¹„êµ
            const participantId = String(p.userId);
            const splitAmongStrings = item.splitAmong.map(id => String(id));
            const isSplitter = splitAmongStrings.includes(participantId);
            row.push(isSplitter ? item.perPerson : 0);
          });

          csvContent += row.join(',') + '\n';
        });
      });
    });

    // í•©ê³„ í–‰
    const totalRow = ['', '', 'ì§€ì¶œ í•©ê³„', receipts.reduce((sum, r) => sum + r.totalAmount, 0), '', ''];
    participantList.forEach(p => {
      totalRow.push(participantOwedAmounts[p.userId] || 0);
    });
    csvContent += totalRow.join(',') + '\n';

    // ë‚¸ ëˆ í–‰
    const paidRow = ['', '', '', '', '', 'ë‚¸ ëˆ'];
    participantList.forEach(p => {
      paidRow.push(participantPaidAmounts[p.userId] || 0);
    });
    csvContent += paidRow.join(',') + '\n';

    // ë‚¼ ëˆ í–‰
    const owedRow = ['', '', '', '', '', 'ë‚¼ ëˆ'];
    participantList.forEach(p => {
      const balance = p.balance;
      owedRow.push(balance < 0 ? Math.abs(balance) : 0);
    });
    csvContent += owedRow.join(',') + '\n';

    // ë‹¤ìš´ë¡œë“œ
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    link.setAttribute('href', url);
    link.setAttribute('download', `ì •ì‚°_${weekId || 'export'}.csv`);
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  };

  // ì´ë¯¸ì§€ë¡œ ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
  const downloadAsImage = async () => {
    if (!tableRef.current) return;

    try {
      setIsCapturing(true);

      // ì•½ê°„ì˜ ì§€ì—°ì„ ì£¼ì–´ ìƒíƒœ ë³€ê²½ì´ ë Œë”ë§ë˜ë„ë¡ í•¨
      await new Promise(resolve => setTimeout(resolve, 100));

      // ìº¡ì²˜ ì „ ì›ë˜ ìŠ¤íƒ€ì¼ ì €ì¥
      const originalOverflow = tableRef.current.style.overflow;
      const originalWidth = tableRef.current.style.width;
      const originalMaxWidth = tableRef.current.style.maxWidth;

      // ìº¡ì²˜ë¥¼ ìœ„í•´ ìŠ¤í¬ë¡¤ ì œê±°í•˜ê³  ì „ì²´ ë„ˆë¹„ í‘œì‹œ
      tableRef.current.style.overflow = 'visible';
      tableRef.current.style.width = 'max-content';
      tableRef.current.style.maxWidth = 'none';

      // ìŠ¤íƒ€ì¼ ë³€ê²½ í›„ ë Œë”ë§ ëŒ€ê¸°
      await new Promise(resolve => setTimeout(resolve, 100));

      const canvas = await html2canvas(tableRef.current, {
        scale: 2, // ê³ í•´ìƒë„
        backgroundColor: '#ffffff',
        logging: false,
        useCORS: true,
        allowTaint: true,
        scrollX: 0,
        scrollY: 0,
        windowWidth: tableRef.current.scrollWidth,
        windowHeight: tableRef.current.scrollHeight,
      });

      // ì›ë˜ ìŠ¤íƒ€ì¼ ë³µì›
      tableRef.current.style.overflow = originalOverflow;
      tableRef.current.style.width = originalWidth;
      tableRef.current.style.maxWidth = originalMaxWidth;

      // Canvasë¥¼ Blobìœ¼ë¡œ ë³€í™˜
      canvas.toBlob((blob) => {
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `ì •ì‚°í‘œ_${weekId || 'export'}.png`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
        setIsCapturing(false);
      }, 'image/png');
    } catch (error) {
      console.error('ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨:', error);
      alert('ì´ë¯¸ì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
      setIsCapturing(false);
    }
  };

  if (!receipts || receipts.length === 0) {
    return (
      <div className="text-center py-8 text-gray-500">
        ì œì¶œëœ ì˜ìˆ˜ì¦ì´ ì—†ìŠµë‹ˆë‹¤.
      </div>
    );
  }

  return (
    <div className="bg-white rounded-lg shadow-sm">
      {/* ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ë“¤ */}
      <div className="p-3 border-b border-gray-200 flex justify-end gap-2">
        <button
          onClick={downloadAsImage}
          disabled={isCapturing}
          className="flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white rounded-lg font-semibold transition-colors"
        >
          <ImageIcon className="w-4 h-4" />
          <span className="hidden sm:inline">ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ</span>
          <span className="sm:hidden">ì´ë¯¸ì§€</span>
        </button>
        <button
          onClick={downloadCSV}
          className="flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold transition-colors"
        >
          <Download className="w-4 h-4" />
          <span className="hidden sm:inline">CSV ë‹¤ìš´ë¡œë“œ</span>
          <span className="sm:hidden">CSV</span>
        </button>
      </div>

      {/* í…Œì´ë¸” */}
      <div ref={tableRef} className="overflow-x-auto bg-white p-4">
        {/* í…Œì´ë¸” ì œëª© (ì´ë¯¸ì§€ ìº¡ì²˜ ì‹œ í¬í•¨) */}
        <div className="mb-3 flex items-start justify-between">
          <h2 className="text-lg font-bold text-gray-900 flex-1 text-center">
            {weekId ? `[${weekId}] ì£¼ì°¨ ì •ì‚°` : 'ì •ì‚°í‘œ'}
          </h2>
          <div className="flex flex-col items-end gap-1">
            {settlement?.allSettled && (
              <span className="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full font-semibold whitespace-nowrap">
                âœ“ ì •ì‚°ì¢…ê²°
              </span>
            )}
            {settlement?.status === 'settled' && !settlement?.allSettled && (
              <span className="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full font-semibold whitespace-nowrap">
                ì ‘ìˆ˜ë§ˆê°
              </span>
            )}
            {settlement?.status === 'active' && (
              <span className="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full font-semibold whitespace-nowrap">
                ì§„í–‰ì¤‘
              </span>
            )}
          </div>
        </div>

        <table className="w-full border-collapse text-sm">
        <thead>
          <tr className="bg-gray-100 border-b-2 border-gray-300">
            <th className="border border-gray-300 px-3 py-2 text-left font-bold whitespace-nowrap">ë‚ ì§œ</th>
            <th className="border border-gray-300 px-3 py-2 text-left font-bold whitespace-nowrap">ë‚´ìš©</th>
            <th className="border border-gray-300 px-3 py-2 text-left font-bold whitespace-nowrap">ì§€ì¶œ</th>
            <th className="border border-gray-300 px-3 py-2 text-left font-bold whitespace-nowrap">ê¸ˆì•¡</th>
            <th className="border border-gray-300 px-3 py-2 text-left font-bold whitespace-nowrap">ë¶„ë‹´ì</th>
            <th className="border border-gray-300 px-3 py-2 text-center font-bold whitespace-nowrap">ì¸ì›</th>
            {participantList.map(participant => (
              <th
                key={participant.userId}
                className="border border-gray-300 px-3 py-2 text-center font-bold whitespace-nowrap bg-blue-50"
              >
                {participant.displayName}
              </th>
            ))}
          </tr>
        </thead>
        <tbody>
          {Object.entries(groupedByDate).map(([date, dateReceipts]) => {
            let dateRowSpan = 0;
            dateReceipts.forEach(receipt => {
              dateRowSpan += receipt.items.length;
            });

            let isFirstDateRow = true;
            const dateRows = [];

            dateReceipts.forEach((receipt, receiptIdx) => {
              receipt.items.forEach((item, itemIdx) => {
                const isFirstItemOfReceipt = itemIdx === 0;

                dateRows.push(
                  <tr key={`${receipt.id}-${itemIdx}`} className="hover:bg-gray-50">
                    {/* ë‚ ì§œ (ë‚ ì§œë³„ ì²« í–‰ì—ë§Œ í‘œì‹œ) */}
                    {isFirstDateRow && (
                      <td
                        rowSpan={dateRowSpan}
                        className="border border-gray-300 px-3 py-2 text-center font-semibold bg-gray-50 align-top"
                      >
                        {date}
                      </td>
                    )}

                    {/* ë‚´ìš© - ì˜ìˆ˜ì¦ë³„ ì²« í•­ëª©ì—ë§Œ í‘œì‹œ */}
                    {isFirstItemOfReceipt && (
                      <td
                        rowSpan={receipt.items.length}
                        className="border border-gray-300 px-3 py-2 align-top"
                      >
                        {receipt.memo || '-'}
                      </td>
                    )}

                    {/* ì§€ì¶œ (í•­ëª©ëª…) */}
                    <td className="border border-gray-300 px-3 py-2">
                      {item.itemName}
                    </td>

                    {/* ê¸ˆì•¡ */}
                    <td className="border border-gray-300 px-3 py-2 text-right">
                      {formatCurrency(item.amount)}
                    </td>

                    {/* ë¶„ë‹´ì (ì˜ìˆ˜ì¦ë³„ ì²« í•­ëª©ì—ë§Œ í‘œì‹œ) */}
                    {isFirstItemOfReceipt && (
                      <td
                        rowSpan={receipt.items.length}
                        className="border border-gray-300 px-3 py-2 text-center align-top"
                      >
                        {userProfiles[receipt.paidBy]?.displayName || receipt.paidByName}
                      </td>
                    )}

                    {/* ì¸ì› */}
                    <td className="border border-gray-300 px-3 py-2 text-center">
                      {item.splitAmong.length}
                    </td>

                    {/* ê° ì°¸ì—¬ìë³„ ë¶„ë‹´ê¸ˆ */}
                    {participantList.map(participant => {
                      // íƒ€ì… ë¶ˆì¼ì¹˜ ë¬¸ì œ í•´ê²°: ë‘˜ ë‹¤ stringìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ë¹„êµ
                      const participantId = String(participant.userId);
                      const splitAmongStrings = item.splitAmong.map(id => String(id));
                      const isSplitter = splitAmongStrings.includes(participantId);

                      return (
                        <td
                          key={participant.userId}
                          className={`border border-gray-300 px-3 py-2 text-right ${
                            isSplitter ? 'bg-yellow-50' : ''
                          }`}
                        >
                          {isSplitter ? formatCurrency(item.perPerson) : '-'}
                        </td>
                      );
                    })}
                  </tr>
                );

                isFirstDateRow = false;
              });
            });

            return dateRows;
          })}

          {/* ì§€ì¶œ í•©ê³„ */}
          <tr className="bg-gray-100 font-bold border-t-2 border-gray-400">
            <td colSpan="3" className="border border-gray-300 px-3 py-2 text-center">
              ì§€ì¶œ í•©ê³„
            </td>
            <td className="border border-gray-300 px-3 py-2 text-right">
              {formatCurrency(receipts.reduce((sum, r) => sum + r.totalAmount, 0))}
            </td>
            <td colSpan="2" className="border border-gray-300"></td>
            {participantList.map(participant => (
              <td
                key={participant.userId}
                className="border border-gray-300 px-3 py-2 text-right bg-yellow-100"
              >
                {formatCurrency(participantOwedAmounts[participant.userId] || 0)}
              </td>
            ))}
          </tr>

          {/* ë‚¸ ëˆ */}
          <tr className="bg-blue-50">
            <td colSpan="6" className="border border-gray-300 px-3 py-2 text-center font-semibold">
              ë‚¸ ëˆ
            </td>
            {participantList.map(participant => (
              <td
                key={participant.userId}
                className="border border-gray-300 px-3 py-2 text-right font-semibold"
              >
                {formatCurrency(participantPaidAmounts[participant.userId] || 0)}
              </td>
            ))}
          </tr>

          {/* ì •ì‚° ê²°ê³¼ */}
          <tr className="bg-blue-50 font-bold">
            <td colSpan="6" className="border border-gray-300 px-3 py-2 text-center">
              ì •ì‚° ê²°ê³¼
            </td>
            {participantList.map(participant => {
              const balance = participant.balance;
              const amount = Math.abs(balance);
              const isPaymentConfirmed = participant.paymentConfirmed === true;
              const isTransferCompleted = participant.transferCompleted === true;
              const needsPayment = balance < 0;
              const needsReceive = balance > 0;

              return (
                <td
                  key={participant.userId}
                  className={`border border-gray-300 px-3 py-2 text-right ${
                    needsReceive
                      ? isTransferCompleted ? 'text-gray-500' : 'text-green-600'
                      : needsPayment
                      ? isPaymentConfirmed ? 'text-gray-500' : 'text-orange-600'
                      : 'text-gray-600'
                  }`}
                >
                  {balance !== 0 ? (
                    <div className="flex flex-col items-end gap-0.5">
                      <span className={(isPaymentConfirmed && needsPayment) || (isTransferCompleted && needsReceive) ? 'line-through' : ''}>
                        {needsReceive ? '+' : ''}{formatCurrency(amount)}
                      </span>
                      {isPaymentConfirmed && needsPayment && (
                        <span className="text-xs text-green-600 font-semibold">
                          âœ“ ì…ê¸ˆí™•ì¸
                        </span>
                      )}
                      {isTransferCompleted && needsReceive && (
                        <span className="text-xs text-green-600 font-semibold">
                          âœ“ ì†¡ê¸ˆì™„ë£Œ
                        </span>
                      )}
                    </div>
                  ) : (
                    '-'
                  )}
                </td>
              );
            })}
          </tr>
        </tbody>
      </table>
      </div>
    </div>
  );
};

export default SettlementTableView;
</file>

<file path="src/services/authService.js">
// src/services/authService.js
import { doc, getDoc, setDoc, collection, getDocs, Timestamp } from 'firebase/firestore';
import { db } from '../config/firebase';

class AuthService {
  KAUTH_BASE = 'https://kauth.kakao.com';
  KAPI_BASE = 'https://kapi.kakao.com';

  // ----- ë‚´ë¶€ ìœ í‹¸ -----
  _requireEnv(key, msg) {
    const val = import.meta.env[key];
    if (!val) {
      throw new Error(msg || `í™˜ê²½ë³€ìˆ˜ ${key} ê°€ ì„¤ì •ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.`);
    }
    return val;
  }

  async _postForm(url, params) {
    const body = params instanceof URLSearchParams ? params.toString() : new URLSearchParams(params).toString();
    const res = await fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body
    });
    return res;
  }

  async _assertOk(res, label) {
    if (!res.ok) {
      let text = '';
      try { text = await res.text(); } catch {}
      throw new Error(`${label} ì‹¤íŒ¨(${res.status}). ${text || ''}`.trim());
    }
  }

  // ----- 1) ì¹´ì¹´ì˜¤ ì½”ë“œ â†’ í† í° â†’ ì‚¬ìš©ì ì •ë³´ -----
  async getKakaoUserInfo(code) {
    if (!code) {
      throw new Error('ì¸ê°€ ì½”ë“œ(code)ê°€ ì—†ìŠµë‹ˆë‹¤. ì½œë°± URL/redirectUrië¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
    }

    const REST_API_KEY = this._requireEnv(
      'VITE_KAKAO_REST_API_KEY',
      'í™˜ê²½ë³€ìˆ˜ VITE_KAKAO_REST_API_KEY ê°€ í•„ìš”í•©ë‹ˆë‹¤.'
    );
    
    const currentOrigin = window.location.origin;
    const REDIRECT_URI = `${currentOrigin}/auth/kakao/callback`;
    
    const CLIENT_SECRET = import.meta.env.VITE_KAKAO_CLIENT_SECRET;

    console.log('ğŸ”‘ í† í° êµí™˜ìš© ë¦¬ë‹¤ì´ë ‰íŠ¸ URI:', REDIRECT_URI);

    const tokenParams = new URLSearchParams({
      grant_type: 'authorization_code',
      client_id: REST_API_KEY,
      redirect_uri: REDIRECT_URI,
      code
    });
    if (CLIENT_SECRET) tokenParams.append('client_secret', CLIENT_SECRET);

    const tokenRes = await this._postForm(`${this.KAUTH_BASE}/oauth/token`, tokenParams);
    await this._assertOk(tokenRes, 'í† í° êµí™˜');
    const tokenJson = await tokenRes.json();
    const accessToken = tokenJson?.access_token;
    if (!accessToken) {
      throw new Error('í† í° êµí™˜ì€ ì„±ê³µí–ˆìœ¼ë‚˜ access_tokenì´ ì—†ìŠµë‹ˆë‹¤.');
    }

    return await this.getKakaoUserInfoFromAccessToken(accessToken);
  }

  // ----- 2) access_tokenìœ¼ë¡œ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ -----
  async getKakaoUserInfoFromAccessToken(accessToken) {
    if (!accessToken) {
      throw new Error('access_token ì´ ì—†ìŠµë‹ˆë‹¤.');
    }
    const meRes = await fetch(`${this.KAPI_BASE}/v2/user/me`, {
      headers: { Authorization: `Bearer ${accessToken}` }
    });
    await this._assertOk(meRes, 'ì¹´ì¹´ì˜¤ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ');
    const data = await meRes.json();

    const id = data?.id;
    if (!id) {
      throw new Error('ì¹´ì¹´ì˜¤ ì‘ë‹µì— ì‚¬ìš©ì IDê°€ ì—†ìŠµë‹ˆë‹¤.');
    }

    const account = data?.kakao_account || {};
    const profile = account?.profile || {};

    // âœ… ì¹´ì¹´ì˜¤ ì‹¤ëª…/ê¸°ë³¸ì •ë³´
    const name = account?.name || '';
    const nickname = profile?.nickname || '';
    const gender = account?.gender || '';        // "male" | "female" (ì—†ì„ ìˆ˜ ìˆìŒ)
    const birthyear = account?.birthyear || '';  // "1990" (ì—†ì„ ìˆ˜ ìˆìŒ)
    const phone_number = account?.phone_number || ''; // "+82 10-1234-5678" ë“±

    return {
      id: String(id),
      email: account?.email ?? '',
      // âœ… displayName = ì‹¤ëª…, nickname = ì¹´ì¹´ì˜¤ë‹‰ë„¤ì„
      displayName: name || nickname || 'ì‚¬ìš©ì',  // ì‹¤ëª… ìš°ì„ 
      nickname,                                    // ì¹´ì¹´ì˜¤ ë‹‰ë„¤ì„ ë³„ë„ ë³´ê´€
      gender,
      birthyear,
      phoneNumber: phone_number,
      profileImage: profile?.profile_image_url ?? '',
      kakaoRaw: data,
    };
  }

  // ----- 3) Firestore: ì‚¬ìš©ì ì¡´ì¬ ì—¬ë¶€ -----
  async checkUserExists(userId) {
    // âœ… userIdë¥¼ ë°˜ë“œì‹œ stringìœ¼ë¡œ í†µì¼
    const userIdString = String(userId);
    const snap = await getDoc(doc(db, 'users', userIdString));
    return snap.exists();
  }

  // ----- 4) Firestore: ì‚¬ìš©ì ìµœì´ˆ ë“±ë¡ (í™•ì¥ëœ í•„ë“œ ì§€ì›) -----
  async registerUser(userData) {
    // âœ… userIdë¥¼ ë°˜ë“œì‹œ stringìœ¼ë¡œ í†µì¼
    const userId = String(userData.id);

    const userDoc = {
      id: userId,  // âœ… stringìœ¼ë¡œ ë³€í™˜ëœ id ì €ì¥
      displayName: userData.displayName ?? '',  // ì‹¤ëª…
      nickname: userData.nickname ?? '',         // âœ… ì¹´ì¹´ì˜¤ ë‹‰ë„¤ì„ ì¶”ê°€
      email: userData.email ?? '',
      phoneNumber: userData.phoneNumber ?? '',
      profileImage: userData.profileImage ?? '',
      provider: userData.provider ?? 'kakao',
      createdAt: Timestamp.now()  // Firebase Timestamp ì‚¬ìš©
    };

    // ì„ íƒì  í•„ë“œë“¤ (íšŒì›ê°€ì… í¼ì—ì„œ ì…ë ¥ë°›ì€ ì •ë³´)
    if (userData.birthyear) {
      userDoc.birthyear = userData.birthyear;
    }
    if (userData.gender) {
      userDoc.gender = userData.gender;
    }

    await setDoc(doc(db, 'users', userId), userDoc, { merge: true });
  }

  // ----- 4-1) Firestore: ì‚¬ìš©ì í”„ë¡œí•„ ì •ë³´ ì—…ë°ì´íŠ¸ (ì¬ë¡œê·¸ì¸ ì‹œ) -----
  async updateUserProfile(userId, profileData) {
    // âœ… userIdë¥¼ ë°˜ë“œì‹œ stringìœ¼ë¡œ í†µì¼
    const userIdString = String(userId);

    const updates = {};

    if (profileData.displayName !== undefined) {
      updates.displayName = profileData.displayName;  // ì‹¤ëª…
    }
    if (profileData.nickname !== undefined) {  // âœ… ì¹´ì¹´ì˜¤ ë‹‰ë„¤ì„ ì—…ë°ì´íŠ¸ ì¶”ê°€
      updates.nickname = profileData.nickname;
    }
    if (profileData.profileImage !== undefined) {
      updates.profileImage = profileData.profileImage;
    }
    if (profileData.birthyear !== undefined) {
      updates.birthyear = profileData.birthyear;
    }
    if (profileData.gender !== undefined) {
      updates.gender = profileData.gender;
    }
    if (profileData.phoneNumber !== undefined) {
      updates.phoneNumber = profileData.phoneNumber;
    }
    if (profileData.email !== undefined) {
      updates.email = profileData.email;
    }

    if (Object.keys(updates).length > 0) {
      await setDoc(doc(db, 'users', userIdString), updates, { merge: true });
    }
  }

  // ----- 5) Firestore: ì‚¬ìš©ì + spaceAccess ë¬¶ìŒ ì¡°íšŒ -----
  async getUserData(userId) {
    // âœ… userIdë¥¼ ë°˜ë“œì‹œ stringìœ¼ë¡œ í†µì¼
    const userIdString = String(userId);

    const userRef = doc(db, 'users', userIdString);
    const userSnap = await getDoc(userRef);
    if (!userSnap.exists()) return null;

    const accessRef = collection(db, `users/${userIdString}/spaceAccess`);
    const accessSnap = await getDocs(accessRef);

    const spaceAccess = [];
    accessSnap.forEach((d) => {
      const v = d.data();
      spaceAccess.push({
        spaceId: d.id,
        userType: v?.userType ?? '',
        order: v?.order ?? 0
      });
    });

    return {
      id: userIdString,  // âœ… stringìœ¼ë¡œ ë³€í™˜ëœ id ë°˜í™˜
      ...userSnap.data(),
      spaceAccess
    };
  }

  // ----- 6) Firestore: í”„ë¡œí•„ ë‹¤ê±´ ì¡°íšŒ -----
  async getUserProfiles(userIds) {
    try {
      const profiles = {};
      await Promise.all(
        (userIds ?? []).map(async (uid) => {
          try {
            // userIdë¥¼ ë¬¸ìì—´ë¡œ ë³€í™˜ (Firebase doc()ëŠ” ë¬¸ìì—´ í•„ìš”)
            const userIdStr = String(uid);
            const s = await getDoc(doc(db, 'users', userIdStr));
            if (s.exists()) {
              const d = s.data();
              profiles[userIdStr] = {
                displayName: d?.displayName ?? '',
                profileImage: d?.profileImage ?? '',
                gender: d?.gender ?? ''
              };
            }
          } catch (e) {
            console.warn(`[AuthService] í”„ë¡œí•„ ì¡°íšŒ ì‹¤íŒ¨: ${uid}`, e.message || e);
          }
        })
      );
      return profiles;
    } catch (error) {
      console.warn('[AuthService] getUserProfiles ì „ì²´ ì‹¤íŒ¨:', error.message || error);
      return {};
    }
  }
}

export default new AuthService();
</file>

<file path="package.json">
{
  "name": "lounge-app",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@capacitor/cli": "^8.0.0",
    "@capacitor/core": "^8.0.0",
    "@capacitor/ios": "^8.0.0",
    "@capacitor/push-notifications": "^8.0.0",
    "firebase-admin": "^12.0.0",
    "html2canvas": "^1.4.1",
    "node-fetch": "^2.7.0",
    "openai": "^6.10.0",
    "puppeteer": "^24.34.0",
    "react": "^19.1.1",
    "react-dom": "^19.1.1",
    "resend": "^6.4.2",
    "solapi": "^5.5.2"
  },
  "devDependencies": {
    "@eslint/js": "^9.36.0",
    "@types/react": "^19.1.16",
    "@types/react-dom": "^19.1.9",
    "@vitejs/plugin-react": "^5.0.4",
    "autoprefixer": "^10.4.20",
    "axios": "^1.7.7",
    "clsx": "^2.1.1",
    "eslint": "^9.36.0",
    "eslint-plugin-react-hooks": "^5.2.0",
    "eslint-plugin-react-refresh": "^0.4.22",
    "firebase": "^10.13.0",
    "globals": "^16.4.0",
    "lucide-react": "^0.562.0",
    "postcss": "^8.4.45",
    "react-router-dom": "^6.26.2",
    "tailwind-merge": "^3.3.1",
    "tailwindcss": "^3.4.1",
    "vite": "^7.2.6",
    "zustand": "^4.5.5"
  }
}
</file>

<file path="src/services/spaceSettingsService.js">
import { doc, getDoc, updateDoc, setDoc, collection, addDoc, query, where, getDocs, orderBy, writeBatch } from 'firebase/firestore';
import { db } from '../config/firebase';

/**
 * ìŠ¤í˜ì´ìŠ¤ ê¸°ë³¸ ì„¤ì • ì„œë¹„ìŠ¤
 */
const spaceSettingsService = {
  /**
   * ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ ì—…ë°ì´íŠ¸
   * spaces/{spaceId} ë¬¸ì„œì˜ name í•„ë“œì™€
   * ëª¨ë“  ë©¤ë²„ì˜ users/{userId}/spaceAccess/{spaceId} ë¬¸ì„œì˜ spaceName í•„ë“œë¥¼ ë™ê¸°í™”
   */
  async updateSpaceName(spaceId, newName, userId) {
    try {
      console.log('ğŸ“ ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ ì—…ë°ì´íŠ¸ ì‹œì‘:', { spaceId, newName, userId });

      // 1. spaces/{spaceId} ë¬¸ì„œ ì—…ë°ì´íŠ¸
      const spaceRef = doc(db, 'spaces', spaceId);
      await updateDoc(spaceRef, {
        name: newName,
        updatedAt: new Date(),
        updatedBy: userId
      });

      console.log('âœ… spaces ë¬¸ì„œ ì—…ë°ì´íŠ¸ ì™„ë£Œ');

      // 2. ëª¨ë“  ë©¤ë²„ì˜ spaceAccess ì—…ë°ì´íŠ¸
      const assignedUsersRef = collection(db, `spaces/${spaceId}/assignedUsers`);
      const snapshot = await getDocs(assignedUsersRef);
      
      console.log(`ğŸ“‹ ${snapshot.size}ëª…ì˜ ë©¤ë²„ spaceAccess ì—…ë°ì´íŠ¸ ì‹œì‘`);

      // Batchë¡œ ëª¨ë“  ë©¤ë²„ì˜ spaceAccess ë™ì‹œ ì—…ë°ì´íŠ¸
      const batch = writeBatch(db);
      
      snapshot.forEach((userDoc) => {
        const userSpaceRef = doc(db, `users/${userDoc.id}/spaceAccess`, spaceId);
        batch.update(userSpaceRef, {
          spaceName: newName,
          updatedAt: new Date().toISOString()
        });
      });

      await batch.commit();
      console.log('âœ… ëª¨ë“  ë©¤ë²„ì˜ spaceAccess ì—…ë°ì´íŠ¸ ì™„ë£Œ');

      return { success: true };
    } catch (error) {
      console.error('âŒ ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ìŠ¤í˜ì´ìŠ¤ ê¸°ë³¸ ì„¤ì • ì¡°íšŒ
   */
  async getSpaceSettings(spaceId) {
    try {
      const spaceRef = doc(db, 'spaces', spaceId);
      const spaceDoc = await getDoc(spaceRef);

      if (!spaceDoc.exists()) {
        throw new Error('ìŠ¤í˜ì´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }

      return spaceDoc.data();
    } catch (error) {
      console.error('âŒ ìŠ¤í˜ì´ìŠ¤ ì„¤ì • ì¡°íšŒ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ì•Œë¦¼í†¡ ì„¤ì • ì¡°íšŒ
   */
  async getAlimtalkSettings(spaceId) {
    try {
      const alimtalkRef = doc(db, `spaces/${spaceId}/settings`, 'alimtalk');
      const alimtalkDoc = await getDoc(alimtalkRef);

      if (!alimtalkDoc.exists()) {
        // ê¸°ë³¸ê°’ ë°˜í™˜
        return {
          enabled: false,
          status: 'inactive', // inactive, pending, approved, rejected
          updatedAt: null,
          updatedBy: null,
          requestedAt: null,
          requestedBy: null,
          approvedAt: null,
          approvedBy: null
        };
      }

      return alimtalkDoc.data();
    } catch (error) {
      console.error('âŒ ì•Œë¦¼í†¡ ì„¤ì • ì¡°íšŒ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ì•Œë¦¼í†¡ í™œì„±í™” ì‹ ì²­
   */
  async requestAlimtalkActivation(spaceId, userId, userName, userType, spaceName) {
    try {
      console.log('ğŸ“ ì•Œë¦¼í†¡ í™œì„±í™” ì‹ ì²­ ì‹œì‘:', { spaceId, userId });

      // 1. ì•Œë¦¼í†¡ ì„¤ì • ì—…ë°ì´íŠ¸ (pending ìƒíƒœë¡œ)
      const alimtalkRef = doc(db, `spaces/${spaceId}/settings`, 'alimtalk');
      
      const settingsData = {
        enabled: false,
        status: 'pending',
        requestedAt: new Date(),
        requestedBy: {
          id: userId,
          displayName: userName,
          userType: userType
        },
        updatedAt: new Date()
      };

      await setDoc(alimtalkRef, settingsData, { merge: true });

      // 2. admin_requests ì»¬ë ‰ì…˜ì— ì‹ ì²­ ê¸°ë¡ ì¶”ê°€
      const requestsRef = collection(db, 'admin_requests');
      await addDoc(requestsRef, {
        type: 'alimtalk_activation',
        spaceId: spaceId,
        spaceName: spaceName,
        status: 'pending',
        requestedBy: {
          id: userId,
          displayName: userName,
          userType: userType
        },
        requestedAt: new Date(),
        processedAt: null,
        processedBy: null,
        rejectionReason: null
      });

      console.log('âœ… ì•Œë¦¼í†¡ í™œì„±í™” ì‹ ì²­ ì™„ë£Œ');

      return { success: true };
    } catch (error) {
      console.error('âŒ ì•Œë¦¼í†¡ í™œì„±í™” ì‹ ì²­ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ì•Œë¦¼í†¡ ë¹„í™œì„±í™” (ì¦‰ì‹œ ì²˜ë¦¬)
   */
  async deactivateAlimtalk(spaceId, userId, userName, userType) {
    try {
      console.log('ğŸ“ ì•Œë¦¼í†¡ ë¹„í™œì„±í™” ì‹œì‘:', { spaceId, userId });

      const alimtalkRef = doc(db, `spaces/${spaceId}/settings`, 'alimtalk');
      
      const settingsData = {
        enabled: false,
        status: 'inactive',
        updatedAt: new Date(),
        updatedBy: {
          id: userId,
          displayName: userName,
          userType: userType
        }
      };

      await setDoc(alimtalkRef, settingsData, { merge: true });

      console.log('âœ… ì•Œë¦¼í†¡ ë¹„í™œì„±í™” ì™„ë£Œ');

      return { success: true };
    } catch (error) {
      console.error('âŒ ì•Œë¦¼í†¡ ë¹„í™œì„±í™” ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ìŠˆí¼ ì–´ë“œë¯¼: ì•Œë¦¼í†¡ ì‹ ì²­ ìŠ¹ì¸
   */
  async approveAlimtalkRequest(requestId, spaceId, adminId, adminName) {
    try {
      console.log('âœ… ì•Œë¦¼í†¡ ì‹ ì²­ ìŠ¹ì¸ ì‹œì‘:', { requestId, spaceId, adminId });

      // 1. ì‹ ì²­ ë¬¸ì„œ ì—…ë°ì´íŠ¸
      const requestRef = doc(db, 'admin_requests', requestId);
      await updateDoc(requestRef, {
        status: 'approved',
        processedAt: new Date(),
        processedBy: {
          id: adminId,
          displayName: adminName
        }
      });

      // 2. ì•Œë¦¼í†¡ ì„¤ì • í™œì„±í™”
      const alimtalkRef = doc(db, `spaces/${spaceId}/settings`, 'alimtalk');
      await updateDoc(alimtalkRef, {
        enabled: true,
        status: 'approved',
        approvedAt: new Date(),
        approvedBy: {
          id: adminId,
          displayName: adminName
        }
      });

      console.log('âœ… ì•Œë¦¼í†¡ ì‹ ì²­ ìŠ¹ì¸ ì™„ë£Œ');
      return { success: true };
    } catch (error) {
      console.error('âŒ ì•Œë¦¼í†¡ ì‹ ì²­ ìŠ¹ì¸ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ìŠˆí¼ ì–´ë“œë¯¼: ì•Œë¦¼í†¡ ì‹ ì²­ ê±°ë¶€
   */
  async rejectAlimtalkRequest(requestId, spaceId, adminId, adminName, reason) {
    try {
      console.log('âŒ ì•Œë¦¼í†¡ ì‹ ì²­ ê±°ë¶€ ì‹œì‘:', { requestId, spaceId, adminId });

      // 1. ì‹ ì²­ ë¬¸ì„œ ì—…ë°ì´íŠ¸
      const requestRef = doc(db, 'admin_requests', requestId);
      await updateDoc(requestRef, {
        status: 'rejected',
        processedAt: new Date(),
        processedBy: {
          id: adminId,
          displayName: adminName
        },
        rejectionReason: reason
      });

      // 2. ì•Œë¦¼í†¡ ì„¤ì • ê±°ë¶€ ìƒíƒœë¡œ
      const alimtalkRef = doc(db, `spaces/${spaceId}/settings`, 'alimtalk');
      await updateDoc(alimtalkRef, {
        enabled: false,
        status: 'rejected',
        rejectionReason: reason,
        updatedAt: new Date()
      });

      console.log('âœ… ì•Œë¦¼í†¡ ì‹ ì²­ ê±°ë¶€ ì™„ë£Œ');
      return { success: true };
    } catch (error) {
      console.error('âŒ ì•Œë¦¼í†¡ ì‹ ì²­ ê±°ë¶€ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ìŠˆí¼ ì–´ë“œë¯¼: ëŒ€ê¸° ì¤‘ì¸ ì•Œë¦¼í†¡ ì‹ ì²­ ëª©ë¡ ì¡°íšŒ
   */
  async getPendingAlimtalkRequests() {
    try {
      const requestsRef = collection(db, 'admin_requests');
      const q = query(
        requestsRef,
        where('type', '==', 'alimtalk_activation'),
        where('status', '==', 'pending'),
        orderBy('requestedAt', 'desc')
      );

      const snapshot = await getDocs(q);
      const requests = [];

      snapshot.forEach(doc => {
        requests.push({
          id: doc.id,
          ...doc.data()
        });
      });

      return requests;
    } catch (error) {
      console.error('âŒ ëŒ€ê¸° ì¤‘ì¸ ì‹ ì²­ ì¡°íšŒ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ìŠˆí¼ ì–´ë“œë¯¼: í™œì„±í™”ëœ ì•Œë¦¼í†¡ ìŠ¤í˜ì´ìŠ¤ ëª©ë¡ ì¡°íšŒ
   */
  async getActiveAlimtalkSpaces() {
    try {
      console.log('ğŸ“‹ í™œì„±í™”ëœ ì•Œë¦¼í†¡ ìŠ¤í˜ì´ìŠ¤ ì¡°íšŒ ì‹œì‘');

      // ëª¨ë“  ìŠ¤í˜ì´ìŠ¤ ì¡°íšŒ
      const spacesRef = collection(db, 'spaces');
      const spacesSnapshot = await getDocs(spacesRef);

      const activeSpaces = [];

      // ê° ìŠ¤í˜ì´ìŠ¤ì˜ ì•Œë¦¼í†¡ ì„¤ì • í™•ì¸
      for (const spaceDoc of spacesSnapshot.docs) {
        const spaceId = spaceDoc.id;
        const spaceData = spaceDoc.data();

        // ì•Œë¦¼í†¡ ì„¤ì • ì¡°íšŒ
        const alimtalkRef = doc(db, `spaces/${spaceId}/settings`, 'alimtalk');
        const alimtalkDoc = await getDoc(alimtalkRef);

        if (alimtalkDoc.exists()) {
          const alimtalkData = alimtalkDoc.data();

          // enabled: trueì¸ ê²½ìš°ë§Œ ì¶”ê°€
          if (alimtalkData.enabled === true) {
            activeSpaces.push({
              spaceId,
              spaceName: spaceData.name || 'ì´ë¦„ ì—†ìŒ',
              alimtalkSettings: alimtalkData,
              spaceData
            });
          }
        }
      }

      console.log(`âœ… í™œì„±í™”ëœ ì•Œë¦¼í†¡ ìŠ¤í˜ì´ìŠ¤ ${activeSpaces.length}ê°œ ë°œê²¬`);

      // ìŠ¹ì¸ì¼ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
      activeSpaces.sort((a, b) => {
        const aDate = a.alimtalkSettings.approvedAt?.toDate?.() || new Date(0);
        const bDate = b.alimtalkSettings.approvedAt?.toDate?.() || new Date(0);
        return bDate - aDate;
      });

      return activeSpaces;
    } catch (error) {
      console.error('âŒ í™œì„±í™”ëœ ì•Œë¦¼í†¡ ìŠ¤í˜ì´ìŠ¤ ì¡°íšŒ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ìŠˆí¼ ì–´ë“œë¯¼: ì•Œë¦¼í†¡ ê°•ì œ ë¹„í™œì„±í™”
   */
  async superAdminDeactivateAlimtalk(spaceId, adminId, adminName, reason) {
    try {
      console.log('ğŸ”’ ìŠˆí¼ ì–´ë“œë¯¼ ì•Œë¦¼í†¡ ë¹„í™œì„±í™” ì‹œì‘:', { spaceId, adminId });

      const alimtalkRef = doc(db, `spaces/${spaceId}/settings`, 'alimtalk');

      const settingsData = {
        enabled: false,
        status: 'deactivated_by_admin',
        deactivatedAt: new Date(),
        deactivatedBy: {
          id: adminId,
          displayName: adminName
        },
        deactivationReason: reason,
        updatedAt: new Date()
      };

      await updateDoc(alimtalkRef, settingsData);

      console.log('âœ… ìŠˆí¼ ì–´ë“œë¯¼ ì•Œë¦¼í†¡ ë¹„í™œì„±í™” ì™„ë£Œ');

      return { success: true };
    } catch (error) {
      console.error('âŒ ìŠˆí¼ ì–´ë“œë¯¼ ì•Œë¦¼í†¡ ë¹„í™œì„±í™” ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ê²ŒìŠ¤íŠ¸ ì •ì±… ì¡°íšŒ
   */
  async getGuestPolicy(spaceId) {
    try {
      console.log('ğŸ“‹ ê²ŒìŠ¤íŠ¸ ì •ì±… ì¡°íšŒ:', spaceId);

      const spaceRef = doc(db, 'spaces', spaceId);
      const spaceDoc = await getDoc(spaceRef);

      if (!spaceDoc.exists()) {
        throw new Error('ìŠ¤í˜ì´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }

      const data = spaceDoc.data();

      return {
        accountBank: data.accountBank || '',
        accountNumber: data.accountNumber || '',
        accountHolder: data.accountHolder || '',
        guestPricePerNight: data.guestPricePerNight || 30000,
      };
    } catch (error) {
      console.error('âŒ ê²ŒìŠ¤íŠ¸ ì •ì±… ì¡°íšŒ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ê²ŒìŠ¤íŠ¸ ì •ì±… ì—…ë°ì´íŠ¸
   */
  async updateGuestPolicy(spaceId, policyData, userId, userName) {
    try {
      console.log('ğŸ’¾ ê²ŒìŠ¤íŠ¸ ì •ì±… ì—…ë°ì´íŠ¸:', { spaceId, policyData });

      const spaceRef = doc(db, 'spaces', spaceId);

      const updateData = {
        accountBank: policyData.accountBank,
        accountNumber: policyData.accountNumber,
        accountHolder: policyData.accountHolder,
        guestPricePerNight: policyData.guestPricePerNight,
        guestPolicyUpdatedAt: new Date(),
        guestPolicyUpdatedBy: {
          id: userId,
          displayName: userName
        }
      };

      await updateDoc(spaceRef, updateData);

      console.log('âœ… ê²ŒìŠ¤íŠ¸ ì •ì±… ì—…ë°ì´íŠ¸ ì™„ë£Œ');

      return { success: true };
    } catch (error) {
      console.error('âŒ ê²ŒìŠ¤íŠ¸ ì •ì±… ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ì´ë©”ì¼ ì•Œë¦¼ ì„¤ì • ì¡°íšŒ
   */
  async getEmailSettings(spaceId) {
    try {
      console.log('ğŸ“§ ì´ë©”ì¼ ì•Œë¦¼ ì„¤ì • ì¡°íšŒ:', spaceId);

      const emailRef = doc(db, `spaces/${spaceId}/settings`, 'email');
      const emailDoc = await getDoc(emailRef);

      if (!emailDoc.exists()) {
        // ê¸°ë³¸ê°’ ë°˜í™˜ (ëª¨ë‘ ë¹„í™œì„±í™”)
        return {
          reservation: {
            enabled: false,
            types: [],
            recipients: []
          },
          settlement: {
            enabled: false,
            recipients: []
          },
          praise: {
            enabled: false,
            recipients: []
          },
          expense: {
            enabled: false,
            recipients: []
          }
        };
      }

      return emailDoc.data();
    } catch (error) {
      console.error('âŒ ì´ë©”ì¼ ì•Œë¦¼ ì„¤ì • ì¡°íšŒ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ì´ë©”ì¼ ì•Œë¦¼ ì„¤ì • ì—…ë°ì´íŠ¸
   */
  async updateEmailSettings(spaceId, settings, userId) {
    try {
      console.log('ğŸ’¾ ì´ë©”ì¼ ì•Œë¦¼ ì„¤ì • ì—…ë°ì´íŠ¸:', { spaceId, settings });

      const emailRef = doc(db, `spaces/${spaceId}/settings`, 'email');

      const updateData = {
        ...settings,
        updatedAt: new Date(),
        updatedBy: userId
      };

      await setDoc(emailRef, updateData);

      console.log('âœ… ì´ë©”ì¼ ì•Œë¦¼ ì„¤ì • ì—…ë°ì´íŠ¸ ì™„ë£Œ');

      return { success: true };
    } catch (error) {
      console.error('âŒ ì´ë©”ì¼ ì•Œë¦¼ ì„¤ì • ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ì •ì‚° ê³„ì¢Œ ì •ë³´ ì¡°íšŒ
   */
  async getSettlementAccount(spaceId) {
    try {
      console.log('ğŸ’° ì •ì‚° ê³„ì¢Œ ì •ë³´ ì¡°íšŒ:', spaceId);

      const spaceRef = doc(db, 'spaces', spaceId);
      const spaceDoc = await getDoc(spaceRef);

      if (!spaceDoc.exists()) {
        throw new Error('ìŠ¤í˜ì´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }

      const data = spaceDoc.data();

      return {
        accountBank_settle: data.accountBank_settle || '',
        accountNumber_settle: data.accountNumber_settle || '',
        accountHolder_settle: data.accountHolder_settle || '',
      };
    } catch (error) {
      console.error('âŒ ì •ì‚° ê³„ì¢Œ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ì •ì‚° ê³„ì¢Œ ì •ë³´ ì—…ë°ì´íŠ¸
   */
  async updateSettlementAccount(spaceId, accountData, userId, userName) {
    try {
      console.log('ğŸ’¾ ì •ì‚° ê³„ì¢Œ ì •ë³´ ì—…ë°ì´íŠ¸:', { spaceId, accountData });

      const spaceRef = doc(db, 'spaces', spaceId);

      const updateData = {
        accountBank_settle: accountData.accountBank_settle,
        accountNumber_settle: accountData.accountNumber_settle,
        accountHolder_settle: accountData.accountHolder_settle,
        settlementAccountUpdatedAt: new Date(),
        settlementAccountUpdatedBy: {
          id: userId,
          displayName: userName
        }
      };

      await updateDoc(spaceRef, updateData);

      console.log('âœ… ì •ì‚° ê³„ì¢Œ ì •ë³´ ì—…ë°ì´íŠ¸ ì™„ë£Œ');

      return { success: true };
    } catch (error) {
      console.error('âŒ ì •ì‚° ê³„ì¢Œ ì •ë³´ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
      throw error;
    }
  }
};

export default spaceSettingsService;
</file>

<file path="src/services/notificationService.js">
/**
 * ì•Œë¦¼ ì„œë¹„ìŠ¤ (NHN Cloud ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡)
 *
 * ê¸°ì¡´ Solapi ì½”ë“œë¥¼ NHN Cloudë¡œ ì „í™˜
 */

import spaceSettingsService from './spaceSettingsService';

const NETLIFY_FUNCTION_URL = '/.netlify/functions/send-notification';

/**
 * ì˜ˆì•½ í™•ì¸ ì•Œë¦¼ ë°œì†¡ (íƒ€ì…ë³„ ë¶„ê¸°)
 * - ê²ŒìŠ¤íŠ¸(guest): ì•Œë¦¼í†¡ ë°œì†¡
 * - ì£¼ì£¼/ë§¤ë‹ˆì €/ë¶€ë§¤ë‹ˆì €: ì•Œë¦¼ ì—†ìŒ
 */
export async function sendReservationConfirm(reservationData, options = {}) {
  try {
    console.log('ğŸ“¨ ì˜ˆì•½ í™•ì¸ ì•Œë¦¼ ë°œì†¡ ì²´í¬:', {
      type: reservationData.type,
      alimtalkEnabled: options.alimtalkEnabled
    });

    // ê²ŒìŠ¤íŠ¸ì¸ ê²½ìš°ë§Œ ì•Œë¦¼í†¡ ë°œì†¡
    if (reservationData.type === 'guest') {
      if (!options.alimtalkEnabled) {
        console.log('âš ï¸ ì•Œë¦¼í†¡ ë¹„í™œì„±í™” ìƒíƒœ - ë°œì†¡ ê±´ë„ˆëœ€');
        return { success: true, skipped: true, reason: 'alimtalk_disabled' };
      }
      
      return await sendGuestConfirmation(reservationData);
    }
    
    // ì£¼ì£¼/ë§¤ë‹ˆì €/ë¶€ë§¤ë‹ˆì €ëŠ” ì•Œë¦¼ ì—†ìŒ
    console.log('â„¹ï¸ ì£¼ì£¼/ë§¤ë‹ˆì € ì˜ˆì•½ - ì•Œë¦¼ ë°œì†¡ ì•ˆ í•¨');
    return { success: true, skipped: true, reason: 'not_guest' };
    
  } catch (error) {
    console.error('âŒ ì˜ˆì•½ í™•ì¸ ì•Œë¦¼ ë°œì†¡ ì‹¤íŒ¨:', error);
    // ì•Œë¦¼ ì‹¤íŒ¨í•´ë„ ì˜ˆì•½ì€ ì„±ê³µìœ¼ë¡œ ì²˜ë¦¬ë˜ë„ë¡ throwí•˜ì§€ ì•ŠìŒ
    return { success: false, error: error.message };
  }
}

/**
 * ê²ŒìŠ¤íŠ¸ ì˜ˆì•½ í™•ì¸ ì•Œë¦¼í†¡ ë°œì†¡
 */
export async function sendGuestConfirmation(reservationData) {
  try {
    console.log('ğŸ“¨ ê²ŒìŠ¤íŠ¸ ì˜ˆì•½ í™•ì¸ ì•Œë¦¼í†¡ ë°œì†¡ ì‹œì‘:', reservationData);

    // í•„ìˆ˜ ë°ì´í„° ê²€ì¦
    if (!reservationData.phone) {
      throw new Error('ì „í™”ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
    }

    if (!reservationData.name) {
      throw new Error('ì˜ˆì•½ì ì´ë¦„ì´ ì—†ìŠµë‹ˆë‹¤.');
    }

    if (!reservationData.spaceId) {
      throw new Error('ìŠ¤í˜ì´ìŠ¤ IDê°€ ì—†ìŠµë‹ˆë‹¤.');
    }

    // ê²ŒìŠ¤íŠ¸ ì •ì±… ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ê³„ì¢Œ ì •ë³´ + 1ë°• ìš”ê¸ˆ)
    let guestPolicy;
    try {
      guestPolicy = await spaceSettingsService.getGuestPolicy(reservationData.spaceId);
    } catch (error) {
      console.warn('ê²ŒìŠ¤íŠ¸ ì •ì±… ì¡°íšŒ ì‹¤íŒ¨, ê¸°ë³¸ê°’ ì‚¬ìš©:', error);
      guestPolicy = {
        accountBank: 'ì¹´ì¹´ì˜¤ë±…í¬',
        accountNumber: '7942-24-38529',
        accountHolder: 'ì´ìˆ˜ì§„',
        guestPricePerNight: 30000
      };
    }

    // ë‚ ì§œ í¬ë§·íŒ… (YYYY-MM-DD)
    const checkIn = formatDate(reservationData.checkIn);
    const checkOut = formatDate(reservationData.checkOut);

    // ë°•ìˆ˜ ê³„ì‚°
    const nights = calculateNights(reservationData.checkIn, reservationData.checkOut);
    const days = nights + 1;

    // ê¸ˆì•¡ ê³„ì‚° (ë™ì  1ë°• ìš”ê¸ˆ ì‚¬ìš©)
    const pricePerNight = guestPolicy.guestPricePerNight || 30000;
    const cost = nights * pricePerNight;
    const pricePerNightper10000 = pricePerNight / 10000;

    // ë¼ìš´ì§€ëª… (ì „ë‹¬ë°›ê±°ë‚˜ ê¸°ë³¸ê°’)
    const loungeName = reservationData.spaceName || 'ì¡°ê°•308í˜¸';

    // ê³„ì¢Œ ì •ë³´ (ê²ŒìŠ¤íŠ¸ ì •ì±…ì—ì„œ ê°€ì ¸ì˜´)
    const accountBank = guestPolicy.accountBank;
    const accountNumber = guestPolicy.accountNumber;
    const accountHolder = guestPolicy.accountHolder;

    // í˜„ê´€ë²ˆí˜¸ = íœ´ëŒ€í° ë’·ìë¦¬ 4ìë¦¬
    // ì˜ˆ: 010-1234-5678 â†’ "5678" ì „ë‹¬ â†’ í…œí”Œë¦¿ì—ì„œ "567811*" í‘œì‹œ
    const doorNumber = extractPhoneLast4Digits(reservationData.phone);

    console.log('ğŸ“‹ ì•Œë¦¼í†¡ ë°œì†¡ ë°ì´í„°:', {
      name: reservationData.name,
      phone: reservationData.phone,
      loungeName,
      checkIn,
      checkOut,
      nights,
      days,
      cost,
      pricePerNightper10000,
      accountBank,
      accountNumber,
      accountHolder,
      doorNumber,
    });

    // Netlify Function í˜¸ì¶œ
    const response = await fetch(NETLIFY_FUNCTION_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        type: 'guest_confirmation',
        reservationData: {
          name: reservationData.name,
          phone: reservationData.phone,
          loungeName,
          checkIn,
          checkOut,
          nights,
          days,
          cost,
          pricePerNightper10000,
          accountBank,      // ë³€ê²½
          accountNumber,    // ì¶”ê°€
          accountHolder,    // ì¶”ê°€
          doorNumber,
        },
      }),
    });

    const result = await response.json();

    if (!result.success) {
      throw new Error(result.error || 'ì•Œë¦¼í†¡ ë°œì†¡ ì‹¤íŒ¨');
    }

    console.log('âœ… ê²ŒìŠ¤íŠ¸ ì˜ˆì•½ í™•ì¸ ì•Œë¦¼í†¡ ë°œì†¡ ì™„ë£Œ:', result);
    return result;

  } catch (error) {
    console.error('âŒ ê²ŒìŠ¤íŠ¸ ì˜ˆì•½ í™•ì¸ ì•Œë¦¼í†¡ ë°œì†¡ ì‹¤íŒ¨:', error);
    throw error;
  }
}

/**
 * ì²´í¬ì¸ ë‹¹ì¼ ì¶œì… ì•ˆë‚´ ì•Œë¦¼í†¡ ë°œì†¡
 * (ë¹„ë°€ë²ˆí˜¸ í¬í•¨)
 */
export async function sendCheckinGuide(reservationData, password) {
  try {
    console.log('ğŸ“¨ ì²´í¬ì¸ ì•ˆë‚´ ì•Œë¦¼í†¡ ë°œì†¡ ì‹œì‘:', reservationData);

    // TODO: ì²´í¬ì¸ ì•ˆë‚´ í…œí”Œë¦¿ì´ ì¤€ë¹„ë˜ë©´ êµ¬í˜„
    console.warn('âš ï¸ ì²´í¬ì¸ ì•ˆë‚´ í…œí”Œë¦¿ì´ ì•„ì§ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');

    // ì„ì‹œ: ì½˜ì†”ì—ë§Œ ì¶œë ¥
    console.log('ğŸ”‘ í˜„ê´€ ë¹„ë°€ë²ˆí˜¸:', password);

    return {
      success: true,
      message: 'ì²´í¬ì¸ ì•ˆë‚´ëŠ” ìˆ˜ë™ìœ¼ë¡œ ë°œì†¡í•´ì£¼ì„¸ìš”.',
    };

  } catch (error) {
    console.error('âŒ ì²´í¬ì¸ ì•ˆë‚´ ì•Œë¦¼í†¡ ë°œì†¡ ì‹¤íŒ¨:', error);
    throw error;
  }
}

/**
 * ì˜ˆì•½ ì·¨ì†Œ ì•Œë¦¼í†¡ ë°œì†¡
 */
export async function sendCancellationNotice(reservationData) {
  try {
    console.log('ğŸ“¨ ì˜ˆì•½ ì·¨ì†Œ ì•Œë¦¼í†¡ ë°œì†¡ ì‹œì‘:', reservationData);

    // TODO: ì˜ˆì•½ ì·¨ì†Œ í…œí”Œë¦¿ì´ ì¤€ë¹„ë˜ë©´ êµ¬í˜„
    console.warn('âš ï¸ ì˜ˆì•½ ì·¨ì†Œ í…œí”Œë¦¿ì´ ì•„ì§ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');

    return {
      success: true,
      message: 'ì˜ˆì•½ ì·¨ì†Œ ì•Œë¦¼ì€ ìˆ˜ë™ìœ¼ë¡œ ë°œì†¡í•´ì£¼ì„¸ìš”.',
    };

  } catch (error) {
    console.error('âŒ ì˜ˆì•½ ì·¨ì†Œ ì•Œë¦¼í†¡ ë°œì†¡ ì‹¤íŒ¨:', error);
    throw error;
  }
}

/**
 * ì •ì‚° ì™„ë£Œ ì•Œë¦¼í†¡ ë°œì†¡
 * ê° ì°¸ì—¬ìì—ê²Œ ê°œë³„ì ìœ¼ë¡œ ì •ì‚° ê²°ê³¼ ì „ì†¡
 * - balance > 0: ë°›ì„ ëˆ ìˆìŒ (JH8637)
 * - balance < 0: ë‚¼ ëˆ ìˆìŒ (JH8638)
 * - balance === 0: ì•Œë¦¼ ë°œì†¡ ì•ˆ í•¨
 */
export async function sendSettlementComplete(settlementData, options = {}) {
  try {
    console.log('ğŸ’° ì •ì‚° ì™„ë£Œ ì•Œë¦¼í†¡ ë°œì†¡ ì‹œì‘:', {
      spaceId: settlementData.spaceId,
      weekId: settlementData.weekId,
      participantCount: Object.keys(settlementData.participants || {}).length
    });

    // ì•Œë¦¼í†¡ì´ ë¹„í™œì„±í™”ëœ ê²½ìš° ê±´ë„ˆë›°ê¸°
    if (!options.alimtalkEnabled) {
      console.log('âš ï¸ ì•Œë¦¼í†¡ ë¹„í™œì„±í™” ìƒíƒœ - ì •ì‚° ì•Œë¦¼ ë°œì†¡ ê±´ë„ˆëœ€');
      return { success: true, skipped: true, reason: 'alimtalk_disabled' };
    }

    // ìŠ¤í˜ì´ìŠ¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ë¼ìš´ì§€ëª…)
    const spaceData = options.spaceData || {};
    const loungeName = spaceData.name || settlementData.spaceName || 'ë¼ìš´ì§€';

    // ë§¤ë‹ˆì € ì „í™”ë²ˆí˜¸ (í•„ìˆ˜)
    const managerPhone = settlementData.managerPhone;
    if (!managerPhone) {
      console.warn('âš ï¸ ë§¤ë‹ˆì € ì „í™”ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤. ì •ì‚° ì•Œë¦¼ì„ ë°œì†¡í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      return { success: false, error: 'manager_phone_missing' };
    }

    // ì •ì‚° ê³„ì¢Œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    let settlementAccount;
    try {
      settlementAccount = await spaceSettingsService.getSettlementAccount(settlementData.spaceId);

      // ì •ì‚° ê³„ì¢Œê°€ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš° ê²ŒìŠ¤íŠ¸ ì •ì±… ê³„ì¢Œ ì‚¬ìš©
      if (!settlementAccount.accountBank_settle || !settlementAccount.accountNumber_settle || !settlementAccount.accountHolder_settle) {
        console.warn('âš ï¸ ì •ì‚° ê³„ì¢Œ ë¯¸ì„¤ì •, ê²ŒìŠ¤íŠ¸ ê³„ì¢Œ ì‚¬ìš©');
        const guestPolicy = await spaceSettingsService.getGuestPolicy(settlementData.spaceId);
        settlementAccount = {
          accountBank_settle: guestPolicy.accountBank,
          accountNumber_settle: guestPolicy.accountNumber,
          accountHolder_settle: guestPolicy.accountHolder,
        };
      }
    } catch (error) {
      console.warn('ì •ì‚° ê³„ì¢Œ ì¡°íšŒ ì‹¤íŒ¨, ê¸°ë³¸ê°’ ì‚¬ìš©:', error);
      settlementAccount = {
        accountBank_settle: 'ì¹´ì¹´ì˜¤ë±…í¬',
        accountNumber_settle: '7942-24-38529',
        accountHolder_settle: 'ì´ìˆ˜ì§„',
      };
    }

    const results = [];
    const errors = [];
    let skippedCount = 0;

    // ì°¸ì—¬ì ëª©ë¡ ìƒì„¸ ë¡œê·¸
    console.log('ğŸ“‹ ì°¸ì—¬ì ëª©ë¡ ìƒì„¸:', Object.entries(settlementData.participants).map(([userId, p]) => ({
      userId,
      name: p.name,
      phone: p.phone || 'âŒ ì—†ìŒ',
      balance: p.balance
    })));

    // ê° ì°¸ì—¬ìì—ê²Œ ê°œë³„ ë°œì†¡
    for (const [userId, participant] of Object.entries(settlementData.participants)) {
      const balance = participant.balance || 0;

      console.log(`ğŸ‘¤ ì°¸ì—¬ì ì²˜ë¦¬ ì¤‘:`, {
        userId,
        name: participant.name,
        phone: participant.phone || 'âŒ ì—†ìŒ',
        balance,
        hasPhone: !!participant.phone
      });

      // balanceê°€ 0ì´ë©´ ìŠ¤í‚µ
      if (balance === 0) {
        console.log(`â„¹ï¸ [${participant.name}] ì •ì‚° ì™„ë£Œ (balance: 0) - ë°œì†¡ ê±´ë„ˆëœ€`);
        skippedCount++;
        continue;
      }

      // ì „í™”ë²ˆí˜¸ê°€ ì—†ìœ¼ë©´ ìŠ¤í‚µ
      if (!participant.phone) {
        console.log(`âš ï¸ [${participant.name}] ì „í™”ë²ˆí˜¸ ì—†ìŒ - ë°œì†¡ ê±´ë„ˆëœ€`, {
          participantObject: participant
        });
        skippedCount++;
        continue;
      }

      try {
        // balanceì— ë”°ë¼ type ê²°ì •
        let notificationType;
        if (balance > 0) {
          notificationType = 'settlement_receive'; // JH8637
          console.log(`ğŸ“± [${participant.name}] ë°›ì„ ëˆ ì•Œë¦¼ ë°œì†¡ (${balance.toLocaleString()}ì›)`);
        } else {
          notificationType = 'settlement_pay'; // JH8638
          console.log(`ğŸ“± [${participant.name}] ë‚¼ ëˆ ì•Œë¦¼ ë°œì†¡ (${Math.abs(balance).toLocaleString()}ì›)`);
        }

        // Netlify Function í˜¸ì¶œ
        const response = await fetch(NETLIFY_FUNCTION_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            type: notificationType,
            settlementData: {
              name: participant.name,
              phone: participant.phone,
              loungeName,
              weekId: settlementData.weekId,
              totalPaid: participant.totalPaid || 0,
              totalOwed: participant.totalOwed || 0,
              balance: Math.abs(balance),
              managerPhone,
              accountBank: settlementAccount.accountBank_settle,
              accountNumber: settlementAccount.accountNumber_settle,
              accountHolder: settlementAccount.accountHolder_settle,
            },
          }),
        });

        const result = await response.json();

        if (result.success) {
          console.log(`âœ… [${participant.name}] ì •ì‚° ì•Œë¦¼ ë°œì†¡ ì„±ê³µ`);
          results.push({
            userId,
            name: participant.name,
            phone: participant.phone,
            balance: participant.balance,
            type: notificationType,
            status: 'sent'
          });
        } else {
          throw new Error(result.error || 'ì•Œë¦¼í†¡ ë°œì†¡ ì‹¤íŒ¨');
        }

      } catch (error) {
        console.error(`âŒ [${participant.name}] ì •ì‚° ì•Œë¦¼ ë°œì†¡ ì‹¤íŒ¨:`, error);
        errors.push({
          userId,
          name: participant.name,
          error: error.message
        });
      }
    }

    return {
      success: true,
      message: `${results.length}ëª…ì—ê²Œ ì •ì‚° ì•Œë¦¼ì„ ë°œì†¡í–ˆìŠµë‹ˆë‹¤.`,
      sentCount: results.length,
      errorCount: errors.length,
      skippedCount,
      results,
      errors
    };

  } catch (error) {
    console.error('âŒ ì •ì‚° ì™„ë£Œ ì•Œë¦¼í†¡ ë°œì†¡ ì‹¤íŒ¨:', error);
    // ì•Œë¦¼ ì‹¤íŒ¨í•´ë„ ì •ì‚° ì™„ë£ŒëŠ” ì„±ê³µìœ¼ë¡œ ì²˜ë¦¬
    return { success: false, error: error.message };
  }
}

/**
 * ë‚ ì§œ í¬ë§·íŒ… (YYYY-MM-DD)
 */
function formatDate(date) {
  if (date instanceof Date) {
    return date.toISOString().split('T')[0];
  }
  
  if (typeof date === 'string') {
    return date.split('T')[0];
  }

  if (date?.toDate) {
    // Firestore Timestamp
    return date.toDate().toISOString().split('T')[0];
  }

  throw new Error('ì˜¬ë°”ë¥´ì§€ ì•Šì€ ë‚ ì§œ í˜•ì‹ì…ë‹ˆë‹¤.');
}

/**
 * ë°•ìˆ˜ ê³„ì‚°
 */
function calculateNights(checkIn, checkOut) {
  const checkInDate = checkIn instanceof Date ? checkIn : new Date(checkIn);
  const checkOutDate = checkOut instanceof Date ? checkOut : new Date(checkOut);

  const diffTime = Math.abs(checkOutDate - checkInDate);
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

  return diffDays;
}

/**
 * ì „í™”ë²ˆí˜¸ ì •ê·œí™” (ë‹¤ì–‘í•œ í˜•ì‹ â†’ 010-XXXX-XXXX)
 *
 * ì…ë ¥ í˜•ì‹:
 * - +82 10-3114-8626
 * - 01031148626
 * - 010-3114-8626
 *
 * ì¶œë ¥: 010-3114-8626
 */
export function normalizePhoneNumber(phone) {
  if (!phone) return null;

  // ëª¨ë“  ê³µë°±, í•˜ì´í”ˆ, + ì œê±°
  let cleaned = phone.replace(/[\s\-+]/g, '');

  // +82ë¡œ ì‹œì‘í•˜ë©´ 82ë¥¼ 0ìœ¼ë¡œ ë³€í™˜
  if (cleaned.startsWith('82')) {
    cleaned = '0' + cleaned.slice(2);
  }

  // 010ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” 11ìë¦¬ ìˆ«ìì¸ì§€ í™•ì¸
  if (cleaned.length === 11 && cleaned.startsWith('010')) {
    return `${cleaned.slice(0, 3)}-${cleaned.slice(3, 7)}-${cleaned.slice(7)}`;
  }

  // í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•Šìœ¼ë©´ null ë°˜í™˜
  console.warn('âš ï¸ ì˜¬ë°”ë¥´ì§€ ì•Šì€ ì „í™”ë²ˆí˜¸ í˜•ì‹:', phone);
  return null;
}

/**
 * ì „í™”ë²ˆí˜¸ í¬ë§·íŒ… (í•˜ì´í”ˆ ì¶”ê°€)
 * @deprecated normalizePhoneNumber ì‚¬ìš© ê¶Œì¥
 */
export function formatPhoneNumber(phone) {
  return normalizePhoneNumber(phone);
}

/**
 * ì „í™”ë²ˆí˜¸ ë’·ìë¦¬ 4ìë¦¬ ì¶”ì¶œ
 * í˜„ê´€ë²ˆí˜¸ìš©: 010-1234-5678 â†’ "5678"
 */
function extractPhoneLast4Digits(phone) {
  // í•˜ì´í”ˆ ì œê±°
  const cleaned = phone.replace(/-/g, '');
  
  // ë’·ìë¦¬ 4ìë¦¬ ë°˜í™˜
  return cleaned.slice(-4);
}
</file>

<file path="src/services/reservationService.js">
import { collection, getDocs, addDoc, deleteDoc, doc, setDoc, getDoc, query, where, Timestamp, orderBy } from 'firebase/firestore';
import { db } from '../config/firebase';
import { formatDate } from '../utils/dateUtils';
import * as notificationService from './notificationService';  // âœ… named importë¡œ ë³€ê²½

class ReservationService {
  async getReservations(spaceId, currentWeekStart) {
    try {
      console.log('ğŸ” ì˜ˆì•½ ì¡°íšŒ ì‹œì‘, spaceId:', spaceId);
      
      const reservesRef = collection(db, `spaces/${spaceId}/reserves`);
      
      // í˜„ì¬ ì£¼ ì‹œì‘ì¼ ê¸°ì¤€ìœ¼ë¡œ ì•ë’¤ 1ì£¼ì”© (ì´ 3ì£¼ ë²”ìœ„)
      const startDate = new Date(currentWeekStart);
      startDate.setDate(startDate.getDate() - 7); // 1ì£¼ ì „
      startDate.setHours(0, 0, 0, 0);
      
      const endDate = new Date(currentWeekStart);
      endDate.setDate(endDate.getDate() + 20); // í˜„ì¬ì£¼ 7ì¼ + ë’¤ 2ì£¼ (13ì¼)
      endDate.setHours(23, 59, 59, 999);
      
      console.log('ğŸ“… ì¿¼ë¦¬ ë²”ìœ„:', {
        start: startDate.toLocaleDateString('ko-KR'),
        end: endDate.toLocaleDateString('ko-KR'),
        currentWeek: currentWeekStart.toLocaleDateString('ko-KR')
      });
      
      // checkIn <= endDate AND checkOut >= startDate ë²”ìœ„ì˜ ì˜ˆì•½ë§Œ ì¡°íšŒ
      const q = query(
        reservesRef,
        where('checkIn', '<=', Timestamp.fromDate(endDate)),
        where('checkOut', '>=', Timestamp.fromDate(startDate)),
        orderBy('checkIn', 'asc')
      );
      
      const snapshot = await getDocs(q);
      
      console.log('ğŸ“‹ reserves ë¬¸ì„œ ìˆ˜:', snapshot.size);
      
      const reserveData = {};
      const userIds = new Set();
      
      snapshot.forEach((docSnap) => {
        const data = docSnap.data();
        
        // checkIn, checkOutì´ ì¡´ì¬í•˜ê³  Timestampì¸ì§€ í™•ì¸
        if (!data.checkIn || !data.checkOut) {
          console.warn('âš ï¸ checkIn/checkOut ì—†ìŒ:', docSnap.id);
          return;
        }
        
        if (typeof data.checkIn.toDate !== 'function' || typeof data.checkOut.toDate !== 'function') {
          console.warn('âš ï¸ Timestamp ì•„ë‹˜:', docSnap.id);
          return;
        }
        
        userIds.add(data.userId);

        const checkIn = data.checkIn.toDate();
        const checkOut = data.checkOut.toDate();

        // ë‹¹ì¼ì¹˜ê¸° ì²˜ë¦¬ (nights === 0 ë˜ëŠ” isDayTrip === true)
        if (data.nights === 0 || data.isDayTrip) {
          const dateStr = formatDate(checkIn);

          if (!reserveData[dateStr]) {
            reserveData[dateStr] = [];
          }

          reserveData[dateStr].push({
            id: docSnap.id,
            ...data,
            checkIn,
            checkOut,
            isCheckIn: true,
            isDayTrip: true
          });

          return;
        }

        // ì²´í¬ì¸ë¶€í„° ì²´í¬ì•„ì›ƒ ì „ë‚ ê¹Œì§€ (ê¸°ì¡´ ìˆ™ë°• ë¡œì§)
        let current = new Date(checkIn);
        const lastDay = new Date(checkOut);
        lastDay.setDate(lastDay.getDate() - 1);

        while (current <= lastDay) {
          const dateStr = formatDate(current);

          if (!reserveData[dateStr]) {
            reserveData[dateStr] = [];
          }

          reserveData[dateStr].push({
            id: docSnap.id,
            ...data,
            checkIn,
            checkOut,
            isCheckIn: current.getTime() === checkIn.getTime()
          });

          current.setDate(current.getDate() + 1);
        }
      });
      
      console.log('âœ… ë‚ ì§œë³„ ì˜ˆì•½ ìƒì„± ì™„ë£Œ:', Object.keys(reserveData).length, 'ê°œ ë‚ ì§œ');
      
      return { reservations: reserveData, userIds: Array.from(userIds) };
    } catch (error) {
      console.error('âŒ getReservations ì—ëŸ¬:', error);
      return { reservations: {}, userIds: [] };
    }
  }
  
  async createReservation(spaceId, reservationData) {
    try {
      console.log('ğŸ“ createReservation ì‹œì‘');
      console.log('spaceId:', spaceId);
      console.log('reservationData:', reservationData);
      
      const reservesRef = collection(db, `spaces/${spaceId}/reserves`);
      
      // ì²´í¬ì¸ ë‚ ì§œ ê¸°ì¤€ ë¬¸ì„œ ID ìƒì„± (ê´€ë¦¬ì í¸ì˜ì„±)
      const checkInDate = reservationData.checkIn;
      const now = new Date();
      
      // YYYYMMDD_HHMMSS_ëœë¤4ìë¦¬
      const docId = `${checkInDate.getFullYear()}${String(checkInDate.getMonth() + 1).padStart(2, '0')}${String(checkInDate.getDate()).padStart(2, '0')}_${String(now.getHours()).padStart(2, '0')}${String(now.getMinutes()).padStart(2, '0')}${String(now.getSeconds()).padStart(2, '0')}_${String(Math.floor(Math.random() * 10000)).padStart(4, '0')}`;
      
      console.log('ìƒì„±ëœ ë¬¸ì„œ ID (ì²´í¬ì¸ì¼ ê¸°ì¤€):', docId);
      
      const dataToSave = {
        userId: String(reservationData.userId),  // ë¬¸ìì—´ë¡œ ë³€í™˜
        name: reservationData.name,
        type: reservationData.type,
        checkIn: Timestamp.fromDate(reservationData.checkIn),
        checkOut: Timestamp.fromDate(reservationData.checkOut),
        nights: reservationData.nights ?? 1,  // 0 í—ˆìš© (ë‹¹ì¼ì¹˜ê¸°)
        isDayTrip: reservationData.nights === 0,  // ë‹¹ì¼ì¹˜ê¸° í”Œë˜ê·¸
        memo: reservationData.memo || '',
        phone: reservationData.phone || '',
        hostDisplayName: reservationData.hostDisplayName || '',  // ì´ˆëŒ€ì ì´ë¦„
        hostId: reservationData.hostId || '',  // ì´ˆëŒ€ì ID
        status: 'active',
        createdAt: Timestamp.now()
      };
      
      console.log('ğŸ’¾ Firebaseì— ì €ì¥í•  ë°ì´í„°:', dataToSave);
      
      await setDoc(doc(reservesRef, docId), dataToSave);
      
      console.log('âœ… Firebase ì €ì¥ ì™„ë£Œ!');
      
      // ğŸ”¥ ì•Œë¦¼ ë°œì†¡ ì¶”ê°€ (ì´ë©”ì¼ + ì•Œë¦¼í†¡)
      try {
        console.log('ğŸ“§ ì•Œë¦¼ ë°œì†¡ ì‹œì‘...');

        // Firebaseì—ì„œ ì•Œë¦¼í†¡ ì„¤ì • ê°€ì ¸ì˜¤ê¸°
        const alimtalkDocRef = doc(db, 'spaces', spaceId, 'settings', 'alimtalk');
        const alimtalkDoc = await getDoc(alimtalkDocRef);
        const alimtalkData = alimtalkDoc.exists() ? alimtalkDoc.data() : {};
        const alimtalkEnabled = alimtalkData.enabled === true; // enabled í•„ë“œ í™•ì¸

        // ìŠ¤í˜ì´ìŠ¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ì´ë¦„, ê³„ì¢Œë²ˆí˜¸)
        const spaceDocRef = doc(db, 'spaces', spaceId);
        const spaceDoc = await getDoc(spaceDocRef);
        const spaceData = spaceDoc.exists() ? spaceDoc.data() : {};

        // ì´ë©”ì¼ ì•Œë¦¼ ì„¤ì • ê°€ì ¸ì˜¤ê¸°
        const emailSettingsRef = doc(db, 'spaces', spaceId, 'settings', 'email');
        const emailSettingsDoc = await getDoc(emailSettingsRef);
        const emailSettings = emailSettingsDoc.exists() ? emailSettingsDoc.data() : null;

        console.log('ì•Œë¦¼í†¡ í™œì„±í™” ì—¬ë¶€:', alimtalkEnabled);
        console.log('ì•Œë¦¼í†¡ ì„¤ì • ë°ì´í„°:', alimtalkData);
        console.log('ìŠ¤í˜ì´ìŠ¤ ë°ì´í„°:', spaceData);
        console.log('ì´ë©”ì¼ ì•Œë¦¼ ì„¤ì •:', emailSettings);

        const notificationData = {
          ...reservationData,
          spaceId: spaceId,  // â† notificationServiceì—ì„œ ê²ŒìŠ¤íŠ¸ ì •ì±… ì¡°íšŒì— í•„ìš”
          spaceName: spaceData.name || 'ì¡°ê°•308í˜¸',
          hostDisplayName: reservationData.hostDisplayName || ''
        };

        // ì•Œë¦¼í†¡ ë°œì†¡
        const result = await notificationService.sendReservationConfirm(
          notificationData,
          { alimtalkEnabled }
        );

        console.log('ğŸ“¬ ì•Œë¦¼í†¡ ë°œì†¡ ê²°ê³¼:', result);

        // ì´ë©”ì¼ ë°œì†¡
        if (emailSettings?.reservation?.enabled) {
          const reservationType = reservationData.type; // 'guest', 'shareholder', 'manager', 'vice-manager'
          const shouldSendEmail = emailSettings.reservation.types.includes(reservationType);

          if (shouldSendEmail && emailSettings.reservation.recipients.length > 0) {
            console.log(`ğŸ“§ ì´ë©”ì¼ ë°œì†¡ ì‹œì‘ (${reservationType} ì˜ˆì•½)`);

            try {
              const emailResponse = await fetch('/.netlify/functions/send-email', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  type: 'guest_reservation',
                  reservationType: reservationType, // ì‹¤ì œ ì˜ˆì•½ íƒ€ì… ì „ë‹¬ (guest, shareholder, manager, vice-manager)
                  name: reservationData.name,
                  phone: reservationData.phone,
                  checkIn: reservationData.checkIn,
                  checkOut: reservationData.checkOut,
                  gender: reservationData.gender,
                  birthYear: reservationData.birthYear,
                  hostDisplayName: reservationData.hostDisplayName,
                  memo: reservationData.memo,
                  spaceName: spaceData.name || 'ì¡°ê°•308í˜¸',
                  accountInfo: spaceData.accountBank && spaceData.accountNumber
                    ? `${spaceData.accountBank} ${spaceData.accountNumber} ${spaceData.accountHolder}`
                    : undefined,
                  recipients: {
                    to: emailSettings.reservation.recipients[0],
                    cc: emailSettings.reservation.recipients.slice(1)
                  }
                })
              });

              const emailResult = await emailResponse.json();
              console.log('âœ… ì´ë©”ì¼ ë°œì†¡ ê²°ê³¼:', emailResult);
            } catch (emailError) {
              console.error('âš ï¸ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨ (ì˜ˆì•½ì€ ì™„ë£Œë¨):', emailError);
            }
          } else {
            console.log(`â„¹ï¸ ì´ë©”ì¼ ë°œì†¡ ê±´ë„ˆëœ€: ${reservationType} íƒ€ì…ì´ ì„¤ì •ì— í¬í•¨ë˜ì§€ ì•ŠìŒ ë˜ëŠ” ìˆ˜ì‹ ì ì—†ìŒ`);
          }
        } else {
          console.log('â„¹ï¸ ì´ë©”ì¼ ì•Œë¦¼ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŒ');
        }
      } catch (notifyError) {
        // ì•Œë¦¼ ì‹¤íŒ¨í•´ë„ ì˜ˆì•½ì€ ì„±ê³µìœ¼ë¡œ ì²˜ë¦¬
        console.error('âš ï¸ ì•Œë¦¼ ë°œì†¡ ì‹¤íŒ¨ (ì˜ˆì•½ì€ ì™„ë£Œë¨):', notifyError);
      }
      
      return { docId, ...dataToSave };
    } catch (error) {
      console.error('âŒ createReservation ì—ëŸ¬:', error);
      throw error;
    }
  }
  
  async cancelReservation(spaceId, reservationId) {
  if (!spaceId || !reservationId) {
    throw new Error('spaceId ë˜ëŠ” reservationIdê°€ ì—†ìŠµë‹ˆë‹¤.');
  }

  const reserveRef = doc(db, 'spaces', spaceId, 'reserves', reservationId);
  await deleteDoc(reserveRef);
  }

  /**
   * ì˜ˆì•½ ìˆ˜ì • (ì²´í¬ì¸/ì²´í¬ì•„ì›ƒ ë‚ ì§œ ë³€ê²½)
   */
  async updateReservation(spaceId, reservationId, updateData) {
    if (!spaceId || !reservationId) {
      throw new Error('spaceId ë˜ëŠ” reservationIdê°€ ì—†ìŠµë‹ˆë‹¤.');
    }

    const reserveRef = doc(db, 'spaces', spaceId, 'reserves', reservationId);

    try {
      // ê¸°ì¡´ ì˜ˆì•½ ì •ë³´ ì¡°íšŒ
      const reserveDoc = await getDoc(reserveRef);
      if (!reserveDoc.exists()) {
        throw new Error('ì˜ˆì•½ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }

      const existingData = reserveDoc.data();

      // ì—…ë°ì´íŠ¸í•  ë°ì´í„° ì¤€ë¹„
      const dataToUpdate = {
        checkIn: Timestamp.fromDate(updateData.checkIn),
        checkOut: Timestamp.fromDate(updateData.checkOut),
        nights: updateData.nights ?? 0,
        isDayTrip: updateData.isDayTrip ?? false,
        updatedAt: Timestamp.now()
      };

      // ì˜ˆì•½ ë¬¸ì„œ ì—…ë°ì´íŠ¸
      await setDoc(reserveRef, dataToUpdate, { merge: true });

      console.log('âœ… ì˜ˆì•½ ìˆ˜ì • ì„±ê³µ:', reservationId);
      return { success: true };
    } catch (error) {
      console.error('âŒ ì˜ˆì•½ ìˆ˜ì • ì‹¤íŒ¨:', error);
      throw error;
    }
  }

  // í†µê³„ìš©: ì „ì²´ ì˜ˆì•½ ë°ì´í„° ì¡°íšŒ (ê¸°ê°„ í•„í„°ë§ ê°€ëŠ¥)
  async getAllReservations(spaceId, startDate = null, endDate = null) {
    try {
      console.log('ğŸ“Š í†µê³„ìš© ì˜ˆì•½ ì¡°íšŒ ì‹œì‘, spaceId:', spaceId);

      const reservesRef = collection(db, `spaces/${spaceId}/reserves`);

      let q;

      if (startDate && endDate) {
        // ê¸°ê°„ í•„í„°ë§
        const start = Timestamp.fromDate(startDate);
        const end = Timestamp.fromDate(endDate);

        q = query(
          reservesRef,
          where('checkIn', '<=', end),
          where('checkOut', '>=', start),
          orderBy('checkIn', 'desc')
        );
      } else {
        // ì „ì²´ ì¡°íšŒ
        q = query(reservesRef, orderBy('checkIn', 'desc'));
      }

      const snapshot = await getDocs(q);

      console.log('ğŸ“‹ ì¡°íšŒëœ ì˜ˆì•½ ìˆ˜:', snapshot.size);

      const reservations = [];

      snapshot.forEach((docSnap) => {
        const data = docSnap.data();

        if (!data.checkIn || !data.checkOut) {
          return;
        }

        reservations.push({
          id: docSnap.id,
          ...data,
          checkIn: data.checkIn.toDate(),
          checkOut: data.checkOut.toDate()
        });
      });

      return reservations;
    } catch (error) {
      console.error('âŒ getAllReservations ì—ëŸ¬:', error);
      return [];
    }
  }
}

export default new ReservationService();
</file>

<file path="src/services/settlementService.js">
// src/services/settlementService.js
import {
  collection,
  doc,
  getDocs,
  getDoc,
  setDoc,
  updateDoc,
  deleteDoc,
  query,
  where,
  orderBy,
  Timestamp
} from 'firebase/firestore';
import { db } from '../config/firebase';
import * as notificationService from './notificationService';
import { normalizePhoneNumber } from './notificationService';

/**
 * ì£¼ì°¨ ID ìƒì„± (ISO 8601 Week)
 * í˜•ì‹: YYYY-Wxx
 * ì˜ˆ: 2025-W51
 *
 * ISO 8601 í‘œì¤€:
 * - í•œ ì£¼ëŠ” ì›”ìš”ì¼ë¶€í„° ì¼ìš”ì¼ê¹Œì§€
 * - ì—°ë„ì˜ ì²« ë²ˆì§¸ ì£¼(W01)ëŠ” ê·¸ í•´ì˜ ì²« ë²ˆì§¸ ëª©ìš”ì¼ì„ í¬í•¨í•˜ëŠ” ì£¼
 * - ì—°ë§-ìƒˆí•´ ì „í™˜ ì‹œ ê°™ì€ ì£¼ëŠ” ê°™ì€ ì£¼ì°¨ ë²ˆí˜¸ë¥¼ ê°€ì§
 *   ì˜ˆ: 2025-12-29(ì›”) ~ 2026-01-04(ì¼) = 2026-W01
 */
const getWeekId = (date = new Date()) => {
  const target = new Date(date.valueOf());

  // ê·¸ ì£¼ì˜ ëª©ìš”ì¼ë¡œ ì´ë™ (ISO 8601 ê¸°ì¤€: ëª©ìš”ì¼ì´ ì†í•œ ì—°ë„ê°€ ì£¼ì°¨ì˜ ì—°ë„)
  const dayOfWeek = (target.getDay() + 6) % 7; // ì›”ìš”ì¼=0, ì¼ìš”ì¼=6
  target.setDate(target.getDate() - dayOfWeek + 3);

  // í•´ë‹¹ ì—°ë„ì˜ ì²« ë²ˆì§¸ ëª©ìš”ì¼ ê³„ì‚°
  const year = target.getFullYear();
  const firstThursday = new Date(year, 0, 4); // 1ì›” 4ì¼ì€ í•­ìƒ ì²« ì£¼ì— ì†í•¨
  const firstThursdayDay = (firstThursday.getDay() + 6) % 7;
  firstThursday.setDate(firstThursday.getDate() - firstThursdayDay + 3);

  // ì²« ë²ˆì§¸ ëª©ìš”ì¼ë¶€í„° ê²½ê³¼í•œ ì£¼ ìˆ˜ ê³„ì‚°
  const weekNumber = 1 + Math.floor((target - firstThursday) / 604800000); // 7ì¼ = 604800000ms

  return `${year}-W${String(weekNumber).padStart(2, '0')}`;
};

/**
 * ì£¼ì˜ ì‹œì‘ì¼/ì¢…ë£Œì¼ ê³„ì‚° (ì›”ìš”ì¼~ì¼ìš”ì¼)
 */
const getWeekRange = (date = new Date()) => {
  const day = date.getDay();
  const diff = date.getDate() - day + (day === 0 ? -6 : 1); // ì›”ìš”ì¼ë¡œ ì¡°ì •
  
  const weekStart = new Date(date.setDate(diff));
  weekStart.setHours(0, 0, 0, 0);
  
  const weekEnd = new Date(weekStart);
  weekEnd.setDate(weekStart.getDate() + 6);
  weekEnd.setHours(23, 59, 59, 999);
  
  return { weekStart, weekEnd };
};

/**
 * Receipt ID ìƒì„± (íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜)
 * í˜•ì‹: YYYY-MM-DDTHHMM
 */
const generateReceiptId = (date = new Date()) => {
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  const hours = String(date.getHours()).padStart(2, '0');
  const minutes = String(date.getMinutes()).padStart(2, '0');
  const seconds = String(date.getSeconds()).padStart(2, '0');
  
  return `${year}-${month}-${day}T${hours}${minutes}${seconds}`;
};

const settlementService = {
  /**
   * ì´ë²ˆì£¼ Settlement ê°€ì ¸ì˜¤ê¸° (ì—†ìœ¼ë©´ ìƒì„±)
   * ìƒˆ ì£¼ì°¨ ìƒì„± ì‹œ ì´ì „ ì£¼ì°¨ê°€ active ìƒíƒœì´ë©´ ê²½ê³  ë°˜í™˜
   */
  async getCurrentWeekSettlement(spaceId) {
    try {
      const weekId = getWeekId();
      const { weekStart, weekEnd } = getWeekRange();

      console.log('ğŸ“… ì´ë²ˆì£¼ Settlement ì¡°íšŒ:', { spaceId, weekId });

      const settlementRef = doc(db, 'spaces', spaceId, 'settlement', weekId);
      const settlementSnap = await getDoc(settlementRef);

      // ì´ë¯¸ ì¡´ì¬í•˜ë©´ ë°˜í™˜
      if (settlementSnap.exists()) {
        const data = settlementSnap.data();
        console.log('âœ… ê¸°ì¡´ Settlement ë°œê²¬');
        return {
          id: settlementSnap.id,
          weekId,
          ...data,
          weekStart: data.weekStart?.toDate(),
          weekEnd: data.weekEnd?.toDate(),
          createdAt: data.createdAt?.toDate(),
          settledAt: data.settledAt?.toDate(),
        };
      }

      // ìƒˆë¡œ ìƒì„±í•˜ê¸° ì „ì— ì´ì „ ì£¼ì°¨ í™•ì¸
      const prevWeekWarning = await this.checkPreviousWeekStatus(spaceId, weekStart);

      // ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±
      console.log('ğŸ†• ìƒˆ Settlement ìƒì„±');
      const newSettlement = {
        weekId,
        weekStart: Timestamp.fromDate(weekStart),
        weekEnd: Timestamp.fromDate(weekEnd),
        status: 'active', // active, settled
        createdAt: Timestamp.now(),
        settledAt: null,
        participants: {}, // { userId: { name, totalPaid, totalOwed, balance } }
        totalAmount: 0,
      };

      await setDoc(settlementRef, newSettlement);

      return {
        id: weekId,
        weekId,
        ...newSettlement,
        weekStart,
        weekEnd,
        createdAt: new Date(),
        settledAt: null,
        prevWeekWarning, // ì´ì „ ì£¼ì°¨ ê²½ê³  ë©”ì‹œì§€
      };
    } catch (error) {
      console.error('âŒ getCurrentWeekSettlement ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ì´ì „ ì£¼ì°¨ ìƒíƒœ í™•ì¸
   * ìƒˆ ì£¼ì°¨ ìƒì„± ì‹œ ì´ì „ ì£¼ì°¨ê°€ active ìƒíƒœì´ë©´ ê²½ê³  ë°˜í™˜
   */
  async checkPreviousWeekStatus(spaceId, currentWeekStart) {
    try {
      // ì´ì „ ì£¼ ì›”ìš”ì¼ ê³„ì‚°
      const prevWeekStart = new Date(currentWeekStart);
      prevWeekStart.setDate(prevWeekStart.getDate() - 7);

      const prevWeekId = getWeekId(prevWeekStart);
      console.log('ğŸ” ì´ì „ ì£¼ì°¨ í™•ì¸:', prevWeekId);

      const prevSettlement = await this.getWeekSettlement(spaceId, prevWeekId);

      if (prevSettlement && prevSettlement.status === 'active') {
        const warning = {
          hasPreviousActiveWeek: true,
          prevWeekId,
          prevWeekStart: prevSettlement.weekStart,
          prevWeekEnd: prevSettlement.weekEnd,
          message: `ì´ì „ ì£¼ì°¨(${prevWeekId})ê°€ ì•„ì§ ì •ì‚° ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`,
        };
        console.warn('âš ï¸ ì´ì „ ì£¼ì°¨ê°€ active ìƒíƒœ:', warning);
        return warning;
      }

      return null;
    } catch (error) {
      console.error('âŒ checkPreviousWeekStatus ì‹¤íŒ¨:', error);
      return null;
    }
  },

  /**
   * ê·€ì† ì£¼ì°¨ê°€ ì•”ë¬µì ìœ¼ë¡œ ë§ˆê°ë˜ì—ˆëŠ”ì§€ í™•ì¸
   * ê·€ì† ì£¼ì°¨ë³´ë‹¤ ë¯¸ë˜ ì£¼ì°¨ ì¤‘ í•˜ë‚˜ë¼ë„ settledê°€ ìˆìœ¼ë©´ true ë°˜í™˜
   */
  async isImplicitlyClosed(spaceId, belongsToWeekId) {
    try {
      console.log('ğŸ” ì•”ë¬µì  ë§ˆê° ì—¬ë¶€ í™•ì¸:', belongsToWeekId);

      // belongsToWeekIdì˜ ë‚ ì§œ ê³„ì‚°
      const [year, week] = belongsToWeekId.split('-W').map(Number);
      const belongsDate = new Date(year, 0, 1 + (week - 1) * 7);

      // í˜„ì¬ ë‚ ì§œ
      const now = new Date();
      const currentWeekId = getWeekId(now);

      // belongsToWeekIdë¶€í„° í˜„ì¬ê¹Œì§€ ëª¨ë“  ì£¼ì°¨ í™•ì¸
      const checkDate = new Date(belongsDate);
      checkDate.setDate(checkDate.getDate() + 7); // ë‹¤ìŒ ì£¼ë¶€í„° ì‹œì‘

      while (checkDate <= now) {
        const checkWeekId = getWeekId(checkDate);

        // í˜„ì¬ ì£¼ì°¨ë³´ë‹¤ ë¯¸ë˜ë©´ ì¤‘ë‹¨
        if (checkWeekId > currentWeekId) break;

        const settlement = await this.getWeekSettlement(spaceId, checkWeekId);

        if (settlement && settlement.status === 'settled') {
          console.log(`âš ï¸ ë¯¸ë˜ ì£¼ì°¨(${checkWeekId})ê°€ settled ìƒíƒœ â†’ ${belongsToWeekId}ëŠ” ì•”ë¬µì  ë§ˆê°`);
          return true;
        }

        checkDate.setDate(checkDate.getDate() + 7);
      }

      console.log(`âœ… ${belongsToWeekId}ëŠ” ì•”ë¬µì  ë§ˆê° ì•„ë‹˜`);
      return false;
    } catch (error) {
      console.error('âŒ isImplicitlyClosed í™•ì¸ ì‹¤íŒ¨:', error);
      return false;
    }
  },

  /**
   * íŠ¹ì • ì£¼ì°¨ Settlement ê°€ì ¸ì˜¤ê¸° (ì—†ìœ¼ë©´ null ë°˜í™˜, ìƒì„±í•˜ì§€ ì•ŠìŒ)
   */
  async getWeekSettlement(spaceId, weekId) {
    try {
      console.log('ğŸ“… íŠ¹ì • ì£¼ì°¨ Settlement ì¡°íšŒ:', { spaceId, weekId });

      const settlementRef = doc(db, 'spaces', spaceId, 'settlement', weekId);
      const settlementSnap = await getDoc(settlementRef);

      if (!settlementSnap.exists()) {
        console.log('âŒ Settlement ì—†ìŒ');
        return null;
      }

      const data = settlementSnap.data();
      console.log('âœ… Settlement ë°œê²¬');
      return {
        id: settlementSnap.id,
        weekId,
        ...data,
        weekStart: data.weekStart?.toDate(),
        weekEnd: data.weekEnd?.toDate(),
        createdAt: data.createdAt?.toDate(),
        settledAt: data.settledAt?.toDate(),
      };
    } catch (error) {
      console.error('âŒ getWeekSettlement ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ë‚ ì§œë¡œ ì£¼ì°¨ Settlement ê°€ì ¸ì˜¤ê¸° (ì—†ìœ¼ë©´ null ë°˜í™˜)
   */
  async getSettlementByDate(spaceId, date) {
    try {
      const weekId = getWeekId(date);
      return await this.getWeekSettlement(spaceId, weekId);
    } catch (error) {
      console.error('âŒ getSettlementByDate ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ëª¨ë“  Settlement ëª©ë¡ ê°€ì ¸ì˜¤ê¸° (ìµœì‹ ìˆœ)
   */
  async getAllSettlements(spaceId) {
    try {
      console.log('ğŸ“‹ ëª¨ë“  Settlement ì¡°íšŒ:', spaceId);

      const settlementsRef = collection(db, 'spaces', spaceId, 'settlement');
      const q = query(settlementsRef, orderBy('weekStart', 'desc'));
      const snapshot = await getDocs(q);

      const settlements = [];
      snapshot.forEach((doc) => {
        const data = doc.data();
        settlements.push({
          id: doc.id,
          weekId: doc.id,
          ...data,
          weekStart: data.weekStart?.toDate(),
          weekEnd: data.weekEnd?.toDate(),
          createdAt: data.createdAt?.toDate(),
          settledAt: data.settledAt?.toDate(),
        });
      });

      console.log('âœ… Settlement ëª©ë¡ ì¡°íšŒ ì™„ë£Œ:', settlements.length);
      return settlements;
    } catch (error) {
      console.error('âŒ getAllSettlements ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ì˜ìˆ˜ì¦ ì œì¶œ
   */
  async submitReceipt(spaceId, receiptData) {
    try {
      console.log('ğŸ§¾ ì˜ìˆ˜ì¦ ì œì¶œ:', { spaceId, receiptData });

      const {
        submittedBy,      // ë“±ë¡ì UID
        submittedByName,  // ë“±ë¡ì ì´ë¦„
        paidBy,           // ì‹¤ì œ ë‚©ë¶€ì UID
        paidByName,       // ì‹¤ì œ ë‚©ë¶€ì ì´ë¦„
        memo,
        imageUrl,
        items,            // [{ itemName, amount, splitAmong: [userId, ...] }]
        belongsToDate,    // ê·€ì†ì¼ (YYYY-MM-DD)
      } = receiptData;

      const now = new Date();
      const receiptId = generateReceiptId(now);

      // ê·€ì†ì¼ ì²˜ë¦¬
      let targetWeekId;
      let belongsToWeekId;
      let actualBelongsToDate = belongsToDate;

      if (belongsToDate) {
        const belongsDate = new Date(belongsToDate);
        belongsToWeekId = getWeekId(belongsDate);

        // ê·€ì† ì£¼ì°¨ì˜ ì •ì‚° ìƒíƒœ í™•ì¸
        const belongsSettlement = await this.getWeekSettlement(spaceId, belongsToWeekId);

        // 1. ì§ì ‘ ë§ˆê° ì—¬ë¶€ í™•ì¸
        const isDirectlyClosed = belongsSettlement?.status === 'settled';

        // 2. ì•”ë¬µì  ë§ˆê° ì—¬ë¶€ í™•ì¸ (ê·€ì† ì£¼ì°¨ë³´ë‹¤ ë¯¸ë˜ì— settledê°€ ìˆëŠ”ì§€)
        const isImplicitClosed = await this.isImplicitlyClosed(spaceId, belongsToWeekId);

        if (isDirectlyClosed) {
          console.log(`âš ï¸ ê·€ì† ì£¼ì°¨(${belongsToWeekId})ê°€ ëª…ì‹œì ìœ¼ë¡œ ë§ˆê°ë¨`);
        }

        if (isImplicitClosed) {
          console.log(`âš ï¸ ê·€ì† ì£¼ì°¨(${belongsToWeekId})ê°€ ì•”ë¬µì ìœ¼ë¡œ ë§ˆê°ë¨ (ë¯¸ë˜ ì£¼ì°¨ ì¤‘ settled ì¡´ì¬)`);
        }

        if (isDirectlyClosed || isImplicitClosed) {
          // ëª…ì‹œì /ì•”ë¬µì  ë§ˆê°ì´ë©´ í˜„ì¬ ì£¼ì°¨ì— ë“±ë¡
          const currentWeekId = getWeekId(now);
          const currentSettlement = await this.getWeekSettlement(spaceId, currentWeekId);

          if (currentSettlement?.status === 'settled') {
            // í˜„ì¬ ì£¼ì°¨ë„ ë§ˆê°ë˜ì—ˆìœ¼ë©´ ë‹¤ìŒ ì£¼ì°¨ë¡œ
            const nextWeekDate = new Date(now);
            nextWeekDate.setDate(nextWeekDate.getDate() + 7);
            targetWeekId = getWeekId(nextWeekDate);
            console.log(`ğŸ”œ í˜„ì¬ ì£¼ì°¨ë„ ë§ˆê°ë¨ â†’ ë‹¤ìŒ ì£¼ì°¨(${targetWeekId})ì— ë“±ë¡`);
          } else {
            // í˜„ì¬ ì£¼ì°¨ê°€ activeì´ê±°ë‚˜ ì—†ìœ¼ë©´ í˜„ì¬ ì£¼ì°¨ì— ë“±ë¡
            targetWeekId = currentWeekId;
            console.log(`ğŸ†• ê·€ì† ì£¼ì°¨ ë§ˆê°ë¨ â†’ í˜„ì¬ ì£¼ì°¨(${currentWeekId})ì— ë“±ë¡`);
          }
        } else {
          // ëª…ì‹œì /ì•”ë¬µì  ë§ˆê° ëª¨ë‘ ì•„ë‹ˆë©´ ê·€ì† ì£¼ì°¨ì— ë“±ë¡
          targetWeekId = belongsToWeekId;
          console.log(`âœ… ê·€ì† ì£¼ì°¨(${belongsToWeekId})ëŠ” ë§ˆê° ì•ˆë¨ â†’ ê·€ì† ì£¼ì°¨ì— ë“±ë¡`);
        }
      } else {
        // ê·€ì†ì¼ì´ ì—†ìœ¼ë©´ í˜„ì¬ ì£¼ì°¨ì— ë“±ë¡
        targetWeekId = getWeekId(now);
        belongsToWeekId = targetWeekId;
        actualBelongsToDate = now.toISOString().split('T')[0];
      }
      
      // ì´ì•¡ ê³„ì‚°
      const totalAmount = items.reduce((sum, item) => sum + item.amount, 0);
      
      // ê° í•­ëª©ì˜ 1/n ê³„ì‚° (ì˜¬ë¦¼ìœ¼ë¡œ ë‚¸ ì‚¬ëŒ ìš°ëŒ€)
      const processedItems = items.map(item => ({
        itemName: item.itemName,
        amount: item.amount,
        splitAmong: item.splitAmong, // [userId, ...]
        perPerson: Math.ceil(item.amount / item.splitAmong.length),
      }));
      
      // ì˜ìˆ˜ì¦ ë°ì´í„°
      const receipt = {
        id: receiptId,
        submittedBy,
        submittedByName,
        paidBy,
        paidByName,
        createdAt: Timestamp.fromDate(now),
        belongsToDate: actualBelongsToDate,  // ê·€ì†ì¼
        belongsToWeekId,                     // ê·€ì† ì£¼ì°¨ ID
        memo: memo || '',
        imageUrl: imageUrl || '',
        items: processedItems,
        totalAmount,
      };

      // Settlement > receipts ì„œë¸Œì»¬ë ‰ì…˜ì— ì¶”ê°€
      const receiptRef = doc(db, 'spaces', spaceId, 'settlement', targetWeekId, 'receipts', receiptId);
      await setDoc(receiptRef, receipt);

      // Settlement ë¬¸ì„œ ì—…ë°ì´íŠ¸ (ì°¸ì—¬ì ëª©ë¡, ì´ì•¡)
      await this.updateSettlementCalculation(spaceId, targetWeekId);

      // ì´ë©”ì¼ ì•Œë¦¼ ë°œì†¡
      try {
        const emailSettingsRef = doc(db, `spaces/${spaceId}/settings`, 'email');
        const emailSettingsDoc = await getDoc(emailSettingsRef);
        const emailSettings = emailSettingsDoc.exists() ? emailSettingsDoc.data() : null;

        if (emailSettings?.settlement?.enabled && emailSettings.settlement.recipients.length > 0) {
          console.log('ğŸ“§ ì˜ìˆ˜ì¦ ì œì¶œ ì´ë©”ì¼ ë°œì†¡ ì‹œì‘');

          // ìŠ¤í˜ì´ìŠ¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
          const spaceDocRef = doc(db, 'spaces', spaceId);
          const spaceDoc = await getDoc(spaceDocRef);
          const spaceData = spaceDoc.exists() ? spaceDoc.data() : {};

          const emailResponse = await fetch('/.netlify/functions/send-email', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              type: 'settlement',
              paidByName,
              submittedByName,
              submittedAt: now,
              totalAmount,
              items: processedItems,
              memo,
              imageUrl,
              spaceName: spaceData.name || 'ë¼ìš´ì§€',
              recipients: {
                to: emailSettings.settlement.recipients[0],
                cc: emailSettings.settlement.recipients.slice(1)
              }
            })
          });

          const emailResult = await emailResponse.json();
          console.log('âœ… ì˜ìˆ˜ì¦ ì œì¶œ ì´ë©”ì¼ ë°œì†¡ ê²°ê³¼:', emailResult);
        } else {
          console.log('â„¹ï¸ ì˜ìˆ˜ì¦ ì œì¶œ ì´ë©”ì¼ ì•Œë¦¼ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆê±°ë‚˜ ìˆ˜ì‹ ì ì—†ìŒ');
        }
      } catch (emailError) {
        console.error('âš ï¸ ì˜ìˆ˜ì¦ ì œì¶œ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨ (ì˜ìˆ˜ì¦ ë“±ë¡ì€ ì™„ë£Œë¨):', emailError);
      }

      console.log('âœ… ì˜ìˆ˜ì¦ ì œì¶œ ì™„ë£Œ:', receiptId);
      return { id: receiptId, ...receipt };
    } catch (error) {
      console.error('âŒ submitReceipt ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ì˜ìˆ˜ì¦ ì‚­ì œ
   */
  async deleteReceipt(spaceId, weekId, receiptId) {
    try {
      console.log('ğŸ—‘ï¸ ì˜ìˆ˜ì¦ ì‚­ì œ:', { spaceId, weekId, receiptId });

      // ì˜ìˆ˜ì¦ ì‚­ì œ
      const receiptRef = doc(db, 'spaces', spaceId, 'settlement', weekId, 'receipts', receiptId);
      await deleteDoc(receiptRef);

      // Settlement ê³„ì‚° ì—…ë°ì´íŠ¸
      await this.updateSettlementCalculation(spaceId, weekId);

      console.log('âœ… ì˜ìˆ˜ì¦ ì‚­ì œ ì™„ë£Œ');
      return true;
    } catch (error) {
      console.error('âŒ deleteReceipt ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ì˜ìˆ˜ì¦ ìˆ˜ì •
   */
  async updateReceipt(spaceId, weekId, receiptId, receiptData) {
    try {
      console.log('âœï¸ ì˜ìˆ˜ì¦ ìˆ˜ì •:', { spaceId, weekId, receiptId, receiptData });

      const {
        paidBy,
        paidByName,
        memo,
        imageUrl,
        items,
      } = receiptData;

      // ì´ì•¡ ê³„ì‚°
      const totalAmount = items.reduce((sum, item) => sum + item.amount, 0);

      // ê° í•­ëª©ì˜ 1/n ê³„ì‚° (ì˜¬ë¦¼ìœ¼ë¡œ ë‚¸ ì‚¬ëŒ ìš°ëŒ€)
      const processedItems = items.map(item => ({
        itemName: item.itemName,
        amount: item.amount,
        splitAmong: item.splitAmong,
        perPerson: Math.ceil(item.amount / item.splitAmong.length),
      }));

      // ì˜ìˆ˜ì¦ ì—…ë°ì´íŠ¸
      const receiptRef = doc(db, 'spaces', spaceId, 'settlement', weekId, 'receipts', receiptId);
      await updateDoc(receiptRef, {
        paidBy,
        paidByName,
        memo: memo || '',
        imageUrl: imageUrl || '',
        items: processedItems,
        totalAmount,
        updatedAt: Timestamp.now(),
      });

      // Settlement ê³„ì‚° ì—…ë°ì´íŠ¸
      await this.updateSettlementCalculation(spaceId, weekId);

      console.log('âœ… ì˜ìˆ˜ì¦ ìˆ˜ì • ì™„ë£Œ');
      return true;
    } catch (error) {
      console.error('âŒ updateReceipt ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ì˜ìˆ˜ì¦ ì¡°íšŒ (ë‹¨ì¼)
   */
  async getReceipt(spaceId, weekId, receiptId) {
    try {
      console.log('ğŸ” ì˜ìˆ˜ì¦ ì¡°íšŒ:', { spaceId, weekId, receiptId });

      const receiptRef = doc(db, 'spaces', spaceId, 'settlement', weekId, 'receipts', receiptId);
      const receiptSnap = await getDoc(receiptRef);

      if (!receiptSnap.exists()) {
        throw new Error('ì˜ìˆ˜ì¦ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }

      const receiptData = {
        id: receiptSnap.id,
        ...receiptSnap.data(),
        createdAt: receiptSnap.data().createdAt?.toDate(),
      };

      console.log('âœ… ì˜ìˆ˜ì¦ ì¡°íšŒ ì™„ë£Œ');
      return receiptData;
    } catch (error) {
      console.error('âŒ getReceipt ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * Settlement ê³„ì‚° ì—…ë°ì´íŠ¸
   */
  async updateSettlementCalculation(spaceId, weekId) {
    try {
      console.log('ğŸ”„ ì •ì‚° ê³„ì‚° ì—…ë°ì´íŠ¸:', { spaceId, weekId });

      // ë©¤ë²„ ì •ë³´ ë¨¼ì € ê°€ì ¸ì˜¤ê¸° (displayNameë§Œ)
      const members = await this.getSpaceMembers(spaceId);
      const memberMap = {};
      members.forEach(m => {
        memberMap[m.userId] = {
          displayName: m.displayName,
        };
      });

      // ëª¨ë“  ì˜ìˆ˜ì¦ ê°€ì ¸ì˜¤ê¸°
      const receiptsRef = collection(db, 'spaces', spaceId, 'settlement', weekId, 'receipts');
      const receiptsSnap = await getDocs(receiptsRef);

      const participants = {};
      let totalAmount = 0;

      receiptsSnap.forEach((doc) => {
        const receipt = doc.data();
        totalAmount += receipt.totalAmount;

        // ë‚©ë¶€ì ì¶”ê°€
        if (!participants[receipt.paidBy]) {
          const memberInfo = memberMap[receipt.paidBy];
          participants[receipt.paidBy] = {
            name: memberInfo?.displayName || receipt.paidByName,
            totalPaid: 0,
            totalOwed: 0,
            balance: 0,
            phone: null, // ë‚˜ì¤‘ì— ì¡°íšŒ
          };
        }
        participants[receipt.paidBy].totalPaid += receipt.totalAmount;

        // ê° í•­ëª©ì˜ ë¶„ë‹´ìë“¤ ì²˜ë¦¬
        receipt.items.forEach(item => {
          item.splitAmong.forEach(userId => {
            if (!participants[userId]) {
              const memberInfo = memberMap[userId];
              participants[userId] = {
                name: memberInfo?.displayName || userId,
                totalPaid: 0,
                totalOwed: 0,
                balance: 0,
                phone: null, // ë‚˜ì¤‘ì— ì¡°íšŒ
              };
            }
            participants[userId].totalOwed += item.perPerson;
          });
        });
      });

      // ê° ì°¸ì—¬ìì˜ ì”ì•¡ ê³„ì‚° (ë°›ì„ ëˆì´ë©´ +, ë‚¼ ëˆì´ë©´ -)
      Object.keys(participants).forEach(userId => {
        const p = participants[userId];
        p.balance = p.totalPaid - p.totalOwed;
      });

      // ê° ì°¸ì—¬ìì˜ ì „í™”ë²ˆí˜¸ ì¡°íšŒ ë° ì •ê·œí™” (users ì»¬ë ‰ì…˜ì—ì„œ)
      console.log('ğŸ“ ì°¸ì—¬ì ì „í™”ë²ˆí˜¸ ì¡°íšŒ ì‹œì‘');
      for (const userId of Object.keys(participants)) {
        try {
          const userDocRef = doc(db, 'users', userId);
          const userDoc = await getDoc(userDocRef);

          if (userDoc.exists()) {
            const userData = userDoc.data();
            const rawPhone = userData.phoneNumber;
            const normalizedPhone = normalizePhoneNumber(rawPhone);

            participants[userId].phone = normalizedPhone;

            console.log(`ğŸ“± [${participants[userId].name}] ì „í™”ë²ˆí˜¸:`, {
              ì›ë³¸: rawPhone || 'ì—†ìŒ',
              ì •ê·œí™”: normalizedPhone || 'ì—†ìŒ'
            });
          } else {
            console.warn(`âš ï¸ [${participants[userId].name}] users ë¬¸ì„œ ì—†ìŒ:`, userId);
          }
        } catch (error) {
          console.error(`âŒ [${participants[userId].name}] ì „í™”ë²ˆí˜¸ ì¡°íšŒ ì‹¤íŒ¨:`, error);
        }
      }

      // Settlement ë¬¸ì„œ ì—…ë°ì´íŠ¸ (ì—†ìœ¼ë©´ ìƒì„±, ìˆìœ¼ë©´ ë³‘í•©)
      const settlementRef = doc(db, 'spaces', spaceId, 'settlement', weekId);
      await setDoc(settlementRef, {
        participants,
        totalAmount,
        updatedAt: Timestamp.now(),
      }, { merge: true });

      console.log('âœ… ì •ì‚° ê³„ì‚° ì™„ë£Œ:', participants);
      return participants;
    } catch (error) {
      console.error('âŒ updateSettlementCalculation ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ì´ë²ˆì£¼ ì˜ìˆ˜ì¦ ëª©ë¡ ì¡°íšŒ
   */
  async getWeekReceipts(spaceId, weekId) {
    try {
      console.log('ğŸ“‹ ì˜ìˆ˜ì¦ ëª©ë¡ ì¡°íšŒ:', { spaceId, weekId });

      const receiptsRef = collection(db, 'spaces', spaceId, 'settlement', weekId, 'receipts');

      // orderBy ì œê±°í•˜ê³  ì¼ë‹¨ ëª¨ë“  ì˜ìˆ˜ì¦ ê°€ì ¸ì˜¤ê¸° (í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì •ë ¬)
      const snapshot = await getDocs(receiptsRef);

      const receipts = [];
      snapshot.forEach((doc) => {
        const data = doc.data();
        receipts.push({
          id: doc.id,
          ...data,
          createdAt: data.createdAt?.toDate(),
        });
      });

      // í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì •ë ¬ (ê·€ì†ì¼ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ, ê·¸ ë‹¤ìŒ ìƒì„±ì¼ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ)
      receipts.sort((a, b) => {
        const dateA = a.belongsToDate || a.createdAt?.toISOString() || '';
        const dateB = b.belongsToDate || b.createdAt?.toISOString() || '';

        if (dateA !== dateB) {
          return dateB.localeCompare(dateA); // ê·€ì†ì¼ ë‚´ë¦¼ì°¨ìˆœ
        }

        const createdA = a.createdAt?.getTime() || 0;
        const createdB = b.createdAt?.getTime() || 0;
        return createdB - createdA; // ìƒì„±ì¼ ë‚´ë¦¼ì°¨ìˆœ
      });

      console.log('âœ… ì˜ìˆ˜ì¦ ëª©ë¡ ì¡°íšŒ ì™„ë£Œ:', receipts.length);
      if (receipts.length > 0) {
        console.log('ğŸ“„ ì²« ë²ˆì§¸ ì˜ìˆ˜ì¦:', receipts[0]);
      }
      return receipts;
    } catch (error) {
      console.error('âŒ getWeekReceipts ì‹¤íŒ¨:', error);
      console.error('ì—ëŸ¬ ìƒì„¸:', error);
      throw error;
    }
  },

  /**
   * ì •ì‚° í™•ì • (ì¼ìš”ì¼ ìì •ì— ìë™ ì‹¤í–‰ or ìˆ˜ë™ ì‹¤í–‰)
   */
  async settleWeek(spaceId, weekId) {
    try {
      console.log('ğŸ’° ì£¼ê°„ ì •ì‚° í™•ì •:', { spaceId, weekId });

      // 1. ì •ì‚° ê³„ì‚° ì—…ë°ì´íŠ¸ (ìµœì‹  ì „í™”ë²ˆí˜¸ í¬í•¨)
      console.log('ğŸ”„ ì •ì‚° í™•ì • ì „ ìµœì‹  ë°ì´í„° ì—…ë°ì´íŠ¸...');
      await this.updateSettlementCalculation(spaceId, weekId);

      // 2. ì •ì‚° ìƒíƒœ ì—…ë°ì´íŠ¸
      const settlementRef = doc(db, 'spaces', spaceId, 'settlement', weekId);
      await updateDoc(settlementRef, {
        status: 'settled',
        settledAt: Timestamp.now(),
      });

      console.log('âœ… ì •ì‚° í™•ì • ì™„ë£Œ');

      // 3. ì •ì‚° ê²°ê³¼ ê°€ì ¸ì˜¤ê¸°
      const settlementDoc = await getDoc(settlementRef);
      if (!settlementDoc.exists()) {
        console.warn('ì •ì‚° ë¬¸ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return { success: true, notificationSent: false };
      }

      const settlementData = settlementDoc.data();
      console.log('ğŸ“‹ ì •ì‚° ë°ì´í„° í™•ì¸:', {
        participantCount: Object.keys(settlementData.participants || {}).length,
        participants: Object.entries(settlementData.participants || {}).map(([userId, p]) => ({
          userId,
          name: p.name,
          phone: p.phone || 'âŒ ì—†ìŒ',
          balance: p.balance
        }))
      });

      let notificationResult = null;

      // 4. ì•Œë¦¼í†¡ í™œì„±í™” ì—¬ë¶€ í™•ì¸ ë° ìŠ¤í˜ì´ìŠ¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      try {
        const alimtalkDocRef = doc(db, 'spaces', spaceId, 'settings', 'alimtalk');
        const alimtalkDoc = await getDoc(alimtalkDocRef);
        const alimtalkData = alimtalkDoc.exists() ? alimtalkDoc.data() : {};
        const alimtalkEnabled = alimtalkData.enabled === true;

        // ìŠ¤í˜ì´ìŠ¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ë¼ìš´ì§€ëª…)
        const spaceDocRef = doc(db, 'spaces', spaceId);
        const spaceDoc = await getDoc(spaceDocRef);
        const spaceData = spaceDoc.exists() ? spaceDoc.data() : {};

        // ë§¤ë‹ˆì € ì „í™”ë²ˆí˜¸ ì°¾ê¸° (MANAGER ê¶Œí•œ ê°€ì§„ ì‚¬ëŒ)
        let managerPhone = null;
        try {
          const membersRef = collection(db, 'spaces', spaceId, 'assignedUsers');
          const membersSnap = await getDocs(membersRef);

          console.log('ğŸ‘¥ assignedUsers ì¡°íšŒ:', {
            spaceId,
            memberCount: membersSnap.size
          });

          let managerUserId = null;
          membersSnap.forEach((memberDoc) => {
            const memberData = memberDoc.data();
            console.log('ğŸ‘¤ ë©¤ë²„ í™•ì¸:', {
              userId: memberDoc.id,
              userType: memberData.userType,
              displayName: memberData.displayName
            });

            if (memberData.userType === 'manager') {
              managerUserId = memberDoc.id;
              console.log('âœ… manager ë°œê²¬:', managerUserId);
            }
          });

          if (managerUserId) {
            console.log('ğŸ“ users ë¬¸ì„œ ì¡°íšŒ ì‹œì‘:', managerUserId);
            const userDocRef = doc(db, 'users', managerUserId);
            const userDoc = await getDoc(userDocRef);

            if (userDoc.exists()) {
              const userData = userDoc.data();
              const rawPhone = userData.phoneNumber;
              const normalizedPhone = normalizePhoneNumber(rawPhone);

              console.log('ğŸ“‹ users ë¬¸ì„œ ë°ì´í„°:', {
                hasPhoneNumber: !!rawPhone,
                phoneNumber: rawPhone,
                ì •ê·œí™”: normalizedPhone,
                allFields: Object.keys(userData)
              });
              managerPhone = normalizedPhone;
            } else {
              console.warn('âŒ users ë¬¸ì„œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ:', managerUserId);
            }
          } else {
            console.warn('âŒ MANAGER ê¶Œí•œì„ ê°€ì§„ ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
          }

          console.log('ğŸ‘¤ ë§¤ë‹ˆì € ì „í™”ë²ˆí˜¸ ìµœì¢…:', managerPhone ? `âœ… ${managerPhone}` : 'âŒ ì—†ìŒ');
        } catch (error) {
          console.error('âš ï¸ ë§¤ë‹ˆì € ì „í™”ë²ˆí˜¸ ì¡°íšŒ ì‹¤íŒ¨:', error);
        }

        console.log('ğŸ“‹ ì•Œë¦¼ ë°œì†¡ ì¤€ë¹„:', {
          alimtalkEnabled,
          spaceName: spaceData.name,
          participantCount: Object.keys(settlementData.participants || {}).length,
          managerPhone: managerPhone ? 'âœ…' : 'âŒ'
        });

        // 5. ì°¸ì—¬ìë“¤ì—ê²Œ ì •ì‚° ì™„ë£Œ ì•Œë¦¼ ë°œì†¡
        if (settlementData.participants && Object.keys(settlementData.participants).length > 0) {
          notificationResult = await notificationService.sendSettlementComplete(
            {
              spaceId,
              weekId,
              spaceName: spaceData.name,
              participants: settlementData.participants,
              managerPhone,
            },
            {
              alimtalkEnabled,
              spaceData
            }
          );

          console.log('ğŸ“¬ ì •ì‚° ì™„ë£Œ ì•Œë¦¼ ë°œì†¡ ê²°ê³¼:', notificationResult);
        }
      } catch (notifyError) {
        // ì•Œë¦¼ ì‹¤íŒ¨í•´ë„ ì •ì‚° í™•ì •ì€ ì„±ê³µìœ¼ë¡œ ì²˜ë¦¬
        console.error('âš ï¸ ì •ì‚° ì™„ë£Œ ì•Œë¦¼ ë°œì†¡ ì‹¤íŒ¨ (ì •ì‚°ì€ ì™„ë£Œë¨):', notifyError);
        notificationResult = { success: false, error: notifyError.message };
      }

      // 6. ì •ì‚°ì¢…ê²° ìƒíƒœ ì²´í¬ (ì ‘ìˆ˜ë§ˆê° ì§í›„)
      console.log('ğŸ”„ ì ‘ìˆ˜ë§ˆê° í›„ ì •ì‚°ì¢…ê²° ìƒíƒœ ì²´í¬...');
      try {
        await this.updateAllSettledStatus(spaceId, weekId);
      } catch (checkError) {
        console.error('âš ï¸ ì •ì‚°ì¢…ê²° ìƒíƒœ ì²´í¬ ì‹¤íŒ¨ (ì ‘ìˆ˜ë§ˆê°ì€ ì™„ë£Œë¨):', checkError);
      }

      return {
        success: true,
        notificationSent: notificationResult?.success || false,
        notificationResult
      };
    } catch (error) {
      console.error('âŒ settleWeek ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ê°€ì¥ ìµœê·¼ì˜ active ìƒíƒœì¸ ì •ì‚° ì£¼ì°¨ ì°¾ê¸°
   */
  async findLatestActiveSettlement(spaceId) {
    try {
      console.log('ğŸ” ê°€ì¥ ìµœê·¼ active ì •ì‚° ì£¼ì°¨ ê²€ìƒ‰:', spaceId);

      const settlementsRef = collection(db, 'spaces', spaceId, 'settlement');
      const q = query(
        settlementsRef,
        where('status', '==', 'active'),
        orderBy('weekStart', 'desc')
      );
      const snapshot = await getDocs(q);

      if (snapshot.empty) {
        console.log('âŒ active ì •ì‚° ì£¼ì°¨ ì—†ìŒ');
        return null;
      }

      const doc = snapshot.docs[0];
      const data = doc.data();

      console.log('âœ… ìµœê·¼ active ì£¼ì°¨ ë°œê²¬:', doc.id);
      return {
        id: doc.id,
        weekId: doc.id,
        ...data,
        weekStart: data.weekStart?.toDate(),
        weekEnd: data.weekEnd?.toDate(),
        createdAt: data.createdAt?.toDate(),
        settledAt: data.settledAt?.toDate(),
      };
    } catch (error) {
      console.error('âŒ findLatestActiveSettlement ì‹¤íŒ¨:', error);
      return null;
    }
  },

  /**
   * Space ë©¤ë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
   */
  async getSpaceMembers(spaceId) {
    try {
      console.log('ğŸ‘¥ ë©¤ë²„ ëª©ë¡ ì¡°íšŒ:', spaceId);

      const membersRef = collection(db, 'spaces', spaceId, 'assignedUsers');
      const snapshot = await getDocs(membersRef);

      const members = [];
      snapshot.forEach((doc) => {
        members.push({
          userId: doc.id,
          ...doc.data(),
        });
      });

      console.log('âœ… ë©¤ë²„ ëª©ë¡ ì¡°íšŒ ì™„ë£Œ:', members.length);
      return members;
    } catch (error) {
      console.error('âŒ getSpaceMembers ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ì…ê¸ˆ í™•ì¸ ì²˜ë¦¬
   * ë¶€ë§¤ë‹ˆì € ì´ìƒì´ íŠ¹ì • ì°¸ì—¬ìì˜ ì…ê¸ˆì„ í™•ì¸í–ˆìŒì„ í‘œì‹œ
   */
  async confirmPayment(spaceId, weekId, userId) {
    try {
      console.log('ğŸ’° ì…ê¸ˆ í™•ì¸ ì²˜ë¦¬:', { spaceId, weekId, userId });

      const settlementRef = doc(db, 'spaces', spaceId, 'settlement', weekId);
      const settlementSnap = await getDoc(settlementRef);

      if (!settlementSnap.exists()) {
        throw new Error('ì •ì‚° ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }

      const settlementData = settlementSnap.data();

      if (!settlementData.participants || !settlementData.participants[userId]) {
        throw new Error('ì°¸ì—¬ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }

      // ì…ê¸ˆ í™•ì¸ ì²˜ë¦¬
      await updateDoc(settlementRef, {
        [`participants.${userId}.paymentConfirmed`]: true,
        [`participants.${userId}.paymentConfirmedAt`]: Timestamp.now(),
      });

      console.log('âœ… ì…ê¸ˆ í™•ì¸ ì™„ë£Œ');

      // ì •ì‚°ì¢…ê²° ìƒíƒœ ì—…ë°ì´íŠ¸
      await this.updateAllSettledStatus(spaceId, weekId);

      return true;
    } catch (error) {
      console.error('âŒ confirmPayment ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ì…ê¸ˆ í™•ì¸ ì·¨ì†Œ
   */
  async cancelPaymentConfirmation(spaceId, weekId, userId) {
    try {
      console.log('ğŸ’° ì…ê¸ˆ í™•ì¸ ì·¨ì†Œ:', { spaceId, weekId, userId });

      const settlementRef = doc(db, 'spaces', spaceId, 'settlement', weekId);
      const settlementSnap = await getDoc(settlementRef);

      if (!settlementSnap.exists()) {
        throw new Error('ì •ì‚° ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }

      const settlementData = settlementSnap.data();

      if (!settlementData.participants || !settlementData.participants[userId]) {
        throw new Error('ì°¸ì—¬ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }

      // ì…ê¸ˆ í™•ì¸ ì·¨ì†Œ
      await updateDoc(settlementRef, {
        [`participants.${userId}.paymentConfirmed`]: false,
        [`participants.${userId}.paymentConfirmedAt`]: null,
      });

      console.log('âœ… ì…ê¸ˆ í™•ì¸ ì·¨ì†Œ ì™„ë£Œ');

      // ì •ì‚°ì¢…ê²° ìƒíƒœ ì—…ë°ì´íŠ¸
      await this.updateAllSettledStatus(spaceId, weekId);

      return true;
    } catch (error) {
      console.error('âŒ cancelPaymentConfirmation ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ì†¡ê¸ˆ ì™„ë£Œ ì²˜ë¦¬
   * ë¶€ë§¤ë‹ˆì € ì´ìƒì´ íŠ¹ì • ì°¸ì—¬ìì—ê²Œ ì†¡ê¸ˆì„ ì™„ë£Œí–ˆìŒì„ í‘œì‹œ
   */
  async confirmTransfer(spaceId, weekId, userId) {
    try {
      console.log('ğŸ’¸ ì†¡ê¸ˆ ì™„ë£Œ ì²˜ë¦¬:', { spaceId, weekId, userId });

      const settlementRef = doc(db, 'spaces', spaceId, 'settlement', weekId);
      const settlementSnap = await getDoc(settlementRef);

      if (!settlementSnap.exists()) {
        throw new Error('ì •ì‚° ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }

      const settlementData = settlementSnap.data();

      if (!settlementData.participants || !settlementData.participants[userId]) {
        throw new Error('ì°¸ì—¬ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }

      // ì†¡ê¸ˆ ì™„ë£Œ ì²˜ë¦¬
      await updateDoc(settlementRef, {
        [`participants.${userId}.transferCompleted`]: true,
        [`participants.${userId}.transferCompletedAt`]: Timestamp.now(),
      });

      console.log('âœ… ì†¡ê¸ˆ ì™„ë£Œ');

      // ì •ì‚°ì¢…ê²° ìƒíƒœ ì—…ë°ì´íŠ¸
      await this.updateAllSettledStatus(spaceId, weekId);

      return true;
    } catch (error) {
      console.error('âŒ confirmTransfer ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ì†¡ê¸ˆ ì™„ë£Œ ì·¨ì†Œ
   */
  async cancelTransferConfirmation(spaceId, weekId, userId) {
    try {
      console.log('ğŸ’¸ ì†¡ê¸ˆ ì™„ë£Œ ì·¨ì†Œ:', { spaceId, weekId, userId });

      const settlementRef = doc(db, 'spaces', spaceId, 'settlement', weekId);
      const settlementSnap = await getDoc(settlementRef);

      if (!settlementSnap.exists()) {
        throw new Error('ì •ì‚° ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }

      const settlementData = settlementSnap.data();

      if (!settlementData.participants || !settlementData.participants[userId]) {
        throw new Error('ì°¸ì—¬ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }

      // ì†¡ê¸ˆ ì™„ë£Œ ì·¨ì†Œ
      await updateDoc(settlementRef, {
        [`participants.${userId}.transferCompleted`]: false,
        [`participants.${userId}.transferCompletedAt`]: null,
      });

      console.log('âœ… ì†¡ê¸ˆ ì™„ë£Œ ì·¨ì†Œ');

      // ì •ì‚°ì¢…ê²° ìƒíƒœ ì—…ë°ì´íŠ¸
      await this.updateAllSettledStatus(spaceId, weekId);

      return true;
    } catch (error) {
      console.error('âŒ cancelTransferConfirmation ì‹¤íŒ¨:', error);
      throw error;
    }
  },

  /**
   * ëª¨ë“  ì…ê¸ˆ/ì†¡ê¸ˆ í™•ì¸ ì—¬ë¶€ ì²´í¬ ë° ì •ì‚°ì¢…ê²° ìƒíƒœ ì—…ë°ì´íŠ¸
   */
  async updateAllSettledStatus(spaceId, weekId) {
    try {
      console.log('ğŸ” ì •ì‚°ì¢…ê²° ìƒíƒœ í™•ì¸:', { spaceId, weekId });

      const settlementRef = doc(db, 'spaces', spaceId, 'settlement', weekId);
      const settlementSnap = await getDoc(settlementRef);

      if (!settlementSnap.exists()) {
        throw new Error('ì •ì‚° ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }

      const settlementData = settlementSnap.data();
      const participants = settlementData.participants || {};

      // ì°¸ì—¬ìê°€ ì—†ìœ¼ë©´ ì¢…ê²° ë¶ˆê°€
      if (Object.keys(participants).length === 0) {
        console.log('âš ï¸ ì°¸ì—¬ìê°€ ì—†ìŒ - ì¢…ê²° ë¶ˆê°€');
        await updateDoc(settlementRef, {
          allSettled: false,
          allSettledAt: null,
        });
        return false;
      }

      // ëª¨ë“  ì°¸ì—¬ìê°€ ì…ê¸ˆ/ì†¡ê¸ˆ í™•ì¸ë˜ì—ˆëŠ”ì§€ ì²´í¬
      let allConfirmed = true;
      const checkResults = [];

      for (const [userId, participant] of Object.entries(participants)) {
        const balance = participant.balance || 0;
        const participantName = participant.name || userId;

        // balanceê°€ 0ì´ ì•„ë‹Œ ê²½ìš°ë§Œ í™•ì¸ í•„ìš”
        if (balance !== 0) {
          if (balance < 0) {
            // ë‚® ëˆì´ ìˆìœ¼ë©´ ì…ê¸ˆí™•ì¸ í•„ìš”
            const confirmed = participant.paymentConfirmed === true;
            checkResults.push({
              name: participantName,
              balance,
              type: 'ì…ê¸ˆ',
              confirmed,
            });
            if (!confirmed) {
              allConfirmed = false;
            }
          } else if (balance > 0) {
            // ë°›ì„ ëˆì´ ìˆìœ¼ë©´ ì†¡ê¸ˆì™„ë£Œ í•„ìš”
            const completed = participant.transferCompleted === true;
            checkResults.push({
              name: participantName,
              balance,
              type: 'ì†¡ê¸ˆ',
              confirmed: completed,
            });
            if (!completed) {
              allConfirmed = false;
            }
          }
        } else {
          checkResults.push({
            name: participantName,
            balance: 0,
            type: 'ì—†ìŒ',
            confirmed: true,
          });
        }
      }

      console.log('ğŸ“Š ì •ì‚° ìƒíƒœ ì²´í¬ ê²°ê³¼:', checkResults);
      console.log('âœ… ì •ì‚°ì¢…ê²° ìƒíƒœ:', allConfirmed ? 'ëª¨ë“  ê±°ë˜ ì™„ë£Œ' : 'í™•ì¸ ëŒ€ê¸°ì¤‘');

      // ì •ì‚°ì¢…ê²° ìƒíƒœ ì—…ë°ì´íŠ¸
      const updateData = {
        allSettled: allConfirmed,
        allSettledAt: allConfirmed ? Timestamp.now() : null,
      };

      await updateDoc(settlementRef, updateData);

      return allConfirmed;
    } catch (error) {
      console.error('âŒ updateAllSettledStatus ì‹¤íŒ¨:', error);
      throw error;
    }
  },
};

// ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ export
export { getWeekId, getWeekRange };

export default settlementService;
</file>

<file path="src/pages/SettlementPage.jsx">
// src/pages/SettlementPage.jsx
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Receipt, Plus, TrendingUp, TrendingDown, Users, Calendar, User, CheckCircle, Table, LayoutGrid, ChevronLeft, ChevronRight, List } from 'lucide-react';
import { useAuth } from '../hooks/useAuth';
import useStore from '../store/useStore';
import settlementService, { getWeekId, getWeekRange } from '../services/settlementService';
import authService from '../services/authService';
import LoginOverlay from '../components/auth/LoginOverlay';
import ReceiptDetailModal from '../components/settlement/ReceiptDetailModal';
import ParticipantDetailModal from '../components/settlement/ParticipantDetailModal';
import SettlementTableView from '../components/settlement/SettlementTableView';
import { canManageSpace } from '../utils/permissions';

const SettlementPage = () => {
  const navigate = useNavigate();
  const { user, isLoggedIn } = useAuth();
  const { selectedSpace } = useStore();

  // í˜„ì¬ ë³´ê³  ìˆëŠ” ì£¼ì°¨ì˜ ì‹œì‘ì¼
  const [selectedWeekStart, setSelectedWeekStart] = useState(() => {
    const today = new Date();
    const { weekStart } = getWeekRange(today);
    return weekStart;
  });

  const [settlement, setSettlement] = useState(null);
  const [receipts, setReceipts] = useState([]);
  const [loading, setLoading] = useState(true);
  const [myBalance, setMyBalance] = useState(null);
  const [members, setMembers] = useState([]);
  const [userProfiles, setUserProfiles] = useState({}); // userId -> {displayName, profileImage}
  const [selectedReceipt, setSelectedReceipt] = useState(null);
  const [showReceiptModal, setShowReceiptModal] = useState(false);
  const [selectedParticipant, setSelectedParticipant] = useState(null);
  const [selectedParticipantId, setSelectedParticipantId] = useState(null);
  const [showParticipantModal, setShowParticipantModal] = useState(false);
  const [viewMode, setViewMode] = useState('card'); // 'card' | 'table'
  const [activeTab, setActiveTab] = useState('myReceipts'); // 'myReceipts' | 'participants' | 'allReceipts'
  const [allSettlements, setAllSettlements] = useState([]); // ëª¨ë“  ì •ì‚° ëª©ë¡
  const [showWeekList, setShowWeekList] = useState(false); // ì£¼ì°¨ ëª©ë¡ í‘œì‹œ ì—¬ë¶€

  useEffect(() => {
    if (selectedSpace?.id && user?.id) {
      loadSettlement();
      loadAllSettlements();
    } else if (selectedSpace && user) {
      // user.idê°€ ì—†ëŠ” ê²½ìš°ì—ë„ ë¡œë”© ì¢…ë£Œ
      setLoading(false);
    }
  }, [selectedSpace, user, selectedWeekStart]);

  const loadSettlement = async () => {
    if (!selectedSpace?.id || !user?.id) return;

    try {
      setLoading(true);

      // ë©¤ë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      const spaceMembers = await settlementService.getSpaceMembers(selectedSpace.id);
      setMembers(spaceMembers);

      // ì„ íƒëœ ì£¼ì°¨ì˜ weekId ê³„ì‚°
      const weekId = getWeekId(selectedWeekStart);
      console.log('ğŸ“… ì„ íƒëœ ì£¼ì°¨:', weekId, selectedWeekStart);

      // ì„ íƒëœ ì£¼ì°¨ì˜ Settlement ê°€ì ¸ì˜¤ê¸°
      let weekSettlement = await settlementService.getSettlementByDate(selectedSpace.id, selectedWeekStart);

      // í˜„ì¬ ì£¼ì°¨ë¥¼ ë³´ê³  ìˆê³  settlementì´ ì—†ìœ¼ë©´ ìë™ ìƒì„±
      const today = new Date();
      const { weekStart: currentWeekStart } = getWeekRange(today);
      const isCurrentWeek = selectedWeekStart.getTime() === currentWeekStart.getTime();

      if (!weekSettlement && isCurrentWeek) {
        console.log('ğŸ†• í˜„ì¬ ì£¼ì°¨ì˜ settlementì´ ì—†ìŒ â†’ ìë™ ìƒì„±');
        weekSettlement = await settlementService.getCurrentWeekSettlement(selectedSpace.id);
      }

      // ì˜ìˆ˜ì¦ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
      let weekReceipts = [];
      if (weekSettlement?.weekId) {
        weekReceipts = await settlementService.getWeekReceipts(selectedSpace.id, weekSettlement.weekId);

        // ğŸ”„ ì˜ìˆ˜ì¦ì´ ìˆìœ¼ë©´ ë¬´ì¡°ê±´ ì¬ê³„ì‚°í•˜ì—¬ í•­ìƒ ìµœì‹  ìƒíƒœ ìœ ì§€
        if (weekReceipts.length > 0) {
          const actualTotalAmount = weekReceipts.reduce((sum, receipt) => sum + (receipt.totalAmount || 0), 0);
          const storedTotalAmount = weekSettlement.totalAmount || 0;

          console.log('ğŸ”„ ì˜ìˆ˜ì¦ ê¸°ë°˜ ì •ì‚° ìƒíƒœ í™•ì¸:', {
            ì˜ìˆ˜ì¦ìˆ˜: weekReceipts.length,
            ì‹¤ì œì´ì•¡: actualTotalAmount,
            ì €ì¥ëœì´ì•¡: storedTotalAmount,
            ì°¸ì—¬ììˆ˜: Object.keys(weekSettlement.participants || {}).length
          });

          try {
            console.log('ğŸ”„ ì •ì‚° ì¬ê³„ì‚° ì‹œì‘...');
            const updatedParticipants = await settlementService.updateSettlementCalculation(selectedSpace.id, weekSettlement.weekId);
            console.log('âœ… ì •ì‚° ì¬ê³„ì‚° ì™„ë£Œ:', updatedParticipants);

            // ì¬ê³„ì‚° í›„ ìµœì‹  ë°ì´í„° ë‹¤ì‹œ ê°€ì ¸ì˜¤ê¸°
            const freshSettlement = await settlementService.getSettlementByDate(selectedSpace.id, selectedWeekStart);
            if (freshSettlement) {
              weekSettlement = freshSettlement;
              console.log('âœ… ìµœì‹  ì •ì‚° ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
            } else {
              console.warn('âš ï¸ ì¬ê³„ì‚° í›„ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨ - ê¸°ì¡´ ë°ì´í„° ìœ ì§€');
            }
          } catch (recalcError) {
            console.error('âŒ ì •ì‚° ì¬ê³„ì‚° ì‹¤íŒ¨:', recalcError);
            console.error('ìƒì„¸ ì—ëŸ¬:', recalcError.message, recalcError.stack);
            // ì¬ê³„ì‚° ì‹¤íŒ¨í•´ë„ ê¸°ì¡´ ë°ì´í„°ëŠ” ìœ ì§€
          }
        }
      }

      setSettlement(weekSettlement);
      setReceipts(weekReceipts);

      // ì°¸ì—¬ìë“¤ì˜ í”„ë¡œí•„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (users ì»¬ë ‰ì…˜ì—ì„œ)
      const participantIds = Object.keys(weekSettlement?.participants || {});
      if (participantIds.length > 0) {
        const profiles = await authService.getUserProfiles(participantIds);
        setUserProfiles(profiles);
      }

      // ë‚´ ì”ì•¡ ê³„ì‚°
      const myInfo = weekSettlement?.participants?.[user.id];
      setMyBalance(myInfo || { name: user.displayName, totalPaid: 0, totalOwed: 0, balance: 0 });

    } catch (error) {
      console.error('ì •ì‚° ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
      // ì—ëŸ¬ê°€ ë°œìƒí•´ë„ ê¸°ë³¸ê°’ ì„¤ì •
      setSettlement(null);
      setReceipts([]);
      setMyBalance({ name: user.displayName, totalPaid: 0, totalOwed: 0, balance: 0 });
    } finally {
      setLoading(false);
    }
  };

  // ëª¨ë“  ì •ì‚° ëª©ë¡ ë¡œë“œ
  const loadAllSettlements = async () => {
    if (!selectedSpace?.id) return;

    try {
      const settlements = await settlementService.getAllSettlements(selectedSpace.id);
      setAllSettlements(settlements);
    } catch (error) {
      console.error('ì •ì‚° ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
    }
  };

  const formatCurrency = (amount) => {
    return amount.toLocaleString('ko-KR') + 'ì›';
  };

  const formatDate = (date) => {
    if (!date) return '';
    return new Date(date).toLocaleDateString('ko-KR', {
      month: 'long',
      day: 'numeric',
    });
  };

  const formatDateTime = (date) => {
    if (!date) return '';
    return new Date(date).toLocaleDateString('ko-KR', {
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
    });
  };

  // userIdë¡œ ë©¤ë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (users ì»¬ë ‰ì…˜ì—ì„œ)
  const getMemberInfo = (userId) => {
    const userProfile = userProfiles[userId];
    return {
      displayName: userProfile?.displayName || userId,
      profileImage: userProfile?.profileImage || '',
    };
  };

  // ì˜ìˆ˜ì¦ í´ë¦­ í•¸ë“¤ëŸ¬
  const handleReceiptClick = (receipt) => {
    setSelectedReceipt(receipt);
    setShowReceiptModal(true);
  };

  // ì˜ìˆ˜ì¦ ìˆ˜ì • í•¸ë“¤ëŸ¬
  const handleReceiptEdit = () => {
    if (!selectedReceipt || !settlement?.weekId) return;

    setShowReceiptModal(false);
    // ìˆ˜ì • í˜ì´ì§€ë¡œ ì´ë™
    navigate(`/settlement/submit?receiptId=${selectedReceipt.id}&weekId=${settlement.weekId}`);
  };

  // ì˜ìˆ˜ì¦ ì‚­ì œ í•¸ë“¤ëŸ¬
  const handleReceiptDelete = async () => {
    if (!selectedReceipt || !settlement?.weekId) return;

    try {
      setShowReceiptModal(false);
      setLoading(true);

      await settlementService.deleteReceipt(
        selectedSpace.id,
        settlement.weekId,
        selectedReceipt.id
      );

      // ì •ì‚° ì •ë³´ ë‹¤ì‹œ ë¡œë“œ
      await loadSettlement();

      alert('ì˜ìˆ˜ì¦ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
      setSelectedReceipt(null);
    } catch (error) {
      console.error('ì˜ìˆ˜ì¦ ì‚­ì œ ì‹¤íŒ¨:', error);
      alert('ì˜ìˆ˜ì¦ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
      setLoading(false);
    }
  };

  // ì°¸ì—¬ì í´ë¦­ í•¸ë“¤ëŸ¬
  const handleParticipantClick = (userId, participant) => {
    setSelectedParticipantId(userId);
    setSelectedParticipant(participant);
    setShowParticipantModal(true);
  };

  // ì£¼ì°¨ ë„¤ë¹„ê²Œì´ì…˜ í•¨ìˆ˜
  const prevWeek = () => {
    const newDate = new Date(selectedWeekStart);
    newDate.setDate(newDate.getDate() - 7);
    setSelectedWeekStart(newDate);
  };

  const nextWeek = () => {
    const newDate = new Date(selectedWeekStart);
    newDate.setDate(newDate.getDate() + 7);
    setSelectedWeekStart(newDate);
  };

  const goToThisWeek = () => {
    const today = new Date();
    const { weekStart } = getWeekRange(today);
    setSelectedWeekStart(weekStart);
  };

  const goToWeek = (weekStart) => {
    setSelectedWeekStart(weekStart);
    setShowWeekList(false);
  };

  // í˜„ì¬ ì£¼ì°¨ì¸ì§€ í™•ì¸
  const isCurrentWeek = () => {
    const today = new Date();
    const { weekStart } = getWeekRange(today);
    return selectedWeekStart.getTime() === weekStart.getTime();
  };

  // ì ‘ìˆ˜ ë§ˆê° í•¸ë“¤ëŸ¬ (ë§¤ë‹ˆì €ë§Œ)
  const handleCompleteSettlement = async () => {
    if (!settlement?.weekId) return;

    console.log('ğŸ’° ì ‘ìˆ˜ ë§ˆê° ë²„íŠ¼ í´ë¦­:', {
      spaceId: selectedSpace.id,
      weekId: settlement.weekId,
      participantCount: Object.keys(settlement.participants || {}).length
    });

    const confirmed = window.confirm(
      'ì˜ìˆ˜ì¦ ì ‘ìˆ˜ë¥¼ ë§ˆê°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\në§ˆê° ì‹œ ëª¨ë“  ì°¸ì—¬ìì—ê²Œ ì •ì‚° ê²°ê³¼ ì•Œë¦¼í†¡ì´ ë°œì†¡ë˜ë©°, ë” ì´ìƒ ì˜ìˆ˜ì¦ì„ ì œì¶œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'
    );
    if (!confirmed) return;

    try {
      setLoading(true);
      console.log('ğŸ”„ settlementService.settleWeek í˜¸ì¶œ ì¤‘...');

      const result = await settlementService.settleWeek(selectedSpace.id, settlement.weekId);

      console.log('âœ… settleWeek ì™„ë£Œ:', result);

      // ì•Œë¦¼ ë°œì†¡ ê²°ê³¼ì— ë”°ë¼ ë©”ì‹œì§€ ë³€ê²½
      if (result.notificationResult?.skipped) {
        alert('ì˜ìˆ˜ì¦ ì ‘ìˆ˜ê°€ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nì•Œë¦¼í†¡ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆì–´ ì•Œë¦¼ì´ ë°œì†¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
      } else if (result.notificationSent) {
        const { sentCount, errorCount } = result.notificationResult || {};
        let message = 'ì˜ìˆ˜ì¦ ì ‘ìˆ˜ê°€ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤!';
        if (sentCount > 0) {
          message += `\n\nâœ… ${sentCount}ëª…ì—ê²Œ ì•Œë¦¼í†¡ ë°œì†¡ ì™„ë£Œ`;
        }
        if (errorCount > 0) {
          message += `\nâš ï¸ ${errorCount}ëª… ë°œì†¡ ì‹¤íŒ¨ (ë¸Œë¼ìš°ì € ì½˜ì†” í™•ì¸)`;
        }
        alert(message);
      } else {
        alert('ì˜ìˆ˜ì¦ ì ‘ìˆ˜ê°€ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nì•Œë¦¼ ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (ë¸Œë¼ìš°ì € ì½˜ì†” í™•ì¸)');
      }

      await loadSettlement();
      await loadAllSettlements();
    } catch (error) {
      console.error('âŒ ì ‘ìˆ˜ ë§ˆê° ì‹¤íŒ¨:', error);
      alert('ì ‘ìˆ˜ ë§ˆê°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
      setLoading(false);
    }
  };

  // ì…ê¸ˆ í™•ì¸ í•¸ë“¤ëŸ¬
  const handleConfirmPayment = async (userId, participantName) => {
    if (!settlement?.weekId) return;

    const confirmed = window.confirm(
      `${participantName}ë‹˜ì˜ ì…ê¸ˆì„ í™•ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`
    );
    if (!confirmed) return;

    try {
      setLoading(true);
      await settlementService.confirmPayment(selectedSpace.id, settlement.weekId, userId);
      await loadSettlement();
      alert(`${participantName}ë‹˜ì˜ ì…ê¸ˆì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    } catch (error) {
      console.error('ì…ê¸ˆ í™•ì¸ ì‹¤íŒ¨:', error);
      alert('ì…ê¸ˆ í™•ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
      setLoading(false);
    }
  };

  // ì…ê¸ˆ í™•ì¸ ì·¨ì†Œ í•¸ë“¤ëŸ¬
  const handleCancelPaymentConfirmation = async (userId, participantName) => {
    if (!settlement?.weekId) return;

    const confirmed = window.confirm(
      `${participantName}ë‹˜ì˜ ì…ê¸ˆ í™•ì¸ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`
    );
    if (!confirmed) return;

    try {
      setLoading(true);
      await settlementService.cancelPaymentConfirmation(selectedSpace.id, settlement.weekId, userId);
      await loadSettlement();
      alert(`${participantName}ë‹˜ì˜ ì…ê¸ˆ í™•ì¸ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.`);
    } catch (error) {
      console.error('ì…ê¸ˆ í™•ì¸ ì·¨ì†Œ ì‹¤íŒ¨:', error);
      alert('ì…ê¸ˆ í™•ì¸ ì·¨ì†Œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
      setLoading(false);
    }
  };

  // ì†¡ê¸ˆ ì™„ë£Œ í•¸ë“¤ëŸ¬
  const handleConfirmTransfer = async (userId, participantName) => {
    if (!settlement?.weekId) return;

    const confirmed = window.confirm(
      `${participantName}ë‹˜ì—ê²Œ ì†¡ê¸ˆì„ ì™„ë£Œí•˜ì…¨ìŠµë‹ˆê¹Œ?`
    );
    if (!confirmed) return;

    try {
      setLoading(true);
      await settlementService.confirmTransfer(selectedSpace.id, settlement.weekId, userId);
      await loadSettlement();
      alert(`${participantName}ë‹˜ì—ê²Œ ì†¡ê¸ˆ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    } catch (error) {
      console.error('ì†¡ê¸ˆ ì™„ë£Œ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
      alert('ì†¡ê¸ˆ ì™„ë£Œ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
      setLoading(false);
    }
  };

  // ì†¡ê¸ˆ ì™„ë£Œ ì·¨ì†Œ í•¸ë“¤ëŸ¬
  const handleCancelTransferConfirmation = async (userId, participantName) => {
    if (!settlement?.weekId) return;

    const confirmed = window.confirm(
      `${participantName}ë‹˜ì˜ ì†¡ê¸ˆ ì™„ë£Œë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`
    );
    if (!confirmed) return;

    try {
      setLoading(true);
      await settlementService.cancelTransferConfirmation(selectedSpace.id, settlement.weekId, userId);
      await loadSettlement();
      alert(`${participantName}ë‹˜ì˜ ì†¡ê¸ˆ ì™„ë£Œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.`);
    } catch (error) {
      console.error('ì†¡ê¸ˆ ì™„ë£Œ ì·¨ì†Œ ì‹¤íŒ¨:', error);
      alert('ì†¡ê¸ˆ ì™„ë£Œ ì·¨ì†Œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
      setLoading(false);
    }
  };

  // ë§¤ë‹ˆì € ê¶Œí•œ ì²´í¬
  const isManager = selectedSpace?.userType && canManageSpace(selectedSpace.userType);

  if (!isLoggedIn) {
    return <LoginOverlay />;
  }

  if (!selectedSpace) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center px-4">
        <div className="text-center">
          <div className="text-2xl mb-4">ğŸ </div>
          <p className="text-gray-600 mb-2">ìŠ¤í˜ì´ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
          <p className="text-sm text-gray-500">ì˜ˆì•½ í˜ì´ì§€ì—ì„œ ìŠ¤í˜ì´ìŠ¤ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”</p>
        </div>
      </div>
    );
  }

  if (loading) {
    return (
      <div className="flex items-center justify-center h-screen bg-gray-50">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
          <p className="text-gray-600">ì •ì‚° ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 pb-24">
      {/* í—¤ë” */}
      <div className="bg-white border-b border-gray-200 sticky top-0 z-10">
        <div className="px-4 py-4">
          <div className="flex items-center justify-between mb-3">
            <div className="flex-1">
              <h1 className="text-2xl font-bold text-gray-900">ğŸ’° ì •ì‚°</h1>
            </div>

            <div className="flex items-center gap-2">
              {/* ì£¼ì°¨ ëª©ë¡ ë²„íŠ¼ */}
              <div className="relative">
                <button
                  onClick={() => setShowWeekList(!showWeekList)}
                  className="px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors flex items-center gap-1.5"
                >
                  <List className="w-4 h-4" />
                  <span className="text-sm font-medium hidden sm:inline">ëª©ë¡</span>
                </button>

                {/* ì£¼ì°¨ ëª©ë¡ ë“œë¡­ë‹¤ìš´ */}
                {showWeekList && (
                  <>
                    <div
                      className="fixed inset-0 z-40"
                      onClick={() => setShowWeekList(false)}
                    />
                    <div className="absolute top-full right-0 mt-2 bg-white rounded-xl shadow-xl z-50 overflow-hidden min-w-[280px] max-h-[400px] overflow-y-auto">
                      {allSettlements.length > 0 ? (
                        allSettlements.map((s) => (
                          <button
                            key={s.weekId}
                            onClick={() => goToWeek(s.weekStart)}
                            className={`w-full px-4 py-3 text-left hover:bg-gray-50 transition-colors border-b border-gray-100 last:border-b-0 ${
                              s.weekStart.getTime() === selectedWeekStart.getTime() ? 'bg-blue-50' : ''
                            }`}
                          >
                            <div className="flex items-center justify-between">
                              <div>
                                <div className="font-semibold text-gray-900">
                                  {formatDate(s.weekStart)} ~ {formatDate(s.weekEnd)}
                                </div>
                                <div className="text-xs text-gray-500 mt-0.5">
                                  {s.allSettled ? 'âœ“ ì •ì‚°ì¢…ê²°' : s.status === 'settled' ? 'ì ‘ìˆ˜ë§ˆê°' : 'ì§„í–‰ì¤‘'}
                                  {s.totalAmount > 0 && ` Â· ${formatCurrency(s.totalAmount)}`}
                                </div>
                              </div>
                              {s.weekStart.getTime() === selectedWeekStart.getTime() && (
                                <div className="w-2 h-2 rounded-full bg-blue-600" />
                              )}
                            </div>
                          </button>
                        ))
                      ) : (
                        <div className="px-4 py-8 text-center text-gray-500 text-sm">
                          ì •ì‚° ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤
                        </div>
                      )}
                    </div>
                  </>
                )}
              </div>

              {/* ë·° ëª¨ë“œ í† ê¸€ ë²„íŠ¼ */}
              <div className="flex bg-gray-100 rounded-lg p-1">
                <button
                  onClick={() => setViewMode('card')}
                  className={`px-3 py-1.5 rounded-md transition-all flex items-center gap-1.5 ${
                    viewMode === 'card'
                      ? 'bg-white text-blue-600 shadow-sm'
                      : 'text-gray-600 hover:text-gray-900'
                  }`}
                >
                  <LayoutGrid className="w-4 h-4" />
                  <span className="text-sm font-medium hidden sm:inline">ì¹´ë“œ</span>
                </button>
                <button
                  onClick={() => setViewMode('table')}
                  className={`px-3 py-1.5 rounded-md transition-all flex items-center gap-1.5 ${
                    viewMode === 'table'
                      ? 'bg-white text-blue-600 shadow-sm'
                      : 'text-gray-600 hover:text-gray-900'
                  }`}
                >
                  <Table className="w-4 h-4" />
                  <span className="text-sm font-medium hidden sm:inline">í…Œì´ë¸”</span>
                </button>
              </div>

              {/* ì ‘ìˆ˜ ë§ˆê° ë²„íŠ¼ (ë§¤ë‹ˆì €ë§Œ, settled ì•„ë‹ˆë©´ í‘œì‹œ) */}
              {isManager && settlement && settlement.status !== 'settled' && (
                <button
                  onClick={handleCompleteSettlement}
                  className="flex px-3 py-1.5 sm:px-4 sm:py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg font-semibold shadow-md hover:shadow-lg transition-all items-center gap-1.5 sm:gap-2"
                  data-tour="settlement-complete-button"
                >
                  <CheckCircle className="w-4 h-4" />
                  <span className="text-sm sm:text-base">ì ‘ìˆ˜ë§ˆê°</span>
                </button>
              )}
            </div>
          </div>

          {/* ì£¼ì°¨ ë„¤ë¹„ê²Œì´ì…˜ */}
          <div className="flex items-center justify-between">
            <button
              onClick={prevWeek}
              className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
            >
              <ChevronLeft className="w-5 h-5 text-gray-600" />
            </button>

            <div className="flex-1 text-center">
              <div className="text-sm text-gray-600">
                {settlement?.weekStart && settlement?.weekEnd ? (
                  <>
                    {formatDate(settlement.weekStart)} ~ {formatDate(settlement.weekEnd)}
                  </>
                ) : (
                  <>
                    {formatDate(selectedWeekStart)} ~ {formatDate(new Date(selectedWeekStart.getTime() + 6 * 24 * 60 * 60 * 1000))}
                  </>
                )}
              </div>
              <div className="flex items-center justify-center gap-2 mt-1">
                {settlement?.allSettled && (
                  <span className="text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded-full font-semibold">
                    âœ“ ì •ì‚°ì¢…ê²°
                  </span>
                )}
                {settlement?.status === 'settled' && !settlement?.allSettled && (
                  <span className="text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full font-semibold">
                    ì ‘ìˆ˜ë§ˆê°
                  </span>
                )}
                {!settlement && (
                  <span className="text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full">
                    ì •ì‚° ë‚´ì—­ ì—†ìŒ
                  </span>
                )}
                {isCurrentWeek() && (
                  <span className="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full font-semibold">
                    ì´ë²ˆ ì£¼
                  </span>
                )}
              </div>
            </div>

            <div className="flex items-center gap-1">
              {!isCurrentWeek() && (
                <button
                  onClick={goToThisWeek}
                  className="px-3 py-1.5 text-sm bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors font-semibold"
                >
                  ì´ë²ˆ ì£¼
                </button>
              )}
              <button
                onClick={nextWeek}
                className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
              >
                <ChevronRight className="w-5 h-5 text-gray-600" />
              </button>
            </div>
          </div>
        </div>
      </div>

      <div className="p-4 space-y-4">
        {viewMode === 'card' ? (
          <>
            {/* ë‚´ ì •ì‚° í˜„í™© ì¹´ë“œ */}
            <div className="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 text-white shadow-md">
              <div className="flex items-center justify-between mb-3">
                <div className="flex items-center gap-2">
                  <Users className="w-4 h-4" />
                  <span className="font-semibold text-sm">ë‚´ ì •ì‚° í˜„í™©</span>
                </div>
                <div className="flex items-center gap-2">
                  {myBalance?.paymentConfirmed && myBalance?.balance < 0 && (
                    <span className="text-xs bg-green-400 text-white px-2 py-0.5 rounded-full font-semibold">
                      âœ“ ì…ê¸ˆí™•ì¸
                    </span>
                  )}
                  {myBalance?.transferCompleted && myBalance?.balance > 0 && (
                    <span className="text-xs bg-green-400 text-white px-2 py-0.5 rounded-full font-semibold">
                      âœ“ ì†¡ê¸ˆì™„ë£Œ
                    </span>
                  )}
                  {settlement?.status === 'active' && (
                    <span className="text-xs bg-white/20 px-2 py-0.5 rounded-full">ì§„í–‰ì¤‘</span>
                  )}
                </div>
              </div>

              {/* ì •ì‚° ê²°ê³¼ì™€ ìƒì„¸ ì •ë³´ë¥¼ í•œ ì¤„ë¡œ */}
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-2">
                  {myBalance?.balance > 0 ? (
                    <>
                      <TrendingUp className="w-5 h-5 text-green-300" />
                      <div>
                        <p className="text-xs opacity-75">ì •ì‚° ê²°ê³¼</p>
                        <span className={`text-2xl font-bold ${
                          myBalance?.transferCompleted ? 'text-gray-300 line-through' : 'text-green-300'
                        }`}>
                          +{formatCurrency(myBalance.balance)}
                        </span>
                      </div>
                    </>
                  ) : myBalance?.balance < 0 ? (
                    <>
                      <TrendingDown className="w-5 h-5 text-orange-300" />
                      <div>
                        <p className="text-xs opacity-75">ì •ì‚° ê²°ê³¼</p>
                        <span className={`text-2xl font-bold ${
                          myBalance?.paymentConfirmed ? 'text-gray-300 line-through' : 'text-orange-300'
                        }`}>
                          {formatCurrency(myBalance.balance)}
                        </span>
                      </div>
                    </>
                  ) : (
                    <div>
                      <p className="text-xs opacity-75">ì •ì‚° ê²°ê³¼</p>
                      <span className="text-2xl font-bold">0ì›</span>
                    </div>
                  )}
                </div>

                <div className="flex gap-3 text-xs">
                  <div className="text-right">
                    <p className="opacity-70 mb-0.5">ë‚¸ ê¸ˆì•¡</p>
                    <p className="font-semibold">{formatCurrency(myBalance?.totalPaid || 0)}</p>
                  </div>
                  <div className="text-right">
                    <p className="opacity-70 mb-0.5">ë¶€ë‹´ì•¡</p>
                    <p className="font-semibold">{formatCurrency(myBalance?.totalOwed || 0)}</p>
                  </div>
                </div>
              </div>
            </div>

            {/* íƒ­ UI */}
            <div className="bg-white rounded-xl shadow-sm overflow-hidden">
              {/* íƒ­ í—¤ë” */}
              <div className="flex border-b border-gray-200">
                <button
                  onClick={() => setActiveTab('myReceipts')}
                  className={`flex-1 py-3 px-2 sm:px-4 font-semibold transition-colors ${
                    activeTab === 'myReceipts'
                      ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50/50'
                      : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'
                  }`}
                  data-tour="my-receipts-tab"
                >
                  <div className="flex items-center justify-center gap-1 sm:gap-2">
                    <User className="w-4 h-4" />
                    <span className="text-sm sm:text-base">ë‚´ ì°¸ì—¬ë‚´ì—­</span>
                  </div>
                </button>
                <button
                  onClick={() => setActiveTab('participants')}
                  className={`flex-1 py-3 px-2 sm:px-4 font-semibold transition-colors ${
                    activeTab === 'participants'
                      ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50/50'
                      : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'
                  }`}
                >
                  <div className="flex items-center justify-center gap-1 sm:gap-2">
                    <Users className="w-4 h-4" />
                    <span className="text-sm sm:text-base">ì°¸ì—¬ìë³„</span>
                  </div>
                </button>
                <button
                  onClick={() => setActiveTab('allReceipts')}
                  className={`flex-1 py-3 px-2 sm:px-4 font-semibold transition-colors ${
                    activeTab === 'allReceipts'
                      ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50/50'
                      : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'
                  }`}
                >
                  <div className="flex items-center justify-center gap-1 sm:gap-2">
                    <Calendar className="w-4 h-4" />
                    <span className="text-sm sm:text-base">ì „ì²´ ë‚´ì—­</span>
                  </div>
                </button>
              </div>

              {/* íƒ­ ì»¨í…ì¸  */}
              <div className="p-4">
                {/* ë‚´ ì°¸ì—¬ë‚´ì—­ íƒ­ */}
                {activeTab === 'myReceipts' && (
                  <>
                    {(() => {
                      const myReceipts = receipts.filter(receipt =>
                        receipt.items.some(item => item.splitAmong?.includes(user?.id))
                      );

                      if (myReceipts.length === 0) {
                        return (
                          <div className="text-center py-12">
                            <Receipt className="w-16 h-16 mx-auto mb-4 text-gray-300" />
                            <p className="text-gray-600 font-medium mb-2">ì°¸ì—¬í•œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</p>
                            <p className="text-sm text-gray-500">ì˜ìˆ˜ì¦ ì œì¶œ ì‹œ ë¶„ë‹´ìë¡œ ì¶”ê°€ë˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</p>
                          </div>
                        );
                      }

                      return (
                        <div className="space-y-3">
                          {myReceipts.map((receipt) => {
                            const myItems = receipt.items.filter(item => item.splitAmong?.includes(user?.id));
                            const myShare = myItems.reduce((sum, item) => sum + (item.perPerson || 0), 0);
                            const isPayer = receipt.paidBy === user?.id;

                            return (
                              <div
                                key={receipt.id}
                                className={`border-2 rounded-lg p-4 hover:shadow-md transition-all cursor-pointer ${
                                  isPayer ? 'border-green-200 bg-green-50/30' : 'border-gray-200 bg-white'
                                }`}
                                onClick={() => handleReceiptClick(receipt)}
                              >
                                {/* ìƒí˜¸ëª…/ë©”ëª¨ */}
                                <div className="flex items-start justify-between mb-3">
                                  <div className="flex-1">
                                    {receipt.memo && (
                                      <h4 className="font-bold text-gray-900 text-base mb-1">
                                        {receipt.memo}
                                      </h4>
                                    )}
                                    <p className="text-xs text-gray-500">
                                      {receipt.belongsToDate ? formatDate(new Date(receipt.belongsToDate)) : formatDate(receipt.createdAt)}
                                    </p>
                                  </div>
                                </div>

                                {/* ë‚´ê°€ ë¶„ë‹´í•œ í’ˆëª©ë§Œ í‘œì‹œ */}
                                <div className="mb-3 space-y-1.5">
                                  {myItems.map((item, idx) => (
                                    <div
                                      key={idx}
                                      className="flex justify-between items-start text-sm py-2 px-2 rounded bg-blue-50"
                                    >
                                      <span className="font-semibold text-blue-900 flex-1">
                                        {item.itemName}
                                      </span>
                                      <div className="flex flex-col items-end gap-0.5 ml-2">
                                        <div className="flex items-baseline gap-1">
                                          <span className="font-bold text-blue-600">
                                            {formatCurrency(item.perPerson || 0)}
                                          </span>
                                          <span className="text-xs text-gray-500">
                                            / {formatCurrency(item.amount || 0)}
                                          </span>
                                        </div>
                                        <span className="text-xs text-gray-500">
                                          {item.splitAmong?.length || 0}ëª… ë¶„ë‹´
                                        </span>
                                      </div>
                                    </div>
                                  ))}
                                </div>

                                {/* í•˜ë‹¨: ë‚´ê°€ ë¶„ë‹´í•œ ê¸ˆì•¡ / ë‚¸ ì‚¬ëŒ ì •ë³´ */}
                                <div className="pt-3 border-t border-gray-200">
                                  <div className="flex items-center justify-between">
                                    <div className="flex items-center gap-2">
                                      <span className="text-xs text-gray-600">ë‚¸ ì‚¬ëŒ</span>
                                      <span className={`font-bold ${isPayer ? 'text-green-600' : 'text-gray-900'}`}>
                                        {receipt.paidByName}
                                        {isPayer && (
                                          <span className="ml-1 text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded">
                                            ë‚˜
                                          </span>
                                        )}
                                      </span>
                                      {isPayer && (
                                        <span className="text-lg font-bold text-green-600">
                                          {formatCurrency(receipt.totalAmount)}
                                        </span>
                                      )}
                                    </div>
                                    {!isPayer && myShare > 0 && (
                                      <div className="flex items-center gap-2">
                                        <span className="text-xs text-gray-600">ë‚´ ë¶„ë‹´ì•¡</span>
                                        <span className="text-lg font-bold text-blue-600">
                                          {formatCurrency(myShare)}
                                        </span>
                                      </div>
                                    )}
                                  </div>
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      );
                    })()}
                  </>
                )}

                {/* ì°¸ì—¬ìë³„ íƒ­ */}
                {activeTab === 'participants' && settlement?.participants && Object.keys(settlement.participants).length > 0 && (
                  <div className="space-y-2">
                    {Object.entries(settlement.participants)
                      .sort(([, a], [, b]) => b.balance - a.balance)
                      .map(([userId, participant]) => {
                        // users ì»¬ë ‰ì…˜ì—ì„œ displayNameê³¼ profileImage ê°€ì ¸ì˜¤ê¸°
                        const memberInfo = getMemberInfo(userId);
                        const displayName = memberInfo.displayName;
                        const profileImage = memberInfo.profileImage;
                        const needsPayment = participant.balance < 0;
                        const needsReceive = participant.balance > 0;
                        const isPaymentConfirmed = participant.paymentConfirmed === true;
                        const isTransferCompleted = participant.transferCompleted === true;

                        const handleAmountClick = (e) => {
                          e.stopPropagation();
                          if (!isManager) return;

                          if (needsPayment) {
                            // ì…ê¸ˆ í™•ì¸/ì·¨ì†Œ
                            if (isPaymentConfirmed) {
                              handleCancelPaymentConfirmation(userId, displayName);
                            } else {
                              handleConfirmPayment(userId, displayName);
                            }
                          } else if (needsReceive) {
                            // ì†¡ê¸ˆ ì™„ë£Œ/ì·¨ì†Œ
                            if (isTransferCompleted) {
                              handleCancelTransferConfirmation(userId, displayName);
                            } else {
                              handleConfirmTransfer(userId, displayName);
                            }
                          }
                        };

                        return (
                          <div
                            key={userId}
                            className={`rounded-lg border-2 ${
                              userId === user.id ? 'bg-blue-50 border-blue-300' : 'bg-white border-gray-200'
                            } hover:shadow-md transition-all`}
                          >
                            <div className="flex items-center gap-3 p-3">
                              {/* í”„ë¡œí•„ ì´ë¯¸ì§€ */}
                              <div
                                onClick={() => handleParticipantClick(userId, participant)}
                                className="cursor-pointer"
                              >
                                {profileImage ? (
                                  <img
                                    src={profileImage}
                                    alt={displayName}
                                    className="w-12 h-12 rounded-full object-cover flex-shrink-0"
                                  />
                                ) : (
                                  <div className="w-12 h-12 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold flex-shrink-0">
                                    {displayName[0]}
                                  </div>
                                )}
                              </div>

                              {/* ì´ë¦„ ë° ì •ë³´ */}
                              <div
                                onClick={() => handleParticipantClick(userId, participant)}
                                className="flex-1 min-w-0 cursor-pointer"
                              >
                                <p className="font-semibold text-gray-900 flex items-center gap-2 mb-0.5">
                                  {displayName}
                                  {userId === user.id && (
                                    <span className="text-xs text-blue-600 font-semibold">(ë‚˜)</span>
                                  )}
                                </p>
                                <div className="flex items-center gap-2 text-xs text-gray-500">
                                  <span>ë‚¸ {formatCurrency(participant.totalPaid)}</span>
                                  <span>Â·</span>
                                  <span>ë¶€ë‹´ {formatCurrency(participant.totalOwed)}</span>
                                </div>
                              </div>

                              {/* ê¸ˆì•¡ (í´ë¦­ ê°€ëŠ¥) */}
                              {participant.balance !== 0 && (
                                <div
                                  onClick={handleAmountClick}
                                  className={`flex flex-col items-end gap-1 px-4 py-2 rounded-lg transition-all flex-shrink-0 ${
                                    isManager ? 'cursor-pointer' : 'cursor-default'
                                  } ${
                                    needsPayment
                                      ? isPaymentConfirmed
                                        ? 'bg-gray-100'
                                        : isManager
                                        ? 'bg-orange-50 hover:bg-orange-100 active:scale-95'
                                        : 'bg-orange-50'
                                      : needsReceive
                                      ? isTransferCompleted
                                        ? 'bg-gray-100'
                                        : isManager
                                        ? 'bg-green-50 hover:bg-green-100 active:scale-95'
                                        : 'bg-green-50'
                                      : 'bg-gray-50'
                                  }`}
                                >
                                  <div className={`font-bold text-lg ${
                                    needsPayment
                                      ? isPaymentConfirmed
                                        ? 'text-gray-400 line-through'
                                        : 'text-orange-600'
                                      : needsReceive
                                      ? isTransferCompleted
                                        ? 'text-gray-400 line-through'
                                        : 'text-green-600'
                                      : 'text-gray-600'
                                  }`}>
                                    {participant.balance > 0 ? '+' : ''}{formatCurrency(participant.balance)}
                                  </div>
                                  {((isPaymentConfirmed && needsPayment) || (isTransferCompleted && needsReceive)) && (
                                    <span className="text-xs font-semibold text-green-600 flex items-center gap-0.5">
                                      <span>âœ“</span>
                                      <span>{needsPayment ? 'ì…ê¸ˆí™•ì¸' : 'ì†¡ê¸ˆì™„ë£Œ'}</span>
                                    </span>
                                  )}
                                  {isManager && !isPaymentConfirmed && !isTransferCompleted && (
                                    <span className="text-xs text-gray-500">
                                      {needsPayment ? 'í´ë¦­í•˜ì—¬ í™•ì¸' : needsReceive ? 'í´ë¦­í•˜ì—¬ ì™„ë£Œ' : ''}
                                    </span>
                                  )}
                                </div>
                              )}

                              {participant.balance === 0 && (
                                <div className="px-4 py-2 rounded-lg bg-gray-50">
                                  <div className="font-bold text-lg text-gray-600">
                                    0ì›
                                  </div>
                                </div>
                              )}
                            </div>
                          </div>
                        );
                      })}
                  </div>
                )}

                {/* ì „ì²´ ë‚´ì—­ íƒ­ */}
                {activeTab === 'allReceipts' && (
                  <>
                    {receipts.length === 0 ? (
                <div className="text-center py-12">
                  <Receipt className="w-16 h-16 mx-auto mb-4 text-gray-300" />
                  <p className="text-gray-600 font-medium mb-2">ì•„ì§ ì œì¶œëœ ì˜ìˆ˜ì¦ì´ ì—†ìŠµë‹ˆë‹¤</p>
                  {settlement?.status !== 'settled' && (
                    <>
                      <p className="text-sm text-gray-500 mb-6">ì²« ì˜ìˆ˜ì¦ì„ ì œì¶œí•´ë³´ì„¸ìš”!</p>
                      <button
                        onClick={() => navigate('/settlement/submit')}
                        className="inline-flex items-center gap-2 bg-blue-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-blue-700 transition-colors"
                      >
                        <Plus className="w-5 h-5" />
                        ì˜ìˆ˜ì¦ ì œì¶œí•˜ê¸°
                      </button>
                    </>
                  )}
                </div>
              ) : (
                <div className="space-y-3">
                  {receipts.map((receipt) => {
                    // ë‚´ê°€ ë¶„ë‹´í•œ í•­ëª©ë“¤ê³¼ ì´ ê¸ˆì•¡ ê³„ì‚°
                    const myItems = receipt.items.filter(item => item.splitAmong?.includes(user?.id));
                    const myShare = myItems.reduce((sum, item) => sum + (item.perPerson || 0), 0);
                    const isPayer = receipt.paidBy === user?.id;

                    return (
                      <div
                        key={receipt.id}
                        className={`border-2 rounded-lg p-4 hover:shadow-md transition-all cursor-pointer ${
                          isPayer ? 'border-green-200 bg-green-50/30' : 'border-gray-200 bg-white'
                        }`}
                        onClick={() => handleReceiptClick(receipt)}
                      >
                        {/* ìƒí˜¸ëª…/ë©”ëª¨ */}
                        <div className="flex items-start justify-between mb-3">
                          <div className="flex-1">
                            {receipt.memo && (
                              <h4 className="font-bold text-gray-900 text-base mb-1">
                                {receipt.memo}
                              </h4>
                            )}
                            <p className="text-xs text-gray-500">
                              {receipt.belongsToDate ? formatDate(new Date(receipt.belongsToDate)) : formatDate(receipt.createdAt)}
                            </p>
                          </div>
                        </div>

                        {/* í’ˆëª© ë¦¬ìŠ¤íŠ¸ */}
                        <div className="mb-3 space-y-1.5">
                          {receipt.items.map((item, idx) => {
                            const isMyItem = item.splitAmong?.includes(user?.id);
                            return (
                              <div
                                key={idx}
                                className={`flex justify-between items-start text-sm py-2 px-2 rounded ${
                                  isMyItem ? 'bg-blue-50' : 'bg-gray-50'
                                }`}
                              >
                                <span className={`${isMyItem ? 'font-semibold text-blue-900' : 'text-gray-700'} flex-1`}>
                                  {item.itemName}
                                </span>
                                <div className="flex flex-col items-end gap-0.5 ml-2">
                                  {isMyItem ? (
                                    <>
                                      <div className="flex items-baseline gap-1">
                                        <span className="font-bold text-blue-600">
                                          {formatCurrency(item.perPerson || 0)}
                                        </span>
                                        <span className="text-xs text-gray-500">
                                          / {formatCurrency(item.amount || 0)}
                                        </span>
                                      </div>
                                      <span className="text-xs text-gray-500">
                                        {item.splitAmong?.length || 0}ëª… ë¶„ë‹´
                                      </span>
                                    </>
                                  ) : (
                                    <>
                                      <span className="text-gray-600">
                                        {formatCurrency(item.amount || 0)}
                                      </span>
                                      <span className="text-xs text-gray-500">
                                        {item.splitAmong?.length || 0}ëª… ë¶„ë‹´
                                      </span>
                                    </>
                                  )}
                                </div>
                              </div>
                            );
                          })}
                        </div>

                        {/* í•˜ë‹¨: ë‚´ê°€ ë¶„ë‹´í•œ ê¸ˆì•¡ / ë‚¸ ì‚¬ëŒ ì •ë³´ */}
                        <div className="pt-3 border-t border-gray-200">
                          <div className="flex items-center justify-between">
                            <div className="flex items-center gap-2">
                              <span className="text-xs text-gray-600">ë‚¸ ì‚¬ëŒ</span>
                              <span className={`font-bold ${isPayer ? 'text-green-600' : 'text-gray-900'}`}>
                                {receipt.paidByName}
                                {isPayer && (
                                  <span className="ml-1 text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded">
                                    ë‚˜
                                  </span>
                                )}
                              </span>
                              {isPayer && (
                                <span className="text-lg font-bold text-green-600">
                                  {formatCurrency(receipt.totalAmount)}
                                </span>
                              )}
                            </div>
                            {!isPayer && myShare > 0 && (
                              <div className="flex items-center gap-2">
                                <span className="text-xs text-gray-600">ë‚´ ë¶„ë‹´ì•¡</span>
                                <span className="text-lg font-bold text-blue-600">
                                  {formatCurrency(myShare)}
                                </span>
                              </div>
                            )}
                          </div>
                        </div>
                      </div>
                    );
                      })}
                    </div>
                  )}
                  </>
                )}
              </div>
            </div>
          </>
        ) : (
          /* í…Œì´ë¸” ë·° */
          <div className="space-y-4">
            {/* ë‚´ ì •ì‚° í˜„í™© ìš”ì•½ (í…Œì´ë¸” ë·°ìš© ê°„ì†Œí™”) */}
            <div className="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 text-white shadow-lg">
              <div className="flex items-center justify-between">
                <div>
                  <div className="flex items-center gap-2 mb-1">
                    <p className="text-sm opacity-90">ë‚´ ì •ì‚° ê²°ê³¼</p>
                    {myBalance?.paymentConfirmed && myBalance?.balance < 0 && (
                      <span className="text-xs bg-green-400 text-white px-2 py-0.5 rounded-full font-semibold">
                        âœ“ ì…ê¸ˆí™•ì¸
                      </span>
                    )}
                    {myBalance?.transferCompleted && myBalance?.balance > 0 && (
                      <span className="text-xs bg-green-400 text-white px-2 py-0.5 rounded-full font-semibold">
                        âœ“ ì†¡ê¸ˆì™„ë£Œ
                      </span>
                    )}
                  </div>
                  <div className="flex items-center gap-2">
                    {myBalance?.balance > 0 ? (
                      <>
                        <TrendingUp className="w-5 h-5 text-green-300" />
                        <span className={`text-2xl font-bold ${
                          myBalance?.transferCompleted ? 'text-gray-300 line-through' : 'text-green-300'
                        }`}>
                          +{formatCurrency(myBalance.balance)}
                        </span>
                      </>
                    ) : myBalance?.balance < 0 ? (
                      <>
                        <TrendingDown className="w-5 h-5 text-orange-300" />
                        <span className={`text-2xl font-bold ${
                          myBalance?.paymentConfirmed ? 'text-gray-300 line-through' : 'text-orange-300'
                        }`}>
                          {formatCurrency(myBalance.balance)}
                        </span>
                      </>
                    ) : (
                      <span className="text-2xl font-bold">0ì›</span>
                    )}
                  </div>
                </div>
                <div className="text-right text-sm opacity-90">
                  <p>ë‚¸ ê¸ˆì•¡: {formatCurrency(myBalance?.totalPaid || 0)}</p>
                  <p>ë¶€ë‹´ì•¡: {formatCurrency(myBalance?.totalOwed || 0)}</p>
                </div>
              </div>
            </div>

            {/* ì—‘ì…€ ìŠ¤íƒ€ì¼ í…Œì´ë¸” */}
            <SettlementTableView
              receipts={receipts}
              participants={settlement?.participants || {}}
              userProfiles={userProfiles}
              formatCurrency={formatCurrency}
              formatDate={formatDate}
              weekId={settlement?.weekId}
              settlement={settlement}
            />
          </div>
        )}
      </div>

      {/* í”Œë¡œíŒ… ì˜ìˆ˜ì¦ ì œì¶œ ë²„íŠ¼ */}
      {(!settlement || settlement.status !== 'settled') && (
        <button
          onClick={() => navigate('/settlement/submit')}
          className="fixed right-4 bottom-32 bg-blue-500 hover:bg-blue-600 text-white rounded-full shadow-lg px-4 py-3 flex items-center gap-2 transition-all active:scale-95 z-[9998]"
          data-tour="submit-receipt-button"
        >
          <Plus size={20} />
          <span className="font-semibold text-sm">ì˜ìˆ˜ì¦ ì œì¶œ</span>
        </button>
      )}

      {/* ì˜ìˆ˜ì¦ ìƒì„¸ ëª¨ë‹¬ */}
      <ReceiptDetailModal
        receipt={selectedReceipt}
        isOpen={showReceiptModal}
        onClose={() => {
          setShowReceiptModal(false);
          setSelectedReceipt(null);
        }}
        onEdit={handleReceiptEdit}
        onDelete={handleReceiptDelete}
        canEdit={selectedReceipt?.submittedBy === user?.id}
        members={members}
        userProfiles={userProfiles}
      />

      {/* ì°¸ì—¬ì ìƒì„¸ ëª¨ë‹¬ */}
      <ParticipantDetailModal
        participant={selectedParticipant}
        userId={selectedParticipantId}
        isOpen={showParticipantModal}
        onClose={() => {
          setShowParticipantModal(false);
          setSelectedParticipant(null);
          setSelectedParticipantId(null);
        }}
        receipts={receipts}
        userProfiles={userProfiles}
        members={members}
        currentUser={user}
      />
    </div>
  );
};

export default SettlementPage;
</file>

<file path="src/App.jsx">
import { BrowserRouter, Routes, Route } from 'react-router-dom';
import MainLayout from './components/common/MainLayout';
import WeeklyList from './components/reservations/WeeklyList';
import PraisePage from './pages/PraisePage';
import KakaoCallback from './components/auth/KakaoCallback';
import SignupPage from './pages/SignupPage';
import SignupDemoPage from './pages/SignupDemoPage';
import JoinSpacePage from './pages/JoinSpacePage';
import TermsOfServicePage from './pages/TermsOfServicePage';
import PrivacyPolicyPage from './pages/PrivacyPolicyPage';
import ExpenseListPage from './pages/ExpenseListPage';
import ExpenseRequestPage from './pages/ExpenseRequestPage';
import MigrationPage from './pages/MigrationPage';

// íˆ¬ì–´ ê´€ë ¨
import { TourProvider } from './contexts/TourContext';
import TourOverlay from './components/tour/TourOverlay';

// ì •ì‚° í˜ì´ì§€ë“¤
import SettlementPage from './pages/SettlementPage';
import SettlementSubmitPage from './pages/SettlementSubmitPage';
import SettlementSchedulePage from './pages/SettlementSchedulePage';
import TestDataPage from './pages/TestDataPage';

// ìŠ¤í˜ì´ìŠ¤ ê´€ë¦¬ í˜ì´ì§€ë“¤
import SpaceManagePage from './pages/SpaceManagePage';
import SpaceSettingsPage from './pages/SpaceSettingsPage';
import MemberManagePage from './pages/MemberManagePage';
import AlimtalkSettingsPage from './pages/AlimtalkSettingsPage';
import GuestPolicySettingsPage from './pages/GuestPolicySettingsPage';
import SettlementSettingsPage from './pages/SettlementSettingsPage';
import TransferManagerPage from './pages/TransferManagerPage';
import SuperAdminPage from './pages/SuperAdminPage';
import SlopesPage from './pages/SlopesPage';
import EmailTestPage from './pages/EmailTestPage';
import MorePage from './pages/MorePage';
import IntroductionPage from './pages/IntroductionPage';
import UserGuidePage from './pages/UserGuidePage';
import ReservationStatsPage from './pages/ReservationStatsPage';

// ë°”í…ë” í˜ì´ì§€ë“¤
import BartenderMenuPage from './pages/BartenderMenuPage';
import BartenderManagePage from './pages/BartenderManagePage';
import BartenderOrderListPage from './pages/BartenderOrderListPage';


function App() {
  return (
    <BrowserRouter>
      <TourProvider>
        <div className="min-h-screen bg-gray-50">
          <TourOverlay />
          <Routes>
          {/* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ì´ ìˆëŠ” ë©”ì¸ í˜ì´ì§€ë“¤ */}
          <Route element={<MainLayout />}>
            <Route path="/" element={<WeeklyList />} />
            <Route path="/settlement" element={<SettlementPage />} />
            <Route path="/praise" element={<PraisePage />} />
            <Route path="/expenses" element={<ExpenseListPage />} />
            <Route path="/slopes" element={<SlopesPage />} />
            <Route path="/more" element={<MorePage />} />
          </Route>

          {/* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ì´ ì—†ëŠ” ë…ë¦½ í˜ì´ì§€ë“¤ */}
          <Route path="/auth/kakao/callback" element={<KakaoCallback />} />
          <Route path="/signup" element={<SignupPage />} />
          <Route path="/signin" element={<SignupDemoPage />} />
          <Route path="/join" element={<JoinSpacePage />} />
          <Route path="/join/:code" element={<JoinSpacePage />} />
          <Route path="/expenses/request" element={<ExpenseRequestPage />} />
          <Route path="/settlement/submit" element={<SettlementSubmitPage />} />
          <Route path="/settlement/schedule" element={<SettlementSchedulePage />} />
          <Route path="/test-data" element={<TestDataPage />} />
          <Route path="/terms" element={<TermsOfServicePage />} />
          <Route path="/privacy" element={<PrivacyPolicyPage />} />
          <Route path="/introduction" element={<IntroductionPage />} />
          <Route path="/user-guide" element={<UserGuidePage />} />
          <Route path="/reservation-stats" element={<ReservationStatsPage />} />
          <Route path="/migration" element={<MigrationPage />} />
          
          {/* ìŠ¤í˜ì´ìŠ¤ ê´€ë¦¬ */}
          <Route path="/space/manage" element={<SpaceManagePage />} />
          <Route path="/space/settings" element={<SpaceSettingsPage />} />
          <Route path="/space/members" element={<MemberManagePage />} />
          <Route path="/space/alimtalk" element={<AlimtalkSettingsPage />} />
          <Route path="/space/guestpolicy" element={<GuestPolicySettingsPage />} />
          <Route path="/space/settlement" element={<SettlementSettingsPage />} />
          <Route path="/space/transfer-manager" element={<TransferManagerPage />} />
          
          {/* ìŠˆí¼ ì–´ë“œë¯¼ */}
          <Route path="/super-admin" element={<SuperAdminPage />} />

          {/* ì´ë©”ì¼ í…ŒìŠ¤íŠ¸ */}
          <Route path="/email-test" element={<EmailTestPage />} />

          {/* ë°”í…ë” */}
          <Route path="/bartender/menu" element={<BartenderMenuPage />} />
          <Route path="/bartender/manage" element={<BartenderManagePage />} />
          <Route path="/bartender/orders" element={<BartenderOrderListPage />} />
          </Routes>
        </div>
      </TourProvider>
    </BrowserRouter>
  );
}

export default App;
</file>

<file path="src/components/reservations/WeeklyList.jsx">
import { useState, useEffect, useRef } from 'react';
import { useNavigate } from 'react-router-dom';
import { ChevronLeft, ChevronRight, ChevronDown, Plus, Check, X, Settings2, Share2, GripVertical, User, LogOut, FileText, Shield, UserCog, UserMinus, Wallet, ShieldCheck, List, Calendar, Users, Mars, Venus, Trophy, Utensils } from 'lucide-react';
import { useAuth } from '../../hooks/useAuth';
import { useReservations } from '../../hooks/useReservations';
import useStore from '../../store/useStore';
import spaceService from '../../services/spaceService';
import reservationService from '../../services/reservationService';
import simpleMealService from '../../services/simpleMealService';
import LoginOverlay from '../auth/LoginOverlay';
import Loading from '../common/Loading';
import Modal from '../common/Modal';
import ReservationModal from './ReservationModal';
import CancelReservationModal from './CancelReservationModal';
import ReservationDetailModal from './ReservationDetailModal';
import WeeklyCalendarView from './WeeklyCalendarView';
import SpaceDropdown from '../space/SpaceDropdown';
import CreateSpaceModal from '../space/CreateSpaceModal';
import ReservationManageModal from './ReservationManageModal';
import ReservationEditModal from './ReservationEditModal';
import SimpleMealModal from './SimpleMealModal';
import { formatDate, formatWeekDay, getWeekDates, isToday } from '../../utils/dateUtils';
import { canManageSpace } from '../../utils/permissions';
import { USER_TYPE_LABELS } from '../../utils/constants';

// í† ìŠ¤íŠ¸ ì•Œë¦¼ ì»´í¬ë„ŒíŠ¸
const Toast = ({ message, type = 'success', onClose }) => {
  useEffect(() => {
    const timer = setTimeout(onClose, 3000);
    return () => clearTimeout(timer);
  }, [onClose]);

  return (
    <div className="fixed left-1/2 transform -translate-x-1/2 z-[99999] px-6 py-4 rounded-xl shadow-xl flex items-center gap-3 animate-slideDown max-w-[90vw]"
      style={{
        top: 'max(20px, env(safe-area-inset-top, 20px))',
        background: type === 'success' ? '#10b981' : '#ef4444',
        color: 'white'
      }}
    >
      {type === 'success' ? <Check className="w-5 h-5" /> : <X className="w-5 h-5" />}
      <span className="font-semibold">{message}</span>
    </div>
  );
};

// ë¡œë”© ì˜¤ë²„ë ˆì´
const LoadingOverlay = () => (
  <div className="fixed inset-0 bg-black/50 z-[9998] flex items-center justify-center">
    <div className="bg-white rounded-2xl p-6 flex flex-col items-center gap-4">
      <div className="w-12 h-12 border-4 border-gray-200 border-t-blue-600 rounded-full animate-spin" />
      <div className="text-gray-700 font-semibold">ì˜ˆì•½ ì²˜ë¦¬ ì¤‘...</div>
    </div>
  </div>
);

// ìŠ¤í˜ì´ìŠ¤ ì—†ìŒ ì•ˆë‚´ ì»´í¬ë„ŒíŠ¸
const NoSpaceNotice = ({ onJoinSpace }) => (
  <div className="min-h-screen flex items-center justify-center p-6">
    <div className="max-w-md w-full bg-white rounded-2xl shadow-xl p-8 text-center space-y-6">
      <div className="w-20 h-20 mx-auto bg-blue-100 rounded-full flex items-center justify-center">
        <Settings2 className="w-10 h-10 text-blue-600" />
      </div>
      
      <div className="space-y-2">
        <h2 className="text-2xl font-bold text-gray-900">
          ê°€ì…ëœ ìŠ¤í˜ì´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤
        </h2>
        <p className="text-gray-600">
          ì˜ˆì•½ì„ ê´€ë¦¬í•˜ë ¤ë©´ ë¨¼ì € ìŠ¤í˜ì´ìŠ¤ì— ê°€ì…í•´ì£¼ì„¸ìš”
        </p>
      </div>
      
      <button
        onClick={onJoinSpace}
        className="w-full py-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl font-semibold hover:shadow-lg transition-all hover:scale-105 active:scale-95"
      >
        ìŠ¤í˜ì´ìŠ¤ ê°€ì…í•˜ê¸°
      </button>
      
      <p className="text-sm text-gray-500">
        ì´ˆëŒ€ ì½”ë“œê°€ ìˆë‹¤ë©´ ìŠ¤í˜ì´ìŠ¤ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”
      </p>
    </div>
  </div>
);

const WeeklyList = () => {
  const navigate = useNavigate();
  const { user, isLoggedIn, logout } = useAuth();
  const { selectedSpace, setSelectedSpace, profiles, setReservations } = useStore();
  const hasInitializedSpace = useRef(false);
  
  const [currentWeekStart, setCurrentWeekStart] = useState(() => {
    const today = new Date();
    const day = today.getDay();
    const diff = day === 0 ? -6 : 1 - day;
    const monday = new Date(today);
    monday.setDate(today.getDate() + diff);
    monday.setHours(0, 0, 0, 0);
    return monday;
  });
  
  const [showReservationModal, setShowReservationModal] = useState(false);
  const [showDetailModal, setShowDetailModal] = useState(false);
  const [selectedDateDetail, setSelectedDateDetail] = useState(null);
  const [userSpaces, setUserSpaces] = useState([]);
  const [loading, setLoading] = useState(true);
  const [showDatePicker, setShowDatePicker] = useState(false);
  const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());
  const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth());
  const [toast, setToast] = useState(null);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSpaceDropdown, setShowSpaceDropdown] = useState(false);
  const [draggedSpaceIndex, setDraggedSpaceIndex] = useState(null);
  const [touchStartY, setTouchStartY] = useState(null);
  const [touchCurrentY, setTouchCurrentY] = useState(null);
  const [showProfileMenu, setShowProfileMenu] = useState(false);
  const [showCancelModal, setShowCancelModal] = useState(false);
  const [selectedReservationForCancel, setSelectedReservationForCancel] = useState(null);
  const [showReservationDetailModal, setShowReservationDetailModal] = useState(false);
  const [selectedDateForDetail, setSelectedDateForDetail] = useState(null);
  const [selectedReservationsForDetail, setSelectedReservationsForDetail] = useState([]);
  const [viewMode, setViewMode] = useState('list'); // 'list' | 'calendar'
  const [showManageModal, setShowManageModal] = useState(false);
  const [showEditModal, setShowEditModal] = useState(false);
  const [selectedReservationForManage, setSelectedReservationForManage] = useState(null);
  const [currentDateStrForManage, setCurrentDateStrForManage] = useState(null); // dateStrë¡œ ì €ì¥
  const [mealsByDate, setMealsByDate] = useState({}); // ë‚ ì§œë³„ ì‹ì‚¬ ì°¸ì—¬ì ì •ë³´
  const [showMealModal, setShowMealModal] = useState(false);
  const [selectedDateForMeal, setSelectedDateForMeal] = useState(null);
  const [showCreateSpaceModal, setShowCreateSpaceModal] = useState(false);
  const [isCreatingSpace, setIsCreatingSpace] = useState(false);

  const { reservations: reservationsObj, loading: reservationsLoading, createReservation, cancelReservation, refresh } = useReservations(selectedSpace?.id, currentWeekStart);
  
  // ğŸ†• ìŠ¤í˜ì´ìŠ¤ ë¡œë“œ ë° ì—†ìŒ ì²˜ë¦¬
  useEffect(() => {
    const loadSpaces = async () => {
      if (!user?.id) return;
      
      setLoading(true);
      try {
        const spaces = await spaceService.getUserSpaces(user.id);
        console.log('ğŸ“¦ ì‚¬ìš©ì ìŠ¤í˜ì´ìŠ¤ ë¡œë“œ:', spaces);
        
        setUserSpaces(spaces);
        
        // ìŠ¤í˜ì´ìŠ¤ê°€ ìˆìœ¼ë©´ ë§ˆì§€ë§‰ ì„ íƒ ê³µê°„ ë³µì› ë˜ëŠ” ê¸°ë³¸ê°’ ì„ íƒ
        if (spaces.length > 0 && !hasInitializedSpace.current) {
          // localStorageì—ì„œ ë§ˆì§€ë§‰ ì„ íƒ ê³µê°„ ID ê°€ì ¸ì˜¤ê¸°
          const lastSelectedId = localStorage.getItem('lastSelectedSpaceId');
          console.log('ğŸ’¾ ë§ˆì§€ë§‰ ì„ íƒ ê³µê°„ ID:' , lastSelectedId);
          
          // ë§ˆì§€ë§‰ ì„ íƒ ê³µê°„ì´ í˜„ì¬ ìŠ¤í˜ì´ìŠ¤ ëª©ë¡ì— ìˆëŠ”ì§€ í™•ì¸
          const lastSpace = spaces.find(s => s.id === lastSelectedId);
          
          // ë§ˆì§€ë§‰ ì„ íƒ ê³µê°„ì´ ìˆìœ¼ë©´ ë³µì›, ì—†ìœ¼ë©´ order 0 ë˜ëŠ” ì²« ë²ˆì§¸ ê³µê°„ ì„ íƒ
          const spaceToSelect = lastSpace || spaces.find(s => s.order === 0) || spaces[0];
          
          console.log('âœ… ì„ íƒëœ ê³µê°„:' , spaceToSelect.spaceName, '(ID:' , spaceToSelect.id, ')' );
          setSelectedSpace(spaceToSelect);
          hasInitializedSpace.current = true;
        }
        // ìŠ¤í˜ì´ìŠ¤ê°€ ì—†ìœ¼ë©´ selectedSpaceë¥¼ nullë¡œ ì„¤ì •
        else if (spaces.length === 0) {
          setSelectedSpace(null);
          hasInitializedSpace.current = true;
        }
      } catch (error) {
        console.error('âŒ ìŠ¤í˜ì´ìŠ¤ ë¡œë“œ ì‹¤íŒ¨:', error);
        setToast({ message: 'ìŠ¤í˜ì´ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', type: 'error' });
      } finally {
        setLoading(false);
      }
    };
    
    loadSpaces();
  }, [user, setSelectedSpace]);

  // ì‹ì‚¬ ì°¸ì—¬ì ì •ë³´ ë¡œë“œ í•¨ìˆ˜
  const loadMeals = async () => {
    if (!selectedSpace?.id) return;

    try {
      const weekDates = getWeekDates(currentWeekStart);
      const dateStrings = weekDates.map(date => formatDate(date));

      const mealsData = await simpleMealService.getMealsByDateRange(
        selectedSpace.id,
        dateStrings
      );

      setMealsByDate(mealsData);
    } catch (error) {
      console.error('âŒ ì‹ì‚¬ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
    }
  };

  // ì‹ì‚¬ ì°¸ì—¬ì ì •ë³´ ìë™ ë¡œë“œ
  useEffect(() => {
    loadMeals();
  }, [selectedSpace, currentWeekStart]);

  const prevWeek = () => {
    const newDate = new Date(currentWeekStart);
    newDate.setDate(newDate.getDate() - 7);
    setCurrentWeekStart(newDate);
  };
  
  const nextWeek = () => {
    const newDate = new Date(currentWeekStart);
    newDate.setDate(newDate.getDate() + 7);
    setCurrentWeekStart(newDate);
  };
  
  const thisWeek = () => {
    const today = new Date();
    const day = today.getDay();
    const diff = day === 0 ? -6 : 1 - day;
    const monday = new Date(today);
    monday.setDate(today.getDate() + diff);
    monday.setHours(0, 0, 0, 0);
    setCurrentWeekStart(monday);
  };
  
  const goToSelectedDate = () => {
    const targetDate = new Date(selectedYear, selectedMonth, 1);
    const day = targetDate.getDay();
    const diff = day === 0 ? -6 : 1 - day;
    const monday = new Date(targetDate);
    monday.setDate(targetDate.getDate() + diff);
    monday.setHours(0, 0, 0, 0);
    setCurrentWeekStart(monday);
    setShowDatePicker(false);
  };
  
  // ìŠ¤í˜ì´ìŠ¤ ë“œë˜ê·¸ í•¸ë“¤ëŸ¬
  const handleSpaceDragStart = (e, index) => {
    setDraggedSpaceIndex(index);
    e.dataTransfer.effectAllowed = 'move';
  };

  const handleSpaceDragOver = (e, index) => {
    e.preventDefault();
    if (draggedSpaceIndex === null || draggedSpaceIndex === index) return;

    const newSpaces = [...userSpaces];
    const draggedItem = newSpaces[draggedSpaceIndex];
    newSpaces.splice(draggedSpaceIndex, 1);
    newSpaces.splice(index, 0, draggedItem);

    setUserSpaces(newSpaces);
    setDraggedSpaceIndex(index);
  };

  const handleSpaceDragEnd = async () => {
    if (draggedSpaceIndex !== null) {
      const updatedSpaces = userSpaces.map((space, idx) => ({
        ...space,
        order: idx
      }));
      
      await spaceService.updateSpaceOrder(user.id, updatedSpaces);
      setUserSpaces(updatedSpaces);
    }
    setDraggedSpaceIndex(null);
  };

  // í„°ì¹˜ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
  const handleSpaceTouchStart = (e, index) => {
    const touch = e.touches[0];
    setTouchStartY(touch.clientY);
    setTouchCurrentY(touch.clientY);
    setDraggedSpaceIndex(index);
  };

  const handleSpaceTouchMove = (e) => {
    if (draggedSpaceIndex === null || touchStartY === null) return;
    
    e.preventDefault();
    const touch = e.touches[0];
    setTouchCurrentY(touch.clientY);
    
    const itemHeight = 60;
    const diff = touch.clientY - touchStartY;
    const steps = Math.round(diff / itemHeight);
    
    if (steps !== 0) {
      const newIndex = Math.max(0, Math.min(userSpaces.length - 1, draggedSpaceIndex + steps));
      
      if (newIndex !== draggedSpaceIndex) {
        const newSpaces = [...userSpaces];
        const draggedItem = newSpaces[draggedSpaceIndex];
        newSpaces.splice(draggedSpaceIndex, 1);
        newSpaces.splice(newIndex, 0, draggedItem);
        
        setUserSpaces(newSpaces);
        setDraggedSpaceIndex(newIndex);
        setTouchStartY(touch.clientY);
      }
    }
  };

  const handleSpaceTouchEnd = async () => {
    if (draggedSpaceIndex !== null) {
      const updatedSpaces = userSpaces.map((space, idx) => ({
        ...space,
        order: idx
      }));
      
      await spaceService.updateSpaceOrder(user.id, updatedSpaces);
      setUserSpaces(updatedSpaces);
    }
    
    setDraggedSpaceIndex(null);
    setTouchStartY(null);
    setTouchCurrentY(null);
  };
  
  const handleReservationConfirm = async (reservationData) => {
    setIsSubmitting(true);
    try {
      await createReservation(reservationData);
      setShowReservationModal(false);
      setToast({ message: 'ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤', type: 'success' });
    } catch (error) {
      console.error('âŒ ì˜ˆì•½ ìƒì„± ì‹¤íŒ¨:', error);
      setToast({ message: error.message || 'ì˜ˆì•½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', type: 'error' });
    } finally {
      setIsSubmitting(false);
    }
  };
  
  const handleSpaceChange = (space) => {
    console.log('ğŸ”„ ìŠ¤í˜ì´ìŠ¤ ë³€ê²½:', space);
    setSelectedSpace(space);
    setShowSpaceDropdown(false);
  };
  
  const handleLeaveSpace = async (spaceId) => {
    if (!window.confirm('ì •ë§ë¡œ ì´ ìŠ¤í˜ì´ìŠ¤ë¥¼ ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      return;
    }

    try {
      await spaceService.leaveSpace(user.id, spaceId);

      const updatedSpaces = userSpaces.filter(s => s.id !== spaceId);
      setUserSpaces(updatedSpaces);

      if (selectedSpace?.id === spaceId) {
        if (updatedSpaces.length > 0) {
          setSelectedSpace(updatedSpaces[0]);
        } else {
          setSelectedSpace(null);
        }
      }

      setToast({ message: 'ìŠ¤í˜ì´ìŠ¤ì—ì„œ ë‚˜ê°”ìŠµë‹ˆë‹¤', type: 'success' });
      setShowSpaceDropdown(false);
    } catch (error) {
      console.error('âŒ ìŠ¤í˜ì´ìŠ¤ ë‚˜ê°€ê¸° ì‹¤íŒ¨:', error);
      setToast({ message: 'ìŠ¤í˜ì´ìŠ¤ ë‚˜ê°€ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', type: 'error' });
    }
  };

  // ë°© ìƒì„± ì‹ ì²­ í•¸ë“¤ëŸ¬
  const handleCreateSpaceRequest = async (spaceName) => {
    setIsCreatingSpace(true);
    try {
      const result = await spaceService.requestSpaceCreation(
        user.id,
        user.displayName,
        spaceName
      );

      if (result.success) {
        setToast({
          message: `ë°© ìƒì„± ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! (ì½”ë“œ: ${result.spaceCode})`,
          type: 'success'
        });
        setShowCreateSpaceModal(false);
      }
    } catch (error) {
      console.error('âŒ ë°© ìƒì„± ì‹ ì²­ ì‹¤íŒ¨:', error);
      setToast({
        message: error.message || 'ë°© ìƒì„± ì‹ ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤',
        type: 'error'
      });
    } finally {
      setIsCreatingSpace(false);
    }
  };

  // âœ… ì˜ˆì•½ ì·¨ì†Œ í™•ì •
 const handleCancelConfirm = async (reservation) => {
   if (!cancelReservation) {
     alert('ì˜ˆì•½ ì·¨ì†Œ ê¸°ëŠ¥ì´ ì•„ì§ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
     return;
   }
   setIsSubmitting(true);
   try {
     await cancelReservation(reservation.id);
     setShowCancelModal(false);
     setSelectedReservationForCancel(null);
     setToast({ message: 'ì˜ˆì•½ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤', type: 'success' });
   } catch (error) {
     console.error('âŒ ì˜ˆì•½ ì·¨ì†Œ ì‹¤íŒ¨:', error);
     setToast({ message: error.message || 'ì˜ˆì•½ ì·¨ì†Œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', type: 'error' });
   } finally {
     setIsSubmitting(false);
   }
 };
  
  // ë¡œê·¸ì¸ ì•ˆ ë¨
  if (!isLoggedIn) {
    return <LoginOverlay />;
  }
  
  // ë¡œë”© ì¤‘
  if (loading) {
    return <Loading />;
  }
  
  // ğŸ†• ìŠ¤í˜ì´ìŠ¤ ì—†ìŒ ì²˜ë¦¬
  if (userSpaces.length === 0) {
    return (
      <NoSpaceNotice 
        onJoinSpace={() => navigate('/join')}
      />
    );
  }
  
  const weekDates = getWeekDates(currentWeekStart);
  const weekRange = `${currentWeekStart.getMonth() + 1}/${currentWeekStart.getDate()} - ${new Date(currentWeekStart.getTime() + 6 * 24 * 60 * 60 * 1000).getMonth() + 1}/${new Date(currentWeekStart.getTime() + 6 * 24 * 60 * 60 * 1000).getDate()}`;
  const currentUserType = selectedSpace ? userSpaces.find(s => s.id === selectedSpace.id)?.userType : null;
  const isGuest = currentUserType === 'guest';
  const isManager = canManageSpace(currentUserType);
  
  const years = Array.from({ length: 5 }, (_, i) => new Date().getFullYear() - 2 + i);
  const months = Array.from({ length: 12 }, (_, i) => i);
  
  const currentMonday = (() => {
    const today = new Date();
    const day = today.getDay();
    const diff = day === 0 ? -6 : 1 - day;
    const monday = new Date(today);
    monday.setDate(today.getDate() + diff);
    monday.setHours(0, 0, 0, 0);
    return monday;
  })();
  
  const isCurrentWeek = currentWeekStart.getTime() === currentMonday.getTime();
  
  return (
    <div className="min-h-screen bg-gray-50">
      {/* í—¤ë” - sticky ì¶”ê°€ */}
      <div className="bg-gradient-to-br from-blue-600 to-blue-700 text-white sticky top-0 z-30 shadow-lg">
        <div className="max-w-2xl mx-auto">
          <div className="flex items-center justify-between p-4">
            {/* ì¢Œì¸¡: ìŠ¤í˜ì´ìŠ¤ ì„ íƒ */}
            <div className="relative">
              <SpaceDropdown
                spaces={userSpaces}
                selectedSpace={selectedSpace}
                onSelect={handleSpaceChange}
                onReorder={async (updatedSpaces) => {
                  setUserSpaces(updatedSpaces);
                  await spaceService.updateSpaceOrder(user.id, updatedSpaces);
                }}
                onCreateSpace={() => setShowCreateSpaceModal(true)}
              />
            </div>

            {/* ìš°ì¸¡: í†µê³„ + ë·° ëª¨ë“œ í† ê¸€ + í”„ë¡œí•„ */}
            <div className="flex items-center gap-2">
              {/* í†µê³„ ë²„íŠ¼ */}
              <button
                onClick={() => navigate('/reservation-stats')}
                className="p-2 bg-white/20 rounded-lg hover:bg-white/30 transition-colors"
                title="ì˜ˆì•½ í†µê³„"
              >
                <Trophy className="w-4 h-4 text-white" />
              </button>

              {/* ë·° ëª¨ë“œ í† ê¸€ */}
              <div className="flex items-center bg-white/20 rounded-lg p-1">
                <button
                  onClick={() => setViewMode('list')}
                  className={`p-1.5 rounded transition-colors ${
                    viewMode === 'list'
                      ? 'bg-white text-blue-600'
                      : 'text-white/70 hover:text-white'
                  }`}
                  title="ë¦¬ìŠ¤íŠ¸ ë·°"
                >
                  <List className="w-4 h-4" />
                </button>
                <button
                  onClick={() => setViewMode('calendar')}
                  className={`p-1.5 rounded transition-colors ${
                    viewMode === 'calendar'
                      ? 'bg-white text-blue-600'
                      : 'text-white/70 hover:text-white'
                  }`}
                  title="ë‹¬ë ¥ ë·°"
                >
                  <Calendar className="w-4 h-4" />
                </button>
              </div>

              {/* í”„ë¡œí•„ ë©”ë‰´ */}
              <div className="relative">
                {user?.profileImage && (
                  <>
                    <button
                      onClick={() => setShowProfileMenu(!showProfileMenu)}
                      className="w-9 h-9 rounded-full ring-2 ring-white/30 hover:ring-white/50 transition-all"
                    >
                      <img 
                        src={user.profileImage} 
                        alt={user.name}
                        className="w-full h-full rounded-full object-cover"
                      />
                    </button>

                    {/* í”„ë¡œí•„ ë“œë¡­ë‹¤ìš´ */}
                    {showProfileMenu && (
                      <>
                        <div 
                          className="fixed inset-0 z-40" 
                          onClick={() => setShowProfileMenu(false)}
                        />
                        <div className="absolute top-full right-0 mt-2 bg-white rounded-xl shadow-xl z-50 overflow-hidden min-w-[220px]">
                          {/* ì‚¬ìš©ì ì •ë³´ */}
                          <div className="px-4 py-3 bg-gray-50 border-b border-gray-100">
                            <div className="font-semibold text-gray-900">{user.displayName}</div>
                            <div className="text-xs text-gray-500 mt-0.5">
                              {selectedSpace?.userType && USER_TYPE_LABELS[selectedSpace.userType]}
                            </div>
                          </div>

                          {/* ë©”ë‰´ ì•„ì´í…œ */}
                          <div className="py-2">
                            <button
                              onClick={() => {
                                setShowProfileMenu(false);
                                alert('ê°œì¸ì •ë³´ ìˆ˜ì • ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
                              }}
                              className="w-full px-4 py-3 text-left hover:bg-gray-50 transition-colors text-gray-700 flex items-center gap-3"
                            >
                              <UserCog className="w-5 h-5 text-gray-500" />
                              <span className="font-medium">ê°œì¸ì •ë³´ ìˆ˜ì •</span>
                            </button>

                            <button
                              onClick={() => {
                                setShowProfileMenu(false);
                                navigate('/terms');
                              }}
                              className="w-full px-4 py-3 text-left hover:bg-gray-50 transition-colors text-gray-700 flex items-center gap-3"
                            >
                              <FileText className="w-5 h-5 text-gray-500" />
                              <span className="font-medium">ì´ìš©ì•½ê´€</span>
                            </button>

                            <button
                              onClick={() => {
                                setShowProfileMenu(false);
                                navigate('/privacy');
                              }}
                              className="w-full px-4 py-3 text-left hover:bg-gray-50 transition-colors text-gray-700 flex items-center gap-3"
                            >
                              <Shield className="w-5 h-5 text-gray-500" />
                              <span className="font-medium">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</span>
                            </button>

                            {/* ìŠˆí¼ì–´ë“œë¯¼ ë©”ë‰´ */}
                            {user?.isSuperAdmin && (
                              <>
                                <div className="border-t border-gray-100 my-2"></div>
                                <button
                                  onClick={() => {
                                    setShowProfileMenu(false);
                                    navigate('/super-admin');
                                  }}
                                  className="w-full px-4 py-3 text-left hover:bg-purple-50 transition-colors text-purple-700 flex items-center gap-3"
                                >
                                  <ShieldCheck className="w-5 h-5 text-purple-600" />
                                  <span className="font-medium">ìŠˆí¼ì–´ë“œë¯¼</span>
                                </button>
                              </>
                            )}

                            <div className="border-t border-gray-100 my-2"></div>

                            <button
                              onClick={() => {
                                setShowProfileMenu(false);
                                if (window.confirm('ì •ë§ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                                  logout();
                                  navigate('/');
                                }
                              }}
                              className="w-full px-4 py-3 text-left hover:bg-gray-50 transition-colors text-gray-700 flex items-center gap-3"
                            >
                              <LogOut className="w-5 h-5 text-gray-500" />
                              <span className="font-medium">ë¡œê·¸ì•„ì›ƒ</span>
                            </button>

                            <button
                              onClick={() => {
                                setShowProfileMenu(false);
                                if (window.confirm('ì •ë§ íšŒì› íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ë©° ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                                  alert('íšŒì› íƒˆí‡´ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
                                }
                              }}
                              className="w-full px-4 py-3 text-left hover:bg-red-50 transition-colors text-red-600 flex items-center gap-3"
                            >
                              <UserMinus className="w-5 h-5" />
                              <span className="font-medium">íšŒì› íƒˆí‡´</span>
                            </button>
                          </div>
                        </div>
                      </>
                    )}
                  </>
                )}
              </div>
            </div>
          </div>

          {/* ì£¼ê°„ ë„¤ë¹„ê²Œì´ì…˜ (ë¦¬ìŠ¤íŠ¸ ë·°ì—ë§Œ í‘œì‹œ) */}
          {viewMode === 'list' && (
            <div className="flex items-center justify-center gap-2 px-4 pb-4">
              <button onClick={prevWeek} className="px-3 py-2 rounded-full bg-white/20 hover:bg-white/30">
                <ChevronLeft className="w-5 h-5" />
              </button>
              <button
                onClick={() => setShowDatePicker(true)}
                className="px-4 py-2 rounded-full bg-white text-blue-600 font-semibold"
              >
                ğŸ“… {weekRange}
              </button>
              <button onClick={nextWeek} className="px-3 py-2 rounded-full bg-white/20 hover:bg-white/30">
                <ChevronRight className="w-5 h-5" />
              </button>
              <button onClick={thisWeek} className="px-3 py-2 rounded-full bg-white/20 hover:bg-white/30 text-sm font-semibold">
                ì˜¤ëŠ˜
              </button>
            </div>
          )}
        </div>
      </div>
      
      {/* ë‹¬ë ¥ ë·° */}
      {viewMode === 'calendar' && (
        <div className="pb-24 pt-4">
          <WeeklyCalendarView
            currentWeekStart={currentWeekStart}
            reservationsObj={reservationsObj}
            profiles={profiles}
            user={user}
            onDateClick={(date, reservations) => {
              setSelectedDateForDetail(date);
              setSelectedReservationsForDetail(reservations);
              setShowReservationDetailModal(true);
            }}
            onPrevWeek={prevWeek}
            onNextWeek={nextWeek}
            onThisWeek={thisWeek}
          />
        </div>
      )}

      {/* ë¦¬ìŠ¤íŠ¸ ë·° */}
      {viewMode === 'list' && (
        <div className="max-w-2xl mx-auto p-4 pb-24">
        {weekDates.map((date, dateIndex) => {
          const dateStr = formatDate(date);
          const isCurrentDay = isToday(date);

          console.log(`ğŸ—“ï¸ [WeeklyList] ì¹´ë“œ ë Œë”ë§ [${dateIndex}]:`, {
            dateStr,
            date: date.toISOString(),
            dateObject: date
          });

          // ë‚ ì§œë³„ ì˜ˆì•½ ê°€ì ¸ì˜¤ê¸° (ê°ì²´ì—ì„œ ì§ì ‘ ì ‘ê·¼)
          const dateReservations = reservationsObj[dateStr] || [];
          
          // ğŸ” ë””ë²„ê¹…: ì˜ˆì•½ ë°ì´í„° í™•ì¸
          console.log(`ğŸ“… ${dateStr} (${formatWeekDay(date)}) ë””ë²„ê¹…:`, {
            dateReservations: dateReservations.length,
            allReservations: dateReservations.map(r => ({
              id: r.id,
              userId: r.userId,
              userIdType: typeof r.userId,
              name: r.name,
              type: r.type
            })),
            currentUserId: user.id,
            currentUserIdType: typeof user.id,
            isGuest: isGuest
          });
          
          // ê²ŒìŠ¤íŠ¸ëŠ” ë³¸ì¸ ì˜ˆì•½ë§Œ ìƒì„¸ì •ë³´ í‘œì‹œ
          const myReservations = dateReservations.filter(r => {
            const match = String(r.userId) === String(user.id);
            console.log(`  ğŸ” ì˜ˆì•½ ${r.id}: userId=${r.userId}, match=${match}`);
            return match;
          }).map(r => ({
            ...r,
            isCheckIn: formatDate(r.checkIn) === dateStr,
            hostDisplayName: profiles[r.hostId]?.displayName || r.hostId
          }));
          
          console.log(`  âœ… ë‚´ ì˜ˆì•½: ${myReservations.length}ê°œ`);
          
          // í†µê³„ìš© ì „ì²´ ì˜ˆì•½ (ê²ŒìŠ¤íŠ¸ë„ ì´ ì¸ì›ìˆ˜ëŠ” ë´ì•¼ í•¨)
          const allReservations = dateReservations.map(r => ({
            ...r,
            isCheckIn: formatDate(new Date(r.checkIn)) === dateStr,
            hostDisplayName: profiles[r.hostId]?.displayName || r.hostId
          }));
          
          const memberTypes = ['shareholder', 'manager', 'vice-manager'];
          const stats = allReservations.reduce((acc, r) => {
            const isMember = memberTypes.includes(r.type);
            const isDayTrip = r.nights === 0 || r.isDayTrip;

            if (isMember) {
              isDayTrip ? acc.memberDayTrip++ : acc.weekdayCount++;
            } else {
              isDayTrip ? acc.guestDayTrip++ : acc.guestCount++;
            }
            return acc;
          }, { weekdayCount: 0, guestCount: 0, memberDayTrip: 0, guestDayTrip: 0 });
          
          return (
            <details 
              key={dateStr}
              className="mb-3 bg-white rounded-xl border shadow-sm overflow-hidden transition-all"
              style={{
                borderColor: isCurrentDay ? '#3b82f6' : '#e5e7eb',
                borderWidth: isCurrentDay ? '2px' : '1px'
              }}
              open={isCurrentDay || allReservations.length > 0}
            >
              <summary className="p-4 cursor-pointer hover:bg-gray-50 flex items-center justify-between">
                {/* ë‚ ì§œ */}
                <div className="flex items-center gap-2">
                  {isCurrentDay && <span className="text-blue-600">ğŸ“</span>}
                  <span className="font-bold text-gray-900">
                    {date.getMonth() + 1}ì›” {date.getDate()}ì¼
                  </span>
                  <span className={`text-sm ${
                    formatWeekDay(date) === 'ì¼' ? 'text-red-500' :
                    formatWeekDay(date) === 'í† ' ? 'text-blue-500' :
                    'text-gray-500'
                  }`}>
                    ({formatWeekDay(date)})
                  </span>
                  {/* í¬í¬ ì•„ì´ì½˜ (ì‹ì‚¬ ì—´ê¸°) */}
                  <div className="relative meal-check-button">
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        setSelectedDateForMeal(date);
                        setShowMealModal(true);
                      }}
                      className="p-1.5 hover:bg-orange-100 rounded-lg transition-colors"
                      title="ë°¥ ë³´ê¸°"
                    >
                      <Utensils className="w-4 h-4 text-orange-600" />
                    </button>
                    {/* ë³¸ì¸ ì‹ì‚¬ ìƒíƒœ í‘œì‹œ */}
                    {(() => {
                      const dateMeals = mealsByDate[dateStr] || { lunch: [], dinner: [] };
                      const myLunch = dateMeals.lunch.includes(user.id);
                      const myDinner = dateMeals.dinner.includes(user.id);
                      const hasMyMeal = myLunch || myDinner;

                      if (!hasMyMeal) return null;

                      return (
                        <div className="absolute -top-0.5 -right-0.5 flex gap-0.5">
                          {myLunch && (
                            <div className="w-1.5 h-1.5 rounded-full bg-green-500 border border-white" title="ì ì‹¬" />
                          )}
                          {myDinner && (
                            <div className="w-1.5 h-1.5 rounded-full bg-orange-500 border border-white" title="ì €ë…" />
                          )}
                        </div>
                      );
                    })()}
                  </div>
                  {/* ê²ŒìŠ¤íŠ¸ìš© ì²´í¬ì¸/ì²´í¬ì•„ì›ƒ í‘œì‹œ */}
                  {isGuest && myReservations.length > 0 && myReservations.map(r => {
                    const isCheckInDay = formatDate(r.checkIn) === dateStr;
                    const isCheckOutDay = formatDate(r.checkOut) === dateStr;
                    if (isCheckInDay) {
                      return <span key={r.id} className="text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full font-semibold ml-1">ì²´í¬ì¸</span>;
                    } else if (isCheckOutDay) {
                      return <span key={r.id} className="text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded-full font-semibold ml-1">ì²´í¬ì•„ì›ƒ</span>;
                    }
                    return null;
                  })}
                </div>
                
                {/* ì¸ì›ìˆ˜ */}
                <div className="flex items-center justify-end gap-3">
                  {allReservations.length > 0 ? (
                    <>
                      <div className="flex flex-col gap-1 items-end">
                        <div className="text-sm text-gray-600">
                          ê²ŒìŠ¤íŠ¸ {stats.guestCount} / ë‹¹ì¼ {stats.memberDayTrip + stats.guestDayTrip}
                        </div>
                        <div className="text-xs text-gray-500 flex items-center gap-1.5">
                          <span className="flex items-center gap-0.5 text-blue-600">
                            <Mars className="w-3 h-3" />
                            {allReservations.filter(r => profiles[r.userId]?.gender === 'male').length}
                          </span>
                          <span>/</span>
                          <span className="flex items-center gap-0.5 text-pink-600">
                            <Venus className="w-3 h-3" />
                            {allReservations.filter(r => profiles[r.userId]?.gender === 'female').length}
                          </span>
                        </div>
                      </div>
                      <div className="text-2xl font-bold text-gray-900">
                        {allReservations.filter(r => !r.isDayTrip && r.nights !== 0).length}
                      </div>
                    </>
                  ) : (
                    <div className="text-sm text-gray-400">ì˜ˆì•½ ì—†ìŒ</div>
                  )}
                </div>
              </summary>
              
              {/* í¼ì³¤ì„ ë•Œ */}
              <div className="px-4 pb-4 border-t bg-gray-50">
                {isGuest ? (
                  // ê²ŒìŠ¤íŠ¸: ë³¸ì¸ í”„ë¡œí•„ë§Œ í‘œì‹œ + ì „ì²´ ë³´ê¸° ë²„íŠ¼
                  <div className="pt-3 space-y-2">
                    {myReservations.length > 0 ? (
                      <div className="flex items-center gap-2 flex-wrap">
                        {myReservations.filter(r => !r.isDayTrip && r.nights !== 0).map((reservation) => {
                          const profile = profiles[reservation.userId];
                          const isMine = String(reservation.userId) === String(user.id);
                          const ringColor = profile?.gender === 'female' ? 'ring-pink-500' : 'ring-blue-500';
                          const bgColor = profile?.gender === 'female' ? 'bg-pink-500' : 'bg-blue-500';

                          return (
                            <div key={reservation.id} className="relative group">
                              {profile?.profileImage ? (
                                <div className="relative">
                                  <img
                                    src={profile.profileImage}
                                    alt={reservation.name}
                                    className={`w-12 h-12 rounded-full object-cover ring-2 ${ringColor} ${isMine ? 'cursor-pointer' : ''}`}
                                    onClick={() => {
                                      if (!isMine) return;
                                      console.log('ğŸ“… í”„ë¡œí•„ í´ë¦­ (ì´ë¯¸ì§€ ìˆìŒ):', {
                                        dateStr,
                                        reservationId: reservation.id
                                      });
                                      setSelectedReservationForManage(reservation);
                                      setCurrentDateStrForManage(dateStr);
                                      setShowManageModal(true);
                                    }}
                                  />
                                  {/* ë‚´ ì˜ˆì•½ ë°°ì§€ */}
                                  {isMine && (
                                    <div className="absolute bottom-0 left-0 w-4 h-4 bg-green-500 rounded-full flex items-center justify-center ring-2 ring-white">
                                      <Check className="w-2.5 h-2.5 text-white" strokeWidth={3} />
                                    </div>
                                  )}
                                </div>
                              ) : (
                                <div className="relative">
                                  <div
                                    className={`w-12 h-12 rounded-full flex items-center justify-center text-white font-bold ring-2 ${ringColor} ${bgColor} ${isMine ? 'cursor-pointer' : ''}`}
                                    onClick={() => {
                                      if (!isMine) return;
                                      console.log('ğŸ“… í”„ë¡œí•„ í´ë¦­ (ì´ë¯¸ì§€ ì—†ìŒ):', {
                                        dateStr,
                                        reservationId: reservation.id
                                      });
                                      setSelectedReservationForManage(reservation);
                                      setCurrentDateStrForManage(dateStr);
                                      setShowManageModal(true);
                                    }}
                                  >
                                    {reservation.name?.[0]}
                                  </div>
                                  {/* ë‚´ ì˜ˆì•½ ë°°ì§€ */}
                                  {isMine && (
                                    <div className="absolute bottom-0 left-0 w-4 h-4 bg-green-500 rounded-full flex items-center justify-center ring-2 ring-white">
                                      <Check className="w-2.5 h-2.5 text-white" strokeWidth={3} />
                                    </div>
                                  )}
                                </div>
                              )}
                              {/* í˜¸ë²„ì‹œ ì´ë¦„ + ì´ˆëŒ€ì í‘œì‹œ */}
                              <div className="absolute bottom-full left-0 mb-2 px-2 py-1 bg-gray-900 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 whitespace-nowrap">
                                <div>{reservation.name}</div>
                                {reservation.hostDisplayName && (
                                  <div className="text-[10px] text-gray-300">
                                    {profiles[reservation.hostId]?.displayName || reservation.hostDisplayName} ì´ˆëŒ€
                                  </div>
                                )}
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    ) : (
                      <div className="py-4 text-center text-gray-400 text-sm">
                        ë‚´ ì˜ˆì•½ ì—†ìŒ
                      </div>
                    )}

                    {/* ì „ì²´ ì˜ˆì•½ì ë³´ê¸° ë²„íŠ¼ */}
                    {allReservations.length > 0 && (() => {
                      const regularCount = allReservations.filter(r => !r.isDayTrip && r.nights !== 0).length;
                      const dayTripCount = allReservations.filter(r => r.isDayTrip || r.nights === 0).length;
                      return (
                        <button
                          onClick={() => {
                            setSelectedDateForDetail(date);
                            setSelectedReservationsForDetail(allReservations);
                            setShowReservationDetailModal(true);
                          }}
                          className="w-full py-1.5 px-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-1.5"
                        >
                          <Users className="w-3.5 h-3.5" />
                          ì „ì²´ë³´ê¸° ({regularCount}{dayTripCount > 0 ? `+${dayTripCount}` : ''})
                        </button>
                      );
                    })()}
                  </div>
                ) : (
                  // ì£¼ì£¼: ì „ì²´ ì˜ˆì•½ (í”„ë¡œí•„ ì‚¬ì§„ ìµœëŒ€ 5ê°œ + ë”ë³´ê¸°)
                  allReservations.length > 0 ? (
                    <div className="pt-3 space-y-2">
                      {/* í”„ë¡œí•„ ì‚¬ì§„ ê°€ë¡œ ë‚˜ì—´ (ìµœëŒ€ 5ê°œ, ë‚´ í”„ë¡œí•„ ìš°ì„ ) */}
                      <div className="flex items-center gap-2">
                        {/* ë‚´ ì˜ˆì•½ ìš°ì„  ì •ë ¬, ë‹¹ì¼ì¹˜ê¸° ì œì™¸ */}
                        {[...allReservations].filter(r => !r.isDayTrip && r.nights !== 0).sort((a, b) => {
                          const aIsMine = String(a.userId) === String(user.id);
                          const bIsMine = String(b.userId) === String(user.id);
                          if (aIsMine && !bIsMine) return -1;
                          if (!aIsMine && bIsMine) return 1;
                          return 0;
                        }).slice(0, 5).map((reservation) => {
                          const profile = profiles[reservation.userId];
                          const memberTypes = ['shareholder', 'manager', 'vice-manager'];
                          const isMember = memberTypes.includes(reservation.type);
                          const isMine = String(reservation.userId) === String(user.id);
                          const ringColor = profile?.gender === 'female' ? 'ring-pink-500' : 'ring-blue-500';
                          const bgColor = profile?.gender === 'female' ? 'bg-pink-500' : 'bg-blue-500';

                          return (
                            <div key={reservation.id} className="relative group">
                              {profile?.profileImage ? (
                                <div className="relative">
                                  <img
                                    src={profile.profileImage}
                                    alt={reservation.name}
                                    className={`w-12 h-12 rounded-full object-cover ring-2 ${ringColor} ${isMine ? 'cursor-pointer' : ''}`}
                                    onClick={() => {
                                      if (!isMine) return;
                                      console.log('ğŸ“… í”„ë¡œí•„ í´ë¦­ (ìº˜ë¦°ë” ë·°, ì´ë¯¸ì§€ ìˆìŒ):', {
                                        dateStr,
                                        reservationId: reservation.id
                                      });
                                      setSelectedReservationForManage(reservation);
                                      setCurrentDateStrForManage(dateStr);
                                      setShowManageModal(true);
                                    }}
                                  />
                                  {/* ë‚´ ì˜ˆì•½ ë°°ì§€ */}
                                  {isMine && (
                                    <div className="absolute bottom-0 left-0 w-4 h-4 bg-green-500 rounded-full flex items-center justify-center ring-2 ring-white">
                                      <Check className="w-2.5 h-2.5 text-white" strokeWidth={3} />
                                    </div>
                                  )}
                                </div>
                              ) : (
                                <div className="relative">
                                  <div
                                    className={`w-12 h-12 rounded-full flex items-center justify-center text-white font-bold ring-2 ${ringColor} ${bgColor} ${isMine ? 'cursor-pointer' : ''}`}
                                    onClick={() => {
                                      if (!isMine) return;
                                      console.log('ğŸ“… í”„ë¡œí•„ í´ë¦­ (ìº˜ë¦°ë” ë·°, ì´ë¯¸ì§€ ì—†ìŒ):', {
                                        dateStr,
                                        reservationId: reservation.id
                                      });
                                      setSelectedReservationForManage(reservation);
                                      setCurrentDateStrForManage(dateStr);
                                      setShowManageModal(true);
                                    }}
                                  >
                                    {reservation.name?.[0]}
                                  </div>
                                  {/* ë‚´ ì˜ˆì•½ ë°°ì§€ */}
                                  {isMine && (
                                    <div className="absolute bottom-0 left-0 w-4 h-4 bg-green-500 rounded-full flex items-center justify-center ring-2 ring-white">
                                      <Check className="w-2.5 h-2.5 text-white" strokeWidth={3} />
                                    </div>
                                  )}
                                </div>
                              )}
                              {/* í˜¸ë²„ì‹œ ì´ë¦„ + ì´ˆëŒ€ì í‘œì‹œ */}
                              <div className="absolute bottom-full left-0 mb-2 px-2 py-1 bg-gray-900 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 whitespace-nowrap">
                                <div>{reservation.name}</div>
                                {!isMember && reservation.hostDisplayName && (
                                  <div className="text-[10px] text-gray-300">
                                    {reservation.hostDisplayName} ì´ˆëŒ€
                                  </div>
                                )}
                              </div>
                            </div>
                          );
                        })}

                        {/* ë”ë³´ê¸° ë²„íŠ¼ */}
                        {(() => {
                          const regularReservations = allReservations.filter(r => !r.isDayTrip && r.nights !== 0);
                          const remainingRegular = Math.max(0, regularReservations.length - 5);

                          return remainingRegular > 0 ? (
                            <button
                              onClick={() => {
                                setSelectedDateForDetail(date);
                                setSelectedReservationsForDetail(allReservations);
                                setShowReservationDetailModal(true);
                              }}
                              className="w-12 h-12 rounded-full bg-gray-200 hover:bg-gray-300 flex items-center justify-center text-gray-700 font-bold text-sm transition-colors"
                            >
                              +{remainingRegular}
                            </button>
                          ) : null;
                        })()}
                      </div>

                      {/* ì „ì²´ ë³´ê¸° ë²„íŠ¼ (í•­ìƒ í‘œì‹œ) */}
                      {(() => {
                        const regularCount = allReservations.filter(r => !r.isDayTrip && r.nights !== 0).length;
                        const dayTripCount = allReservations.filter(r => r.isDayTrip || r.nights === 0).length;
                        return (
                          <button
                            onClick={() => {
                              setSelectedDateForDetail(date);
                              setSelectedReservationsForDetail(allReservations);
                              setShowReservationDetailModal(true);
                            }}
                            className="w-full py-1.5 px-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-1.5"
                          >
                            <Users className="w-3.5 h-3.5" />
                            ì „ì²´ë³´ê¸° ({regularCount}{dayTripCount > 0 ? `+${dayTripCount}` : ''})
                          </button>
                        );
                      })()}
                    </div>
                  ) : (
                    <div className="py-4 text-center text-gray-400 text-sm">
                      ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤
                    </div>
                  )
                )}
              </div>
            </details>
          );
        })}
        </div>
      )}
      
      {/* ë‚ ì§œ ì„ íƒ ëª¨ë‹¬ */}
      <Modal isOpen={showDatePicker} onClose={() => setShowDatePicker(false)} title="ë‚ ì§œ ì„ íƒ">
        <div className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">ë…„ë„</label>
            <select
              value={selectedYear}
              onChange={(e) => setSelectedYear(Number(e.target.value))}
              className="w-full px-3 py-2 border border-gray-300 rounded-lg"
            >
              {years.map(year => (
                <option key={year} value={year}>{year}ë…„</option>
              ))}
            </select>
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">ì›”</label>
            <select
              value={selectedMonth}
              onChange={(e) => setSelectedMonth(Number(e.target.value))}
              className="w-full px-3 py-2 border border-gray-300 rounded-lg"
            >
              {months.map(month => (
                <option key={month} value={month}>{month + 1}ì›”</option>
              ))}
            </select>
          </div>
          <div className="flex gap-2 pt-4">
            <button
              onClick={() => setShowDatePicker(false)}
              className="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50"
            >
              ì·¨ì†Œ
            </button>
            <button
              onClick={goToSelectedDate}
              className="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
            >
              ì´ë™
            </button>
          </div>
        </div>
      </Modal>
      
      {/* ì˜ˆì•½ ì¶”ê°€ ëª¨ë‹¬ */}
      <ReservationModal
        isOpen={showReservationModal}
        onClose={() => setShowReservationModal(false)}
        onConfirm={handleReservationConfirm}
        spaceId={selectedSpace?.id}
        existingReservations={Object.values(reservationsObj || {}).flat()}
        user={user}
        selectedSpace={selectedSpace}
      />
      {/* âœ… ì˜ˆì•½ ì·¨ì†Œ ëª¨ë‹¬ */}
 <CancelReservationModal
   isOpen={showCancelModal}
   onClose={() => {
     setShowCancelModal(false);
     setSelectedReservationForCancel(null);
   }}
   reservation={selectedReservationForCancel}
   onConfirm={handleCancelConfirm}
 />

      {/* ì˜ˆì•½ ê´€ë¦¬ ëª¨ë‹¬ */}
      <ReservationManageModal
        isOpen={showManageModal}
        onClose={() => {
          setShowManageModal(false);
          setSelectedReservationForManage(null);
          setCurrentDateStrForManage(null);
        }}
        reservation={selectedReservationForManage}
        currentDateStr={currentDateStrForManage}
        spaceId={selectedSpace?.id}
        onRefresh={async () => {
          await refresh();
          // ì‹ì‚¬ ì°¸ì—¬ì ì •ë³´ë„ ë‹¤ì‹œ ë¡œë“œ
          await loadMeals();
        }}
        onEdit={(reservation) => {
          console.log('ğŸ“ [WeeklyList] ì˜ˆì•½ ìˆ˜ì • ë²„íŠ¼ í´ë¦­:', {
            reservation,
            currentDateStrForManage
          });
          // ManageModalì„ ë¨¼ì € ë‹«ê³  EditModal ì—´ê¸°
          setShowManageModal(false);
          setSelectedReservationForManage(reservation);
          setShowEditModal(true);
        }}
        onCancel={(reservation) => {
          setSelectedReservationForCancel(reservation);
          setShowCancelModal(true);
        }}
        showToast={setToast}
      />

      {/* ì˜ˆì•½ ìˆ˜ì • ëª¨ë‹¬ */}
      <ReservationEditModal
        isOpen={showEditModal}
        onClose={() => {
          setShowEditModal(false);
        }}
        reservation={selectedReservationForManage}
        existingReservations={reservationsObj}
        onConfirm={async (updateData) => {
          try {
            await reservationService.updateReservation(
              selectedSpace.id,
              selectedReservationForManage.id,
              updateData
            );

            await refresh();
            setToast({ message: 'ì˜ˆì•½ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤', type: 'success' });
            setShowEditModal(false);
            setShowManageModal(false);
          } catch (error) {
            console.error('ì˜ˆì•½ ìˆ˜ì • ì‹¤íŒ¨:', error);
            setToast({ message: 'ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', type: 'error' });
          }
        }}
      />

      {/* ì˜ˆì•½ì ìƒì„¸ ëª¨ë‹¬ */}
      <ReservationDetailModal
        isOpen={showReservationDetailModal}
        onClose={() => {
          setShowReservationDetailModal(false);
          setSelectedDateForDetail(null);
          setSelectedReservationsForDetail([]);
        }}
        date={selectedDateForDetail}
        reservations={selectedReservationsForDetail}
        profiles={profiles}
        user={user}
        onProfileClick={(reservation, clickedDate) => {
          console.log('ğŸ‘¤ [WeeklyList] ìƒì„¸ ëª¨ë‹¬ì—ì„œ ë³¸ì¸ í”„ë¡œí•„ í´ë¦­:', {
            reservation,
            clickedDate,
            dateStr: formatDate(clickedDate)
          });
          // ìƒì„¸ ëª¨ë‹¬ ë‹«ê³  ì˜ˆì•½ê´€ë¦¬ ëª¨ë‹¬ ì—´ê¸°
          setShowReservationDetailModal(false);
          setSelectedReservationForManage(reservation);
          setCurrentDateStrForManage(formatDate(clickedDate));
          setShowManageModal(true);
        }}
      />
      
      {/* í† ìŠ¤íŠ¸ */}
      {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}
      
      {/* ë¡œë”© */}
      {isSubmitting && <LoadingOverlay />}
      
      {/* í”Œë¡œíŒ… ì˜ˆì•½ ì¶”ê°€ ë²„íŠ¼ */}
      {!showReservationModal && !showDatePicker && (
        <button
          onClick={() => setShowReservationModal(true)}
          className="fixed bottom-6 right-6 z-40 px-5 py-3 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full shadow-lg flex items-center gap-2 text-white hover:shadow-xl transition-all hover:scale-105 active:scale-95"
          style={{ 
            bottom: 'calc(5rem + env(safe-area-inset-bottom))',
            right: 'max(24px, env(safe-area-inset-right))'
          }}
        >
          <Plus className="w-5 h-5" />
          <span className="font-semibold">ì˜ˆì•½í•˜ê¸°</span>
        </button>
      )}

      {/* ì‹ì‚¬ ëª¨ë‹¬ */}
      <SimpleMealModal
        isOpen={showMealModal}
        onClose={() => {
          setShowMealModal(false);
          setSelectedDateForMeal(null);
          loadMeals(); // ì‹ì‚¬ ì •ë³´ ìƒˆë¡œê³ ì¹¨
        }}
        date={selectedDateForMeal}
        spaceId={selectedSpace?.id}
        currentUser={user}
        profiles={profiles}
      />

      {/* ë°© ìƒì„± ì‹ ì²­ ëª¨ë‹¬ */}
      <CreateSpaceModal
        isOpen={showCreateSpaceModal}
        onClose={() => setShowCreateSpaceModal(false)}
        onSubmit={handleCreateSpaceRequest}
        isLoading={isCreatingSpace}
      />
    </div>
  );
};

export default WeeklyList;
</file>

</files>
